<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Web Admin - Hệ thống Quản lý Thu gom rác (GRAC)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }
        
        /* Modal scroll fixes for mobile */
        #payment-modal {
            -webkit-overflow-scrolling: touch;
            overscroll-behavior: contain;
        }
        
        #payment-modal .bg-white {
            -webkit-overflow-scrolling: touch;
            overscroll-behavior: contain;
        }
        
        /* Prevent body scroll when modal is open */
        body.modal-open {
            overflow: hidden !important;
            position: fixed !important;
            width: 100% !important;
        }
        .sidebar-icon {
            width: 20px;
            height: 20px;
        }
        .role-button.active {
            background-color: #2563eb;
            color: white;
        }
        
        .role-button {
            font-weight: 500;
            min-height: 44px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            white-space: nowrap;
        }
        
        .role-button:hover {
            transform: translateY(-1px);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }
        
        /* Role Selection Panel Styles */
        #role-selection-panel {
            transition: all 0.3s ease-in-out;
            border: 1px solid #e5e7eb;
        }
        
        #role-selection-panel.collapsed {
            padding: 0 !important;
            border: none !important;
            box-shadow: none !important;
        }
        
        #role-toggle-container {
            transition: margin-bottom 0.3s ease-in-out;
        }
        
        #role-toggle-btn {
            transition: all 0.3s ease-in-out;
        }
        
        #role-toggle-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(37, 99, 235, 0.15);
        }
        
        #role-toggle-icon {
            transition: transform 0.3s ease-in-out;
        }
        
        /* Responsive role selection */
        @media (max-width: 768px) {
            .mb-4.flex.justify-between.items-center {
                flex-direction: column;
                gap: 12px;
                align-items: stretch;
            }
            
            .mb-4.flex.justify-between.items-center .text-sm {
                text-align: center;
            }
            
            #role-toggle-btn {
                width: 100%;
                justify-content: center;
            }
            
            #role-selection-panel .flex.flex-wrap.gap-2 {
                justify-content: center;
            }
            
            #role-selection-panel .role-button {
                flex: 1;
                min-width: 140px;
                text-align: center;
                padding: 12px 16px;
                font-size: 14px;
            }
            
            #role-selection-panel .flex.flex-wrap.gap-3 {
                gap: 8px !important;
            }
        }
        .status-tab {
            transition: all 0.2s ease-in-out;
        }
        .status-tab.active {
            color: #2563eb;
            border-bottom-width: 2px;
            border-color: #2563eb;
        }
        .detail-tab.active {
            border-color: #2563eb;
            color: #2563eb;
            background-color: #eff6ff;
        }
        .status-tag {
            padding: 2px 8px;
            border-radius: 9999px;
            font-size: 0.75rem;
            font-weight: 500;
            white-space: nowrap;
        }
        .dropdown:hover .dropdown-menu {
            display: block;
        }
        
        /* Improve clickable areas */
        .view-customer-detail {
            cursor: pointer;
            padding: 4px 8px;
            border-radius: 4px;
            transition: background-color 0.2s;
        }
        
        .view-customer-detail:hover {
            background-color: #f3f4f6;
        }
        
        /* Sidebar toggle functionality */
        #sidebar-container {
            transition: width 0.3s ease;
        }
        
        #sidebar-container.collapsed {
            width: 64px;
        }
        
        #sidebar-container.collapsed .sidebar-text {
            display: none;
        }
        
        #sidebar-container.collapsed .sidebar-icon {
            margin-right: 0;
        }
        
        #sidebar-container.collapsed .web-nav-link {
            justify-content: center;
            padding: 12px 8px;
        }
        
        #sidebar-container.collapsed .web-nav-link:hover {
            background-color: #f3f4f6;
        }
        
        #sidebar-container.collapsed .web-nav-link.active {
            background-color: #dbeafe;
        }
        
        /* Mobile responsive */
        @media (max-width: 768px) {
            #sidebar-container {
                display: none;
            }
            
            .main-content {
                margin-left: 0;
            }
            
            /* Fix container padding for mobile */
            .container {
                padding: 0;
            }
            
            /* Fix main content padding for mobile */
            main {
                padding: 8px !important;
            }
            
            /* Ensure mobile cards have proper width */
            .mobile-card-view {
                width: 100%;
                max-width: 100%;
                padding: 0;
                margin: 0;
            }
            
            /* Reduce padding for content containers on mobile */
            .bg-white.p-6.rounded-lg.shadow-sm {
                padding: 12px !important;
            }
            
            /* Fix mobile container */
            .mobile-container {
                border-radius: 0;
                height: 100vh;
            }
            
            /* Fix flex container on mobile */
            .flex-1 {
                min-width: 0;
                overflow-x: hidden;
            }
            
            /* Fix button groups on mobile */
            .flex.space-x-2 {
                flex-wrap: wrap;
                gap: 8px;
            }
            
            /* Make buttons smaller on mobile */
            .flex.space-x-2 button {
                font-size: 14px;
                padding: 8px 12px;
                white-space: nowrap;
            }
            
            /* Mobile responsive pagination */
            .pagination-container {
                flex-direction: column;
                gap: 1rem;
                align-items: center;
            }
            
            .pagination-controls {
                justify-content: center;
                flex-wrap: wrap;
            }
            
            .pagination-button {
                min-width: 40px;
                height: 40px;
                display: flex;
                align-items: center;
                justify-content: center;
            }
            
            /* Fix page headers on mobile */
            .flex.justify-between.items-center {
                flex-direction: column;
                align-items: stretch;
                gap: 16px;
            }
            
            .flex.justify-between.items-center h2 {
                margin: 0;
                text-align: center;
            }
            
            .flex.justify-between.items-center .flex.space-x-2 {
                justify-content: center;
                width: 100%;
            }
            
            /* Fix search form on mobile */
            .grid.grid-cols-1.md\:grid-cols-2.lg\:grid-cols-4 {
                grid-template-columns: 1fr;
                gap: 12px;
            }
            
            /* Improve mobile layout for customer list */
            #customers-content .bg-white {
                padding: 16px;
            }
            
            #customers-content .flex.justify-between.items-center {
                flex-direction: column;
                align-items: stretch;
                gap: 12px;
            }
            
            #customers-content .flex.justify-between.items-center h2 {
                text-align: center;
                margin: 0;
            }
            
            #customers-content .flex.justify-between.items-center .flex.space-x-2 {
                justify-content: center;
                flex-wrap: wrap;
                gap: 8px;
            }
            
            #customers-content .flex.justify-between.items-center .flex.space-x-2 button {
                flex: 1;
                min-width: 120px;
                justify-content: center;
            }
            
            /* Fix status tabs on mobile */
            .flex.border-b.border-gray-200 {
                flex-wrap: wrap;
                gap: 8px;
                border-bottom: none;
                padding-bottom: 16px;
            }
            
            .status-tab {
                flex: 1;
                min-width: 0;
                text-align: center;
                white-space: nowrap;
                border-bottom: 2px solid transparent;
                transition: all 0.2s ease;
            }
            
            .status-tab.active {
                border-bottom-color: #2563eb;
                color: #2563eb;
            }
            
            .status-tab.active span {
                background-color: #dbeafe !important;
                color: #1d4ed8 !important;
            }
            
            /* Status tab colors for different states */
            .status-tab.status-active {
                color: #059669;
            }
            
            .status-tab.status-active:hover {
                color: #047857;
            }
            
            .status-tab.status-active span {
                background-color: #d1fae5 !important;
                color: #065f46 !important;
            }
            
            .status-tab.status-inactive {
                color: #6b7280;
            }
            
            .status-tab.status-inactive:hover {
                color: #4b5563;
            }
            
            .status-tab.status-inactive span {
                background-color: #f3f4f6 !important;
                color: #374151 !important;
            }
            
            /* Additional status tab colors for invoices */
            .status-tab.status-warning {
                color: #d97706;
            }
            
            .status-tab.status-warning:hover {
                color: #b45309;
            }
            
            .status-tab.status-warning span {
                background-color: #fef3c7 !important;
                color: #92400e !important;
            }
            
            .status-tab.status-success {
                color: #059669;
            }
            
            .status-tab.status-success:hover {
                color: #047857;
            }
            
            .status-tab.status-success span {
                background-color: #d1fae5 !important;
                color: #065f46 !important;
            }
            
            /* Contract detail responsive styles */
            #contract-detail-content .bg-white {
                padding: 16px !important;
            }
            
            #contract-detail-content .flex.flex-col.md\:flex-row {
                gap: 16px;
            }
            
            #contract-detail-content .flex.flex-col.md\:flex-row .flex.flex-wrap {
                justify-content: center;
                width: 100%;
            }
            
            #contract-detail-content .flex.flex-col.md\:flex-row .flex.flex-wrap button {
                flex: 1;
                min-width: 120px;
                justify-content: center;
                font-size: 14px;
                padding: 8px 12px;
            }
            
            /* Contract header responsive */
            #contract-detail-content .flex.flex-col.md\:flex-row.items-start.md\:items-center {
                gap: 16px;
            }
            
            #contract-detail-content .flex.flex-col.md\:flex-row.items-start.md\:items-center h2 {
                text-align: center;
                margin: 0;
            }
            
            #contract-detail-content .flex.flex-col.md\:flex-row.gap-2.md\:gap-4 {
                width: 100%;
                justify-content: center;
            }
            
            #contract-detail-content .flex.flex-col.md\:flex-row.gap-2.md\:gap-4 > div {
                flex: 1;
                min-width: 140px;
                text-align: center;
            }
            
            /* Contract tabs responsive */
            #contract-detail-content .contract-detail-tabs {
                border-bottom: 1px solid #e5e7eb;
                margin-bottom: 24px;
            }
            
            #contract-detail-content .contract-detail-tabs nav {
                overflow-x: auto;
                -webkit-overflow-scrolling: touch;
                scrollbar-width: none;
                -ms-overflow-style: none;
                display: flex;
                flex-wrap: nowrap;
                gap: 0;
            }
            
            #contract-detail-content .contract-detail-tabs nav::-webkit-scrollbar {
                display: none;
            }
            
            #contract-detail-content .contract-detail-tabs .contract-detail-tab {
                flex-shrink: 0;
                min-width: 120px;
                text-align: center;
                white-space: nowrap;
                border: none;
                background: none;
                cursor: pointer;
                padding: 12px 16px;
                font-size: 14px;
                font-weight: 500;
                color: #6b7280;
                border-bottom: 2px solid transparent;
                transition: all 0.2s ease;
            }
            
            #contract-detail-content .contract-detail-tabs .contract-detail-tab:hover {
                color: #2563eb;
                border-bottom-color: #d1d5db;
            }
            
            #contract-detail-content .contract-detail-tabs .contract-detail-tab.active {
                color: #2563eb;
                border-bottom-color: #2563eb;
                font-weight: 600;
            }
            
            /* Tab content visibility */
            #contract-detail-content .contract-detail-tab-content {
                display: block !important;
                opacity: 1;
                visibility: visible;
            }
            
            #contract-detail-content .contract-detail-tab-content.hidden {
                display: none !important;
                opacity: 0;
                visibility: hidden;
            }
            
            /* Ensure first tab content is always visible */
            #contract-detail-content #contract-tab-info {
                display: block !important;
            }
            
            #contract-detail-content #contract-tab-info.hidden {
                display: none !important;
            }
            
            /* Contract content responsive */
            #contract-detail-content .grid.grid-cols-1.lg\:grid-cols-3 {
                gap: 16px;
            }
            
            #contract-detail-content .grid.grid-cols-1.md\:grid-cols-2 {
                gap: 12px;
            }
            
            #contract-detail-content .bg-gray-50,
            #contract-detail-content .bg-blue-50 {
                padding: 16px;
            }
            
            #contract-detail-content .bg-blue-50 .space-y-4 {
                gap: 16px;
            }
            
            #contract-detail-content .bg-blue-50 .space-y-4 > div {
                padding: 12px;
            }
            
            /* Payment table responsive */
            #contract-detail-content .overflow-x-auto {
                margin: 0 -16px;
                padding: 0 16px;
            }
            
            #contract-detail-content .table-responsive {
                overflow-x: auto;
                -webkit-overflow-scrolling: touch;
            }
            
            #contract-detail-content .table-responsive table {
                min-width: 600px;
            }
            
            /* Payment button in table */
            #contract-detail-content .flex.justify-between.items-center {
                flex-direction: column;
                align-items: stretch;
                gap: 12px;
            }
            
            #contract-detail-content .flex.justify-between.items-center h3 {
                text-align: center;
                margin: 0;
            }
            
            #contract-detail-content .flex.justify-between.items-center button {
                align-self: center;
                min-width: 120px;
            }
            
            /* Statistics cards responsive */
            #contract-detail-content .flex.flex-col.md\:flex-row.gap-3.md\:gap-4 {
                width: 100%;
            }
            
            #contract-detail-content .flex.flex-col.md\:flex-row.gap-3.md\:gap-4 > div {
                flex: 1;
                min-width: 200px;
            }
            
            #contract-detail-content .bg-gradient-to-r {
                transition: all 0.3s ease;
            }
            
            #contract-detail-content .bg-gradient-to-r:hover {
                transform: translateY(-2px);
                box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            }
            
            /* Actions dropdown responsive */
            #contract-detail-content .relative {
                align-self: flex-end;
            }
            
            #contract-detail-content #contract-actions-dropdown {
                min-width: 120px;
                justify-content: center;
            }
            
            #contract-detail-content #contract-actions-menu {
                min-width: 200px;
            }
            
            #contract-detail-content #contract-actions-menu button {
                transition: all 0.2s ease;
            }
            
            #contract-detail-content #contract-actions-menu button:hover {
                transform: translateX(4px);
            }
            
            /* Dropdown arrow animation */
            .fa-chevron-down {
                transition: transform 0.2s ease;
            }
            
            .fa-chevron-down.rotate-180 {
                transform: rotate(180deg);
            }
            
            /* Payment modal responsive */
            #payment-modal .bg-white.rounded-lg.shadow-xl {
                max-height: 90vh;
                overflow-y: auto;
            }
            
            #payment-modal .grid.grid-cols-2.md\\:grid-cols-3.lg\\:grid-cols-4 {
                grid-template-columns: repeat(2, 1fr);
            }
            
            #payment-modal .grid.grid-cols-2.md\\:grid-cols-4 {
                grid-template-columns: repeat(2, 1fr);
            }
            
            #payment-modal .payment-period-option {
                padding: 8px;
                font-size: 12px;
            }
            
            #payment-modal .payment-period-option .font-medium {
                font-size: 11px;
            }
            
            #payment-modal .payment-period-option .text-xs {
                font-size: 10px;
            }
            
            /* One-time service payment styles */
            #one-time-payment-info {
                transition: all 0.3s ease;
            }
            
            #one-time-payment-info .bg-orange-50 {
                border-left: 4px solid #f97316;
            }
            
            #one-time-amount {
                font-size: 1.25rem;
                font-weight: 700;
            }
            
            /* Add contract modal styles */
            #add-contract-modal .bg-gray-50 {
                border: 1px solid #e5e7eb;
            }
            
            #add-contract-modal .bg-blue-50 {
                border: 1px solid #dbeafe;
            }
            
            #add-contract-modal select:focus,
            #add-contract-modal input:focus,
            #add-contract-modal textarea:focus {
                border-color: #3b82f6;
                box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
            }
            
            #add-contract-modal .bg-blue-600:hover {
                background-color: #2563eb;
                transform: translateY(-1px);
                box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            }
            
            #add-contract-modal .bg-gray-300:hover {
                background-color: #d1d5db;
                transform: translateY(-1px);
            }
            
            /* One-time service input alignment */
            #one-time-unit-price {
                text-align: right;
                padding-right: 2rem;
            }
            
            #one-time-unit-price::placeholder {
                text-align: right;
            }
            
            /* Unit price label alignment */
            .unit-price-label {
                text-align: right;
                font-weight: 600;
                color: #374151;
            }
            
            /* Unit price input alignment */
            #contract-unit-price {
                text-align: right;
                padding-right: 2rem;
            }
            
            #contract-unit-price::placeholder {
                text-align: right;
            }
            
            /* Quantity input alignment */
            #one-time-quantity {
                text-align: right;
                padding-right: 2rem;
            }
            
            #one-time-quantity::placeholder {
                text-align: right;
            }
            
            /* Unit select alignment */
            #contract-unit {
                text-align: right;
                padding-right: 2rem;
            }
            
            /* Total value alignment */
            #contract-total-value {
                text-align: right;
                display: block;
            }
            
            /* Summary values alignment */
            #contract-duration {
                text-align: right;
                display: block;
            }
            
            .status-tag {
                text-align: right;
                display: block;
            }
            
            /* Notification modal fixes */
            #notification-modal {
                display: flex !important;
            }
            
            #notification-modal:not(.hidden) {
                display: flex !important;
            }
            
            #notification-modal .bg-white {
                display: block !important;
            }
            
            #success-notification:not(.hidden),
            #error-notification:not(.hidden),
            #warning-notification:not(.hidden),
            #confirm-notification:not(.hidden),
            #info-notification:not(.hidden) {
                display: block !important;
            }
            
            /* Force display for notification content */
            #success-notification,
            #error-notification,
            #warning-notification,
            #confirm-notification,
            #info-notification {
                display: block !important;
                z-index: 9999 !important;
                position: relative !important;
                visibility: visible !important;
                opacity: 1 !important;
            }
            
            /* Override hidden class completely */
            .hidden {
                display: none !important;
            }
            
            #success-notification.hidden,
            #error-notification.hidden,
            #warning-notification.hidden,
            #confirm-notification.hidden,
            #info-notification.hidden {
                display: block !important;
                visibility: visible !important;
                opacity: 1 !important;
            }
            
            /* Ensure notification modal is always on top */
            #notification-modal {
                z-index: 9999 !important;
            }
            
            /* Ensure notification content is visible */
            #notification-modal .bg-white {
                z-index: 10000 !important;
                position: relative !important;
            }
            
            /* Reset price button styles */
            #reset-contract-price,
            #reset-one-time-price {
                transition: all 0.2s ease;
            }
            
            #reset-contract-price:hover,
            #reset-one-time-price:hover {
                color: #059669 !important;
                transform: scale(1.1);
            }
            
            /* Disabled button styles */
            #save-contract:disabled {
                opacity: 0.5;
                cursor: not-allowed;
                transform: none !important;
                box-shadow: none !important;
            }
            
            #save-contract:disabled:hover {
                background-color: #2563eb !important;
                transform: none !important;
                box-shadow: none !important;
            }
            
            /* Mobile optimizations for statistics */
            @media (max-width: 768px) {
                #contract-detail-content .flex.flex-col.md\:flex-row.gap-3.md\:gap-4 > div {
                    min-width: 100%;
                }
                
                #contract-detail-content .bg-gradient-to-r {
                    padding: 16px;
                }
                
                #contract-detail-content .bg-gradient-to-r p {
                    font-size: 16px;
                }
                
                #contract-detail-content .bg-gradient-to-r .text-xl.md\:text-2xl {
                    font-size: 20px;
                }
                
                /* Mobile tab optimizations */
                #contract-detail-content .contract-detail-tabs nav {
                    padding: 0 16px;
                    margin: 0 -16px;
                }
                
                #contract-detail-content .contract-detail-tabs .contract-detail-tab {
                    min-width: 100px;
                    padding: 12px 8px;
                    font-size: 13px;
                }
                
                #contract-detail-content .contract-detail-tab-content {
                    margin-top: 16px;
                }
                
                #contract-detail-content .contract-detail-tab-content .bg-gray-50 {
                    padding: 16px;
                    margin: 0 -16px;
                }
                
                /* Ensure table is scrollable on mobile */
                #contract-detail-content .table-responsive {
                    margin: 0 -16px;
                    padding: 0 16px;
                }
                
                #contract-detail-content .table-responsive table {
                    min-width: 500px;
                }
                
                /* Mobile payment cards */
                #contract-detail-content .md\:hidden.space-y-3 {
                    margin-top: 16px;
                }
                
                #contract-detail-content .md\:hidden.space-y-3 > div {
                    background: white;
                    border-radius: 8px;
                    border: 1px solid #e5e7eb;
                    padding: 16px;
                    margin-bottom: 12px;
                }
                
                #contract-detail-content .md\:hidden.space-y-3 > div:last-child {
                    margin-bottom: 0;
                }
                
                #contract-detail-content .md\:hidden.space-y-3 h4 {
                    font-size: 16px;
                    font-weight: 500;
                    color: #111827;
                    margin-bottom: 4px;
                }
                
                #contract-detail-content .md\:hidden.space-y-3 .text-lg.font-bold {
                    font-size: 18px;
                    font-weight: 700;
                    color: #111827;
                }
                
                #contract-detail-content .md\:hidden.space-y-3 .space-y-2 {
                    margin-top: 12px;
                }
                
                #contract-detail-content .md\:hidden.space-y-3 .space-y-2 > div {
                    display: flex;
                    justify-content: space-between;
                    align-items: center;
                    padding: 4px 0;
                }
                
                #contract-detail-content .md\:hidden.space-y-3 .space-y-2 span:first-child {
                    color: #6b7280;
                    font-size: 14px;
                }
                
                #contract-detail-content .md\:hidden.space-y-3 .space-y-2 span:last-child {
                    font-weight: 500;
                    font-size: 14px;
                }
                
                #contract-detail-content .md\:hidden.space-y-3 .text-gray-400 {
                    color: #9ca3af;
                }
            }
            
            .status-tab.status-danger {
                color: #dc2626;
            }
            
            .status-tab.status-danger:hover {
                color: #b91c1c;
            }
            
            .status-tab.status-danger span {
                background-color: #fee2e2 !important;
                color: #991b1b !important;
            }
            
            /* Radio button styles for status filter */
            .status-radio {
                appearance: none;
                -webkit-appearance: none;
                -moz-appearance: none;
                width: 16px;
                height: 16px;
                border: 2px solid #d1d5db;
                border-radius: 50%;
                outline: none;
                cursor: pointer;
                position: relative;
                transition: all 0.2s ease;
                margin-right: 2px;
            }
            
            .status-radio:checked {
                border-color: #2563eb;
                background-color: #2563eb;
            }
            
            .status-radio:checked::after {
                content: '';
                position: absolute;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                width: 6px;
                height: 6px;
                background-color: white;
                border-radius: 50%;
            }
            
            .status-radio:hover {
                border-color: #2563eb;
            }
            
            /* Desktop styles for status filter */
            @media (min-width: 769px) {
                .status-filter-container label {
                    cursor: pointer;
                    transition: all 0.2s ease;
                    padding: 6px 12px;
                    border-radius: 6px;
                }
                
                .status-filter-container label:hover {
                    opacity: 0.9;
                    transform: translateY(-1px);
                }
                
                .status-filter-container label:has(.status-radio:checked) {
                    transform: scale(1.02);
                    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
                }
            }
            
            /* Background colors for all screen sizes */
            .status-filter-container .status-filter-all {
                background-color: #f3f4f6 !important;
                border: 1px solid #d1d5db !important;
            }
            
            .status-filter-container .status-filter-active {
                background-color: #dcfce7 !important;
                border: 1px solid #86efac !important;
            }
            
            .status-filter-container .status-filter-inactive {
                background-color: #fef3c7 !important;
                border: 1px solid #fde68a !important;
            }
            
            /* Status filter container */
            .status-filter-container {
                background-color: #f9fafb;
                border: 1px solid #e5e7eb;
                border-radius: 8px;
                padding: 16px;
            }
            
            @media (max-width: 768px) {
                .status-filter-container {
                    padding: 12px;
                }
                
                .status-filter-container .flex {
                    flex-direction: row;
                    flex-wrap: wrap;
                    gap: 8px;
                    justify-content: flex-start;
                }
                
                .status-filter-container label {
                    display: flex;
                    align-items: center;
                    justify-content: flex-start;
                    padding: 10px 12px;
                    border-radius: 8px;
                    border: 1px solid #e5e7eb;
                    cursor: pointer;
                    transition: all 0.2s ease;
                    min-height: 44px;
                    flex: 0 1 auto;
                    min-width: fit-content;
                    white-space: nowrap;
                }
                
                .status-filter-container label:hover {
                    background-color: #f3f4f6;
                    border-color: #d1d5db;
                }
                
                .status-filter-container label:active {
                    background-color: #e5e7eb;
                }
                
                /* Radio button styles for mobile */
                .status-filter-container .status-radio {
                    width: 16px;
                    height: 16px;
                    margin-right: 2px;
                    flex-shrink: 0;
                    flex-grow: 0;
                }
                
                .status-filter-container label span {
                    display: flex;
                    align-items: center;
                    justify-content: flex-start;
                    font-size: 13px;
                    font-weight: 500;
                    white-space: nowrap;
                    flex-shrink: 0;
                }
                
                /* Active state for mobile */
                .status-filter-container label:has(.status-radio:checked) {
                    box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
                    transform: scale(1.02);
                }
                
                .status-filter-container label:has(.status-radio:checked) span {
                    color: #1f2937;
                    font-weight: 600;
                }
                
                /* Touch-friendly improvements */
                .status-filter-container label {
                    -webkit-tap-highlight-color: transparent;
                    user-select: none;
                }
                
                /* Better visual hierarchy */
                .status-filter-container {
                    margin-bottom: 16px;
                }
                
                /* Optimize for different screen sizes */
                @media (max-width: 640px) and (min-width: 481px) {
                    .status-filter-container .flex {
                        gap: 10px;
                    }
                    
                    .status-filter-container label {
                        padding: 12px 16px;
                        min-height: 48px;
                        min-width: fit-content;
                    }
                }
                
                /* Add some spacing between filter sections */
                .status-filter-container + .table-responsive,
                .status-filter-container + .mobile-card-view {
                    margin-top: 16px;
                }
                
                /* Ensure proper spacing on very small screens */
                @media (max-width: 480px) {
                    .status-filter-container .flex {
                        gap: 6px;
                    }
                    
                    .status-filter-container label {
                        padding: 8px 10px;
                        min-height: 40px;
                        min-width: fit-content;
                    }
                    
                    .status-filter-container label span {
                        font-size: 12px;
                    }
                    
                    .status-filter-container .status-radio {
                        width: 14px;
                        height: 14px;
                        margin-right: 1px;
                    }
                }
            }
            
            .status-filter-container label {
                cursor: pointer;
                transition: all 0.2s ease;
            }
            
            .status-filter-container label:hover {
                opacity: 0.9;
            }
            
            /* Customer row filtering */
            .customer-row {
                transition: all 0.3s ease;
            }
            
            .customer-row.hidden {
                display: none !important;
            }
            
            /* Smooth animation for filtering */
            .customer-row[style*="display: none"] {
                opacity: 0;
                transform: translateY(-10px);
            }
            
            .customer-row:not([style*="display: none"]) {
                opacity: 1;
                transform: translateY(0);
            }
            
            /* General button fixes for mobile */
            button {
                min-height: 44px; /* Touch-friendly minimum height */
            }
            
                        /* Hide unwanted footer text on desktop */
            @media (min-width: 769px) {
                body::after,
                body::before {
                    display: none !important;
                }
                
                /* Hide any text that might be appearing at bottom */
                .hidden-text,
                .debug-text,
                .footer-text {
                    display: none !important;
                }
                
                /* Hide any elements that might contain navigation text at bottom */
                div[style*="position: fixed"][style*="bottom: 0"],
                div[style*="position: absolute"][style*="bottom: 0"] {
                    display: none !important;
                }
                
                /* Hide any text content that matches navigation items */
                div:not(.sidebar):not(.mobile-menu):not(.web-content-page) {
                    position: relative;
                }
                
                /* Hide any floating text at bottom */
                div[style*="position: fixed"],
                div[style*="position: absolute"] {
                    z-index: -1;
                }
                
                /* Specific hide for navigation text */
                body > div:last-child:not(.web-content-page):not(.sidebar):not(.mobile-menu) {
                    display: none !important;
                }
                
                /* Force hide any text containing navigation items */
                * {
                    position: relative;
                }
                
                /* Hide any element that contains specific text */
                div:contains("GRAC SYSTEM"),
                div:contains("Dashboard"),
                div:contains("Khách hàng"),
                div:contains("Quản lý Hợp đồng"),
                div:contains("Công nợ"),
                div:contains("Thanh toán"),
                div:contains("ĐV Thu gom"),
                div:contains("Dịch vụ"),
                div:contains("Quản trị"),
                div:contains("Thống kê") {
                    display: none !important;
                    visibility: hidden !important;
                    opacity: 0 !important;
                }
                
                /* Hide any element positioned at bottom */
                div[style*="bottom"],
                span[style*="bottom"],
                p[style*="bottom"] {
                    display: none !important;
                }
                
                /* Hide specific mobile menu elements on desktop */
                #mobile-menu-grac-admin,
                #mobile-menu-dv-quanly,
                #mobile-menu-dv-coso,
                #mobile-menu-dv-thugom {
                    display: none !important;
                    visibility: hidden !important;
                    opacity: 0 !important;
                    position: absolute !important;
                    left: -9999px !important;
                    top: -9999px !important;
                    z-index: -9999 !important;
                    pointer-events: none !important;
                }
                
                /* Hide mobile menu content on desktop */
                .mobile-menu-content {
                    display: none !important;
                    visibility: hidden !important;
                    opacity: 0 !important;
                }
                
                /* Hide entire mobile menu on desktop */
                #mobile-menu,
                div#mobile-menu,
                div[id="mobile-menu"] {
                    display: none !important;
                    visibility: hidden !important;
                    opacity: 0 !important;
                    position: absolute !important;
                    left: -9999px !important;
                    top: -9999px !important;
                    z-index: -9999 !important;
                    pointer-events: none !important;
                    width: 0 !important;
                    height: 0 !important;
                    overflow: hidden !important;
                }
                
                /* Hide any element containing mobile menu text */
                .mobile-menu-role,
                .mobile-menu-item {
                    display: none !important;
                    visibility: hidden !important;
                    opacity: 0 !important;
                }
                
                /* Force hide any element with mobile menu classes */
                [class*="mobile-menu"] {
                    display: none !important;
                    visibility: hidden !important;
                    opacity: 0 !important;
                }
                
                /* Force hide mobile menu with highest specificity */
                body #mobile-menu,
                html body #mobile-menu,
                body div#mobile-menu {
                    display: none !important;
                    visibility: hidden !important;
                    opacity: 0 !important;
                    position: absolute !important;
                    left: -9999px !important;
                    top: -9999px !important;
                    z-index: -9999 !important;
                    pointer-events: none !important;
                    width: 0 !important;
                    height: 0 !important;
                    overflow: hidden !important;
                }
            }
            
            /* Fix all flex button groups */
            .flex.space-x-2,
            .flex.space-x-3,
            .flex.space-x-4,
            .flex.space-x-5 {
                flex-wrap: wrap;
                gap: 8px;
            }
            
            /* Fix all justify-between headers */
            .flex.justify-between:not(header .flex.justify-between) {
                flex-direction: column;
                gap: 16px;
            }
            
            .flex.justify-between:not(header .flex.justify-between) > * {
                width: 100%;
            }
            
            /* Mobile Menu */
            .mobile-menu {
                position: fixed;
                top: 0;
                left: -100%;
                width: 280px;
                height: 100vh;
                background: white;
                z-index: 50;
                transition: left 0.3s ease;
                box-shadow: 2px 0 10px rgba(0, 0, 0, 0.1);
            }
            
            /* Hide mobile menu on desktop */
            @media (min-width: 769px) {
                .mobile-menu,
                #mobile-menu {
                    display: none !important;
                    visibility: hidden !important;
                    opacity: 0 !important;
                    position: absolute !important;
                    left: -9999px !important;
                    top: -9999px !important;
                    z-index: -9999 !important;
                    pointer-events: none !important;
                }
            }
            
            .mobile-menu.open {
                left: 0;
            }
            
            .mobile-menu-header {
                padding: 20px;
                border-bottom: 1px solid #e5e7eb;
                background: #f8fafc;
            }
            
            .mobile-menu-title {
                font-size: 18px;
                font-weight: 600;
                color: #1f2937;
                margin-bottom: 8px;
            }
            
            .mobile-menu-subtitle {
                font-size: 14px;
                color: #6b7280;
            }
            
            .mobile-menu-content {
                padding: 16px 0;
                overflow-y: auto;
                height: calc(100vh - 80px);
            }
            
            .mobile-menu-item {
                display: block;
                padding: 12px 20px;
                color: #374151;
                text-decoration: none;
                border-bottom: 1px solid #f3f4f6;
                transition: background-color 0.2s;
            }
            
            .mobile-menu-item:hover {
                background-color: #f9fafb;
            }
            
            .mobile-menu-item.active {
                background-color: #dbeafe;
                color: #1d4ed8;
                font-weight: 500;
            }
            
            .mobile-overlay {
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background-color: rgba(0, 0, 0, 0.5);
                z-index: 40;
                display: none;
            }
            
            /* Hide mobile overlay on desktop */
            @media (min-width: 769px) {
                .mobile-overlay {
                    display: none !important;
                    visibility: hidden !important;
                    opacity: 0 !important;
                    position: absolute !important;
                    left: -9999px !important;
                    top: -9999px !important;
                    z-index: -9999 !important;
                    pointer-events: none !important;
                }
            }
            
            .mobile-overlay.active {
                display: block;
            }
            
            /* Hide tables on mobile, show cards instead */
            .table-responsive {
                display: none;
            }
            
            /* Mobile table scroll improvements */
            .mobile-table-scroll {
                overflow-x: auto;
                -webkit-overflow-scrolling: touch;
                scrollbar-width: none; /* Hide scrollbar on mobile */
                -ms-overflow-style: none;
            }
            
            .mobile-table-scroll::-webkit-scrollbar {
                display: none; /* Hide scrollbar on mobile */
            }
            
            .mobile-card-view {
                display: block;
            }
            
            .grid-cols-1.md\:grid-cols-2.lg\:grid-cols-4 {
                grid-template-columns: repeat(1, minmax(0, 1fr));
            }
            
            /* Mobile card styles */
            .mobile-card {
                background: white;
                border: 1px solid #e5e7eb;
                border-radius: 8px;
                padding: 12px;
                
            /* Customer Detail Mobile Optimization */
            .customer-detail-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 1rem;
            }
            
            .customer-detail-header .flex {
                width: 100%;
                justify-content: space-between;
            }
            
            .customer-detail-header button {
                padding: 0.5rem 1rem;
                font-size: 0.875rem;
            }
            
            .customer-detail-tabs {
                overflow-x: auto;
                -webkit-overflow-scrolling: touch;
            }
            
            .customer-detail-tabs nav {
                flex-wrap: nowrap;
                gap: 0.5rem;
            }
            
            .customer-detail-tabs button {
                white-space: nowrap;
                padding: 0.75rem 0.5rem;
                font-size: 0.75rem;
                min-width: auto;
            }
            
            .customer-detail-content {
                padding: 1rem;
            }
            
            .customer-detail-content .bg-white {
                padding: 1rem;
            }
            
            .customer-detail-grid {
                grid-template-columns: 1fr;
                gap: 1rem;
            }
            
            .customer-detail-grid .md\:col-span-2 {
                grid-column: 1;
            }
            
            .customer-detail-info {
                padding: 1rem;
            }
            
            .customer-detail-info .grid {
                grid-template-columns: 1fr;
                gap: 0.75rem;
            }
            
            .customer-detail-info p {
                display: flex;
                flex-direction: column;
                gap: 0.25rem;
            }
            
            .customer-detail-info p.col-span-2 {
                grid-column: 1;
            }
            
            .customer-detail-debt {
                padding: 1rem;
                margin-top: 1rem;
            }
            
            .customer-detail-debt .text-3xl {
                font-size: 1.5rem;
            }
            
            /* Tab Content Mobile Optimization */
            .detail-tab-content {
                padding: 0;
            }
            
            .detail-tab-content .flex {
                flex-direction: column;
                align-items: flex-start;
                gap: 1rem;
            }
            
            .detail-tab-content .flex button {
                width: 100%;
                padding: 0.75rem;
                font-size: 0.875rem;
            }
            
            .detail-tab-content .flex .space-x-2 {
                width: 100%;
                gap: 0.5rem;
            }
            
            .detail-tab-content .flex .space-x-2 button {
                flex: 1;
            }
                margin-bottom: 8px;
                box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
                width: 100%;
                box-sizing: border-box;
                overflow: hidden;
            }
            
            .mobile-card-header {
                display: flex;
                justify-content: space-between;
                align-items: center;
                margin-bottom: 8px;
                gap: 8px;
            }
            
            .mobile-card-title {
                font-weight: 600;
                color: #1f2937;
                font-size: 16px;
                flex: 1;
                overflow: hidden;
                text-overflow: ellipsis;
                white-space: nowrap;
            }
            
            .mobile-card-status {
                padding: 4px 8px;
                border-radius: 12px;
                font-size: 12px;
                font-weight: 500;
            }
            
            .mobile-card-content {
                display: grid;
                gap: 8px;
                font-size: 14px;
            }
            
            .mobile-card-row {
                display: flex;
                justify-content: space-between;
                align-items: flex-start;
                gap: 8px;
                margin-bottom: 8px;
            }
            
            .mobile-card-label {
                color: #6b7280;
                font-weight: 500;
                flex-shrink: 0;
                min-width: 80px;
            }
            
            .mobile-card-value {
                color: #1f2937;
                text-align: right;
                flex: 1;
                word-wrap: break-word;
                overflow-wrap: break-word;
            }
            
            .mobile-card-actions {
                margin-top: 8px;
                padding-top: 8px;
                border-top: 1px solid #e5e7eb;
            }
            
            .mobile-card-action-btn {
                color: #2563eb;
                font-weight: 500;
                font-size: 14px;
                text-decoration: none;
            }
        }
        
        /* Desktop: hide mobile cards, show tables */
        @media (min-width: 769px) {
            .mobile-card-view {
                display: none;
            }
            
            .table-responsive {
                display: block !important;
                overflow-x: auto !important;
                -webkit-overflow-scrolling: touch;
                scrollbar-width: thin;
                scrollbar-color: #cbd5e0 #f7fafc;
                width: 100%;
                max-width: 100%;
            }
            
            /* Custom scrollbar for webkit browsers */
            .table-responsive::-webkit-scrollbar {
                height: 8px;
            }
            
            .table-responsive::-webkit-scrollbar-track {
                background: #f7fafc;
                border-radius: 4px;
            }
            
            .table-responsive::-webkit-scrollbar-thumb {
                background: #cbd5e0;
                border-radius: 4px;
            }
            
            .table-responsive::-webkit-scrollbar-thumb:hover {
                background: #a0aec0;
            }
            
            /* COMPLETE TABLE REWRITE - PERFECT ALIGNMENT */
            .table-responsive {
                overflow-x: auto !important;
                border-radius: 0.5rem;
                border: 1px solid #e5e7eb;
                width: 100%;
                max-width: 100%;
            }
            
            .table-responsive table {
                width: 100%;
                min-width: 1200px;
                border-collapse: collapse;
                white-space: nowrap;
                table-layout: auto;
            }
            
            /* RESET ALL TABLE STYLES */
            .table-responsive table,
            .table-responsive thead,
            .table-responsive tbody,
            .table-responsive tr,
            .table-responsive th,
            .table-responsive td {
                margin: 0 !important;
                padding: 0 !important;
                border: none !important;
                background: none !important;
                font-size: inherit !important;
                font-weight: inherit !important;
                text-align: inherit !important;
                vertical-align: inherit !important;
            }
            
            /* APPLY CLEAN STYLES */
            .table-responsive thead th {
                background-color: #f9fafb !important;
                color: #374151 !important;
                font-weight: 600 !important;
                text-transform: uppercase !important;
                font-size: 0.75rem !important;
                letter-spacing: 0.05em !important;
                padding: 0.75rem 1.5rem !important;
                text-align: left !important;
                border-bottom: 2px solid #e5e7eb !important;
                vertical-align: middle !important;
                box-sizing: border-box !important;
            }
            
            .table-responsive tbody td {
                padding: 0.75rem 1.5rem !important;
                border-bottom: 1px solid #f3f4f6 !important;
                vertical-align: middle !important;
                text-align: left !important;
                box-sizing: border-box !important;
            }
            
            /* OVERRIDE ALL TAILWIND PADDING CLASSES */
            .table-responsive th.px-6,
            .table-responsive th.py-3,
            .table-responsive th.px-6.py-3,
            .table-responsive td.px-6,
            .table-responsive td.py-4,
            .table-responsive td.px-6.py-4 {
                padding: 0.75rem 1.5rem !important;
            }
            
            .table-responsive tbody tr:hover {
                background-color: #f9fafb !important;
            }
            

            
            /* Customer table specific column widths */
            .customer-table {
                min-width: 1200px;
                width: 100%;
            }
            
            /* Ensure containers don't limit table width */
            .web-content-page {
                overflow: visible !important;
                max-width: none !important;
            }
            
            .web-content-page .bg-white {
                overflow: visible !important;
                max-width: none !important;
            }
            
            /* Ensure main content area allows horizontal scroll */
            main {
                overflow: visible !important;
                max-width: none !important;
            }
            
            /* Fix flex container issues */
            .flex-1 {
                min-width: 0;
                overflow: visible !important;
            }
            
            .flex {
                overflow: visible !important;
            }
            
            /* Ensure mobile container doesn't limit width */
            .mobile-container {
                overflow: visible !important;
            }
            
            /* Force horizontal scrolling to work */
            .table-responsive {
                overflow-x: scroll !important;
                overflow-y: visible !important;
                -webkit-overflow-scrolling: touch;
            }
            
            /* Ensure table content is fully visible */
            .table-responsive table {
                display: table !important;
                min-width: max-content !important;
            }
            
            /* Debug: ensure all table elements are visible */
            .table-responsive thead,
            .table-responsive tbody,
            .table-responsive tr {
                display: table-row-group !important;
            }
            
            .table-responsive th,
            .table-responsive td {
                display: table-cell !important;
                visibility: visible !important;
            }
            

            
            /* Let browser auto-calculate column widths for better content display */
            .customer-table .col-stt { min-width: 60px; }
            .customer-table .col-action { min-width: 120px; }
            .customer-table .col-code { min-width: 80px; }
            .customer-table .col-name { min-width: 150px; }
            .customer-table .col-type { min-width: 100px; }
            .customer-table .col-address { min-width: 300px; }
            .customer-table .col-phone { min-width: 100px; }
            .customer-table .col-unit { min-width: 120px; }
            .customer-table .col-status { min-width: 100px; }
            
            /* Allow text wrapping for specific columns */
            .allow-wrap {
                white-space: normal;
                word-wrap: break-word;
            }
            
            /* Status tags */
            .status-tag {
                display: inline-block;
                padding: 0.25rem 0.5rem;
                border-radius: 0.375rem;
                font-size: 0.75rem;
                font-weight: 500;
                text-align: center;
                white-space: nowrap;
            }
            
            /* Mobile card view */
            .mobile-card-view {
                display: none;
            }
            
            @media (max-width: 768px) {
                .table-responsive {
                    display: none;
                }
                
                .mobile-card-view {
                    display: block;
                }
                
                .mobile-card {
                    background: white;
                    border: 1px solid #e5e7eb;
                    border-radius: 0.5rem;
                    padding: 1rem;
                    margin-bottom: 1rem;
                }
                
                .mobile-card-header {
                    display: flex;
                    justify-content: space-between;
                    align-items: center;
                    margin-bottom: 0.75rem;
                }
                
                .mobile-card-title {
                    font-weight: 600;
                    color: #374151;
                }
                
                .mobile-card-status {
                    padding: 0.25rem 0.5rem;
                    border-radius: 0.375rem;
                    font-size: 0.75rem;
                    font-weight: 500;
                }
                
                .mobile-card-content {
                    display: grid;
                    grid-template-columns: 1fr 1fr;
                    gap: 0.5rem;
                    font-size: 0.875rem;
                }
                
                .mobile-card-row {
                    display: flex;
                    justify-content: space-between;
                }
                
                .mobile-card-label {
                    color: #6b7280;
                    font-weight: 500;
                }
                
                .mobile-card-value {
                    color: #374151;
                    text-align: right;
                }
            }
        }
        
        /* Sidebar toggle button */
        .sidebar-toggle {
            transition: transform 0.3s ease;
        }
        
        .sidebar-toggle.rotated {
            transform: rotate(180deg);
        }
        
        /* Pagination styles */
        .pagination-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 1rem 0;
            border-top: 1px solid #e5e7eb;
            margin-top: 1rem;
            gap: 1rem;
        }
        
        .pagination-info {
            color: #6b7280;
            font-size: 0.875rem;
        }
        
        .pagination-controls {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .pagination-button {
            padding: 0.5rem 0.75rem;
            border: 1px solid #d1d5db;
            background-color: white;
            color: #374151;
            border-radius: 0.375rem;
            font-size: 0.875rem;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .pagination-button:hover:not(:disabled) {
            background-color: #f9fafb;
            border-color: #9ca3af;
        }
        
        .pagination-button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .pagination-button.active {
            background-color: #2563eb;
            color: white;
            border-color: #2563eb;
        }
        
        .pagination-button.active:hover {
            background-color: #1d4ed8;
        }
        
        .pagination-ellipsis {
            padding: 0.5rem 0.75rem;
            color: #6b7280;
            font-size: 0.875rem;
        }
        
        /* Contract detail tab styles */
        .contract-detail-tab {
            transition: all 0.3s ease;
        }
        
        .contract-detail-tab.active {
            color: #2563eb !important;
            border-bottom-color: #2563eb !important;
        }
        
        .contract-detail-tab:hover {
            color: #2563eb !important;
            border-bottom-color: #d1d5db !important;
        }
        
        /* Address Categories Tab Styles */
        .address-tab {
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .address-tab.active {
            color: #2563eb !important;
            border-bottom-color: #2563eb !important;
        }
        
        .address-tab:hover {
            color: #2563eb !important;
            border-bottom-color: #d1d5db !important;
        }
        
        .address-tab-content {
            transition: all 0.3s ease;
        }
    </style>
</head>
<body class="bg-gray-100">

    <div class="container mx-auto p-4">
        <div id="web-admin-view">
            <!-- Role Selection Toggle Button -->
            <div id="role-toggle-container" class="mb-2 flex justify-between items-center">
                <button id="role-toggle-btn" class="bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700 flex items-center transition-all duration-300">
                    <i class="fas fa-users-cog mr-2"></i>
                    <span id="role-toggle-text">Chọn vai trò người dùng</span>
                    <i id="role-toggle-icon" class="fas fa-chevron-down ml-2 transition-transform duration-300"></i>
                </button>
                <div class="text-sm text-gray-600">
                    <span id="current-role-display">Vai trò hiện tại: <strong>GRAC Admin</strong></span>
                </div>
            </div>
            
            <!-- Collapsible Role Selection Panel -->
            <div id="role-selection-panel" class="mb-2 p-6 bg-white rounded-lg shadow-md transition-all duration-300 overflow-hidden" style="max-height: 0; opacity: 0; padding: 0;">
                <h3 class="font-semibold text-gray-700 mb-4">Chọn vai trò người dùng Web Admin:</h3>
                <div class="flex flex-wrap gap-3">
                    <button class="role-button px-6 py-3 rounded-md bg-gray-200 text-gray-800 active hover:bg-gray-300 transition-colors" data-role="grac-admin"><i class="fas fa-user-shield mr-2"></i>GRAC Admin</button>
                    <button class="role-button px-6 py-3 rounded-md bg-gray-200 text-gray-800 hover:bg-gray-300 transition-colors" data-role="dv-quanly"><i class="fas fa-building mr-2"></i>Đơn vị quản lý</button>
                    <button class="role-button px-6 py-3 rounded-md bg-gray-200 text-gray-800 hover:bg-gray-300 transition-colors" data-role="dv-coso"><i class="fas fa-store mr-2"></i>Đơn vị cơ sở</button>
                    <button class="role-button px-6 py-3 rounded-md bg-gray-200 text-gray-800 hover:bg-gray-300 transition-colors" data-role="dv-thugom"><i class="fas fa-truck mr-2"></i>Đơn vị thu gom</button>
                </div>
            </div>

            <div class="flex h-screen bg-white rounded-lg shadow-xl overflow-hidden mobile-container">
                <div id="sidebar-container" class="w-64 bg-white border-r border-gray-200 flex-shrink-0">
                    <div class="px-6 py-4 flex items-center justify-between border-b">
                         <h2 class="text-xl font-bold text-blue-600 sidebar-text">GRAC SYSTEM</h2>
                         <button id="sidebar-toggle" class="sidebar-toggle p-1 rounded hover:bg-gray-100">
                             <i class="fas fa-chevron-left text-gray-600"></i>
                         </button>
                    </div>
                    <div id="sidebar-grac-admin" class="sidebar p-4"><nav class="space-y-2">
                        <a href="#" class="web-nav-link flex items-center px-4 py-2 rounded-md bg-blue-50 text-blue-700 font-semibold" data-target="dashboard-grac-admin"><i class="fas fa-tachometer-alt sidebar-icon mr-3"></i><span class="sidebar-text"> Dashboard</span></a>
                        <a href="#" class="web-nav-link flex items-center px-4 py-2 rounded-md text-gray-600 hover:bg-gray-100" data-target="customers-content"><i class="fas fa-users sidebar-icon mr-3"></i><span class="sidebar-text"> Khách hàng</span></a>
                        <a href="#" class="web-nav-link flex items-center px-4 py-2 rounded-md text-gray-600 hover:bg-gray-100" data-target="contracts-content"><i class="fas fa-file-signature sidebar-icon mr-3"></i><span class="sidebar-text"> Hợp đồng</span></a>
                        <a href="#" class="web-nav-link flex items-center px-4 py-2 rounded-md text-gray-600 hover:bg-gray-100" data-target="invoices-content"><i class="fas fa-file-invoice-dollar sidebar-icon mr-3"></i><span class="sidebar-text"> Công nợ & Thanh toán</span></a>
                        <a href="#" class="web-nav-link flex items-center px-4 py-2 rounded-md text-gray-600 hover:bg-gray-100" data-target="page-placeholder"><i class="fas fa-truck-moving sidebar-icon mr-3"></i><span class="sidebar-text"> Quản lý ĐV Thu gom</span></a>
                        <a href="#" class="web-nav-link flex items-center px-4 py-2 rounded-md text-gray-600 hover:bg-gray-100" data-target="services-content"><i class="fas fa-concierge-bell sidebar-icon mr-3"></i><span class="sidebar-text"> Dịch vụ</span></a>
                        <a href="#" class="web-nav-link flex items-center px-4 py-2 rounded-md text-gray-600 hover:bg-gray-100" data-target="address-categories-content"><i class="fas fa-map-marker-alt sidebar-icon mr-3"></i><span class="sidebar-text"> Quản lý danh mục địa chỉ</span></a>
                        <a href="#" class="web-nav-link flex items-center px-4 py-2 rounded-md text-gray-600 hover:bg-gray-100" data-target="page-placeholder"><i class="fas fa-chart-pie sidebar-icon mr-3"></i><span class="sidebar-text"> Thống kê & Báo cáo</span></a>
                    </nav></div>
                    
                    <div id="sidebar-dv-quanly" class="sidebar hidden p-4"><nav class="space-y-2">
                        <a href="#" class="web-nav-link flex items-center px-4 py-2 rounded-md text-gray-600 hover:bg-gray-100" data-target="dashboard-dv-quanly"><i class="fas fa-tachometer-alt sidebar-icon mr-3"></i><span class="sidebar-text"> Dashboard</span></a>
                        <a href="#" class="web-nav-link flex items-center px-4 py-2 rounded-md text-gray-600 hover:bg-gray-100" data-target="page-placeholder"><i class="fas fa-store-alt sidebar-icon mr-3"></i><span class="sidebar-text"> Quản lý ĐV Cơ sở</span></a>
                        <a href="#" class="web-nav-link flex items-center px-4 py-2 rounded-md text-gray-600 hover:bg-gray-100" data-target="page-placeholder"><i class="fas fa-truck-moving sidebar-icon mr-3"></i><span class="sidebar-text"> Quản lý ĐV Thu gom</span></a>
                        <a href="#" class="web-nav-link flex items-center px-4 py-2 rounded-md text-gray-600 hover:bg-gray-100" data-target="employees-content"><i class="fas fa-user-friends sidebar-icon mr-3"></i><span class="sidebar-text"> Nhân viên</span></a>
                        <a href="#" class="web-nav-link flex items-center px-4 py-2 rounded-md text-gray-600 hover:bg-gray-100" data-target="customers-content"><i class="fas fa-users sidebar-icon mr-3"></i><span class="sidebar-text"> Khách hàng</span></a>
                        <a href="#" class="web-nav-link flex items-center px-4 py-2 rounded-md text-gray-600 hover:bg-gray-100" data-target="page-placeholder"><i class="fas fa-calendar-alt sidebar-icon mr-3"></i><span class="sidebar-text"> Kế hoạch thu gom</span></a>
                        <a href="#" class="web-nav-link flex items-center px-4 py-2 rounded-md text-gray-600 hover:bg-gray-100" data-target="page-placeholder"><i class="fas fa-tasks sidebar-icon mr-3"></i><span class="sidebar-text"> Theo dõi hiệu suất</span></a>
                        <a href="#" class="web-nav-link flex items-center px-4 py-2 rounded-md text-gray-600 hover:bg-gray-100" data-target="page-placeholder"><i class="fas fa-chart-bar sidebar-icon mr-3"></i><span class="sidebar-text"> Thống kê thu gom</span></a>
                        <a href="#" class="web-nav-link flex items-center px-4 py-2 rounded-md text-gray-600 hover:bg-gray-100" data-target="page-placeholder"><i class="fab fa-rocketchat sidebar-icon mr-3"></i><span class="sidebar-text"> Hệ thống phản hồi</span></a>
                        <a href="#" class="web-nav-link flex items-center px-4 py-2 rounded-md text-gray-600 hover:bg-gray-100" data-target="invoices-content"><i class="fas fa-file-invoice sidebar-icon mr-3"></i><span class="sidebar-text"> Quản lý hóa đơn</span></a>
                    </nav></div>
                                            <div id="sidebar-dv-coso" class="sidebar hidden p-4"><nav class="space-y-2">
                        <a href="#" class="web-nav-link flex items-center px-4 py-2 rounded-md text-gray-600 hover:bg-gray-100" data-target="dashboard-dv-coso"><i class="fas fa-tachometer-alt sidebar-icon mr-3"></i><span class="sidebar-text"> Dashboard</span></a>
                        <a href="#" class="web-nav-link flex items-center px-4 py-2 rounded-md text-gray-600 hover:bg-gray-100" data-target="page-placeholder"><i class="fas fa-route sidebar-icon mr-3"></i><span class="sidebar-text"> Quản lý tuyến thu gom</span></a>
                        <a href="#" class="web-nav-link flex items-center px-4 py-2 rounded-md text-gray-600 hover:bg-gray-100" data-target="page-placeholder"><i class="fas fa-truck sidebar-icon mr-3"></i><span class="sidebar-text"> Quản lý phương tiện</span></a>
                        <a href="#" class="web-nav-link flex items-center px-4 py-2 rounded-md text-gray-600 hover:bg-gray-100" data-target="employees-content"><i class="fas fa-user-friends sidebar-icon mr-3"></i><span class="sidebar-text"> Nhân viên</span></a>
                        <a href="#" class="web-nav-link flex items-center px-4 py-2 rounded-md text-gray-600 hover:bg-gray-100" data-target="page-placeholder"><i class="fas fa-calendar-check sidebar-icon mr-3"></i><span class="sidebar-text"> Lịch trình thu gom</span></a>
                        <a href="#" class="web-nav-link flex items-center px-4 py-2 rounded-md text-gray-600 hover:bg-gray-100" data-target="customers-content"><i class="fas fa-user-tag sidebar-icon mr-3"></i><span class="sidebar-text"> Khách hàng</span></a>
                        <a href="#" class="web-nav-link flex items-center px-4 py-2 rounded-md text-gray-600 hover:bg-gray-100" data-target="payment-tracking-content"><i class="fas fa-eye sidebar-icon mr-3"></i><span class="sidebar-text"> Theo dõi thanh toán</span></a>
                        <a href="#" class="web-nav-link flex items-center px-4 py-2 rounded-md text-gray-600 hover:bg-gray-100" data-target="page-placeholder"><i class="fas fa-exclamation-triangle sidebar-icon mr-3"></i><span class="sidebar-text"> Báo cáo sự cố</span></a>
                    </nav></div>
                    <div id="sidebar-dv-thugom" class="sidebar hidden p-4"><nav class="space-y-2">
                        <a href="#" class="web-nav-link flex items-center px-4 py-2 rounded-md text-gray-600 hover:bg-gray-100" data-target="dashboard-dv-thugom"><i class="fas fa-tachometer-alt sidebar-icon mr-3"></i><span class="sidebar-text"> Dashboard</span></a>
                        <a href="#" class="web-nav-link flex items-center px-4 py-2 rounded-md text-gray-600 hover:bg-gray-100" data-target="page-placeholder"><i class="fas fa-map-marked-alt sidebar-icon mr-3"></i><span class="sidebar-text"> Lịch làm việc / Tuyến</span></a>
                        <a href="#" class="web-nav-link flex items-center px-4 py-2 rounded-md text-gray-600 hover:bg-gray-100" data-target="page-placeholder"><i class="fas fa-people-arrows sidebar-icon mr-3"></i><span class="sidebar-text"> Giao việc / Điều phối</span></a>
                        <a href="#" class="web-nav-link flex items-center px-4 py-2 rounded-md text-gray-600 hover:bg-gray-100" data-target="page-placeholder"><i class="fas fa-history sidebar-icon mr-3"></i><span class="sidebar-text"> Lịch sử thu gom</span></a>
                        <a href="#" class="web-nav-link flex items-center px-4 py-2 rounded-md text-gray-600 hover:bg-gray-100" data-target="page-placeholder"><i class="fas fa-comment-dots sidebar-icon mr-3"></i><span class="sidebar-text"> Phản hồi từ người dân</span></a>
                        <a href="#" class="web-nav-link flex items-center px-4 py-2 rounded-md text-gray-600 hover:bg-gray-100" data-target="customers-content"><i class="fas fa-users sidebar-icon mr-3"></i><span class="sidebar-text"> Khách hàng</span></a>
                        <a href="#" class="web-nav-link flex items-center px-4 py-2 rounded-md text-gray-600 hover:bg-gray-100" data-target="employees-content"><i class="fas fa-user-friends sidebar-icon mr-3"></i><span class="sidebar-text"> Nhân viên</span></a>
                        <a href="#" class="web-nav-link flex items-center px-4 py-2 rounded-md text-gray-600 hover:bg-gray-100" data-target="contracts-content"><i class="fas fa-file-signature sidebar-icon mr-3"></i><span class="sidebar-text"> Hợp đồng</span></a>
                        <a href="#" class="web-nav-link flex items-center px-4 py-2 rounded-md text-gray-600 hover:bg-gray-100" data-target="payment-collection-content"><i class="fas fa-money-bill-wave sidebar-icon mr-3"></i><span class="sidebar-text"> Thu tiền</span></a>
                        <a href="#" class="web-nav-link flex items-center px-4 py-2 rounded-md text-gray-600 hover:bg-gray-100" data-target="page-placeholder"><i class="fas fa-tools sidebar-icon mr-3"></i><span class="sidebar-text"> Tình trạng phương tiện</span></a>
                    </nav></div>
                </div>

                <div class="flex-1 flex flex-col bg-gray-50">
                    <header class="bg-white shadow-sm p-4 flex justify-between items-center border-b">
                        <div class="flex items-center">
                            <button id="mobile-menu-toggle" class="md:hidden mr-3 p-2 rounded-md hover:bg-gray-100">
                                <i class="fas fa-bars text-gray-600 text-lg"></i>
                            </button>
                            <div id="breadcrumb" class="text-sm text-gray-500">
                                <a href="#" class="hover:text-blue-600">TRANG CHỦ</a>
                                <span class="mx-2">/</span>
                                <span id="page-name-breadcrumb" class="font-semibold text-gray-700">DASHBOARD</span>
                            </div>
                        </div>
                        <div class="flex items-center space-x-5">
                            <i class="fas fa-bell text-gray-600 cursor-pointer"></i>
                            <i class="fas fa-question-circle text-gray-600 cursor-pointer"></i>
                            <div class="flex items-center space-x-4">
                                <div class="flex items-center">
                                    <img src="https://placehold.co/40x40/E2E8F0/4A5568?text=AV" alt="Avatar" class="w-8 h-8 rounded-full">
                                    <span id="user-role-name" class="ml-2 text-gray-700 font-medium">GRAC Admin</span>
                                </div>
                                <button id="logout-btn" class="text-gray-600 hover:text-red-600 transition-colors" title="Đăng xuất" onclick="logout()">
                                    <i class="fas fa-sign-out-alt"></i>
                                </button>
                            </div>
                        </div>
                    </header>
                    
                    <main class="flex-1 overflow-y-auto p-6">
                        <div id="dashboard-grac-admin" class="web-content-page">
                            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                                <div class="bg-white p-5 rounded-lg shadow-sm"><h3 class="text-sm font-medium text-gray-500">Tổng khách hàng</h3><p class="text-3xl font-bold text-gray-800">8</p></div>
                                <div class="bg-white p-5 rounded-lg shadow-sm"><h3 class="text-sm font-medium text-gray-500">Hợp đồng hoạt động</h3><p class="text-3xl font-bold text-gray-800">8</p></div>
                                <div class="bg-white p-5 rounded-lg shadow-sm"><h3 class="text-sm font-medium text-gray-500">Doanh thu tháng</h3><p class="text-3xl font-bold text-green-600">280.000 ₫</p></div>
                                <div class="bg-white p-5 rounded-lg shadow-sm"><h3 class="text-sm font-medium text-gray-500">Tổng công nợ</h3><p class="text-3xl font-bold text-red-600">280.000 ₫</p></div>
                            </div>
                            <div class="mt-8 bg-white p-6 rounded-lg shadow-sm">
                                <h3 class="text-xl font-semibold mb-4 text-gray-700">Biểu đồ doanh thu toàn hệ thống (6 tháng gần nhất)</h3>
                                <canvas id="revenueChart"></canvas>
                            </div>
                        </div>
                        
                        <div id="customers-content" class="web-content-page hidden">
                             <div class="bg-white p-6 rounded-lg shadow-sm">
                                <div class="flex justify-between items-center mb-4">
                                    <h2 class="text-xl font-bold text-gray-800">Danh sách Khách hàng</h2>
                                    <div class="flex space-x-2">
                                        <button class="bg-white border border-gray-300 text-gray-700 px-4 py-2 rounded-md hover:bg-gray-50 flex items-center"><i class="fas fa-upload mr-2"></i> Import</button>
                                        <button class="bg-white border border-gray-300 text-gray-700 px-4 py-2 rounded-md hover:bg-gray-50 flex items-center"><i class="fas fa-download mr-2"></i> Export</button>
                                        <button id="add-customer-btn" class="bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700 flex items-center"><i class="fas fa-plus mr-2"></i>Thêm mới</button>
                                    </div>
                                </div>
                                <div class="p-4 bg-gray-50 rounded-lg border border-gray-200 mb-4">
                                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                                        <input type="text" placeholder="Tìm kiếm mã, tên, địa chỉ..." class="px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                        <select class="px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"><option>Tất cả khu vực</option></select>
                                        <select class="px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"><option>Tất cả ĐV thu gom</option></select>
                                        <button class="bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700">Tìm kiếm</button>
                                    </div>
                                </div>
                                <div class="flex items-center space-x-6 mb-4 p-4 bg-gray-50 rounded-lg status-filter-container">
                                    <div class="flex items-center space-x-4">
                                        <label class="flex items-center status-filter-all" role="button" tabindex="0" aria-label="Lọc tất cả khách hàng">
                                            <input type="radio" name="status-filter" value="all" class="status-radio" checked>
                                            <span class="ml-2 text-sm font-medium text-gray-700">Tất cả | 8</span>
                                        </label>
                                        <label class="flex items-center status-filter-active" role="button" tabindex="0" aria-label="Lọc khách hàng hoạt động">
                                            <input type="radio" name="status-filter" value="active" class="status-radio">
                                            <span class="ml-2 text-sm font-medium text-gray-700">Hoạt động | 5</span>
                                        </label>
                                        <label class="flex items-center status-filter-inactive" role="button" tabindex="0" aria-label="Lọc khách hàng tạm khoá">
                                            <input type="radio" name="status-filter" value="inactive" class="status-radio">
                                            <span class="ml-2 text-sm font-medium text-gray-700">Tạm khoá | 3</span>
                                        </label>
                                    </div>
                                </div>
                                <div class="overflow-x-auto table-responsive">
                                    <table class="w-full text-sm text-left text-gray-600 customer-table">
                                        <thead class="text-xs text-gray-700 uppercase bg-gray-100">
                                            <tr>
                                                <th scope="col" class="col-stt">STT</th>
                                                <th scope="col" class="col-action">Hành động</th>
                                                <th scope="col" class="col-code">Mã KH</th>
                                                <th scope="col" class="col-name">Tên khách hàng</th>
                                                <th scope="col" class="col-type">Loại KH</th>
                                                <th scope="col" class="col-address allow-wrap">Địa chỉ</th>
                                                <th scope="col" class="col-phone">SĐT</th>
                                                <th scope="col" class="col-unit">ĐV Thu gom</th>
                                                <th scope="col" class="col-status">Trạng thái</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr class="bg-white border-b hover:bg-gray-50 customer-row" data-status="active">
                                                <td class="col-stt">1</td>
                                                <td class="col-action"><a href="#" class="view-customer-detail font-medium text-blue-600 hover:underline">Xem chi tiết</a></td>
                                                <td class="font-medium text-gray-900 col-code">KH001</td>
                                                <td class="col-name">Nguyễn Văn An</td>
                                                <td class="col-type"><span class="status-tag bg-blue-100 text-blue-800">Cá nhân</span></td>
                                                <td class="col-address">123 Lê Lợi, P. Bến Nghé, TP. Hồ Chí Minh</td>
                                                <td class="col-phone">090xxxx123</td>
                                                <td class="col-unit">ĐV Thu gom A</td>
                                                <td class="col-status"><span class="status-tag bg-green-100 text-green-800">Hoạt động</span></td>
                                            </tr>
                                            <tr class="bg-white border-b hover:bg-gray-50 customer-row" data-status="active">
                                                <td class="col-stt">2</td>
                                                <td class="col-action"><a href="#" class="view-customer-detail font-medium text-blue-600 hover:underline">Xem chi tiết</a></td>
                                                <td class="font-medium text-gray-900 col-code">KH002</td>
                                                <td class="col-name">Trần Thị Bích</td>
                                                <td class="col-type"><span class="status-tag bg-blue-100 text-blue-800">Cá nhân</span></td>
                                                <td class="col-address">456 Nguyễn Huệ, P. Bến Nghé, TP. Hồ Chí Minh</td>
                                                <td class="col-phone">091xxxx456</td>
                                                <td class="col-unit">ĐV Thu gom A</td>
                                                <td class="col-status"><span class="status-tag bg-green-100 text-green-800">Hoạt động</span></td>
                                            </tr>
                                            <tr class="bg-white border-b hover:bg-gray-50 customer-row" data-status="inactive">
                                                <td class="px-6 py-4 col-stt">3</td>
                                                <td class="px-6 py-4 col-action"><a href="#" class="view-customer-detail font-medium text-blue-600 hover:underline">Xem chi tiết</a></td>
                                                <td class="px-6 py-4 font-medium text-gray-900 col-code">KH003</td>
                                                <td class="px-6 py-4 col-name">Công ty TNHH ABC</td>
                                                <td class="px-6 py-4 col-type"><span class="status-tag bg-emerald-100 text-emerald-800">Tổ chức</span></td>
                                                <td class="px-6 py-4 col-address">789 Hai Bà Trưng, P. Đa Kao, TP. Hồ Chí Minh</td>
                                                <td class="px-6 py-4 col-phone">098xxxx789</td>
                                                <td class="px-6 py-4 col-unit">ĐV Thu gom B</td>
                                                <td class="px-6 py-4 col-status"><span class="status-tag bg-gray-200 text-gray-800">Tạm khoá</span></td>
                                            </tr>
                                            <tr class="bg-white border-b hover:bg-gray-50 customer-row" data-status="inactive">
                                                <td class="px-6 py-4 col-stt">4</td>
                                                <td class="px-6 py-4 col-action"><a href="#" class="view-customer-detail font-medium text-blue-600 hover:underline">Xem chi tiết</a></td>
                                                <td class="px-6 py-4 font-medium text-gray-900 col-code">KH004</td>
                                                <td class="px-6 py-4 col-name">Công ty CP XYZ</td>
                                                <td class="px-6 py-4 col-type"><span class="status-tag bg-emerald-100 text-emerald-800">Tổ chức</span></td>
                                                <td class="px-6 py-4 col-address">321 Võ Văn Tần, P. 6, TP. Hồ Chí Minh</td>
                                                <td class="px-6 py-4 col-phone">097xxxx321</td>
                                                <td class="px-6 py-4 col-unit">ĐV Thu gom C</td>
                                                <td class="px-6 py-4 col-status"><span class="status-tag bg-gray-200 text-gray-800">Tạm khoá</span></td>
                                            </tr>
                                            <tr class="bg-white border-b hover:bg-gray-50 customer-row" data-status="active">
                                                <td class="px-6 py-4 col-stt">5</td>
                                                <td class="px-6 py-4 col-action"><a href="#" class="view-customer-detail font-medium text-blue-600 hover:underline">Xem chi tiết</a></td>
                                                <td class="px-6 py-4 font-medium text-gray-900 col-code">KH005</td>
                                                <td class="px-6 py-4 col-name">Lê Văn Cường</td>
                                                <td class="px-6 py-4 col-type"><span class="status-tag bg-blue-100 text-blue-800">Cá nhân</span></td>
                                                <td class="px-6 py-4 col-address">555 Trần Hưng Đạo, P. 10, TP. Hồ Chí Minh</td>
                                                <td class="px-6 py-4 col-phone">093xxxx555</td>
                                                <td class="px-6 py-4 col-unit">ĐV Thu gom A</td>
                                                <td class="px-6 py-4 col-status"><span class="status-tag bg-green-100 text-green-800">Hoạt động</span></td>
                                            </tr>
                                            <tr class="bg-white border-b hover:bg-gray-50 customer-row" data-status="active">
                                                <td class="px-6 py-4 col-stt">6</td>
                                                <td class="px-6 py-4 col-action"><a href="#" class="view-customer-detail font-medium text-blue-600 hover:underline">Xem chi tiết</a></td>
                                                <td class="px-6 py-4 font-medium text-gray-900 col-code">KH006</td>
                                                <td class="px-6 py-4 col-name">Phạm Thị Dung</td>
                                                <td class="px-6 py-4 col-type"><span class="status-tag bg-blue-100 text-blue-800">Cá nhân</span></td>
                                                <td class="px-6 py-4 col-address">777 Lý Thường Kiệt, P. 14, TP. Hồ Chí Minh</td>
                                                <td class="px-6 py-4 col-phone">094xxxx777</td>
                                                <td class="px-6 py-4 col-unit">ĐV Thu gom B</td>
                                                <td class="px-6 py-4 col-status"><span class="status-tag bg-green-100 text-green-800">Hoạt động</span></td>
                                            </tr>
                                            <tr class="bg-white border-b hover:bg-gray-50 customer-row" data-status="inactive">
                                                <td class="px-6 py-4 col-stt">7</td>
                                                <td class="px-6 py-4 col-action"><a href="#" class="view-customer-detail font-medium text-blue-600 hover:underline">Xem chi tiết</a></td>
                                                <td class="px-6 py-4 font-medium text-gray-900 col-code">KH007</td>
                                                <td class="px-6 py-4 col-name">Công ty TNHH DEF</td>
                                                <td class="px-6 py-4 col-type"><span class="status-tag bg-emerald-100 text-emerald-800">Tổ chức</span></td>
                                                <td class="px-6 py-4 col-address">888 Cách Mạng Tháng 8, P. 7, TP. Hồ Chí Minh</td>
                                                <td class="px-6 py-4 col-phone">095xxxx888</td>
                                                <td class="px-6 py-4 col-unit">ĐV Thu gom C</td>
                                                <td class="px-6 py-4 col-status"><span class="status-tag bg-gray-200 text-gray-800">Tạm khoá</span></td>
                                            </tr>
                                            <tr class="bg-white border-b hover:bg-gray-50 customer-row" data-status="active">
                                                <td class="px-6 py-4 col-stt">8</td>
                                                <td class="px-6 py-4 col-action"><a href="#" class="view-customer-detail font-medium text-blue-600 hover:underline">Xem chi tiết</a></td>
                                                <td class="px-6 py-4 font-medium text-gray-900 col-code">KH008</td>
                                                <td class="px-6 py-4 col-name">Võ Hoàng Nam</td>
                                                <td class="px-6 py-4 col-type"><span class="status-tag bg-blue-100 text-blue-800">Cá nhân</span></td>
                                                <td class="px-6 py-4 col-address">999 Nguyễn Thị Minh Khai, P. 6, TP. Hồ Chí Minh</td>
                                                <td class="px-6 py-4 col-phone">096xxxx999</td>
                                                <td class="px-6 py-4 col-unit">ĐV Thu gom A</td>
                                                <td class="px-6 py-4 col-status"><span class="status-tag bg-green-100 text-green-800">Hoạt động</span></td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                                
                                <!-- Mobile Card View -->
                                <div class="mobile-card-view">
                                    <div class="mobile-card customer-row" data-status="active">
                                        <div class="mobile-card-header">
                                            <div class="mobile-card-title">Nguyễn Văn An</div>
                                            <span class="mobile-card-status bg-green-100 text-green-800">Hoạt động</span>
                                        </div>
                                        <div class="mobile-card-content">
                                            <div class="mobile-card-row">
                                                <span class="mobile-card-label">Mã KH:</span>
                                                <span class="mobile-card-value">KH001</span>
                                            </div>
                                            <div class="mobile-card-row">
                                                <span class="mobile-card-label">Loại KH:</span>
                                                <span class="mobile-card-value">Cá nhân</span>
                                            </div>
                                            <div class="mobile-card-row">
                                                <span class="mobile-card-label">SĐT:</span>
                                                <span class="mobile-card-value">090xxxx123</span>
                                            </div>
                                            <div class="mobile-card-row">
                                                <span class="mobile-card-label">ĐV Thu gom:</span>
                                                <span class="mobile-card-value">ĐV Thu gom A</span>
                                            </div>
                                            <div class="mobile-card-row">
                                                <span class="mobile-card-label">Địa chỉ:</span>
                                                <span class="mobile-card-value">123 Lê Lợi, P. Bến Nghé, TP. Hồ Chí Minh</span>
                                            </div>
                                        </div>
                                        <div class="mobile-card-actions">
                                            <a href="#" class="mobile-card-action-btn view-customer-detail">Xem chi tiết</a>
                                        </div>
                                    </div>
                                    
                                    <div class="mobile-card customer-row" data-status="active">
                                        <div class="mobile-card-header">
                                            <div class="mobile-card-title">Trần Thị Bích</div>
                                            <span class="mobile-card-status bg-green-100 text-green-800">Hoạt động</span>
                                        </div>
                                        <div class="mobile-card-content">
                                            <div class="mobile-card-row">
                                                <span class="mobile-card-label">Mã KH:</span>
                                                <span class="mobile-card-value">KH002</span>
                                            </div>
                                            <div class="mobile-card-row">
                                                <span class="mobile-card-label">Loại KH:</span>
                                                <span class="mobile-card-value">Cá nhân</span>
                                            </div>
                                            <div class="mobile-card-row">
                                                <span class="mobile-card-label">SĐT:</span>
                                                <span class="mobile-card-value">091xxxx456</span>
                                            </div>
                                            <div class="mobile-card-row">
                                                <span class="mobile-card-label">ĐV Thu gom:</span>
                                                <span class="mobile-card-value">ĐV Thu gom A</span>
                                            </div>
                                            <div class="mobile-card-row">
                                                <span class="mobile-card-label">Địa chỉ:</span>
                                                <span class="mobile-card-value">456 Nguyễn Huệ, P. Bến Nghé, TP. Hồ Chí Minh</span>
                                            </div>
                                        </div>
                                        <div class="mobile-card-actions">
                                            <a href="#" class="mobile-card-action-btn view-customer-detail">Xem chi tiết</a>
                                        </div>
                                    </div>
                                    
                                    <div class="mobile-card customer-row" data-status="inactive">
                                        <div class="mobile-card-header">
                                            <div class="mobile-card-title">Công ty TNHH ABC</div>
                                            <span class="mobile-card-status bg-gray-200 text-gray-800">Tạm khoá</span>
                                        </div>
                                        <div class="mobile-card-content">
                                            <div class="mobile-card-row">
                                                <span class="mobile-card-label">Mã KH:</span>
                                                <span class="mobile-card-value">KH003</span>
                                            </div>
                                            <div class="mobile-card-row">
                                                <span class="mobile-card-label">Loại KH:</span>
                                                <span class="mobile-card-value">Tổ chức</span>
                                            </div>
                                            <div class="mobile-card-row">
                                                <span class="mobile-card-label">SĐT:</span>
                                                <span class="mobile-card-value">098xxxx789</span>
                                            </div>
                                            <div class="mobile-card-row">
                                                <span class="mobile-card-label">ĐV Thu gom:</span>
                                                <span class="mobile-card-value">ĐV Thu gom B</span>
                                            </div>
                                            <div class="mobile-card-row">
                                                <span class="mobile-card-label">Địa chỉ:</span>
                                                <span class="mobile-card-value">789 Hai Bà Trưng, P. Đa Kao, TP. Hồ Chí Minh</span>
                                            </div>
                                        </div>
                                        <div class="mobile-card-actions">
                                            <a href="#" class="mobile-card-action-btn view-customer-detail">Xem chi tiết</a>
                                        </div>
                                    </div>
                                    
                                    <div class="mobile-card customer-row" data-status="inactive">
                                        <div class="mobile-card-header">
                                            <div class="mobile-card-title">Công ty CP XYZ</div>
                                            <span class="mobile-card-status bg-gray-200 text-gray-800">Tạm khoá</span>
                                        </div>
                                        <div class="mobile-card-content">
                                            <div class="mobile-card-row">
                                                <span class="mobile-card-label">Mã KH:</span>
                                                <span class="mobile-card-value">KH004</span>
                                            </div>
                                            <div class="mobile-card-row">
                                                <span class="mobile-card-label">Loại KH:</span>
                                                <span class="mobile-card-value">Tổ chức</span>
                                            </div>
                                            <div class="mobile-card-row">
                                                <span class="mobile-card-label">SĐT:</span>
                                                <span class="mobile-card-value">097xxxx321</span>
                                            </div>
                                            <div class="mobile-card-row">
                                                <span class="mobile-card-label">ĐV Thu gom:</span>
                                                <span class="mobile-card-value">ĐV Thu gom C</span>
                                            </div>
                                            <div class="mobile-card-row">
                                                <span class="mobile-card-label">Địa chỉ:</span>
                                                <span class="mobile-card-value">321 Võ Văn Tần, P. 6, TP. Hồ Chí Minh</span>
                                            </div>
                                        </div>
                                        <div class="mobile-card-actions">
                                            <a href="#" class="mobile-card-action-btn view-customer-detail">Xem chi tiết</a>
                                        </div>
                                    </div>
                                    
                                    <div class="mobile-card customer-row" data-status="active">
                                        <div class="mobile-card-header">
                                            <div class="mobile-card-title">Lê Văn Cường</div>
                                            <span class="mobile-card-status bg-green-100 text-green-800">Hoạt động</span>
                                        </div>
                                        <div class="mobile-card-content">
                                            <div class="mobile-card-row">
                                                <span class="mobile-card-label">Mã KH:</span>
                                                <span class="mobile-card-value">KH005</span>
                                            </div>
                                            <div class="mobile-card-row">
                                                <span class="mobile-card-label">Loại KH:</span>
                                                <span class="mobile-card-value">Cá nhân</span>
                                            </div>
                                            <div class="mobile-card-row">
                                                <span class="mobile-card-label">SĐT:</span>
                                                <span class="mobile-card-value">093xxxx555</span>
                                            </div>
                                            <div class="mobile-card-row">
                                                <span class="mobile-card-label">ĐV Thu gom:</span>
                                                <span class="mobile-card-value">ĐV Thu gom A</span>
                                            </div>
                                            <div class="mobile-card-row">
                                                <span class="mobile-card-label">Địa chỉ:</span>
                                                <span class="mobile-card-value">555 Trần Hưng Đạo, P. 10, TP. Hồ Chí Minh</span>
                                            </div>
                                        </div>
                                        <div class="mobile-card-actions">
                                            <a href="#" class="mobile-card-action-btn view-customer-detail">Xem chi tiết</a>
                                        </div>
                                    </div>
                                    
                                    <div class="mobile-card customer-row" data-status="active">
                                        <div class="mobile-card-header">
                                            <div class="mobile-card-title">Phạm Thị Dung</div>
                                            <span class="mobile-card-status bg-green-100 text-green-800">Hoạt động</span>
                                        </div>
                                        <div class="mobile-card-content">
                                            <div class="mobile-card-row">
                                                <span class="mobile-card-label">Mã KH:</span>
                                                <span class="mobile-card-value">KH006</span>
                                            </div>
                                            <div class="mobile-card-row">
                                                <span class="mobile-card-label">Loại KH:</span>
                                                <span class="mobile-card-value">Cá nhân</span>
                                            </div>
                                            <div class="mobile-card-row">
                                                <span class="mobile-card-label">SĐT:</span>
                                                <span class="mobile-card-value">094xxxx777</span>
                                            </div>
                                            <div class="mobile-card-row">
                                                <span class="mobile-card-label">ĐV Thu gom:</span>
                                                <span class="mobile-card-value">ĐV Thu gom B</span>
                                            </div>
                                            <div class="mobile-card-row">
                                                <span class="mobile-card-label">Địa chỉ:</span>
                                                <span class="mobile-card-value">777 Lý Thường Kiệt, P. 14, TP. Hồ Chí Minh</span>
                                            </div>
                                        </div>
                                        <div class="mobile-card-actions">
                                            <a href="#" class="mobile-card-action-btn view-customer-detail">Xem chi tiết</a>
                                        </div>
                                    </div>
                                    
                                    <div class="mobile-card customer-row" data-status="inactive">
                                        <div class="mobile-card-header">
                                            <div class="mobile-card-title">Công ty TNHH DEF</div>
                                            <span class="mobile-card-status bg-gray-200 text-gray-800">Tạm khoá</span>
                                        </div>
                                        <div class="mobile-card-content">
                                            <div class="mobile-card-row">
                                                <span class="mobile-card-label">Mã KH:</span>
                                                <span class="mobile-card-value">KH007</span>
                                            </div>
                                            <div class="mobile-card-row">
                                                <span class="mobile-card-label">Loại KH:</span>
                                                <span class="mobile-card-value">Tổ chức</span>
                                            </div>
                                            <div class="mobile-card-row">
                                                <span class="mobile-card-label">SĐT:</span>
                                                <span class="mobile-card-value">095xxxx888</span>
                                            </div>
                                            <div class="mobile-card-row">
                                                <span class="mobile-card-label">ĐV Thu gom:</span>
                                                <span class="mobile-card-value">ĐV Thu gom C</span>
                                            </div>
                                            <div class="mobile-card-row">
                                                <span class="mobile-card-label">Địa chỉ:</span>
                                                <span class="mobile-card-value">888 Cách Mạng Tháng 8, P. 7, TP. Hồ Chí Minh</span>
                                            </div>
                                        </div>
                                        <div class="mobile-card-actions">
                                            <a href="#" class="mobile-card-action-btn view-customer-detail">Xem chi tiết</a>
                                        </div>
                                    </div>
                                    
                                    <div class="mobile-card customer-row" data-status="active">
                                        <div class="mobile-card-header">
                                            <div class="mobile-card-title">Võ Hoàng Nam</div>
                                            <span class="mobile-card-status bg-green-100 text-green-800">Hoạt động</span>
                                        </div>
                                        <div class="mobile-card-content">
                                            <div class="mobile-card-row">
                                                <span class="mobile-card-label">Mã KH:</span>
                                                <span class="mobile-card-value">KH008</span>
                                            </div>
                                            <div class="mobile-card-row">
                                                <span class="mobile-card-label">Loại KH:</span>
                                                <span class="mobile-card-value">Cá nhân</span>
                                            </div>
                                            <div class="mobile-card-row">
                                                <span class="mobile-card-label">SĐT:</span>
                                                <span class="mobile-card-value">096xxxx999</span>
                                            </div>
                                            <div class="mobile-card-row">
                                                <span class="mobile-card-label">ĐV Thu gom:</span>
                                                <span class="mobile-card-value">ĐV Thu gom A</span>
                                            </div>
                                            <div class="mobile-card-row">
                                                <span class="mobile-card-label">Địa chỉ:</span>
                                                <span class="mobile-card-value">999 Nguyễn Thị Minh Khai, P. 6, TP. Hồ Chí Minh</span>
                                            </div>
                                        </div>
                                        <div class="mobile-card-actions">
                                            <a href="#" class="mobile-card-action-btn view-customer-detail">Xem chi tiết</a>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Pagination -->
                                <div class="pagination-container">
                                    <div class="pagination-info">
                                        Hiển thị <span id="pagination-start">1</span> - <span id="pagination-end">5</span> của <span id="pagination-total">8</span> khách hàng
                                    </div>
                                    <div class="pagination-controls">
                                        <button class="pagination-button" id="pagination-prev" disabled>
                                            <i class="fas fa-chevron-left"></i>
                                        </button>
                                        <button class="pagination-button active" data-page="1">1</button>
                                        <button class="pagination-button" data-page="2">2</button>
                                        <button class="pagination-button" id="pagination-next">
                                            <i class="fas fa-chevron-right"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div id="customer-detail-content" class="web-content-page hidden">
                            <div class="bg-white p-6 rounded-lg shadow-sm customer-detail-content">
                                <div class="flex justify-between items-center mb-6 customer-detail-header">
                                    <button id="back-to-customer-list" class="flex items-center text-sm text-gray-600 hover:text-blue-600"><i class="fas fa-arrow-left mr-2"></i> Quay lại danh sách</button>
                                    <div class="flex space-x-2">
                                        <button class="bg-red-500 text-white px-4 py-2 rounded-md hover:bg-red-600 text-sm">Khóa tài khoản</button>
                                        <button class="bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700 text-sm">Sửa thông tin</button>
                                    </div>
                                </div>
                                <div class="flex items-center mb-6">
                                    <h2 class="text-2xl font-bold text-gray-800">Công ty TNHH ABC</h2>
                                    <span class="ml-4 status-tag bg-gray-200 text-gray-800">Tạm khoá</span>
                                </div>
                                
                                <div class="border-b border-gray-200 customer-detail-tabs">
                                    <nav class="-mb-px flex space-x-8" aria-label="Tabs">
                                        <button class="detail-tab whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm text-gray-500 hover:text-blue-600 hover:border-gray-300 active" data-target="tab-info">Thông tin chung</button>
                                        <button class="detail-tab whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm text-gray-500 hover:text-blue-600 hover:border-gray-300" data-target="tab-address">Sổ địa chỉ</button>
                                        <button class="detail-tab whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm text-gray-500 hover:text-blue-600 hover:border-gray-300" data-target="tab-contacts">Danh sách liên hệ</button>
                                        <button class="detail-tab whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm text-gray-500 hover:text-blue-600 hover:border-gray-300" data-target="tab-contracts">Danh sách hợp đồng</button>
                                        <button class="detail-tab whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm text-gray-500 hover:text-blue-600 hover:border-gray-300" data-target="tab-history">Lịch sử thanh toán</button>
                                    </nav>
                                </div>

                                <div class="mt-6">
                                    <div id="tab-info" class="detail-tab-content">
                                        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 customer-detail-grid">
                                            <div class="md:col-span-2 bg-gray-50 p-4 rounded-lg customer-detail-info">
                                                <h3 class="font-semibold mb-4">Thông tin chi tiết</h3>
                                                <div class="grid grid-cols-2 gap-4 text-sm">
                                                    <p><strong class="text-gray-600">Mã khách hàng:</strong> KH003</p>
                                                    <p><strong class="text-gray-600">Loại khách hàng:</strong> Tổ chức</p>
                                                    <p><strong class="text-gray-600">Số điện thoại:</strong> 098xxxx789</p>
                                                    <p><strong class="text-gray-600">Email:</strong> contact@abc.com</p>
                                                    <p class="col-span-2"><strong class="text-gray-600">Ghi chú:</strong> Tạm ngưng kinh doanh</p>
                                                </div>
                                            </div>
                                            <div class="bg-red-50 p-3 md:p-4 rounded-lg text-center customer-detail-debt">
                                                <h3 class="font-semibold mb-2 text-sm md:text-base">Thông tin công nợ</h3>
                                                <p class="text-xs md:text-sm text-gray-600">Tổng nợ hiện tại</p>
                                                <p class="text-2xl md:text-3xl font-bold text-red-600">105.000 ₫</p>
                                                <button id="collect-payment-from-detail" class="mt-3 w-full bg-green-600 text-white px-3 py-2 md:px-4 rounded-md hover:bg-green-700 text-xs md:text-sm font-medium transition-colors">
                                                    <i class="fas fa-money-bill-wave mr-1 md:mr-2"></i>
                                                    Thu tiền
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                    <div id="tab-address" class="detail-tab-content hidden">
                                        <div class="flex justify-between items-center mb-4">
                                            <h3 class="text-lg font-semibold text-gray-800">Sổ địa chỉ</h3>
                                            <button class="bg-blue-600 text-white px-3 py-1 rounded-md text-sm hover:bg-blue-700">Thêm địa chỉ</button>
                                        </div>
                                        <div class="overflow-x-auto table-responsive">
                                            <table class="w-full text-sm text-left text-gray-600">
                                                <thead class="text-xs text-gray-700 uppercase bg-gray-100">
                                                    <tr>
                                                        <th scope="col" class="px-6 py-3">STT</th>
                                                        <th scope="col" class="px-6 py-3">Hành động</th>
                                                        <th scope="col" class="px-6 py-3">Loại địa chỉ</th>
                                                        <th scope="col" class="px-6 py-3">Địa chỉ chi tiết</th>
                                                        <th scope="col" class="px-6 py-3">Phường/Xã</th>
                                                        <th scope="col" class="px-6 py-3">Tỉnh/TP</th>
                                                        <th scope="col" class="px-6 py-3">Trạng thái</th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    <tr class="bg-white border-b hover:bg-gray-50">
                                                        <td class="px-6 py-4">1</td>
                                                        <td class="px-6 py-4">
                                                            <div class="flex space-x-2">
                                                                <button class="text-blue-600 hover:text-blue-800 text-sm">Sửa</button>
                                                                <button class="text-red-600 hover:text-red-800 text-sm">Xóa</button>
                                                            </div>
                                                        </td>
                                                        <td class="px-6 py-4"><span class="status-tag bg-blue-100 text-blue-800">Địa chỉ chính</span></td>
                                                        <td class="px-6 py-4">789 Hai Bà Trưng</td>
                                                        <td class="px-6 py-4">Phường Đa Kao</td>
                                                        <td class="px-6 py-4">TP. Hồ Chí Minh</td>
                                                        <td class="px-6 py-4"><span class="status-tag bg-green-100 text-green-800">Hoạt động</span></td>
                                                    </tr>
                                                    <tr class="bg-white border-b hover:bg-gray-50">
                                                        <td class="px-6 py-4">2</td>
                                                        <td class="px-6 py-4">
                                                            <div class="flex space-x-2">
                                                                <button class="text-blue-600 hover:text-blue-800 text-sm">Sửa</button>
                                                                <button class="text-red-600 hover:text-red-800 text-sm">Xóa</button>
                                                            </div>
                                                        </td>
                                                        <td class="px-6 py-4"><span class="status-tag bg-gray-100 text-gray-800">Địa chỉ phụ</span></td>
                                                        <td class="px-6 py-4">456 Nguyễn Huệ</td>
                                                        <td class="px-6 py-4">Phường Bến Nghé</td>
                                                        <td class="px-6 py-4">TP. Hồ Chí Minh</td>
                                                        <td class="px-6 py-4"><span class="status-tag bg-gray-200 text-gray-800">Tạm ngưng</span></td>
                                                    </tr>
                                                </tbody>
                                            </table>
                                        </div>
                                        
                                        <!-- Mobile Card View for Address -->
                                        <div class="mobile-card-view">
                                            <div class="mobile-card">
                                                <div class="mobile-card-header">
                                                    <div class="mobile-card-title">789 Hai Bà Trưng</div>
                                                    <span class="mobile-card-status bg-blue-100 text-blue-800">Địa chỉ chính</span>
                                                </div>
                                                <div class="mobile-card-content">
                                                    <div class="mobile-card-row">
                                                        <span class="mobile-card-label">Phường/Xã:</span>
                                                        <span class="mobile-card-value">Phường Đa Kao</span>
                                                    </div>
                                                    <div class="mobile-card-row">
                                                        <span class="mobile-card-label">Tỉnh/TP:</span>
                                                        <span class="mobile-card-value">TP. Hồ Chí Minh</span>
                                                    </div>
                                                    <div class="mobile-card-row">
                                                        <span class="mobile-card-label">Trạng thái:</span>
                                                        <span class="mobile-card-value"><span class="status-tag bg-green-100 text-green-800">Hoạt động</span></span>
                                                    </div>
                                                </div>
                                                <div class="mobile-card-actions">
                                                    <button class="mobile-card-action-btn text-blue-600">Sửa</button>
                                                    <button class="mobile-card-action-btn text-red-600">Xóa</button>
                                                </div>
                                            </div>
                                            
                                            <div class="mobile-card">
                                                <div class="mobile-card-header">
                                                    <div class="mobile-card-title">456 Nguyễn Huệ</div>
                                                    <span class="mobile-card-status bg-gray-100 text-gray-800">Địa chỉ phụ</span>
                                                </div>
                                                <div class="mobile-card-content">
                                                    <div class="mobile-card-row">
                                                        <span class="mobile-card-label">Phường/Xã:</span>
                                                        <span class="mobile-card-value">Phường Bến Nghé</span>
                                                    </div>
                                                    <div class="mobile-card-row">
                                                        <span class="mobile-card-label">Tỉnh/TP:</span>
                                                        <span class="mobile-card-value">TP. Hồ Chí Minh</span>
                                                    </div>
                                                    <div class="mobile-card-row">
                                                        <span class="mobile-card-label">Trạng thái:</span>
                                                        <span class="mobile-card-value"><span class="status-tag bg-gray-200 text-gray-800">Tạm ngưng</span></span>
                                                    </div>
                                                </div>
                                                <div class="mobile-card-actions">
                                                    <button class="mobile-card-action-btn text-blue-600">Sửa</button>
                                                    <button class="mobile-card-action-btn text-red-600">Xóa</button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div id="tab-contacts" class="detail-tab-content hidden">
                                        <div class="flex justify-between items-center mb-4">
                                            <h3 class="text-lg font-semibold text-gray-800">Danh sách liên hệ</h3>
                                            <button class="bg-blue-600 text-white px-3 py-1 rounded-md text-sm hover:bg-blue-700">Thêm liên hệ</button>
                                        </div>
                                        <div class="overflow-x-auto table-responsive">
                                            <table class="w-full text-sm text-left text-gray-600">
                                                <thead class="text-xs text-gray-700 uppercase bg-gray-100">
                                                    <tr>
                                                        <th scope="col" class="px-6 py-3">STT</th>
                                                        <th scope="col" class="px-6 py-3">Hành động</th>
                                                        <th scope="col" class="px-6 py-3">Họ tên</th>
                                                        <th scope="col" class="px-6 py-3">Chức vụ</th>
                                                        <th scope="col" class="px-6 py-3">Số điện thoại</th>
                                                        <th scope="col" class="px-6 py-3">Email</th>
                                                        <th scope="col" class="px-6 py-3">Loại liên hệ</th>
                                                        <th scope="col" class="px-6 py-3">Trạng thái</th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    <tr class="bg-white border-b hover:bg-gray-50">
                                                        <td class="px-6 py-4">1</td>
                                                        <td class="px-6 py-4">
                                                            <div class="flex space-x-2">
                                                                <button class="text-blue-600 hover:text-blue-800 text-sm">Sửa</button>
                                                                <button class="text-red-600 hover:text-red-800 text-sm">Xóa</button>
                                                            </div>
                                                        </td>
                                                        <td class="px-6 py-4 font-medium">Nguyễn Văn Minh</td>
                                                        <td class="px-6 py-4">Giám đốc</td>
                                                        <td class="px-6 py-4">098xxxx789</td>
                                                        <td class="px-6 py-4">minh@abc.com</td>
                                                        <td class="px-6 py-4"><span class="status-tag bg-blue-100 text-blue-800">Liên hệ chính</span></td>
                                                        <td class="px-6 py-4"><span class="status-tag bg-green-100 text-green-800">Hoạt động</span></td>
                                                    </tr>
                                                    <tr class="bg-white border-b hover:bg-gray-50">
                                                        <td class="px-6 py-4">2</td>
                                                        <td class="px-6 py-4">
                                                            <div class="flex space-x-2">
                                                                <button class="text-blue-600 hover:text-blue-800 text-sm">Sửa</button>
                                                                <button class="text-red-600 hover:text-red-800 text-sm">Xóa</button>
                                                            </div>
                                                        </td>
                                                        <td class="px-6 py-4 font-medium">Trần Thị Lan</td>
                                                        <td class="px-6 py-4">Kế toán</td>
                                                        <td class="px-6 py-4">090xxxx456</td>
                                                        <td class="px-6 py-4">lan@abc.com</td>
                                                        <td class="px-6 py-4"><span class="status-tag bg-gray-100 text-gray-800">Liên hệ phụ</span></td>
                                                        <td class="px-6 py-4"><span class="status-tag bg-green-100 text-green-800">Hoạt động</span></td>
                                                    </tr>
                                                </tbody>
                                            </table>
                                        </div>
                                        
                                        <!-- Mobile Card View for Contacts -->
                                        <div class="mobile-card-view">
                                            <div class="mobile-card">
                                                <div class="mobile-card-header">
                                                    <div class="mobile-card-title">Nguyễn Văn Minh</div>
                                                    <span class="mobile-card-status bg-blue-100 text-blue-800">Liên hệ chính</span>
                                                </div>
                                                <div class="mobile-card-content">
                                                    <div class="mobile-card-row">
                                                        <span class="mobile-card-label">Chức vụ:</span>
                                                        <span class="mobile-card-value">Giám đốc</span>
                                                    </div>
                                                    <div class="mobile-card-row">
                                                        <span class="mobile-card-label">Số điện thoại:</span>
                                                        <span class="mobile-card-value">098xxxx789</span>
                                                    </div>
                                                    <div class="mobile-card-row">
                                                        <span class="mobile-card-label">Email:</span>
                                                        <span class="mobile-card-value">minh@abc.com</span>
                                                    </div>
                                                    <div class="mobile-card-row">
                                                        <span class="mobile-card-label">Trạng thái:</span>
                                                        <span class="mobile-card-value"><span class="status-tag bg-green-100 text-green-800">Hoạt động</span></span>
                                                    </div>
                                                </div>
                                                <div class="mobile-card-actions">
                                                    <button class="mobile-card-action-btn text-blue-600">Sửa</button>
                                                    <button class="mobile-card-action-btn text-red-600">Xóa</button>
                                                </div>
                                            </div>
                                            
                                            <div class="mobile-card">
                                                <div class="mobile-card-header">
                                                    <div class="mobile-card-title">Trần Thị Lan</div>
                                                    <span class="mobile-card-status bg-gray-100 text-gray-800">Liên hệ phụ</span>
                                                </div>
                                                <div class="mobile-card-content">
                                                    <div class="mobile-card-row">
                                                        <span class="mobile-card-label">Chức vụ:</span>
                                                        <span class="mobile-card-value">Kế toán</span>
                                                    </div>
                                                    <div class="mobile-card-row">
                                                        <span class="mobile-card-label">Số điện thoại:</span>
                                                        <span class="mobile-card-value">090xxxx456</span>
                                                    </div>
                                                    <div class="mobile-card-row">
                                                        <span class="mobile-card-label">Email:</span>
                                                        <span class="mobile-card-value">lan@abc.com</span>
                                                    </div>
                                                    <div class="mobile-card-row">
                                                        <span class="mobile-card-label">Trạng thái:</span>
                                                        <span class="mobile-card-value"><span class="status-tag bg-green-100 text-green-800">Hoạt động</span></span>
                                                    </div>
                                                </div>
                                                <div class="mobile-card-actions">
                                                    <button class="mobile-card-action-btn text-blue-600">Sửa</button>
                                                    <button class="mobile-card-action-btn text-red-600">Xóa</button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div id="tab-contracts" class="detail-tab-content hidden">
                                        <div class="flex justify-between items-center mb-4">
                                            <h3 class="text-lg font-semibold text-gray-800">Danh sách hợp đồng</h3>
                                            <button class="bg-blue-600 text-white px-3 py-1 rounded-md text-sm hover:bg-blue-700">Thêm hợp đồng</button>
                                        </div>
                                        <div class="overflow-x-auto table-responsive">
                                            <table class="w-full text-sm text-left text-gray-600">
                                                <thead class="text-xs text-gray-700 uppercase bg-gray-100">
                                                    <tr>
                                                        <th scope="col" class="px-6 py-3">STT</th>
                                                        <th scope="col" class="px-6 py-3">Hành động</th>
                                                        <th scope="col" class="px-6 py-3">Mã HĐ</th>
                                                        <th scope="col" class="px-6 py-3">Tên hợp đồng</th>
                                                        <th scope="col" class="px-6 py-3">ĐV Thu gom</th>
                                                        <th scope="col" class="px-6 py-3">Ngày ký</th>
                                                        <th scope="col" class="px-6 py-3">Ngày hết hạn</th>
                                                        <th scope="col" class="px-6 py-3">Giá trị</th>
                                                        <th scope="col" class="px-6 py-3">Trạng thái</th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    <tr class="bg-white border-b hover:bg-gray-50">
                                                        <td class="px-6 py-4">1</td>
                                                        <td class="px-6 py-4">
                                                            <div class="flex space-x-2">
                                                                <button class="text-blue-600 hover:text-blue-800 text-sm">Xem</button>
                                                                <button class="text-green-600 hover:text-green-800 text-sm">Sửa</button>
                                                            </div>
                                                        </td>
                                                        <td class="px-6 py-4 font-medium">HD002</td>
                                                        <td class="px-6 py-4">Hợp đồng thu gom rác KH003</td>
                                                        <td class="px-6 py-4">ĐV Thu gom B</td>
                                                        <td class="px-6 py-4">01/01/2024</td>
                                                        <td class="px-6 py-4">31/12/2024</td>
                                                        <td class="px-6 py-4 font-semibold">1.260.000 ₫</td>
                                                        <td class="px-6 py-4"><span class="status-tag bg-gray-200 text-gray-800">Tạm khóa</span></td>
                                                    </tr>
                                                    <tr class="bg-white border-b hover:bg-gray-50">
                                                        <td class="px-6 py-4">2</td>
                                                        <td class="px-6 py-4">
                                                            <div class="flex space-x-2">
                                                                <button class="text-blue-600 hover:text-blue-800 text-sm">Xem</button>
                                                                <button class="text-green-600 hover:text-green-800 text-sm">Sửa</button>
                                                            </div>
                                                        </td>
                                                        <td class="px-6 py-4 font-medium">HD002-2023</td>
                                                        <td class="px-6 py-4">Hợp đồng thu gom rác KH003 (2023)</td>
                                                        <td class="px-6 py-4">ĐV Thu gom B</td>
                                                        <td class="px-6 py-4">01/01/2023</td>
                                                        <td class="px-6 py-4">31/12/2023</td>
                                                        <td class="px-6 py-4 font-semibold">1.200.000 ₫</td>
                                                        <td class="px-6 py-4"><span class="status-tag bg-gray-100 text-gray-800">Đã kết thúc</span></td>
                                                    </tr>
                                                </tbody>
                                            </table>
                                        </div>
                                        
                                        <!-- Mobile Card View for Contracts -->
                                        <div class="mobile-card-view">
                                            <div class="mobile-card">
                                                <div class="mobile-card-header">
                                                    <div class="mobile-card-title">Hợp đồng thu gom rác KH003</div>
                                                    <span class="mobile-card-status bg-gray-200 text-gray-800">Tạm khóa</span>
                                                </div>
                                                <div class="mobile-card-content">
                                                    <div class="mobile-card-row">
                                                        <span class="mobile-card-label">Mã HĐ:</span>
                                                        <span class="mobile-card-value">HD002</span>
                                                    </div>
                                                    <div class="mobile-card-row">
                                                        <span class="mobile-card-label">ĐV Thu gom:</span>
                                                        <span class="mobile-card-value">ĐV Thu gom B</span>
                                                    </div>
                                                    <div class="mobile-card-row">
                                                        <span class="mobile-card-label">Ngày ký:</span>
                                                        <span class="mobile-card-value">01/01/2024</span>
                                                    </div>
                                                    <div class="mobile-card-row">
                                                        <span class="mobile-card-label">Ngày hết hạn:</span>
                                                        <span class="mobile-card-value">31/12/2024</span>
                                                    </div>
                                                    <div class="mobile-card-row">
                                                        <span class="mobile-card-label">Giá trị:</span>
                                                        <span class="mobile-card-value font-semibold">1.260.000 ₫</span>
                                                    </div>
                                                </div>
                                                <div class="mobile-card-actions">
                                                    <button class="mobile-card-action-btn text-blue-600">Xem</button>
                                                    <button class="mobile-card-action-btn text-green-600">Sửa</button>
                                                </div>
                                            </div>
                                            
                                            <div class="mobile-card">
                                                <div class="mobile-card-header">
                                                    <div class="mobile-card-title">Hợp đồng thu gom rác KH003 (2023)</div>
                                                    <span class="mobile-card-status bg-gray-100 text-gray-800">Đã kết thúc</span>
                                                </div>
                                                <div class="mobile-card-content">
                                                    <div class="mobile-card-row">
                                                        <span class="mobile-card-label">Mã HĐ:</span>
                                                        <span class="mobile-card-value">HD002-2023</span>
                                                    </div>
                                                    <div class="mobile-card-row">
                                                        <span class="mobile-card-label">ĐV Thu gom:</span>
                                                        <span class="mobile-card-value">ĐV Thu gom B</span>
                                                    </div>
                                                    <div class="mobile-card-row">
                                                        <span class="mobile-card-label">Ngày ký:</span>
                                                        <span class="mobile-card-value">01/01/2023</span>
                                                    </div>
                                                    <div class="mobile-card-row">
                                                        <span class="mobile-card-label">Ngày hết hạn:</span>
                                                        <span class="mobile-card-value">31/12/2023</span>
                                                    </div>
                                                    <div class="mobile-card-row">
                                                        <span class="mobile-card-label">Giá trị:</span>
                                                        <span class="mobile-card-value font-semibold">1.200.000 ₫</span>
                                                    </div>
                                                </div>
                                                <div class="mobile-card-actions">
                                                    <button class="mobile-card-action-btn text-blue-600">Xem</button>
                                                    <button class="mobile-card-action-btn text-green-600">Sửa</button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div id="tab-history" class="detail-tab-content hidden">
                                        <div class="flex justify-between items-center mb-4">
                                            <h3 class="text-lg font-semibold text-gray-800">Lịch sử thanh toán</h3>
                                            <div class="flex space-x-2">
                                                <button class="bg-white border border-gray-300 text-gray-700 px-3 py-1 rounded-md text-sm hover:bg-gray-50">Xuất báo cáo</button>
                                                <button class="bg-white border border-gray-300 text-gray-700 px-3 py-1 rounded-md text-sm hover:bg-gray-50">Lọc</button>
                                            </div>
                                        </div>
                                        <div class="overflow-x-auto table-responsive">
                                            <table class="w-full text-sm text-left text-gray-600">
                                                <thead class="text-xs text-gray-700 uppercase bg-gray-100">
                                                    <tr>
                                                        <th scope="col" class="px-6 py-3">STT</th>
                                                        <th scope="col" class="px-6 py-3">Ngày thanh toán</th>
                                                        <th scope="col" class="px-6 py-3">Mã giao dịch</th>
                                                        <th scope="col" class="px-6 py-3">Kỳ thanh toán</th>
                                                        <th scope="col" class="px-6 py-3">Số tiền</th>
                                                        <th scope="col" class="px-6 py-3">Phương thức</th>
                                                        <th scope="col" class="px-6 py-3">Người thu</th>
                                                        <th scope="col" class="px-6 py-3">Trạng thái</th>
                                                        <th scope="col" class="px-6 py-3">Ghi chú</th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    <tr class="bg-white border-b hover:bg-gray-50">
                                                        <td class="px-6 py-4">1</td>
                                                        <td class="px-6 py-4">15/12/2024</td>
                                                        <td class="px-6 py-4 font-medium">GD001234</td>
                                                        <td class="px-6 py-4">Tháng 12/2024</td>
                                                        <td class="px-6 py-4 font-semibold text-green-600">35.000 ₫</td>
                                                        <td class="px-6 py-4"><span class="status-tag bg-green-100 text-green-800">Tiền mặt</span></td>
                                                        <td class="px-6 py-4">Nguyễn Văn A</td>
                                                        <td class="px-6 py-4"><span class="status-tag bg-green-100 text-green-800">Thành công</span></td>
                                                        <td class="px-6 py-4 text-sm text-gray-500">Thu tại nhà</td>
                                                    </tr>
                                                    <tr class="bg-white border-b hover:bg-gray-50">
                                                        <td class="px-6 py-4">2</td>
                                                        <td class="px-6 py-4">15/11/2024</td>
                                                        <td class="px-6 py-4 font-medium">GD001123</td>
                                                        <td class="px-6 py-4">Tháng 11/2024</td>
                                                        <td class="px-6 py-4 font-semibold text-green-600">35.000 ₫</td>
                                                        <td class="px-6 py-4"><span class="status-tag bg-blue-100 text-blue-800">Momo</span></td>
                                                        <td class="px-6 py-4">Hệ thống</td>
                                                        <td class="px-6 py-4"><span class="status-tag bg-green-100 text-green-800">Thành công</span></td>
                                                        <td class="px-6 py-4 text-sm text-gray-500">Thanh toán online</td>
                                                    </tr>
                                                    <tr class="bg-white border-b hover:bg-gray-50">
                                                        <td class="px-6 py-4">3</td>
                                                        <td class="px-6 py-4">15/10/2024</td>
                                                        <td class="px-6 py-4 font-medium">GD001012</td>
                                                        <td class="px-6 py-4">Tháng 10/2024</td>
                                                        <td class="px-6 py-4 font-semibold text-green-600">35.000 ₫</td>
                                                        <td class="px-6 py-4"><span class="status-tag bg-orange-100 text-orange-800">Payoo</span></td>
                                                        <td class="px-6 py-4">Hệ thống</td>
                                                        <td class="px-6 py-4"><span class="status-tag bg-green-100 text-green-800">Thành công</span></td>
                                                        <td class="px-4 py-4 text-sm text-gray-500">Thanh toán online</td>
                                                    </tr>
                                                    <tr class="bg-white border-b hover:bg-gray-50">
                                                        <td class="px-6 py-4">4</td>
                                                        <td class="px-6 py-4">15/09/2024</td>
                                                        <td class="px-6 py-4 font-medium">GD000901</td>
                                                        <td class="px-6 py-4">Tháng 09/2024</td>
                                                        <td class="px-6 py-4 font-semibold text-green-600">35.000 ₫</td>
                                                        <td class="px-6 py-4"><span class="status-tag bg-green-100 text-green-800">Tiền mặt</span></td>
                                                        <td class="px-6 py-4">Trần Thị B</td>
                                                        <td class="px-6 py-4"><span class="status-tag bg-green-100 text-green-800">Thành công</span></td>
                                                        <td class="px-6 py-4 text-sm text-gray-500">Thu tại nhà</td>
                                                    </tr>
                                                </tbody>
                                            </table>
                                        </div>
                                        
                                        <!-- Mobile Card View for Payment History -->
                                        <div class="mobile-card-view">
                                            <div class="mobile-card">
                                                <div class="mobile-card-header">
                                                    <div class="mobile-card-title">GD001234</div>
                                                    <span class="mobile-card-status bg-green-100 text-green-800">Thành công</span>
                                                </div>
                                                <div class="mobile-card-content">
                                                    <div class="mobile-card-row">
                                                        <span class="mobile-card-label">Ngày thanh toán:</span>
                                                        <span class="mobile-card-value">15/12/2024</span>
                                                    </div>
                                                    <div class="mobile-card-row">
                                                        <span class="mobile-card-label">Kỳ thanh toán:</span>
                                                        <span class="mobile-card-value">Tháng 12/2024</span>
                                                    </div>
                                                    <div class="mobile-card-row">
                                                        <span class="mobile-card-label">Số tiền:</span>
                                                        <span class="mobile-card-value font-semibold text-green-600">35.000 ₫</span>
                                                    </div>
                                                    <div class="mobile-card-row">
                                                        <span class="mobile-card-label">Phương thức:</span>
                                                        <span class="mobile-card-value"><span class="status-tag bg-green-100 text-green-800">Tiền mặt</span></span>
                                                    </div>
                                                    <div class="mobile-card-row">
                                                        <span class="mobile-card-label">Người thu:</span>
                                                        <span class="mobile-card-value">Nguyễn Văn A</span>
                                                    </div>
                                                    <div class="mobile-card-row">
                                                        <span class="mobile-card-label">Ghi chú:</span>
                                                        <span class="mobile-card-value text-sm text-gray-500">Thu tại nhà</span>
                                                    </div>
                                                </div>
                                            </div>
                                            
                                            <div class="mobile-card">
                                                <div class="mobile-card-header">
                                                    <div class="mobile-card-title">GD001123</div>
                                                    <span class="mobile-card-status bg-green-100 text-green-800">Thành công</span>
                                                </div>
                                                <div class="mobile-card-content">
                                                    <div class="mobile-card-row">
                                                        <span class="mobile-card-label">Ngày thanh toán:</span>
                                                        <span class="mobile-card-value">15/11/2024</span>
                                                    </div>
                                                    <div class="mobile-card-row">
                                                        <span class="mobile-card-label">Kỳ thanh toán:</span>
                                                        <span class="mobile-card-value">Tháng 11/2024</span>
                                                    </div>
                                                    <div class="mobile-card-row">
                                                        <span class="mobile-card-label">Số tiền:</span>
                                                        <span class="mobile-card-value font-semibold text-green-600">35.000 ₫</span>
                                                    </div>
                                                    <div class="mobile-card-row">
                                                        <span class="mobile-card-label">Phương thức:</span>
                                                        <span class="mobile-card-value"><span class="status-tag bg-blue-100 text-blue-800">Momo</span></span>
                                                    </div>
                                                    <div class="mobile-card-row">
                                                        <span class="mobile-card-label">Người thu:</span>
                                                        <span class="mobile-card-value">Hệ thống</span>
                                                    </div>
                                                    <div class="mobile-card-row">
                                                        <span class="mobile-card-label">Ghi chú:</span>
                                                        <span class="mobile-card-value text-sm text-gray-500">Thanh toán online</span>
                                                    </div>
                                                </div>
                                            </div>
                                            
                                            <div class="mobile-card">
                                                <div class="mobile-card-header">
                                                    <div class="mobile-card-title">GD001012</div>
                                                    <span class="mobile-card-status bg-green-100 text-green-800">Thành công</span>
                                                </div>
                                                <div class="mobile-card-content">
                                                    <div class="mobile-card-row">
                                                        <span class="mobile-card-label">Ngày thanh toán:</span>
                                                        <span class="mobile-card-value">15/10/2024</span>
                                                    </div>
                                                    <div class="mobile-card-row">
                                                        <span class="mobile-card-label">Kỳ thanh toán:</span>
                                                        <span class="mobile-card-value">Tháng 10/2024</span>
                                                    </div>
                                                    <div class="mobile-card-row">
                                                        <span class="mobile-card-label">Số tiền:</span>
                                                        <span class="mobile-card-value font-semibold text-green-600">35.000 ₫</span>
                                                    </div>
                                                    <div class="mobile-card-row">
                                                        <span class="mobile-card-label">Phương thức:</span>
                                                        <span class="mobile-card-value"><span class="status-tag bg-orange-100 text-orange-800">Payoo</span></span>
                                                    </div>
                                                    <div class="mobile-card-row">
                                                        <span class="mobile-card-label">Người thu:</span>
                                                        <span class="mobile-card-value">Hệ thống</span>
                                                    </div>
                                                    <div class="mobile-card-row">
                                                        <span class="mobile-card-label">Ghi chú:</span>
                                                        <span class="mobile-card-value text-sm text-gray-500">Thanh toán online</span>
                                                    </div>
                                                </div>
                                            </div>
                                            
                                            <div class="mobile-card">
                                                <div class="mobile-card-header">
                                                    <div class="mobile-card-title">GD000901</div>
                                                    <span class="mobile-card-status bg-green-100 text-green-800">Thành công</span>
                                                </div>
                                                <div class="mobile-card-content">
                                                    <div class="mobile-card-row">
                                                        <span class="mobile-card-label">Ngày thanh toán:</span>
                                                        <span class="mobile-card-value">15/09/2024</span>
                                                    </div>
                                                    <div class="mobile-card-row">
                                                        <span class="mobile-card-label">Kỳ thanh toán:</span>
                                                        <span class="mobile-card-value">Tháng 09/2024</span>
                                                    </div>
                                                    <div class="mobile-card-row">
                                                        <span class="mobile-card-label">Số tiền:</span>
                                                        <span class="mobile-card-value font-semibold text-green-600">35.000 ₫</span>
                                                    </div>
                                                    <div class="mobile-card-row">
                                                        <span class="mobile-card-label">Phương thức:</span>
                                                        <span class="mobile-card-value"><span class="status-tag bg-green-100 text-green-800">Tiền mặt</span></span>
                                                    </div>
                                                    <div class="mobile-card-row">
                                                        <span class="mobile-card-label">Người thu:</span>
                                                        <span class="mobile-card-value">Trần Thị B</span>
                                                    </div>
                                                    <div class="mobile-card-row">
                                                        <span class="mobile-card-label">Ghi chú:</span>
                                                        <span class="mobile-card-value text-sm text-gray-500">Thu tại nhà</span>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div id="contracts-content" class="web-content-page hidden">
                            <div class="bg-white p-6 rounded-lg shadow-sm">
                                <!-- Header với tiêu đề và nút hành động -->
                                <div class="flex justify-between items-center mb-4">
                                    <h2 class="text-xl font-bold text-gray-800">Danh sách Hợp đồng</h2>
                                    <div class="flex space-x-2">
                                        <button class="bg-white border border-gray-300 text-gray-700 px-4 py-2 rounded-md hover:bg-gray-50 flex items-center">
                                            <i class="fas fa-upload mr-2"></i> Import
                                        </button>
                                        <button class="bg-white border border-gray-300 text-gray-700 px-4 py-2 rounded-md hover:bg-gray-50 flex items-center">
                                            <i class="fas fa-download mr-2"></i> Export
                                        </button>
                                        <button id="add-contract-btn" class="bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700 flex items-center">
                                            <i class="fas fa-plus mr-2"></i>Thêm mới
                                        </button>
                                    </div>
                                </div>

                                <!-- Bộ lọc tìm kiếm -->
                                <div class="p-4 bg-gray-50 rounded-lg border border-gray-200 mb-4">
                                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                                        <input type="text" placeholder="Tìm kiếm mã hợp đồng, tên KH..." class="px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                        <select class="px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                            <option>Tất cả trạng thái</option>
                                            <option>Đang hoạt động</option>
                                            <option>Tạm dừng</option>
                                            <option>Đã kết thúc</option>
                                        </select>
                                        <select class="px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                            <option>Tất cả ĐV thu gom</option>
                                            <option>ĐV Thu gom A</option>
                                            <option>ĐV Thu gom B</option>
                                            <option>ĐV Thu gom C</option>
                                        </select>
                                        <button class="bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700">Tìm kiếm</button>
                                    </div>
                                </div>

                                <!-- Bộ lọc trạng thái -->
                                <div class="flex items-center space-x-6 mb-4 p-4 bg-gray-50 rounded-lg status-filter-container">
                                    <div class="flex items-center space-x-4">
                                        <label class="flex items-center status-filter-all" role="button" tabindex="0" aria-label="Lọc tất cả hợp đồng">
                                            <input type="radio" name="contract-status-filter" value="all" class="status-radio" checked>
                                            <span class="ml-2 text-sm font-medium text-gray-700">Tất cả | 10</span>
                                        </label>
                                        <label class="flex items-center status-filter-active" role="button" tabindex="0" aria-label="Lọc hợp đồng đang hoạt động">
                                            <input type="radio" name="contract-status-filter" value="active" class="status-radio">
                                            <span class="ml-2 text-sm font-medium text-gray-700">Đang hoạt động | 6</span>
                                        </label>
                                        <label class="flex items-center status-filter-paused" role="button" tabindex="0" aria-label="Lọc hợp đồng tạm dừng">
                                            <input type="radio" name="contract-status-filter" value="paused" class="status-radio">
                                            <span class="ml-2 text-sm font-medium text-gray-700">Tạm dừng | 2</span>
                                        </label>
                                        <label class="flex items-center status-filter-ended" role="button" tabindex="0" aria-label="Lọc hợp đồng đã kết thúc">
                                            <input type="radio" name="contract-status-filter" value="ended" class="status-radio">
                                            <span class="ml-2 text-sm font-medium text-gray-700">Đã kết thúc | 2</span>
                                        </label>
                                    </div>
                                </div>

                                <!-- Bảng dữ liệu Desktop -->
                                <div class="overflow-x-auto table-responsive">
                                    <table class="w-full text-sm text-left text-gray-600" style="min-width: 1300px;">
                                        <thead class="text-xs text-gray-700 uppercase bg-gray-100">
                                            <tr>
                                                <th scope="col" class="px-6 py-3" style="min-width: 60px;">STT</th>
                                                <th scope="col" class="px-6 py-3" style="min-width: 120px;">Hành động</th>
                                                <th scope="col" class="px-6 py-3" style="min-width: 80px;">Mã HĐ</th>
                                                <th scope="col" class="px-6 py-3" style="min-width: 150px;">Khách hàng</th>
                                                <th scope="col" class="px-6 py-3" style="min-width: 200px;">Loại dịch vụ</th>
                                                <th scope="col" class="px-6 py-3" style="min-width: 100px;">Tần suất</th>
                                                <th scope="col" class="px-6 py-3" style="min-width: 120px;">Đơn giá</th>
                                                <th scope="col" class="px-6 py-3" style="min-width: 100px;">Ngày bắt đầu</th>
                                                <th scope="col" class="px-6 py-3" style="min-width: 100px;">Ngày kết thúc</th>
                                                <th scope="col" class="px-6 py-3" style="min-width: 120px;">Trạng thái</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr class="bg-white border-b hover:bg-gray-50 contract-row" data-status="active">
                                                <td class="px-6 py-4">1</td>
                                                <td class="px-6 py-4">
                                                    <a href="#" class="view-contract-detail font-medium text-blue-600 hover:underline">Xem chi tiết</a>
                                                </td>
                                                <td class="px-6 py-4 font-medium text-gray-900">HD001</td>
                                                <td class="px-6 py-4">Nguyễn Văn An</td>
                                                <td class="px-6 py-4">Thu gom rác thải sinh hoạt</td>
                                                <td class="px-6 py-4">Hàng ngày</td>
                                                <td class="px-6 py-4">35.000 ₫/tháng</td>
                                                <td class="px-6 py-4">01/01/2024</td>
                                                <td class="px-6 py-4">31/12/2024</td>
                                                <td class="px-6 py-4">
                                                    <span class="status-tag bg-green-100 text-green-800">Đang hoạt động</span>
                                                </td>
                                            </tr>
                                            <tr class="bg-white border-b hover:bg-gray-50 contract-row" data-status="active">
                                                <td class="px-6 py-4">2</td>
                                                <td class="px-6 py-4">
                                                    <a href="#" class="view-contract-detail font-medium text-blue-600 hover:underline">Xem chi tiết</a>
                                                </td>
                                                <td class="px-6 py-4 font-medium text-gray-900">HD002</td>
                                                <td class="px-6 py-4">Trần Thị Bích</td>
                                                <td class="px-6 py-4">Thu gom rác thải sinh hoạt</td>
                                                <td class="px-6 py-4">Hàng ngày</td>
                                                <td class="px-6 py-4">35.000 ₫/tháng</td>
                                                <td class="px-6 py-4">01/01/2024</td>
                                                <td class="px-6 py-4">31/12/2024</td>
                                                <td class="px-6 py-4">
                                                    <span class="status-tag bg-green-100 text-green-800">Đang hoạt động</span>
                                                </td>
                                            </tr>
                                            <tr class="bg-white border-b hover:bg-gray-50 contract-row" data-status="paused">
                                                <td class="px-6 py-4">3</td>
                                                <td class="px-6 py-4">
                                                    <a href="#" class="view-contract-detail font-medium text-blue-600 hover:underline">Xem chi tiết</a>
                                                </td>
                                                <td class="px-6 py-4 font-medium text-gray-900">HD003</td>
                                                <td class="px-6 py-4">Công ty TNHH ABC</td>
                                                <td class="px-6 py-4">Thu gom rác thải công nghiệp</td>
                                                <td class="px-6 py-4">3 lần/tuần</td>
                                                <td class="px-6 py-4">150.000 ₫/tháng</td>
                                                <td class="px-6 py-4">01/01/2024</td>
                                                <td class="px-6 py-4">31/12/2024</td>
                                                <td class="px-6 py-4">
                                                    <span class="status-tag bg-yellow-100 text-yellow-800">Tạm dừng</span>
                                                </td>
                                            </tr>
                                            <tr class="bg-white border-b hover:bg-gray-50 contract-row" data-status="active">
                                                <td class="px-6 py-4">4</td>
                                                <td class="px-6 py-4">
                                                    <a href="#" class="view-contract-detail font-medium text-blue-600 hover:underline">Xem chi tiết</a>
                                                </td>
                                                <td class="px-6 py-4 font-medium text-gray-900">HD004</td>
                                                <td class="px-6 py-4">Công ty CP XYZ</td>
                                                <td class="px-6 py-4">Thu gom rác thải công nghiệp</td>
                                                <td class="px-6 py-4">2 lần/tuần</td>
                                                <td class="px-6 py-4">120.000 ₫/tháng</td>
                                                <td class="px-6 py-4">01/02/2024</td>
                                                <td class="px-6 py-4">31/01/2025</td>
                                                <td class="px-6 py-4">
                                                    <span class="status-tag bg-green-100 text-green-800">Đang hoạt động</span>
                                                </td>
                                            </tr>
                                            <tr class="bg-white border-b hover:bg-gray-50 contract-row" data-status="ended">
                                                <td class="px-6 py-4">5</td>
                                                <td class="px-6 py-4">
                                                    <a href="#" class="view-contract-detail font-medium text-blue-600 hover:underline">Xem chi tiết</a>
                                                </td>
                                                <td class="px-6 py-4 font-medium text-gray-900">HD005</td>
                                                <td class="px-6 py-4">Lê Văn Cường</td>
                                                <td class="px-6 py-4">Thu gom rác thải sinh hoạt</td>
                                                <td class="px-6 py-4">Hàng ngày</td>
                                                <td class="px-6 py-4">35.000 ₫/tháng</td>
                                                <td class="px-6 py-4">01/01/2023</td>
                                                <td class="px-6 py-4">31/12/2023</td>
                                                <td class="px-6 py-4">
                                                    <span class="status-tag bg-gray-200 text-gray-800">Đã kết thúc</span>
                                                </td>
                                            </tr>
                                            <tr class="bg-white border-b hover:bg-gray-50 contract-row" data-status="active">
                                                <td class="px-6 py-4">6</td>
                                                <td class="px-6 py-4">
                                                    <a href="#" class="view-contract-detail font-medium text-blue-600 hover:underline">Xem chi tiết</a>
                                                </td>
                                                <td class="px-6 py-4 font-medium text-gray-900">HD006</td>
                                                <td class="px-6 py-4">Phạm Thị Dung</td>
                                                <td class="px-6 py-4">Thu gom rác thải sinh hoạt</td>
                                                <td class="px-6 py-4">Hàng ngày</td>
                                                <td class="px-6 py-4">35.000 ₫/tháng</td>
                                                <td class="px-6 py-4">01/03/2024</td>
                                                <td class="px-6 py-4">28/02/2025</td>
                                                <td class="px-6 py-4">
                                                    <span class="status-tag bg-green-100 text-green-800">Đang hoạt động</span>
                                                </td>
                                            </tr>
                                            <tr class="bg-white border-b hover:bg-gray-50 contract-row" data-status="paused">
                                                <td class="px-6 py-4">7</td>
                                                <td class="px-6 py-4">
                                                    <a href="#" class="view-contract-detail font-medium text-blue-600 hover:underline">Xem chi tiết</a>
                                                </td>
                                                <td class="px-6 py-4 font-medium text-gray-900">HD007</td>
                                                <td class="px-6 py-4">Công ty TNHH DEF</td>
                                                <td class="px-6 py-4">Thu gom rác thải công nghiệp</td>
                                                <td class="px-6 py-4">2 lần/tuần</td>
                                                <td class="px-6 py-4">200.000 ₫/tháng</td>
                                                <td class="px-6 py-4">01/01/2024</td>
                                                <td class="px-6 py-4">31/12/2024</td>
                                                <td class="px-6 py-4">
                                                    <span class="status-tag bg-yellow-100 text-yellow-800">Tạm dừng</span>
                                                </td>
                                            </tr>
                                            <tr class="bg-white border-b hover:bg-gray-50 contract-row" data-status="ended">
                                                <td class="px-6 py-4">8</td>
                                                <td class="px-6 py-4">
                                                    <a href="#" class="view-contract-detail font-medium text-blue-600 hover:underline">Xem chi tiết</a>
                                                </td>
                                                <td class="px-6 py-4 font-medium text-gray-900">HD008</td>
                                                <td class="px-6 py-4">Võ Văn Em</td>
                                                <td class="px-6 py-4">Thu gom rác thải sinh hoạt</td>
                                                <td class="px-6 py-4">Hàng ngày</td>
                                                <td class="px-6 py-4">35.000 ₫/tháng</td>
                                                <td class="px-6 py-4">01/01/2023</td>
                                                <td class="px-6 py-4">31/12/2023</td>
                                                <td class="px-6 py-4">
                                                    <span class="status-tag bg-gray-200 text-gray-800">Đã kết thúc</span>
                                                </td>
                                            </tr>
                                            <tr class="bg-white border-b hover:bg-gray-50 contract-row" data-status="active">
                                                <td class="px-6 py-4">9</td>
                                                <td class="px-6 py-4">
                                                    <a href="#" class="view-contract-detail font-medium text-blue-600 hover:underline">Xem chi tiết</a>
                                                </td>
                                                <td class="px-6 py-4 font-medium text-gray-900">HD009</td>
                                                <td class="px-6 py-4">Công ty TNHH GHI</td>
                                                <td class="px-6 py-4">Thu dọn xà bần</td>
                                                <td class="px-6 py-4">Một lần</td>
                                                <td class="px-6 py-4">2.000.000 ₫/lần</td>
                                                <td class="px-6 py-4">15/03/2024</td>
                                                <td class="px-6 py-4">15/03/2024</td>
                                                <td class="px-6 py-4">
                                                    <span class="status-tag bg-green-100 text-green-800">Đang hoạt động</span>
                                                </td>
                                            </tr>
                                            <tr class="bg-white border-b hover:bg-gray-50 contract-row" data-status="active">
                                                <td class="px-6 py-4">10</td>
                                                <td class="px-6 py-4">
                                                    <a href="#" class="view-contract-detail font-medium text-blue-600 hover:underline">Xem chi tiết</a>
                                                </td>
                                                <td class="px-6 py-4 font-medium text-gray-900">HD010</td>
                                                <td class="px-6 py-4">Chung cư ABC</td>
                                                <td class="px-6 py-4">Vệ sinh công nghiệp</td>
                                                <td class="px-6 py-4">Một lần</td>
                                                <td class="px-6 py-4">1.500.000 ₫/lần</td>
                                                <td class="px-6 py-4">20/03/2024</td>
                                                <td class="px-6 py-4">20/03/2024</td>
                                                <td class="px-6 py-4">
                                                    <span class="status-tag bg-green-100 text-green-800">Đang hoạt động</span>
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>

                                <!-- Mobile Card View -->
                                <div class="mobile-card-view">
                                    <div class="mobile-card contract-row" data-status="active" data-contract-id="HD001">
                                        <div class="mobile-card-header">
                                            <div class="mobile-card-title">HD001 - Nguyễn Văn An</div>
                                            <span class="mobile-card-status bg-green-100 text-green-800">Đang hoạt động</span>
                                        </div>
                                        <div class="mobile-card-content">
                                            <div class="mobile-card-row">
                                                <span class="mobile-card-label">Loại dịch vụ:</span>
                                                <span class="mobile-card-value">Thu gom rác thải sinh hoạt</span>
                                            </div>
                                            <div class="mobile-card-row">
                                                <span class="mobile-card-label">Tần suất:</span>
                                                <span class="mobile-card-value">Hàng ngày</span>
                                            </div>
                                            <div class="mobile-card-row">
                                                <span class="mobile-card-label">Đơn giá:</span>
                                                <span class="mobile-card-value">35.000 ₫/tháng</span>
                                            </div>
                                            <div class="mobile-card-row">
                                                <span class="mobile-card-label">Thời hạn:</span>
                                                <span class="mobile-card-value">01/01/2024 - 31/12/2024</span>
                                            </div>
                                        </div>
                                        <div class="mobile-card-actions">
                                            <a href="#" class="mobile-card-action-btn view-contract-detail">Xem chi tiết</a>
                                        </div>
                                    </div>

                                    <div class="mobile-card contract-row" data-status="active" data-contract-id="HD002">
                                        <div class="mobile-card-header">
                                            <div class="mobile-card-title">HD002 - Trần Thị Bích</div>
                                            <span class="mobile-card-status bg-green-100 text-green-800">Đang hoạt động</span>
                                        </div>
                                        <div class="mobile-card-content">
                                            <div class="mobile-card-row">
                                                <span class="mobile-card-label">Loại dịch vụ:</span>
                                                <span class="mobile-card-value">Thu gom rác thải sinh hoạt</span>
                                            </div>
                                            <div class="mobile-card-row">
                                                <span class="mobile-card-label">Tần suất:</span>
                                                <span class="mobile-card-value">Hàng ngày</span>
                                            </div>
                                            <div class="mobile-card-row">
                                                <span class="mobile-card-label">Đơn giá:</span>
                                                <span class="mobile-card-value">35.000 ₫/tháng</span>
                                            </div>
                                            <div class="mobile-card-row">
                                                <span class="mobile-card-label">Thời hạn:</span>
                                                <span class="mobile-card-value">01/01/2024 - 31/12/2024</span>
                                            </div>
                                        </div>
                                        <div class="mobile-card-actions">
                                            <a href="#" class="mobile-card-action-btn view-contract-detail">Xem chi tiết</a>
                                        </div>
                                    </div>

                                    <div class="mobile-card contract-row" data-status="paused" data-contract-id="HD003">
                                        <div class="mobile-card-header">
                                            <div class="mobile-card-title">HD003 - Công ty TNHH ABC</div>
                                            <span class="mobile-card-status bg-yellow-100 text-yellow-800">Tạm dừng</span>
                                        </div>
                                        <div class="mobile-card-content">
                                            <div class="mobile-card-row">
                                                <span class="mobile-card-label">Loại dịch vụ:</span>
                                                <span class="mobile-card-value">Thu gom rác thải công nghiệp</span>
                                            </div>
                                            <div class="mobile-card-row">
                                                <span class="mobile-card-label">Tần suất:</span>
                                                <span class="mobile-card-value">3 lần/tuần</span>
                                            </div>
                                            <div class="mobile-card-row">
                                                <span class="mobile-card-label">Đơn giá:</span>
                                                <span class="mobile-card-value">150.000 ₫/tháng</span>
                                            </div>
                                            <div class="mobile-card-row">
                                                <span class="mobile-card-label">Thời hạn:</span>
                                                <span class="mobile-card-value">01/01/2024 - 31/12/2024</span>
                                            </div>
                                        </div>
                                        <div class="mobile-card-actions">
                                            <a href="#" class="mobile-card-action-btn view-contract-detail">Xem chi tiết</a>
                                        </div>
                                    </div>

                                    <div class="mobile-card contract-row" data-status="active" data-contract-id="HD006">
                                        <div class="mobile-card-header">
                                            <div class="mobile-card-title">HD006 - Phạm Thị Dung</div>
                                            <span class="mobile-card-status bg-green-100 text-green-800">Đang hoạt động</span>
                                        </div>
                                        <div class="mobile-card-content">
                                            <div class="mobile-card-row">
                                                <span class="mobile-card-label">Loại dịch vụ:</span>
                                                <span class="mobile-card-value">Thu gom rác thải sinh hoạt</span>
                                            </div>
                                            <div class="mobile-card-row">
                                                <span class="mobile-card-label">Tần suất:</span>
                                                <span class="mobile-card-value">Hàng ngày</span>
                                            </div>
                                            <div class="mobile-card-row">
                                                <span class="mobile-card-label">Đơn giá:</span>
                                                <span class="mobile-card-value">35.000 ₫/tháng</span>
                                            </div>
                                            <div class="mobile-card-row">
                                                <span class="mobile-card-label">Thời hạn:</span>
                                                <span class="mobile-card-value">01/03/2024 - 28/02/2025</span>
                                            </div>
                                        </div>
                                        <div class="mobile-card-actions">
                                            <a href="#" class="mobile-card-action-btn view-contract-detail">Xem chi tiết</a>
                                        </div>
                                    </div>

                                    <div class="mobile-card contract-row" data-status="paused" data-contract-id="HD007">
                                        <div class="mobile-card-header">
                                            <div class="mobile-card-title">HD007 - Công ty TNHH DEF</div>
                                            <span class="mobile-card-status bg-yellow-100 text-yellow-800">Tạm dừng</span>
                                        </div>
                                        <div class="mobile-card-content">
                                            <div class="mobile-card-row">
                                                <span class="mobile-card-label">Loại dịch vụ:</span>
                                                <span class="mobile-card-value">Thu gom rác thải công nghiệp</span>
                                            </div>
                                            <div class="mobile-card-row">
                                                <span class="mobile-card-label">Tần suất:</span>
                                                <span class="mobile-card-value">2 lần/tuần</span>
                                            </div>
                                            <div class="mobile-card-row">
                                                <span class="mobile-card-label">Đơn giá:</span>
                                                <span class="mobile-card-value">200.000 ₫/tháng</span>
                                            </div>
                                            <div class="mobile-card-row">
                                                <span class="mobile-card-label">Thời hạn:</span>
                                                <span class="mobile-card-value">01/01/2024 - 31/12/2024</span>
                                            </div>
                                        </div>
                                        <div class="mobile-card-actions">
                                            <a href="#" class="mobile-card-action-btn view-contract-detail">Xem chi tiết</a>
                                        </div>
                                    </div>

                                    <div class="mobile-card contract-row" data-status="active" data-contract-id="HD004">
                                        <div class="mobile-card-header">
                                            <div class="mobile-card-title">HD004 - Công ty CP XYZ</div>
                                            <span class="mobile-card-status bg-green-100 text-green-800">Đang hoạt động</span>
                                        </div>
                                        <div class="mobile-card-content">
                                            <div class="mobile-card-row">
                                                <span class="mobile-card-label">Loại dịch vụ:</span>
                                                <span class="mobile-card-value">Thu gom rác thải công nghiệp</span>
                                            </div>
                                            <div class="mobile-card-row">
                                                <span class="mobile-card-label">Tần suất:</span>
                                                <span class="mobile-card-value">2 lần/tuần</span>
                                            </div>
                                            <div class="mobile-card-row">
                                                <span class="mobile-card-label">Đơn giá:</span>
                                                <span class="mobile-card-value">120.000 ₫/tháng</span>
                                            </div>
                                            <div class="mobile-card-row">
                                                <span class="mobile-card-label">Thời hạn:</span>
                                                <span class="mobile-card-value">01/02/2024 - 31/01/2025</span>
                                            </div>
                                        </div>
                                        <div class="mobile-card-actions">
                                            <a href="#" class="mobile-card-action-btn view-contract-detail">Xem chi tiết</a>
                                        </div>
                                    </div>

                                    <div class="mobile-card contract-row" data-status="ended" data-contract-id="HD005">
                                        <div class="mobile-card-header">
                                            <div class="mobile-card-title">HD005 - Lê Văn Cường</div>
                                            <span class="mobile-card-status bg-gray-200 text-gray-800">Đã kết thúc</span>
                                        </div>
                                        <div class="mobile-card-content">
                                            <div class="mobile-card-row">
                                                <span class="mobile-card-label">Loại dịch vụ:</span>
                                                <span class="mobile-card-value">Thu gom rác thải sinh hoạt</span>
                                            </div>
                                            <div class="mobile-card-row">
                                                <span class="mobile-card-label">Tần suất:</span>
                                                <span class="mobile-card-value">Hàng ngày</span>
                                            </div>
                                            <div class="mobile-card-row">
                                                <span class="mobile-card-label">Đơn giá:</span>
                                                <span class="mobile-card-value">35.000 ₫/tháng</span>
                                            </div>
                                            <div class="mobile-card-row">
                                                <span class="mobile-card-label">Thời hạn:</span>
                                                <span class="mobile-card-value">01/01/2023 - 31/12/2023</span>
                                            </div>
                                        </div>
                                        <div class="mobile-card-actions">
                                            <a href="#" class="mobile-card-action-btn view-contract-detail">Xem chi tiết</a>
                                        </div>
                                    </div>

                                    <div class="mobile-card contract-row" data-status="ended" data-contract-id="HD008">
                                        <div class="mobile-card-header">
                                            <div class="mobile-card-title">HD008 - Võ Văn Em</div>
                                            <span class="mobile-card-status bg-gray-200 text-gray-800">Đã kết thúc</span>
                                        </div>
                                        <div class="mobile-card-content">
                                            <div class="mobile-card-row">
                                                <span class="mobile-card-label">Loại dịch vụ:</span>
                                                <span class="mobile-card-value">Thu gom rác thải sinh hoạt</span>
                                            </div>
                                            <div class="mobile-card-row">
                                                <span class="mobile-card-label">Tần suất:</span>
                                                <span class="mobile-card-value">Hàng ngày</span>
                                            </div>
                                            <div class="mobile-card-row">
                                                <span class="mobile-card-label">Đơn giá:</span>
                                                <span class="mobile-card-value">35.000 ₫/tháng</span>
                                            </div>
                                            <div class="mobile-card-row">
                                                <span class="mobile-card-label">Thời hạn:</span>
                                                <span class="mobile-card-value">01/01/2023 - 31/12/2023</span>
                                            </div>
                                        </div>
                                        <div class="mobile-card-actions">
                                            <a href="#" class="mobile-card-action-btn view-contract-detail">Xem chi tiết</a>
                                        </div>
                                    </div>
                                </div>

                                <!-- Phân trang -->
                                <div class="pagination-container">
                                    <div class="pagination-info">
                                        Hiển thị <span id="contract-pagination-start">1</span> - <span id="contract-pagination-end">8</span> của <span id="contract-pagination-total">8</span> hợp đồng
                                    </div>
                                    <div class="pagination-controls">
                                        <button class="pagination-button" id="contract-pagination-prev" disabled>
                                            <i class="fas fa-chevron-left"></i>
                                        </button>
                                        <button class="pagination-button active" data-page="1">1</button>
                                        <button class="pagination-button" data-page="2">2</button>
                                        <button class="pagination-button" data-page="3">3</button>
                                        <button class="pagination-button" id="contract-pagination-next">
                                            <i class="fas fa-chevron-right"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div id="contract-detail-content" class="web-content-page hidden">
                            <div class="bg-white p-4 md:p-6 rounded-lg shadow-sm">
                                <!-- Header -->
                                <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-6 gap-4">
                                    <button id="back-to-contract-list" class="flex items-center text-sm text-gray-600 hover:text-blue-600">
                                        <i class="fas fa-arrow-left mr-2"></i> Quay lại danh sách
                                    </button>
                                    
                                    <!-- Actions Dropdown -->
                                    <div class="relative">
                                        <button id="contract-actions-dropdown" class="bg-gray-100 text-gray-700 px-4 py-2 rounded-md hover:bg-gray-200 text-sm flex items-center border">
                                            <i class="fas fa-ellipsis-v mr-2"></i> Thao tác
                                            <i class="fas fa-chevron-down ml-2 text-xs"></i>
                                        </button>
                                        
                                        <div id="contract-actions-menu" class="absolute right-0 mt-2 w-48 bg-white rounded-md shadow-lg border border-gray-200 z-50 hidden">
                                            <div class="py-1">
                                                <button id="collect-payment-from-contract" class="w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-green-50 hover:text-green-700 flex items-center">
                                                    <i class="fas fa-money-bill-wave mr-3 text-green-600"></i> Thu tiền
                                                </button>
                                                <button class="w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-yellow-50 hover:text-yellow-700 flex items-center">
                                                    <i class="fas fa-pause mr-3 text-yellow-600"></i> Tạm dừng
                                                </button>
                                                <button class="w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-red-50 hover:text-red-700 flex items-center">
                                                    <i class="fas fa-stop mr-3 text-red-600"></i> Kết thúc
                                                </button>
                                                <div class="border-t border-gray-100 my-1"></div>
                                                <button class="w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-blue-50 hover:text-blue-700 flex items-center">
                                                    <i class="fas fa-edit mr-3 text-blue-600"></i> Sửa hợp đồng
                                                </button>
                                                <button class="w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-purple-50 hover:text-purple-700 flex items-center">
                                                    <i class="fas fa-copy mr-3 text-purple-600"></i> Sao chép hợp đồng
                                                </button>
                                                <div class="border-t border-gray-100 my-1"></div>
                                                <button class="w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-50 hover:text-gray-700 flex items-center">
                                                    <i class="fas fa-download mr-3 text-gray-600"></i> Xuất PDF
                                                </button>
                                                <button class="w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-50 hover:text-gray-700 flex items-center">
                                                    <i class="fas fa-print mr-3 text-gray-600"></i> In hợp đồng
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Contract Header -->
                                <div class="flex flex-col md:flex-row items-start md:items-center mb-6 gap-4">
                                    <div class="flex items-center">
                                        <h2 class="text-xl md:text-2xl font-bold text-gray-800">Hợp đồng HD001</h2>
                                        <span class="ml-4 status-tag bg-green-100 text-green-800">Đang hoạt động</span>
                                    </div>
                                    
                                    <!-- Statistics Cards -->
                                    <div class="flex flex-col md:flex-row gap-3 md:gap-4 w-full md:w-auto">
                                        <div class="bg-gradient-to-r from-red-50 to-red-100 p-4 rounded-xl border border-red-200 shadow-sm">
                                            <div class="flex items-center justify-between">
                                                <div>
                                                    <p class="text-sm text-red-600 font-medium mb-1">Nợ hiện tại</p>
                                                    <p class="text-xl md:text-2xl font-bold text-red-700">105.000 ₫</p>
                                                </div>
                                                <div class="bg-red-200 p-2 rounded-lg">
                                                    <i class="fas fa-exclamation-triangle text-red-600 text-lg"></i>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="bg-gradient-to-r from-orange-50 to-orange-100 p-4 rounded-xl border border-orange-200 shadow-sm">
                                            <div class="flex items-center justify-between">
                                                <div>
                                                    <p class="text-sm text-orange-600 font-medium mb-1">Tháng chưa thanh toán</p>
                                                    <p class="text-xl md:text-2xl font-bold text-orange-700">3 tháng</p>
                                                </div>
                                                <div class="bg-orange-200 p-2 rounded-lg">
                                                    <i class="fas fa-calendar-times text-orange-600 text-lg"></i>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="bg-gradient-to-r from-blue-50 to-blue-100 p-4 rounded-xl border border-blue-200 shadow-sm">
                                            <div class="flex items-center justify-between">
                                                <div>
                                                    <p class="text-sm text-blue-600 font-medium mb-1">Tổng hợp đồng</p>
                                                    <p class="text-xl md:text-2xl font-bold text-blue-700">420.000 ₫</p>
                                                </div>
                                                <div class="bg-blue-200 p-2 rounded-lg">
                                                    <i class="fas fa-file-contract text-blue-600 text-lg"></i>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Tabs -->
                                <div class="border-b border-gray-200 contract-detail-tabs">
                                    <nav class="-mb-px flex flex-wrap space-x-4 md:space-x-8 overflow-x-auto" aria-label="Tabs">
                                        <button class="contract-detail-tab whitespace-nowrap py-3 md:py-4 px-2 md:px-1 border-b-2 font-medium text-sm text-blue-600 border-blue-600 active" data-target="contract-tab-info">Thông tin chung</button>
                                        <button class="contract-detail-tab whitespace-nowrap py-3 md:py-4 px-2 md:px-1 border-b-2 font-medium text-sm text-gray-500 hover:text-blue-600 hover:border-gray-300" data-target="contract-tab-services">Dịch vụ</button>
                                        <button class="contract-detail-tab whitespace-nowrap py-3 md:py-4 px-2 md:px-1 border-b-2 font-medium text-sm text-gray-500 hover:text-blue-600 hover:border-gray-300" data-target="contract-tab-payments">Lịch sử thanh toán</button>
                                        <button class="contract-detail-tab whitespace-nowrap py-3 md:py-4 px-2 md:px-1 border-b-2 font-medium text-sm text-gray-500 hover:text-blue-600 hover:border-gray-300" data-target="contract-tab-history">Lịch sử thay đổi</button>
                                    </nav>
                                </div>

                                <div class="mt-6">
                                    <div id="contract-tab-info" class="contract-detail-tab-content">
                                        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                                            <div class="lg:col-span-2 bg-gray-50 p-4 rounded-lg">
                                                <h3 class="font-semibold mb-4">Thông tin hợp đồng</h3>
                                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm">
                                                    <p><strong class="text-gray-600">Mã hợp đồng:</strong> HD001</p>
                                                    <p><strong class="text-gray-600">Khách hàng:</strong> Nguyễn Văn An</p>
                                                    <p><strong class="text-gray-600">Loại dịch vụ:</strong> Thu gom rác thải sinh hoạt</p>
                                                    <p><strong class="text-gray-600">Tần suất:</strong> Hàng ngày</p>
                                                    <p><strong class="text-gray-600">Đơn giá:</strong> 35.000 ₫/tháng</p>
                                                    <p><strong class="text-gray-600">Ngày bắt đầu:</strong> 01/01/2024</p>
                                                    <p><strong class="text-gray-600">Ngày kết thúc:</strong> 31/12/2024</p>
                                                    <p><strong class="text-gray-600">Trạng thái:</strong> <span class="status-tag bg-green-100 text-green-800">Đang hoạt động</span></p>
                                                    <p class="md:col-span-2"><strong class="text-gray-600">Ghi chú:</strong> Hợp đồng thu gom rác thải sinh hoạt cho hộ gia đình</p>
                                                </div>
                                            </div>
                                            <div class="bg-blue-50 p-4 rounded-lg text-center">
                                                <h3 class="font-semibold mb-4">Thống kê chi tiết</h3>
                                                <div class="space-y-4">
                                                    <div>
                                                        <p class="text-sm text-gray-600">Số tháng đã thực hiện</p>
                                                        <p class="text-lg md:text-xl font-bold text-green-600">3 tháng</p>
                                                    </div>
                                                    <div>
                                                        <p class="text-sm text-gray-600">Số tháng còn lại</p>
                                                        <p class="text-lg md:text-xl font-bold text-orange-600">9 tháng</p>
                                                    </div>
                                                    <div>
                                                        <p class="text-sm text-gray-600">Tỷ lệ hoàn thành</p>
                                                        <div class="w-full bg-gray-200 rounded-full h-2 mt-2">
                                                            <div class="bg-blue-600 h-2 rounded-full" style="width: 25%"></div>
                                                        </div>
                                                        <p class="text-xs text-gray-500 mt-1">25%</p>
                                                    </div>
                                                    <div class="pt-2 border-t border-blue-200">
                                                        <p class="text-sm text-gray-600">Ngày tạo hợp đồng</p>
                                                        <p class="text-sm font-medium text-gray-700">01/01/2024</p>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div id="contract-tab-services" class="contract-detail-tab-content hidden">
                                        <div class="bg-gray-50 p-4 rounded-lg">
                                            <h3 class="font-semibold mb-4">Chi tiết dịch vụ</h3>
                                            <div class="space-y-4">
                                                <div class="bg-white p-4 rounded-lg border">
                                                    <h4 class="font-medium mb-2">Thu gom rác thải sinh hoạt</h4>
                                                    <div class="grid grid-cols-2 gap-4 text-sm">
                                                        <p><strong class="text-gray-600">Tần suất:</strong> Hàng ngày</p>
                                                        <p><strong class="text-gray-600">Thời gian:</strong> 06:00 - 08:00</p>
                                                        <p><strong class="text-gray-600">Đơn giá:</strong> 35.000 ₫/tháng</p>
                                                        <p><strong class="text-gray-600">Địa điểm:</strong> 123 Lê Lợi, Q.1</p>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div id="contract-tab-payments" class="contract-detail-tab-content hidden">
                                        <div class="bg-gray-50 p-4 rounded-lg">
                                            <div class="flex justify-between items-center mb-4">
                                                <h3 class="font-semibold">Lịch sử thanh toán</h3>
                                                <button id="collect-payment-from-payments-tab" class="bg-green-600 text-white px-3 py-1 rounded-md hover:bg-green-700 text-sm flex items-center">
                                                    <i class="fas fa-plus mr-1"></i> Thu tiền
                                                </button>
                                            </div>
                                            
                                            <!-- Desktop Table View -->
                                            <div class="hidden md:block overflow-x-auto table-responsive">
                                                <table class="w-full text-sm text-left text-gray-600">
                                                    <thead class="text-xs text-gray-700 uppercase bg-gray-100">
                                                        <tr>
                                                            <th scope="col" class="px-6 py-3">Tháng</th>
                                                            <th scope="col" class="px-6 py-3">Số tiền</th>
                                                            <th scope="col" class="px-6 py-3">Ngày thanh toán</th>
                                                            <th scope="col" class="px-6 py-3">Phương thức</th>
                                                            <th scope="col" class="px-6 py-3">Trạng thái</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody>
                                                        <tr class="bg-white border-b hover:bg-gray-50">
                                                            <td class="px-6 py-4">T1/2024</td>
                                                            <td class="px-6 py-4">35.000 ₫</td>
                                                            <td class="px-6 py-4">05/01/2024</td>
                                                            <td class="px-6 py-4">Tiền mặt</td>
                                                            <td class="px-6 py-4"><span class="status-tag bg-green-100 text-green-800">Đã thanh toán</span></td>
                                                        </tr>
                                                        <tr class="bg-white border-b hover:bg-gray-50">
                                                            <td class="px-6 py-4">T2/2024</td>
                                                            <td class="px-6 py-4">35.000 ₫</td>
                                                            <td class="px-6 py-4">03/02/2024</td>
                                                            <td class="px-6 py-4">Chuyển khoản</td>
                                                            <td class="px-6 py-4"><span class="status-tag bg-green-100 text-green-800">Đã thanh toán</span></td>
                                                        </tr>
                                                        <tr class="bg-white border-b hover:bg-gray-50">
                                                            <td class="px-6 py-4">T3/2024</td>
                                                            <td class="px-6 py-4">35.000 ₫</td>
                                                            <td class="px-6 py-4">-</td>
                                                            <td class="px-6 py-4">-</td>
                                                            <td class="px-6 py-4"><span class="status-tag bg-red-100 text-red-800">Chưa thanh toán</span></td>
                                                        </tr>
                                                        <tr class="bg-white border-b hover:bg-gray-50">
                                                            <td class="px-6 py-4">T4/2024</td>
                                                            <td class="px-6 py-4">35.000 ₫</td>
                                                            <td class="px-6 py-4">-</td>
                                                            <td class="px-6 py-4">-</td>
                                                            <td class="px-6 py-4"><span class="status-tag bg-red-100 text-red-800">Chưa thanh toán</span></td>
                                                        </tr>
                                                        <tr class="bg-white border-b hover:bg-gray-50">
                                                            <td class="px-6 py-4">T5/2024</td>
                                                            <td class="px-6 py-4">35.000 ₫</td>
                                                            <td class="px-6 py-4">-</td>
                                                            <td class="px-6 py-4">-</td>
                                                            <td class="px-6 py-4"><span class="status-tag bg-red-100 text-red-800">Chưa thanh toán</span></td>
                                                        </tr>
                                                    </tbody>
                                                </table>
                                            </div>
                                            
                                            <!-- Mobile Card View -->
                                            <div class="md:hidden space-y-3">
                                                <!-- Payment Card 1 -->
                                                <div class="bg-white p-4 rounded-lg border border-gray-200">
                                                    <div class="flex justify-between items-start mb-3">
                                                        <div>
                                                            <h4 class="font-medium text-gray-900">T1/2024</h4>
                                                            <p class="text-lg font-bold text-gray-900">35.000 ₫</p>
                                                        </div>
                                                        <span class="status-tag bg-green-100 text-green-800">Đã thanh toán</span>
                                                    </div>
                                                    <div class="space-y-2 text-sm text-gray-600">
                                                        <div class="flex justify-between">
                                                            <span>Ngày thanh toán:</span>
                                                            <span class="font-medium">05/01/2024</span>
                                                        </div>
                                                        <div class="flex justify-between">
                                                            <span>Phương thức:</span>
                                                            <span class="font-medium">Tiền mặt</span>
                                                        </div>
                                                    </div>
                                                </div>
                                                
                                                <!-- Payment Card 2 -->
                                                <div class="bg-white p-4 rounded-lg border border-gray-200">
                                                    <div class="flex justify-between items-start mb-3">
                                                        <div>
                                                            <h4 class="font-medium text-gray-900">T2/2024</h4>
                                                            <p class="text-lg font-bold text-gray-900">35.000 ₫</p>
                                                        </div>
                                                        <span class="status-tag bg-green-100 text-green-800">Đã thanh toán</span>
                                                    </div>
                                                    <div class="space-y-2 text-sm text-gray-600">
                                                        <div class="flex justify-between">
                                                            <span>Ngày thanh toán:</span>
                                                            <span class="font-medium">03/02/2024</span>
                                                        </div>
                                                        <div class="flex justify-between">
                                                            <span>Phương thức:</span>
                                                            <span class="font-medium">Chuyển khoản</span>
                                                        </div>
                                                    </div>
                                                </div>
                                                
                                                <!-- Payment Card 3 -->
                                                <div class="bg-white p-4 rounded-lg border border-gray-200">
                                                    <div class="flex justify-between items-start mb-3">
                                                        <div>
                                                            <h4 class="font-medium text-gray-900">T3/2024</h4>
                                                            <p class="text-lg font-bold text-gray-900">35.000 ₫</p>
                                                        </div>
                                                        <span class="status-tag bg-red-100 text-red-800">Chưa thanh toán</span>
                                                    </div>
                                                    <div class="space-y-2 text-sm text-gray-600">
                                                        <div class="flex justify-between">
                                                            <span>Ngày thanh toán:</span>
                                                            <span class="font-medium text-gray-400">-</span>
                                                        </div>
                                                        <div class="flex justify-between">
                                                            <span>Phương thức:</span>
                                                            <span class="font-medium text-gray-400">-</span>
                                                        </div>
                                                    </div>
                                                </div>
                                                
                                                <!-- Payment Card 4 -->
                                                <div class="bg-white p-4 rounded-lg border border-gray-200">
                                                    <div class="flex justify-between items-start mb-3">
                                                        <div>
                                                            <h4 class="font-medium text-gray-900">T4/2024</h4>
                                                            <p class="text-lg font-bold text-gray-900">35.000 ₫</p>
                                                        </div>
                                                        <span class="status-tag bg-red-100 text-red-800">Chưa thanh toán</span>
                                                    </div>
                                                    <div class="space-y-2 text-sm text-gray-600">
                                                        <div class="flex justify-between">
                                                            <span>Ngày thanh toán:</span>
                                                            <span class="font-medium text-gray-400">-</span>
                                                        </div>
                                                        <div class="flex justify-between">
                                                            <span>Phương thức:</span>
                                                            <span class="font-medium text-gray-400">-</span>
                                                        </div>
                                                    </div>
                                                </div>
                                                
                                                <!-- Payment Card 5 -->
                                                <div class="bg-white p-4 rounded-lg border border-gray-200">
                                                    <div class="flex justify-between items-start mb-3">
                                                        <div>
                                                            <h4 class="font-medium text-gray-900">T5/2024</h4>
                                                            <p class="text-lg font-bold text-gray-900">35.000 ₫</p>
                                                        </div>
                                                        <span class="status-tag bg-red-100 text-red-800">Chưa thanh toán</span>
                                                    </div>
                                                    <div class="space-y-2 text-sm text-gray-600">
                                                        <div class="flex justify-between">
                                                            <span>Ngày thanh toán:</span>
                                                            <span class="font-medium text-gray-400">-</span>
                                                        </div>
                                                        <div class="flex justify-between">
                                                            <span>Phương thức:</span>
                                                            <span class="font-medium text-gray-400">-</span>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div id="contract-tab-history" class="contract-detail-tab-content hidden">
                                        <div class="bg-gray-50 p-4 rounded-lg">
                                            <h3 class="font-semibold mb-4">Lịch sử thay đổi</h3>
                                            <div class="space-y-4">
                                                <div class="bg-white p-4 rounded-lg border-l-4 border-blue-500">
                                                    <div class="flex justify-between items-start">
                                                        <div>
                                                            <p class="font-medium">Hợp đồng được tạo</p>
                                                            <p class="text-sm text-gray-600">Hợp đồng HD001 được tạo bởi admin</p>
                                                        </div>
                                                        <span class="text-xs text-gray-500">01/01/2024 09:00</span>
                                                    </div>
                                                </div>
                                                <div class="bg-white p-4 rounded-lg border-l-4 border-green-500">
                                                    <div class="flex justify-between items-start">
                                                        <div>
                                                            <p class="font-medium">Hợp đồng được kích hoạt</p>
                                                            <p class="text-sm text-gray-600">Hợp đồng bắt đầu có hiệu lực</p>
                                                        </div>
                                                        <span class="text-xs text-gray-500">01/01/2024 00:00</span>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Add New Contract Modal -->
                        <div id="add-contract-modal" class="fixed inset-0 bg-gray-600 bg-opacity-50 flex justify-center items-center hidden z-50 p-2 md:p-4" style="backdrop-filter: blur(2px);">
                            <div class="bg-white rounded-lg shadow-xl w-full max-w-4xl max-h-[95vh] md:max-h-[90vh] overflow-y-auto">
                                <div class="p-6">
                                    <div class="flex justify-between items-center mb-6">
                                        <h3 class="text-xl font-semibold text-gray-900">Thêm Hợp Đồng Mới</h3>
                                        <button id="close-add-contract-modal" class="text-gray-400 hover:text-gray-600 transition-colors">
                                            <i class="fas fa-times text-xl"></i>
                                        </button>
                                    </div>
                                    
                                    <form id="add-contract-form" class="space-y-6">
                                        <!-- Customer Information -->
                                        <div class="bg-gray-50 p-4 rounded-lg">
                                            <h4 class="font-semibold text-gray-700 mb-4">Thông tin khách hàng</h4>
                                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                                <div>
                                                    <label class="block text-sm font-medium text-gray-700 mb-2">Chọn khách hàng *</label>
                                                    <select id="contract-customer-select" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                                                        <option value="">-- Chọn khách hàng --</option>
                                                        <option value="KH001">KH001 - Nguyễn Văn An</option>
                                                        <option value="KH002">KH002 - Trần Thị Bình</option>
                                                        <option value="KH003">KH003 - Lê Văn Cường</option>
                                                        <option value="KH004">KH004 - Phạm Thị Dung</option>
                                                        <option value="KH005">KH005 - Võ Văn Em</option>
                                                    </select>
                                                </div>
                                                <div>
                                                    <label class="block text-sm font-medium text-gray-700 mb-2">Địa chỉ thực hiện *</label>
                                                    <div class="relative">
                                                        <input type="text" id="contract-address" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="Nhập địa chỉ thực hiện dịch vụ" required>
                                                        <button type="button" id="add-new-address" class="absolute right-2 top-1/2 transform -translate-y-1/2 text-blue-600 hover:text-blue-800 text-sm font-medium" title="Thêm địa chỉ mới">
                                                            <i class="fas fa-plus mr-1"></i>Mới
                                                        </button>
                                                    </div>
                                                    <div id="customer-addresses" class="mt-2 hidden">
                                                        <div class="text-xs text-gray-600 mb-2">Địa chỉ có sẵn:</div>
                                                        <div id="address-list" class="space-y-1">
                                                            <!-- Address options will be populated here -->
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        
                                        <!-- Service Information -->
                                        <div class="bg-gray-50 p-4 rounded-lg">
                                            <h4 class="font-semibold text-gray-700 mb-4">Thông tin dịch vụ</h4>
                                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                                <div>
                                                    <label class="block text-sm font-medium text-gray-700 mb-2">Loại dịch vụ *</label>
                                                    <select id="contract-service-type" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                                                        <option value="">-- Chọn loại dịch vụ --</option>
                                                        <option value="recurring">Dịch vụ định kỳ</option>
                                                        <option value="one-time">Dịch vụ một lần</option>
                                                    </select>
                                                </div>
                                                <div>
                                                    <label class="block text-sm font-medium text-gray-700 mb-2">Dịch vụ *</label>
                                                    <select id="contract-service-detail" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                                                        <option value="">-- Chọn dịch vụ --</option>
                                                    </select>
                                                </div>
                                            </div>
                                            
                                            <!-- Service Details (Dynamic) -->
                                            <div id="service-details-container" class="mt-4 hidden">
                                                <!-- Recurring Service Details -->
                                                <div id="recurring-service-details" class="hidden">
                                                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                                                        <div>
                                                            <label class="block text-sm font-medium text-gray-700 mb-2">Tần suất</label>
                                                            <select id="contract-frequency" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                                                <option value="daily">Hàng ngày</option>
                                                                <option value="weekly">Hàng tuần</option>
                                                                <option value="monthly">Hàng tháng</option>
                                                                <option value="custom">Tùy chỉnh</option>
                                                            </select>
                                                        </div>
                                                        <div>
                                                            <label class="block text-sm font-medium text-gray-700 mb-2 unit-price-label">Đơn giá</label>
                                                            <div class="relative">
                                                                <input type="text" id="contract-unit-price" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="Nhập đơn giá">
                                                                <button type="button" id="reset-contract-price" class="absolute right-2 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600" title="Lấy giá mặc định">
                                                                    <i class="fas fa-undo text-sm"></i>
                                                                </button>
                                                            </div>
                                                        </div>
                                                        <div>
                                                            <label class="block text-sm font-medium text-gray-700 mb-2 unit-price-label">Đơn vị tính</label>
                                                            <select id="contract-unit" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                                                <option value="month">Tháng</option>
                                                                <option value="time">Lần</option>
                                                                <option value="kg">Kg</option>
                                                                <option value="m3">m³</option>
                                                            </select>
                                                        </div>
                                                    </div>
                                                </div>
                                                
                                                <!-- One-time Service Details -->
                                                <div id="one-time-service-details" class="hidden">
                                                    <div class="bg-orange-50 border border-orange-200 p-4 rounded-lg mb-4">
                                                        <div class="flex items-start">
                                                            <i class="fas fa-info-circle text-orange-600 mt-1 mr-3"></i>
                                                            <div>
                                                                <h4 class="font-semibold text-orange-800 mb-2">Dịch vụ một lần</h4>
                                                                <p class="text-orange-700 text-sm mb-3">Vui lòng nhập đơn giá và số lượng để tính tổng giá trị.</p>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                                        <div>
                                                            <label class="block text-sm font-medium text-gray-700 mb-2 unit-price-label">Đơn giá *</label>
                                                            <div class="relative">
                                                                <input type="text" id="one-time-unit-price" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="Nhập đơn giá" required>
                                                                <button type="button" id="reset-one-time-price" class="absolute right-8 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600" title="Lấy giá mặc định">
                                                                    <i class="fas fa-undo text-sm"></i>
                                                                </button>
                                                                <div class="absolute inset-y-0 right-0 flex items-center pr-3">
                                                                    <span class="text-gray-500 text-sm">₫</span>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <div>
                                                            <label class="block text-sm font-medium text-gray-700 mb-2 unit-price-label">Số lượng *</label>
                                                            <input type="number" id="one-time-quantity" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="Nhập số lượng" min="1" value="1" required>
                                                        </div>
                                                    </div>
                                                    <div class="mt-4">
                                                        <label class="block text-sm font-medium text-gray-700 mb-2">Ghi chú chi tiết</label>
                                                        <textarea id="one-time-description" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" rows="2" placeholder="Mô tả chi tiết về dịch vụ (ví dụ: diện tích cần thu dọn, loại rác thải...)"></textarea>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        
                                        <!-- Contract Period -->
                                        <div class="bg-gray-50 p-4 rounded-lg">
                                            <h4 class="font-semibold text-gray-700 mb-4">Thời hạn hợp đồng</h4>
                                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                                <div>
                                                    <label class="block text-sm font-medium text-gray-700 mb-2">Ngày bắt đầu *</label>
                                                    <input type="date" id="contract-start-date" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                                                </div>
                                                <div>
                                                    <label class="block text-sm font-medium text-gray-700 mb-2">Ngày kết thúc</label>
                                                    <input type="date" id="contract-end-date" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                                </div>
                                            </div>
                                            <div class="mt-4">
                                                <label class="flex items-center">
                                                    <input type="checkbox" id="contract-no-end-date" class="mr-2">
                                                    <span class="text-sm text-gray-700">Không có ngày kết thúc (hợp đồng dài hạn)</span>
                                                </label>
                                            </div>
                                        </div>
                                        
                                        <!-- Additional Information -->
                                        <div class="bg-gray-50 p-4 rounded-lg">
                                            <h4 class="font-semibold text-gray-700 mb-4">Thông tin bổ sung</h4>
                                            <div class="space-y-4">
                                                <div>
                                                    <label class="block text-sm font-medium text-gray-700 mb-2">Ghi chú</label>
                                                    <textarea id="contract-note" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" rows="3" placeholder="Ghi chú về hợp đồng..."></textarea>
                                                </div>
                                                <div>
                                                    <label class="block text-sm font-medium text-gray-700 mb-2">Người phụ trách</label>
                                                    <select id="contract-assigned-to" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                                        <option value="">-- Chọn nhân viên --</option>
                                                        <option value="NV001">NV001 - Nguyễn Văn A</option>
                                                        <option value="NV002">NV002 - Trần Thị B</option>
                                                        <option value="NV003">NV003 - Lê Văn C</option>
                                                    </select>
                                                </div>
                                            </div>
                                        </div>
                                        
                                        <!-- Contract Summary -->
                                        <div class="bg-blue-50 p-4 rounded-lg">
                                            <h4 class="font-semibold text-gray-700 mb-4">Tổng kết hợp đồng</h4>
                                            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                                                <div>
                                                    <label class="block text-sm font-medium text-gray-700 unit-price-label">Tổng giá trị:</label>
                                                    <span id="contract-total-value" class="text-lg font-bold text-blue-600">0 ₫</span>
                                                </div>
                                                <div>
                                                    <label class="block text-sm font-medium text-gray-700 unit-price-label">Thời hạn:</label>
                                                    <span id="contract-duration" class="text-sm text-gray-600">Chưa xác định</span>
                                                </div>
                                                <div>
                                                    <label class="block text-sm font-medium text-gray-700 unit-price-label">Trạng thái:</label>
                                                    <span class="status-tag bg-green-100 text-green-800">Sẵn sàng tạo</span>
                                                </div>
                                            </div>
                                        </div>
                                        
                                        <!-- Action Buttons -->
                                        <div class="flex justify-end space-x-3">
                                            <button type="button" id="test-calc" class="px-4 py-2 bg-yellow-500 text-white rounded-md hover:bg-yellow-600">Test Calc</button>
                                            <button type="button" id="test-success" class="px-4 py-2 bg-green-500 text-white rounded-md hover:bg-green-600">Test Success</button>
                                            <button type="button" id="test-submit" class="px-4 py-2 bg-purple-500 text-white rounded-md hover:bg-purple-600">Test Submit</button>
                                            <button type="button" id="test-notification" class="px-4 py-2 bg-orange-500 text-white rounded-md hover:bg-orange-600">Test Modal</button>
                                            <button type="button" id="debug-modal" class="px-4 py-2 bg-red-500 text-white rounded-md hover:bg-red-600">Debug Modal</button>
                                            <button type="button" id="test-alert" class="px-4 py-2 bg-pink-500 text-white rounded-md hover:bg-pink-600">Test Alert</button>
                                            <button type="button" id="test-simple-modal" class="px-4 py-2 bg-indigo-500 text-white rounded-md hover:bg-indigo-600">Test Simple Modal</button>
                                            <button type="button" id="test-payment-modal" class="px-4 py-2 bg-teal-500 text-white rounded-md hover:bg-teal-600">Test Payment Modal</button>
                                            <button type="button" id="cancel-add-contract" class="px-4 py-2 bg-gray-300 text-gray-700 rounded-md hover:bg-gray-400">Hủy</button>
                                            <button type="submit" id="save-contract" class="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 opacity-50 cursor-not-allowed" disabled>Tạo hợp đồng</button>
                                        </div>
                                    </form>
                                </div>
                            </div>
                        </div>
                        
                        <div id="employees-content" class="web-content-page hidden">
                            <div class="bg-white p-6 rounded-lg shadow-sm">
                                <!-- Header với tiêu đề và nút hành động -->
                                <div class="flex justify-between items-center mb-4">
                                    <h2 class="text-xl font-bold text-gray-800">Danh sách Nhân viên</h2>
                                    <div class="flex space-x-2">
                                        <button class="bg-white border border-gray-300 text-gray-700 px-4 py-2 rounded-md hover:bg-gray-50 flex items-center">
                                            <i class="fas fa-upload mr-2"></i> Import
                                        </button>
                                        <button class="bg-white border border-gray-300 text-gray-700 px-4 py-2 rounded-md hover:bg-gray-50 flex items-center">
                                            <i class="fas fa-download mr-2"></i> Export
                                        </button>
                                        <button id="add-employee-btn" class="bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700 flex items-center">
                                            <i class="fas fa-plus mr-2"></i>Thêm mới
                                        </button>
                                    </div>
                                </div>

                                <!-- Bộ lọc tìm kiếm -->
                                <div class="p-4 bg-gray-50 rounded-lg border border-gray-200 mb-4">
                                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                                        <input type="text" placeholder="Tìm kiếm mã NV, tên, SĐT..." class="px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                        <select class="px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                            <option>Tất cả chức vụ</option>
                                            <option>Lái xe</option>
                                            <option>Công nhân thu gom</option>
                                            <option>Giám sát</option>
                                            <option>Quản lý</option>
                                        </select>
                                        <select class="px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                            <option>Tất cả trạng thái</option>
                                            <option>Đang làm việc</option>
                                            <option>Tạm nghỉ</option>
                                            <option>Nghỉ việc</option>
                                        </select>
                                        <button class="bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700">Tìm kiếm</button>
                                    </div>
                                </div>

                                <!-- Bộ lọc trạng thái -->
                                <div class="flex items-center space-x-6 mb-4 p-4 bg-gray-50 rounded-lg status-filter-container">
                                    <div class="flex items-center space-x-4">
                                        <label class="flex items-center status-filter-all" role="button" tabindex="0" aria-label="Lọc tất cả nhân viên">
                                            <input type="radio" name="employee-status-filter" value="all" class="status-radio" checked>
                                            <span class="ml-2 text-sm font-medium text-gray-700">Tất cả | 15</span>
                                        </label>
                                        <label class="flex items-center status-filter-active" role="button" tabindex="0" aria-label="Lọc nhân viên đang làm việc">
                                            <input type="radio" name="employee-status-filter" value="active" class="status-radio">
                                            <span class="ml-2 text-sm font-medium text-gray-700">Đang làm việc | 12</span>
                                        </label>
                                        <label class="flex items-center status-filter-paused" role="button" tabindex="0" aria-label="Lọc nhân viên tạm nghỉ">
                                            <input type="radio" name="employee-status-filter" value="paused" class="status-radio">
                                            <span class="ml-2 text-sm font-medium text-gray-700">Tạm nghỉ | 2</span>
                                        </label>
                                        <label class="flex items-center status-filter-ended" role="button" tabindex="0" aria-label="Lọc nhân viên nghỉ việc">
                                            <input type="radio" name="employee-status-filter" value="ended" class="status-radio">
                                            <span class="ml-2 text-sm font-medium text-gray-700">Nghỉ việc | 1</span>
                                        </label>
                                    </div>
                                </div>

                                <!-- Bảng dữ liệu Desktop -->
                                <div class="overflow-x-auto table-responsive">
                                    <table class="w-full text-sm text-left text-gray-600" style="min-width: 1200px;">
                                        <thead class="text-xs text-gray-700 uppercase bg-gray-100">
                                            <tr>
                                                <th scope="col" class="px-6 py-3" style="min-width: 60px;">STT</th>
                                                <th scope="col" class="px-6 py-3" style="min-width: 120px;">Hành động</th>
                                                <th scope="col" class="px-6 py-3" style="min-width: 80px;">Mã NV</th>
                                                <th scope="col" class="px-6 py-3" style="min-width: 150px;">Họ và tên</th>
                                                <th scope="col" class="px-6 py-3" style="min-width: 120px;">Chức vụ</th>
                                                <th scope="col" class="px-6 py-3" style="min-width: 100px;">Số điện thoại</th>
                                                <th scope="col" class="px-6 py-3" style="min-width: 180px;">Email</th>
                                                <th scope="col" class="px-6 py-3" style="min-width: 100px;">Ngày vào làm</th>
                                                <th scope="col" class="px-6 py-3" style="min-width: 120px;">Tuyến thu gom</th>
                                                <th scope="col" class="px-6 py-3" style="min-width: 120px;">Trạng thái</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr class="bg-white border-b hover:bg-gray-50 employee-row" data-status="active">
                                                <td class="px-6 py-4">1</td>
                                                <td class="px-6 py-4">
                                                    <a href="#" class="view-employee-detail font-medium text-blue-600 hover:underline">Xem chi tiết</a>
                                                </td>
                                                <td class="px-6 py-4 font-medium text-gray-900">NV001</td>
                                                <td class="px-6 py-4">Nguyễn Văn Minh</td>
                                                <td class="px-6 py-4">Lái xe</td>
                                                <td class="px-6 py-4">090xxxx001</td>
                                                <td class="px-6 py-4">minh.nv@example.com</td>
                                                <td class="px-6 py-4">01/01/2023</td>
                                                <td class="px-6 py-4">Tuyến A - Q.1</td>
                                                <td class="px-6 py-4">
                                                    <span class="status-tag bg-green-100 text-green-800">Đang làm việc</span>
                                                </td>
                                            </tr>
                                            <tr class="bg-white border-b hover:bg-gray-50 employee-row" data-status="active">
                                                <td class="px-6 py-4">2</td>
                                                <td class="px-6 py-4">
                                                    <a href="#" class="view-employee-detail font-medium text-blue-600 hover:underline">Xem chi tiết</a>
                                                </td>
                                                <td class="px-6 py-4 font-medium text-gray-900">NV002</td>
                                                <td class="px-6 py-4">Trần Thị Hương</td>
                                                <td class="px-6 py-4">Công nhân thu gom</td>
                                                <td class="px-6 py-4">091xxxx002</td>
                                                <td class="px-6 py-4">huong.tt@example.com</td>
                                                <td class="px-6 py-4">15/02/2023</td>
                                                <td class="px-6 py-4">Tuyến B - Q.3</td>
                                                <td class="px-6 py-4">
                                                    <span class="status-tag bg-green-100 text-green-800">Đang làm việc</span>
                                                </td>
                                            </tr>
                                            <tr class="bg-white border-b hover:bg-gray-50 employee-row" data-status="paused">
                                                <td class="px-6 py-4">3</td>
                                                <td class="px-6 py-4">
                                                    <a href="#" class="view-employee-detail font-medium text-blue-600 hover:underline">Xem chi tiết</a>
                                                </td>
                                                <td class="px-6 py-4 font-medium text-gray-900">NV003</td>
                                                <td class="px-6 py-4">Lê Văn Sơn</td>
                                                <td class="px-6 py-4">Giám sát</td>
                                                <td class="px-6 py-4">092xxxx003</td>
                                                <td class="px-6 py-4">son.lv@example.com</td>
                                                <td class="px-6 py-4">01/03/2023</td>
                                                <td class="px-6 py-4">Tuyến C - Q.5</td>
                                                <td class="px-6 py-4">
                                                    <span class="status-tag bg-yellow-100 text-yellow-800">Tạm nghỉ</span>
                                                </td>
                                            </tr>
                                            <tr class="bg-white border-b hover:bg-gray-50 employee-row" data-status="active">
                                                <td class="px-6 py-4">4</td>
                                                <td class="px-6 py-4">
                                                    <a href="#" class="view-employee-detail font-medium text-blue-600 hover:underline">Xem chi tiết</a>
                                                </td>
                                                <td class="px-6 py-4 font-medium text-gray-900">NV004</td>
                                                <td class="px-6 py-4">Phạm Thị Lan</td>
                                                <td class="px-6 py-4">Công nhân thu gom</td>
                                                <td class="px-6 py-4">093xxxx004</td>
                                                <td class="px-6 py-4">lan.pt@example.com</td>
                                                <td class="px-6 py-4">01/04/2023</td>
                                                <td class="px-6 py-4">Tuyến A - Q.1</td>
                                                <td class="px-6 py-4">
                                                    <span class="status-tag bg-green-100 text-green-800">Đang làm việc</span>
                                                </td>
                                            </tr>
                                            <tr class="bg-white border-b hover:bg-gray-50 employee-row" data-status="ended">
                                                <td class="px-6 py-4">5</td>
                                                <td class="px-6 py-4">
                                                    <a href="#" class="view-employee-detail font-medium text-blue-600 hover:underline">Xem chi tiết</a>
                                                </td>
                                                <td class="px-6 py-4 font-medium text-gray-900">NV005</td>
                                                <td class="px-6 py-4">Võ Hoàng Nam</td>
                                                <td class="px-6 py-4">Lái xe</td>
                                                <td class="px-6 py-4">094xxxx005</td>
                                                <td class="px-6 py-4">nam.vh@example.com</td>
                                                <td class="px-6 py-4">01/01/2022</td>
                                                <td class="px-6 py-4">Tuyến D - Q.7</td>
                                                <td class="px-6 py-4">
                                                    <span class="status-tag bg-gray-200 text-gray-800">Nghỉ việc</span>
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>

                                <!-- Mobile Card View -->
                                <div class="mobile-card-view">
                                    <div class="mobile-card employee-row" data-status="active">
                                        <div class="mobile-card-header">
                                            <div class="mobile-card-title">NV001 - Nguyễn Văn Minh</div>
                                            <span class="mobile-card-status bg-green-100 text-green-800">Đang làm việc</span>
                                        </div>
                                        <div class="mobile-card-content">
                                            <div class="mobile-card-row">
                                                <span class="mobile-card-label">Chức vụ:</span>
                                                <span class="mobile-card-value">Lái xe</span>
                                            </div>
                                            <div class="mobile-card-row">
                                                <span class="mobile-card-label">SĐT:</span>
                                                <span class="mobile-card-value">090xxxx001</span>
                                            </div>
                                            <div class="mobile-card-row">
                                                <span class="mobile-card-label">Email:</span>
                                                <span class="mobile-card-value">minh.nv@example.com</span>
                                            </div>
                                            <div class="mobile-card-row">
                                                <span class="mobile-card-label">Tuyến thu gom:</span>
                                                <span class="mobile-card-value">Tuyến A - Q.1</span>
                                            </div>
                                            <div class="mobile-card-row">
                                                <span class="mobile-card-label">Ngày vào làm:</span>
                                                <span class="mobile-card-value">01/01/2023</span>
                                            </div>
                                        </div>
                                        <div class="mobile-card-actions">
                                            <a href="#" class="mobile-card-action-btn view-employee-detail">Xem chi tiết</a>
                                        </div>
                                    </div>

                                    <div class="mobile-card employee-row" data-status="active">
                                        <div class="mobile-card-header">
                                            <div class="mobile-card-title">NV002 - Trần Thị Hương</div>
                                            <span class="mobile-card-status bg-green-100 text-green-800">Đang làm việc</span>
                                        </div>
                                        <div class="mobile-card-content">
                                            <div class="mobile-card-row">
                                                <span class="mobile-card-label">Chức vụ:</span>
                                                <span class="mobile-card-value">Công nhân thu gom</span>
                                            </div>
                                            <div class="mobile-card-row">
                                                <span class="mobile-card-label">SĐT:</span>
                                                <span class="mobile-card-value">091xxxx002</span>
                                            </div>
                                            <div class="mobile-card-row">
                                                <span class="mobile-card-label">Email:</span>
                                                <span class="mobile-card-value">huong.tt@example.com</span>
                                            </div>
                                            <div class="mobile-card-row">
                                                <span class="mobile-card-label">Tuyến thu gom:</span>
                                                <span class="mobile-card-value">Tuyến B - Q.3</span>
                                            </div>
                                            <div class="mobile-card-row">
                                                <span class="mobile-card-label">Ngày vào làm:</span>
                                                <span class="mobile-card-value">15/02/2023</span>
                                            </div>
                                        </div>
                                        <div class="mobile-card-actions">
                                            <a href="#" class="mobile-card-action-btn view-employee-detail">Xem chi tiết</a>
                                        </div>
                                    </div>

                                    <div class="mobile-card employee-row" data-status="paused">
                                        <div class="mobile-card-header">
                                            <div class="mobile-card-title">NV003 - Lê Văn Sơn</div>
                                            <span class="mobile-card-status bg-yellow-100 text-yellow-800">Tạm nghỉ</span>
                                        </div>
                                        <div class="mobile-card-content">
                                            <div class="mobile-card-row">
                                                <span class="mobile-card-label">Chức vụ:</span>
                                                <span class="mobile-card-value">Giám sát</span>
                                            </div>
                                            <div class="mobile-card-row">
                                                <span class="mobile-card-label">SĐT:</span>
                                                <span class="mobile-card-value">092xxxx003</span>
                                            </div>
                                            <div class="mobile-card-row">
                                                <span class="mobile-card-label">Email:</span>
                                                <span class="mobile-card-value">son.lv@example.com</span>
                                            </div>
                                            <div class="mobile-card-row">
                                                <span class="mobile-card-label">Tuyến thu gom:</span>
                                                <span class="mobile-card-value">Tuyến C - Q.5</span>
                                            </div>
                                            <div class="mobile-card-row">
                                                <span class="mobile-card-label">Ngày vào làm:</span>
                                                <span class="mobile-card-value">01/03/2023</span>
                                            </div>
                                        </div>
                                        <div class="mobile-card-actions">
                                            <a href="#" class="mobile-card-action-btn view-employee-detail">Xem chi tiết</a>
                                        </div>
                                    </div>
                                </div>

                                <!-- Phân trang -->
                                <div class="pagination-container">
                                    <div class="pagination-info">
                                        Hiển thị <span id="employee-pagination-start">1</span> - <span id="employee-pagination-end">5</span> của <span id="employee-pagination-total">15</span> nhân viên
                                    </div>
                                    <div class="pagination-controls">
                                        <button class="pagination-button" id="employee-pagination-prev" disabled>
                                            <i class="fas fa-chevron-left"></i>
                                        </button>
                                        <button class="pagination-button active" data-page="1">1</button>
                                        <button class="pagination-button" data-page="2">2</button>
                                        <button class="pagination-button" data-page="3">3</button>
                                        <button class="pagination-button" id="employee-pagination-next">
                                            <i class="fas fa-chevron-right"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div id="services-content" class="web-content-page hidden">
                            <div class="bg-white p-6 rounded-lg shadow-sm">
                                <!-- Header với tiêu đề và nút hành động -->
                                <div class="flex justify-between items-center mb-4">
                                    <h2 class="text-xl font-bold text-gray-800">Quản lý Dịch vụ Thu gom</h2>
                                    <div class="flex space-x-2">
                                        <button class="bg-white border border-gray-300 text-gray-700 px-4 py-2 rounded-md hover:bg-gray-50 flex items-center">
                                            <i class="fas fa-upload mr-2"></i> Import
                                        </button>
                                        <button class="bg-white border border-gray-300 text-gray-700 px-4 py-2 rounded-md hover:bg-gray-50 flex items-center">
                                            <i class="fas fa-download mr-2"></i> Export
                                        </button>
                                        <button id="add-service-group-btn" class="bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700 flex items-center">
                                            <i class="fas fa-plus mr-2"></i>Thêm nhóm dịch vụ
                                        </button>
                                        <button id="add-service-btn" class="bg-green-600 text-white px-4 py-2 rounded-md hover:bg-green-700 flex items-center">
                                            <i class="fas fa-plus mr-2"></i>Thêm dịch vụ
                                        </button>
                                        <button id="manage-pricing-btn" class="bg-purple-600 text-white px-4 py-2 rounded-md hover:bg-purple-700 flex items-center" onclick="openPricingModal()">
                                            <i class="fas fa-chart-line mr-2"></i>Quản lý giá
                                        </button>
                                    </div>
                                </div>

                                <!-- Bộ lọc tìm kiếm -->
                                <div class="p-4 bg-gray-50 rounded-lg border border-gray-200 mb-4">
                                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                                        <input type="text" placeholder="Tìm kiếm tên dịch vụ, mã dịch vụ..." class="px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                        <select class="px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                            <option>Tất cả nhóm dịch vụ</option>
                                            <option>Thu gom rác sinh hoạt</option>
                                            <option>Thu gom rác công nghiệp</option>
                                            <option>Thu gom rác nguy hại</option>
                                            <option>Thu gom rác tái chế</option>
                                        </select>
                                        <select class="px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                            <option>Tất cả đơn vị cơ sở</option>
                                            <option>ĐV Cơ sở A</option>
                                            <option>ĐV Cơ sở B</option>
                                            <option>ĐV Cơ sở C</option>
                                        </select>
                                        <button class="bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700">Tìm kiếm</button>
                                    </div>
                                </div>

                                <!-- Bộ lọc trạng thái -->
                                <div class="flex items-center space-x-6 mb-4 p-4 bg-gray-50 rounded-lg status-filter-container">
                                    <div class="flex items-center space-x-4">
                                        <label class="flex items-center status-filter-all" role="button" tabindex="0" aria-label="Lọc tất cả dịch vụ">
                                            <input type="radio" name="service-status-filter" value="all" class="status-radio" checked>
                                            <span class="ml-2 text-sm font-medium text-gray-700">Tất cả | 18</span>
                                        </label>
                                        <label class="flex items-center status-filter-active" role="button" tabindex="0" aria-label="Lọc dịch vụ đang hoạt động">
                                            <input type="radio" name="service-status-filter" value="active" class="status-radio">
                                            <span class="ml-2 text-sm font-medium text-gray-700">Đang hoạt động | 15</span>
                                        </label>
                                        <label class="flex items-center status-filter-paused" role="button" tabindex="0" aria-label="Lọc dịch vụ tạm dừng">
                                            <input type="radio" name="service-status-filter" value="paused" class="status-radio">
                                            <span class="ml-2 text-sm font-medium text-gray-700">Tạm dừng | 2</span>
                                        </label>
                                        <label class="flex items-center status-filter-ended" role="button" tabindex="0" aria-label="Lọc dịch vụ đã dừng">
                                            <input type="radio" name="service-status-filter" value="ended" class="status-radio">
                                            <span class="ml-2 text-sm font-medium text-gray-700">Đã dừng | 1</span>
                                        </label>
                                    </div>
                                </div>

                                <!-- Bảng dữ liệu Desktop -->
                                <div class="overflow-x-auto table-responsive">
                                    <table class="w-full text-sm text-left text-gray-600" style="min-width: 1400px;">
                                        <thead class="text-xs text-gray-700 uppercase bg-gray-100">
                                            <tr>
                                                <th scope="col" class="px-6 py-3" style="min-width: 60px;">STT</th>
                                                <th scope="col" class="px-6 py-3" style="min-width: 120px;">Hành động</th>
                                                <th scope="col" class="px-6 py-3" style="min-width: 80px;">Mã DV</th>
                                                <th scope="col" class="px-6 py-3" style="min-width: 200px;">Tên dịch vụ</th>
                                                <th scope="col" class="px-6 py-3" style="min-width: 150px;">Nhóm dịch vụ</th>
                                                <th scope="col" class="px-6 py-3" style="min-width: 120px;">Đơn vị cơ sở</th>
                                                <th scope="col" class="px-6 py-3" style="min-width: 120px;">Đơn giá</th>
                                                <th scope="col" class="px-6 py-3" style="min-width: 100px;">Ngày áp dụng</th>
                                                <th scope="col" class="px-6 py-3 allow-wrap" style="min-width: 250px;">Mô tả</th>
                                                <th scope="col" class="px-6 py-3" style="min-width: 120px;">Trạng thái</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr class="bg-white border-b hover:bg-gray-50 service-row" data-status="active">
                                                <td class="px-6 py-4">1</td>
                                                <td class="px-6 py-4">
                                                    <div class="flex space-x-2">
                                                        <a href="#" class="view-service-detail font-medium text-blue-600 hover:underline">Xem</a>
                                                        <a href="#" class="edit-service-detail font-medium text-green-600 hover:underline">Sửa</a>
                                                        <a href="#" class="view-price-history font-medium text-purple-600 hover:underline" data-service-id="DV001" onclick="openPricingModalWithService('DV001')">Giá</a>
                                                    </div>
                                                </td>
                                                <td class="px-6 py-4 font-medium text-gray-900">DV001</td>
                                                <td class="px-6 py-4">Thu gom rác sinh hoạt hàng ngày</td>
                                                <td class="px-6 py-4">
                                                    <span class="status-tag bg-blue-100 text-blue-800">Thu gom rác sinh hoạt</span>
                                                </td>
                                                <td class="px-6 py-4">ĐV Cơ sở A</td>
                                                <td class="px-6 py-4 font-medium">35.000 ₫/tháng</td>
                                                <td class="px-6 py-4">01/01/2024</td>
                                                <td class="px-6 py-4">Thu gom rác sinh hoạt hàng ngày cho hộ gia đình</td>
                                                <td class="px-6 py-4">
                                                    <span class="status-tag bg-green-100 text-green-800">Đang hoạt động</span>
                                                </td>
                                            </tr>
                                            <tr class="bg-white border-b hover:bg-gray-50 service-row" data-status="active">
                                                <td class="px-6 py-4">2</td>
                                                <td class="px-6 py-4">
                                                    <div class="flex space-x-2">
                                                        <a href="#" class="view-service-detail font-medium text-blue-600 hover:underline">Xem</a>
                                                        <a href="#" class="edit-service-detail font-medium text-green-600 hover:underline">Sửa</a>
                                                        <a href="#" class="view-price-history font-medium text-purple-600 hover:underline" data-service-id="DV002" onclick="openPricingModalWithService('DV002')">Giá</a>
                                                    </div>
                                                </td>
                                                <td class="px-6 py-4 font-medium text-gray-900">DV002</td>
                                                <td class="px-6 py-4">Thu gom rác sinh hoạt 3 lần/tuần</td>
                                                <td class="px-6 py-4">
                                                    <span class="status-tag bg-blue-100 text-blue-800">Thu gom rác sinh hoạt</span>
                                                </td>
                                                <td class="px-6 py-4">ĐV Cơ sở A</td>
                                                <td class="px-6 py-4 font-medium">25.000 ₫/tháng</td>
                                                <td class="px-6 py-4">01/01/2024</td>
                                                <td class="px-6 py-4">Thu gom rác sinh hoạt 3 lần/tuần cho hộ gia đình</td>
                                                <td class="px-6 py-4">
                                                    <span class="status-tag bg-green-100 text-green-800">Đang hoạt động</span>
                                                </td>
                                            </tr>
                                            <tr class="bg-white border-b hover:bg-gray-50 service-row" data-status="active">
                                                <td class="px-6 py-4">3</td>
                                                <td class="px-6 py-4">
                                                    <div class="flex space-x-2">
                                                        <a href="#" class="view-service-detail font-medium text-blue-600 hover:underline">Xem</a>
                                                        <a href="#" class="edit-service-detail font-medium text-green-600 hover:underline">Sửa</a>
                                                        <a href="#" class="view-price-history font-medium text-purple-600 hover:underline" data-service-id="DV003" onclick="openPricingModalWithService('DV003')">Giá</a>
                                                    </div>
                                                </td>
                                                <td class="px-6 py-4 font-medium text-gray-900">DV003</td>
                                                <td class="px-6 py-4">Thu gom rác công nghiệp 2 lần/tuần</td>
                                                <td class="px-6 py-4">
                                                    <span class="status-tag bg-emerald-100 text-emerald-800">Thu gom rác công nghiệp</span>
                                                </td>
                                                <td class="px-6 py-4">ĐV Cơ sở B</td>
                                                <td class="px-6 py-4 font-medium">120.000 ₫/tháng</td>
                                                <td class="px-6 py-4">01/02/2024</td>
                                                <td class="px-6 py-4">Thu gom rác công nghiệp 2 lần/tuần cho doanh nghiệp</td>
                                                <td class="px-6 py-4">
                                                    <span class="status-tag bg-green-100 text-green-800">Đang hoạt động</span>
                                                </td>
                                            </tr>
                                            <tr class="bg-white border-b hover:bg-gray-50 service-row" data-status="active">
                                                <td class="px-6 py-4">4</td>
                                                <td class="px-6 py-4">
                                                    <div class="flex space-x-2">
                                                        <a href="#" class="view-service-detail font-medium text-blue-600 hover:underline">Xem</a>
                                                        <a href="#" class="edit-service-detail font-medium text-green-600 hover:underline">Sửa</a>
                                                        <a href="#" class="view-price-history font-medium text-purple-600 hover:underline" data-service-id="DV004" onclick="openPricingModalWithService('DV004')">Giá</a>
                                                    </div>
                                                </td>
                                                <td class="px-6 py-4 font-medium text-gray-900">DV004</td>
                                                <td class="px-6 py-4">Thu gom rác công nghiệp hàng ngày</td>
                                                <td class="px-6 py-4">
                                                    <span class="status-tag bg-emerald-100 text-emerald-800">Thu gom rác công nghiệp</span>
                                                </td>
                                                <td class="px-6 py-4">ĐV Cơ sở B</td>
                                                <td class="px-6 py-4 font-medium">150.000 ₫/tháng</td>
                                                <td class="px-6 py-4">01/02/2024</td>
                                                <td class="px-6 py-4">Thu gom rác công nghiệp hàng ngày cho doanh nghiệp</td>
                                                <td class="px-6 py-4">
                                                    <span class="status-tag bg-green-100 text-green-800">Đang hoạt động</span>
                                                </td>
                                            </tr>
                                            <tr class="bg-white border-b hover:bg-gray-50 service-row" data-status="paused">
                                                <td class="px-6 py-4">5</td>
                                                <td class="px-6 py-4">
                                                    <div class="flex space-x-2">
                                                        <a href="#" class="view-service-detail font-medium text-blue-600 hover:underline">Xem</a>
                                                        <a href="#" class="edit-service-detail font-medium text-green-600 hover:underline">Sửa</a>
                                                        <a href="#" class="view-price-history font-medium text-purple-600 hover:underline" data-service-id="DV005" onclick="openPricingModalWithService('DV005')">Giá</a>
                                                    </div>
                                                </td>
                                                <td class="px-6 py-4 font-medium text-gray-900">DV005</td>
                                                <td class="px-6 py-4">Thu gom rác nguy hại theo yêu cầu</td>
                                                <td class="px-6 py-4">
                                                    <span class="status-tag bg-red-100 text-red-800">Thu gom rác nguy hại</span>
                                                </td>
                                                <td class="px-6 py-4">ĐV Cơ sở C</td>
                                                <td class="px-6 py-4 font-medium">500.000 ₫/lần</td>
                                                <td class="px-6 py-4">01/03/2024</td>
                                                <td class="px-6 py-4">Thu gom rác nguy hại theo yêu cầu</td>
                                                <td class="px-6 py-4">
                                                    <span class="status-tag bg-yellow-100 text-yellow-800">Tạm dừng</span>
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>

                                <!-- Mobile Card View -->
                                <div class="mobile-card-view">
                                    <div class="mobile-card service-row" data-status="active">
                                        <div class="mobile-card-header">
                                            <div class="mobile-card-title">DV001 - Thu gom rác sinh hoạt hàng ngày</div>
                                            <span class="mobile-card-status bg-green-100 text-green-800">Đang hoạt động</span>
                                        </div>
                                        <div class="mobile-card-content">
                                            <div class="mobile-card-row">
                                                <span class="mobile-card-label">Nhóm dịch vụ:</span>
                                                <span class="mobile-card-value">Thu gom rác sinh hoạt</span>
                                            </div>
                                            <div class="mobile-card-row">
                                                <span class="mobile-card-label">Đơn vị cơ sở:</span>
                                                <span class="mobile-card-value">ĐV Cơ sở A</span>
                                            </div>
                                            <div class="mobile-card-row">
                                                <span class="mobile-card-label">Đơn giá:</span>
                                                <span class="mobile-card-value">35.000 ₫/tháng</span>
                                            </div>
                                            <div class="mobile-card-row">
                                                <span class="mobile-card-label">Ngày áp dụng:</span>
                                                <span class="mobile-card-value">01/01/2024</span>
                                            </div>
                                            <div class="mobile-card-row">
                                                <span class="mobile-card-label">Mô tả:</span>
                                                <span class="mobile-card-value">Thu gom rác sinh hoạt hàng ngày cho hộ gia đình</span>
                                            </div>
                                        </div>
                                        <div class="mobile-card-actions">
                                            <a href="#" class="mobile-card-action-btn view-service-detail">Xem</a>
                                            <a href="#" class="mobile-card-action-btn edit-service-detail">Sửa</a>
                                        </div>
                                    </div>

                                    <div class="mobile-card service-row" data-status="active">
                                        <div class="mobile-card-header">
                                            <div class="mobile-card-title">DV002 - Thu gom rác sinh hoạt 3 lần/tuần</div>
                                            <span class="mobile-card-status bg-green-100 text-green-800">Đang hoạt động</span>
                                        </div>
                                        <div class="mobile-card-content">
                                            <div class="mobile-card-row">
                                                <span class="mobile-card-label">Nhóm dịch vụ:</span>
                                                <span class="mobile-card-value">Thu gom rác sinh hoạt</span>
                                            </div>
                                            <div class="mobile-card-row">
                                                <span class="mobile-card-label">Đơn vị cơ sở:</span>
                                                <span class="mobile-card-value">ĐV Cơ sở A</span>
                                            </div>
                                            <div class="mobile-card-row">
                                                <span class="mobile-card-label">Đơn giá:</span>
                                                <span class="mobile-card-value">25.000 ₫/tháng</span>
                                            </div>
                                            <div class="mobile-card-row">
                                                <span class="mobile-card-label">Ngày áp dụng:</span>
                                                <span class="mobile-card-value">01/01/2024</span>
                                            </div>
                                            <div class="mobile-card-row">
                                                <span class="mobile-card-label">Mô tả:</span>
                                                <span class="mobile-card-value">Thu gom rác sinh hoạt 3 lần/tuần cho hộ gia đình</span>
                                            </div>
                                        </div>
                                        <div class="mobile-card-actions">
                                            <a href="#" class="mobile-card-action-btn view-service-detail">Xem</a>
                                            <a href="#" class="mobile-card-action-btn edit-service-detail">Sửa</a>
                                        </div>
                                    </div>

                                    <div class="mobile-card service-row" data-status="paused">
                                        <div class="mobile-card-header">
                                            <div class="mobile-card-title">DV005 - Thu gom rác nguy hại theo yêu cầu</div>
                                            <span class="mobile-card-status bg-yellow-100 text-yellow-800">Tạm dừng</span>
                                        </div>
                                        <div class="mobile-card-content">
                                            <div class="mobile-card-row">
                                                <span class="mobile-card-label">Nhóm dịch vụ:</span>
                                                <span class="mobile-card-value">Thu gom rác nguy hại</span>
                                            </div>
                                            <div class="mobile-card-row">
                                                <span class="mobile-card-label">Đơn vị cơ sở:</span>
                                                <span class="mobile-card-value">ĐV Cơ sở C</span>
                                            </div>
                                            <div class="mobile-card-row">
                                                <span class="mobile-card-label">Đơn giá:</span>
                                                <span class="mobile-card-value">500.000 ₫/lần</span>
                                            </div>
                                            <div class="mobile-card-row">
                                                <span class="mobile-card-label">Ngày áp dụng:</span>
                                                <span class="mobile-card-value">01/03/2024</span>
                                            </div>
                                            <div class="mobile-card-row">
                                                <span class="mobile-card-label">Mô tả:</span>
                                                <span class="mobile-card-value">Thu gom rác nguy hại theo yêu cầu</span>
                                            </div>
                                        </div>
                                        <div class="mobile-card-actions">
                                            <a href="#" class="mobile-card-action-btn view-service-detail">Xem</a>
                                            <a href="#" class="mobile-card-action-btn edit-service-detail">Sửa</a>
                                        </div>
                                    </div>
                                </div>

                                <!-- Phân trang -->
                                <div class="pagination-container">
                                    <div class="pagination-info">
                                        Hiển thị <span id="service-pagination-start">1</span> - <span id="service-pagination-end">5</span> của <span id="service-pagination-total">18</span> dịch vụ
                                    </div>
                                    <div class="pagination-controls">
                                        <button class="pagination-button" id="service-pagination-prev" disabled>
                                            <i class="fas fa-chevron-left"></i>
                                        </button>
                                        <button class="pagination-button active" data-page="1">1</button>
                                        <button class="pagination-button" data-page="2">2</button>
                                        <button class="pagination-button" data-page="3">3</button>
                                        <button class="pagination-button" data-page="4">4</button>
                                        <button class="pagination-button" id="service-pagination-next">
                                            <i class="fas fa-chevron-right"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div id="invoices-content" class="web-content-page hidden">
                             <div class="bg-white p-6 rounded-lg shadow-sm">
                                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-4">
                                    <div class="p-4 bg-gray-50 rounded-lg"><p class="text-sm text-gray-500">Tổng công nợ</p><p class="text-2xl font-bold text-red-600">345.000.000 ₫</p></div>
                                    <div class="p-4 bg-gray-50 rounded-lg"><p class="text-sm text-gray-500">Tổng doanh thu (tháng)</p><p class="text-2xl font-bold text-green-600">1.250.000.000 ₫</p></div>
                                    <div class="p-4 bg-gray-50 rounded-lg"><p class="text-sm text-gray-500">Thanh toán tiền mặt</p><p class="text-2xl font-bold text-gray-700">800.000.000 ₫</p></div>
                                    <div class="p-4 bg-gray-50 rounded-lg"><p class="text-sm text-gray-500">Thanh toán online</p><p class="text-2xl font-bold text-blue-600">450.000.000 ₫</p></div>
                                </div>
                                
                                <div class="flex border-b border-gray-200 mb-4">
                                    <button class="status-tab py-2 px-4 text-sm font-medium text-gray-600 active">Tất cả <span class="text-xs bg-gray-200 rounded-full px-1.5 py-0.5">1</span></button>
                                    <button class="status-tab status-warning py-2 px-4 text-sm font-medium">Chờ thanh toán <span class="text-xs bg-yellow-100 text-yellow-800 rounded-full px-1.5 py-0.5">1</span></button>
                                    <button class="status-tab status-success py-2 px-4 text-sm font-medium">Đã thanh toán <span class="text-xs bg-green-100 text-green-800 rounded-full px-1.5 py-0.5">0</span></button>
                                    <button class="status-tab status-danger py-2 px-4 text-sm font-medium">Quá hạn <span class="text-xs bg-red-100 text-red-800 rounded-full px-1.5 py-0.5">0</span></button>
                                </div>
                                <div class="overflow-x-auto table-responsive">
                                    <table class="w-full text-sm text-left text-gray-600" style="min-width: 1000px;">
                                        <thead class="text-xs text-gray-700 uppercase bg-gray-100">
                                            <tr>
                                                <th scope="col" class="px-6 py-3" style="min-width: 60px;">STT</th>
                                                <th scope="col" class="px-6 py-3" style="min-width: 120px;">Hành động</th>
                                                <th scope="col" class="px-6 py-3" style="min-width: 80px;">Mã KH</th>
                                                <th scope="col" class="px-6 py-3" style="min-width: 150px;">Khách hàng</th>
                                                <th scope="col" class="px-6 py-3 allow-wrap" style="min-width: 200px;">Công nợ các tháng</th>
                                                <th scope="col" class="px-6 py-3" style="min-width: 100px;">Tổng nợ</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr class="bg-white border-b hover:bg-gray-50">
                                                <td class="px-6 py-4">1</td>
                                                <td class="px-6 py-4"><div class="relative dropdown"><button class="font-medium text-blue-600">Thao tác <i class="fas fa-chevron-down text-xs"></i></button><div class="dropdown-menu absolute hidden bg-white shadow-lg rounded-md mt-2 z-10 w-48 border"><a href="#" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">Xác nhận thanh toán</a><a href="#" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">Xóa công nợ tháng</a><a href="#" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">Hoàn tác</a></div></div></td>
                                                <td class="px-6 py-4">KH002</td>
                                                <td class="px-6 py-4">Trần Thị Bích</td>
                                                <td class="px-6 py-4"><span class="status-tag bg-red-100 text-red-800 mr-1">T6/2025</span><span class="status-tag bg-yellow-100 text-yellow-800">T7/2025</span></td>
                                                <td class="px-6 py-4 font-semibold">70.000 ₫</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>

                        <div id="payment-tracking-content" class="web-content-page hidden">
                            <div class="bg-white p-6 rounded-lg shadow-sm">
                                <div class="flex justify-between items-center mb-6">
                                    <h2 class="text-xl font-bold text-gray-800">Theo dõi Thanh toán</h2>
                                    <div class="flex space-x-2">
                                        <button class="bg-white border border-gray-300 text-gray-700 px-4 py-2 rounded-md hover:bg-gray-50 flex items-center"><i class="fas fa-download mr-2"></i> Xuất báo cáo</button>
                                    </div>
                                </div>
                                
                                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
                                    <div class="p-4 bg-gray-50 rounded-lg">
                                        <p class="text-sm text-gray-500">Tổng công nợ khu vực</p>
                                        <p class="text-2xl font-bold text-red-600">125.000.000 ₫</p>
                                    </div>
                                    <div class="p-4 bg-gray-50 rounded-lg">
                                        <p class="text-sm text-gray-500">Đã thu tháng này</p>
                                        <p class="text-2xl font-bold text-green-600">85.000.000 ₫</p>
                                    </div>
                                    <div class="p-4 bg-gray-50 rounded-lg">
                                        <p class="text-sm text-gray-500">Tỷ lệ thu tiền</p>
                                        <p class="text-2xl font-bold text-blue-600">68%</p>
                                    </div>
                                </div>
                                
                                <div class="overflow-x-auto table-responsive">
                                    <table class="w-full text-sm text-left text-gray-600" style="min-width: 1000px;">
                                        <thead class="text-xs text-gray-700 uppercase bg-gray-100">
                                            <tr>
                                                <th scope="col" class="px-6 py-3" style="min-width: 60px;">STT</th>
                                                <th scope="col" class="px-6 py-3" style="min-width: 80px;">Mã KH</th>
                                                <th scope="col" class="px-6 py-3" style="min-width: 150px;">Khách hàng</th>
                                                <th scope="col" class="px-6 py-3" style="min-width: 120px;">ĐV Thu gom</th>
                                                <th scope="col" class="px-6 py-3" style="min-width: 100px;">Công nợ</th>
                                                <th scope="col" class="px-6 py-3" style="min-width: 100px;">Trạng thái</th>
                                                <th scope="col" class="px-6 py-3 allow-wrap" style="min-width: 150px;">Ghi chú</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr class="bg-white border-b hover:bg-gray-50">
                                                <td class="px-6 py-4">1</td>
                                                <td class="px-6 py-4 font-medium">KH001</td>
                                                <td class="px-6 py-4">Nguyễn Văn An</td>
                                                <td class="px-6 py-4">ĐV Thu gom A</td>
                                                <td class="px-6 py-4 font-semibold">35.000 ₫</td>
                                                <td class="px-6 py-4"><span class="status-tag bg-yellow-100 text-yellow-800">Chờ thu</span></td>
                                                <td class="px-6 py-4 text-sm text-gray-500">Đã nhắc nhở</td>
                                            </tr>
                                            <tr class="bg-white border-b hover:bg-gray-50">
                                                <td class="px-6 py-4">2</td>
                                                <td class="px-6 py-4 font-medium">KH003</td>
                                                <td class="px-6 py-4">Công ty TNHH ABC</td>
                                                <td class="px-6 py-4">ĐV Thu gom B</td>
                                                <td class="px-6 py-4 font-semibold">105.000 ₫</td>
                                                <td class="px-6 py-4"><span class="status-tag bg-red-100 text-red-800">Quá hạn</span></td>
                                                <td class="px-6 py-4 text-sm text-gray-500">Cần xử lý</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                                
                                <!-- Mobile Card View for Payment Tracking -->
                                <div class="mobile-card-view">
                                    <div class="mobile-card">
                                        <div class="mobile-card-header">
                                            <div class="mobile-card-title">Nguyễn Văn An</div>
                                            <span class="mobile-card-status bg-yellow-100 text-yellow-800">Chờ thu</span>
                                        </div>
                                        <div class="mobile-card-content">
                                            <div class="mobile-card-row">
                                                <span class="mobile-card-label">Mã KH:</span>
                                                <span class="mobile-card-value">KH001</span>
                                            </div>
                                            <div class="mobile-card-row">
                                                <span class="mobile-card-label">ĐV Thu gom:</span>
                                                <span class="mobile-card-value">ĐV Thu gom A</span>
                                            </div>
                                            <div class="mobile-card-row">
                                                <span class="mobile-card-label">Công nợ:</span>
                                                <span class="mobile-card-value font-semibold">35.000 ₫</span>
                                            </div>
                                            <div class="mobile-card-row">
                                                <span class="mobile-card-label">Ghi chú:</span>
                                                <span class="mobile-card-value text-sm text-gray-500">Đã nhắc nhở</span>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="mobile-card">
                                        <div class="mobile-card-header">
                                            <div class="mobile-card-title">Công ty TNHH ABC</div>
                                            <span class="mobile-card-status bg-red-100 text-red-800">Quá hạn</span>
                                        </div>
                                        <div class="mobile-card-content">
                                            <div class="mobile-card-row">
                                                <span class="mobile-card-label">Mã KH:</span>
                                                <span class="mobile-card-value">KH003</span>
                                            </div>
                                            <div class="mobile-card-row">
                                                <span class="mobile-card-label">ĐV Thu gom:</span>
                                                <span class="mobile-card-value">ĐV Thu gom B</span>
                                            </div>
                                            <div class="mobile-card-row">
                                                <span class="mobile-card-label">Công nợ:</span>
                                                <span class="mobile-card-value font-semibold">105.000 ₫</span>
                                            </div>
                                            <div class="mobile-card-row">
                                                <span class="mobile-card-label">Ghi chú:</span>
                                                <span class="mobile-card-value text-sm text-gray-500">Cần xử lý</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div id="payment-collection-content" class="web-content-page hidden">
                            <div class="bg-white p-6 rounded-lg shadow-sm">
                                <div class="flex justify-between items-center mb-6">
                                    <h2 class="text-xl font-bold text-gray-800">Thu Tiền</h2>
                                    <div class="flex space-x-2">
                                        <button class="bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700 flex items-center"><i class="fas fa-plus mr-2"></i>Thu tiền mới</button>
                                        <button class="bg-white border border-gray-300 text-gray-700 px-4 py-2 rounded-md hover:bg-gray-50 flex items-center"><i class="fas fa-download mr-2"></i> Xuất báo cáo</button>
                                    </div>
                                </div>
                                
                                <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
                                    <div class="p-4 bg-gray-50 rounded-lg">
                                        <p class="text-sm text-gray-500">Tổng cần thu</p>
                                        <p class="text-2xl font-bold text-red-600">245.000 ₫</p>
                                    </div>
                                    <div class="p-4 bg-gray-50 rounded-lg">
                                        <p class="text-sm text-gray-500">Đã thu hôm nay</p>
                                        <p class="text-2xl font-bold text-green-600">180.000 ₫</p>
                                    </div>
                                    <div class="p-4 bg-gray-50 rounded-lg">
                                        <p class="text-sm text-gray-500">Tiền mặt</p>
                                        <p class="text-2xl font-bold text-gray-700">120.000 ₫</p>
                                    </div>
                                    <div class="p-4 bg-gray-50 rounded-lg">
                                        <p class="text-sm text-gray-500">Online</p>
                                        <p class="text-2xl font-bold text-blue-600">60.000 ₫</p>
                                    </div>
                                </div>
                                
                                <div class="overflow-x-auto table-responsive">
                                    <table class="w-full text-sm text-left text-gray-600" style="min-width: 1200px;">
                                        <thead class="text-xs text-gray-700 uppercase bg-gray-100">
                                            <tr>
                                                <th scope="col" class="px-6 py-3" style="min-width: 60px;">STT</th>
                                                <th scope="col" class="px-6 py-3" style="min-width: 120px;">Hành động</th>
                                                <th scope="col" class="px-6 py-3" style="min-width: 80px;">Mã KH</th>
                                                <th scope="col" class="px-6 py-3" style="min-width: 150px;">Khách hàng</th>
                                                <th scope="col" class="px-6 py-3 allow-wrap" style="min-width: 250px;">Địa chỉ</th>
                                                <th scope="col" class="px-6 py-3" style="min-width: 100px;">Số tiền</th>
                                                <th scope="col" class="px-6 py-3" style="min-width: 120px;">Phương thức</th>
                                                <th scope="col" class="px-6 py-3" style="min-width: 100px;">Trạng thái</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr class="bg-white border-b hover:bg-gray-50">
                                                <td class="px-6 py-4">1</td>
                                                <td class="px-6 py-4">
                                                    <button class="collect-payment bg-blue-600 text-white px-3 py-1 rounded text-sm hover:bg-blue-700">Thu tiền</button>
                                                </td>
                                                <td class="px-6 py-4 font-medium">KH001</td>
                                                <td class="px-6 py-4">Nguyễn Văn An</td>
                                                <td class="px-6 py-4">123 Lê Lợi, P. Bến Nghé, TP. Hồ Chí Minh</td>
                                                <td class="px-6 py-4 font-semibold">35.000 ₫</td>
                                                <td class="px-6 py-4">
                                                    <div class="flex space-x-1">
                                                        <span class="payment-method bg-green-100 text-green-800 px-2 py-1 rounded text-xs">Tiền mặt</span>
                                                        <span class="payment-method bg-blue-100 text-blue-800 px-2 py-1 rounded text-xs">Momo</span>
                                                        <span class="payment-method bg-orange-100 text-orange-800 px-2 py-1 rounded text-xs">Payoo</span>
                                                    </div>
                                                </td>
                                                <td class="px-6 py-4"><span class="status-tag bg-yellow-100 text-yellow-800">Chờ thu</span></td>
                                            </tr>
                                            <tr class="bg-white border-b hover:bg-gray-50">
                                                <td class="px-6 py-4">2</td>
                                                <td class="px-6 py-4">
                                                    <button class="collect-payment bg-blue-600 text-white px-3 py-1 rounded text-sm hover:bg-blue-700">Thu tiền</button>
                                                </td>
                                                <td class="px-6 py-4 font-medium">KH003</td>
                                                <td class="px-6 py-4">Công ty TNHH ABC</td>
                                                <td class="px-6 py-4">789 Hai Bà Trưng, P. Đa Kao, TP. Hồ Chí Minh</td>
                                                <td class="px-6 py-4 font-semibold">105.000 ₫</td>
                                                <td class="px-6 py-4">
                                                    <div class="flex space-x-1">
                                                        <span class="payment-method bg-green-100 text-green-800 px-2 py-1 rounded text-xs">Tiền mặt</span>
                                                        <span class="payment-method bg-blue-100 text-blue-800 px-2 py-1 rounded text-xs">Momo</span>
                                                        <span class="payment-method bg-orange-100 text-orange-800 px-2 py-1 rounded text-xs">Payoo</span>
                                                    </div>
                                                </td>
                                                <td class="px-6 py-4"><span class="status-tag bg-red-100 text-red-800">Quá hạn</span></td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                                
                                <!-- Mobile Card View for Payment Collection -->
                                <div class="mobile-card-view">
                                    <div class="mobile-card">
                                        <div class="mobile-card-header">
                                            <div class="mobile-card-title">Nguyễn Văn An</div>
                                            <span class="mobile-card-status bg-yellow-100 text-yellow-800">Chờ thu</span>
                                        </div>
                                        <div class="mobile-card-content">
                                            <div class="mobile-card-row">
                                                <span class="mobile-card-label">Mã KH:</span>
                                                <span class="mobile-card-value">KH001</span>
                                            </div>
                                            <div class="mobile-card-row">
                                                <span class="mobile-card-label">Số tiền:</span>
                                                <span class="mobile-card-value font-semibold">35.000 ₫</span>
                                            </div>
                                            <div class="mobile-card-row">
                                                <span class="mobile-card-label">Địa chỉ:</span>
                                                <span class="mobile-card-value">123 Lê Lợi, P. Bến Nghé, TP. Hồ Chí Minh</span>
                                            </div>
                                            <div class="mobile-card-row">
                                                <span class="mobile-card-label">Phương thức:</span>
                                                <span class="mobile-card-value">
                                                    <div class="flex space-x-1 mt-1">
                                                        <span class="payment-method bg-green-100 text-green-800 px-2 py-1 rounded text-xs">Tiền mặt</span>
                                                        <span class="payment-method bg-blue-100 text-blue-800 px-2 py-1 rounded text-xs">Momo</span>
                                                        <span class="payment-method bg-orange-100 text-orange-800 px-2 py-1 rounded text-xs">Payoo</span>
                                                    </div>
                                                </span>
                                            </div>
                                        </div>
                                        <div class="mobile-card-actions">
                                            <button class="collect-payment bg-blue-600 text-white px-4 py-2 rounded text-sm hover:bg-blue-700 w-full">Thu tiền</button>
                                        </div>
                                    </div>
                                    
                                    <div class="mobile-card">
                                        <div class="mobile-card-header">
                                            <div class="mobile-card-title">Công ty TNHH ABC</div>
                                            <span class="mobile-card-status bg-red-100 text-red-800">Quá hạn</span>
                                        </div>
                                        <div class="mobile-card-content">
                                            <div class="mobile-card-row">
                                                <span class="mobile-card-label">Mã KH:</span>
                                                <span class="mobile-card-value">KH003</span>
                                            </div>
                                            <div class="mobile-card-row">
                                                <span class="mobile-card-label">Số tiền:</span>
                                                <span class="mobile-card-value font-semibold">105.000 ₫</span>
                                            </div>
                                            <div class="mobile-card-row">
                                                <span class="mobile-card-label">Địa chỉ:</span>
                                                <span class="mobile-card-value">789 Hai Bà Trưng, P. Đa Kao, TP. Hồ Chí Minh</span>
                                            </div>
                                            <div class="mobile-card-row">
                                                <span class="mobile-card-label">Phương thức:</span>
                                                <span class="mobile-card-value">
                                                    <div class="flex space-x-1 mt-1">
                                                        <span class="payment-method bg-green-100 text-green-800 px-2 py-1 rounded text-xs">Tiền mặt</span>
                                                        <span class="payment-method bg-blue-100 text-blue-800 px-2 py-1 rounded text-xs">Momo</span>
                                                        <span class="payment-method bg-orange-100 text-orange-800 px-2 py-1 rounded text-xs">Payoo</span>
                                                    </div>
                                                </span>
                                            </div>
                                        </div>
                                        <div class="mobile-card-actions">
                                            <button class="collect-payment bg-blue-600 text-white px-4 py-2 rounded text-sm hover:bg-blue-700 w-full">Thu tiền</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Address Categories Management -->
                        <div id="address-categories-content" class="web-content-page hidden">
                            <div class="bg-white p-6 rounded-lg shadow-sm">
                                <div class="flex justify-between items-center mb-6">
                                    <h2 class="text-xl font-bold text-gray-800">Quản lý Danh mục Địa chỉ</h2>
                                    <div class="flex space-x-2">
                                        <button id="add-province-btn" class="bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700 flex items-center">
                                            <i class="fas fa-plus mr-2"></i>Thêm Tỉnh/TP
                                        </button>
                                        <button id="add-ward-btn" class="bg-purple-600 text-white px-4 py-2 rounded-md hover:bg-purple-700 flex items-center">
                                            <i class="fas fa-plus mr-2"></i>Thêm Phường/Xã
                                        </button>
                                        <button id="add-village-btn" class="bg-orange-600 text-white px-4 py-2 rounded-md hover:bg-orange-700 flex items-center">
                                            <i class="fas fa-plus mr-2"></i>Thêm Thôn/Ấp/KP
                                        </button>
                                    </div>
                                </div>

                                <!-- Address Structure Overview -->
                                <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-8">
                                    <div class="bg-gradient-to-r from-blue-500 to-blue-600 p-6 rounded-lg text-white">
                                        <div class="flex items-center justify-between">
                                            <div>
                                                <h3 class="text-lg font-semibold">Tỉnh/Thành phố</h3>
                                                <p class="text-3xl font-bold">63</p>
                                                <p class="text-blue-100 text-sm">Tỉnh thành</p>
                                            </div>
                                            <i class="fas fa-map text-4xl opacity-50"></i>
                                        </div>
                                    </div>
                                    <div class="bg-gradient-to-r from-purple-500 to-purple-600 p-6 rounded-lg text-white">
                                        <div class="flex items-center justify-between">
                                            <div>
                                                <h3 class="text-lg font-semibold">Phường/Xã</h3>
                                                <p class="text-3xl font-bold">10,599</p>
                                                <p class="text-purple-100 text-sm">Phường xã</p>
                                            </div>
                                            <i class="fas fa-map-pin text-4xl opacity-50"></i>
                                        </div>
                                    </div>
                                    <div class="bg-gradient-to-r from-orange-500 to-orange-600 p-6 rounded-lg text-white">
                                        <div class="flex items-center justify-between">
                                            <div>
                                                <h3 class="text-lg font-semibold">Thôn/Ấp/KP</h3>
                                                <p class="text-3xl font-bold">1,250</p>
                                                <p class="text-orange-100 text-sm">Thôn ấp</p>
                                            </div>
                                            <i class="fas fa-home text-4xl opacity-50"></i>
                                        </div>
                                    </div>
                                </div>

                                <!-- Address Categories Tabs -->
                                <div class="mb-6">
                                    <div class="border-b border-gray-200">
                                        <nav class="-mb-px flex space-x-8">
                                            <button class="address-tab active py-2 px-1 border-b-2 border-blue-500 text-blue-600 font-medium text-sm" data-tab="provinces">
                                                <i class="fas fa-map mr-2"></i>Tỉnh/Thành phố
                                            </button>
                                            <button class="address-tab py-2 px-1 border-b-2 border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 font-medium text-sm" data-tab="wards">
                                                <i class="fas fa-map-pin mr-2"></i>Phường/Xã
                                            </button>
                                            <button class="address-tab py-2 px-1 border-b-2 border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 font-medium text-sm" data-tab="villages">
                                                <i class="fas fa-home mr-2"></i>Thôn/Ấp/Khu phố
                                            </button>
                                            <button class="address-tab py-2 px-1 border-b-2 border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 font-medium text-sm" data-tab="projects">
                                                <i class="fas fa-building mr-2"></i>Dự án/Toà nhà
                                            </button>
                                        </nav>
                                    </div>
                                </div>

                                <!-- Tab Content -->
                                <div id="provinces-tab" class="address-tab-content">
                                    <div class="bg-white border rounded-lg">
                                        <div class="p-4 border-b bg-gray-50">
                                            <div class="flex justify-between items-center">
                                                <h3 class="text-lg font-semibold text-gray-800">Danh sách Tỉnh/Thành phố</h3>
                                                <div class="flex space-x-2">
                                                    <input type="text" placeholder="Tìm kiếm tỉnh/thành phố..." class="px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                                    <button class="bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700">Tìm kiếm</button>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="overflow-x-auto">
                                            <table class="w-full text-sm text-left text-gray-600">
                                                <thead class="text-xs text-gray-700 uppercase bg-gray-100">
                                                    <tr>
                                                        <th scope="col" class="px-6 py-3">Mã</th>
                                                        <th scope="col" class="px-6 py-3">Tên Tỉnh/Thành phố</th>
                                                        <th scope="col" class="px-6 py-3">Loại</th>
                                                        <th scope="col" class="px-6 py-3">Vùng miền</th>
                                                        <th scope="col" class="px-6 py-3">Số Phường/Xã</th>
                                                        <th scope="col" class="px-6 py-3">Trạng thái</th>
                                                        <th scope="col" class="px-6 py-3">Hành động</th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    <tr class="bg-white border-b hover:bg-gray-50">
                                                        <td class="px-6 py-4 font-medium text-gray-900">01</td>
                                                        <td class="px-6 py-4">Hà Nội</td>
                                                        <td class="px-6 py-4"><span class="status-tag bg-blue-100 text-blue-800">Thành phố</span></td>
                                                        <td class="px-6 py-4">Đồng bằng sông Hồng</td>
                                                        <td class="px-6 py-4">584</td>
                                                        <td class="px-6 py-4"><span class="status-tag bg-green-100 text-green-800">Hoạt động</span></td>
                                                        <td class="px-6 py-4">
                                                            <button class="text-blue-600 hover:text-blue-900 mr-3">Sửa</button>
                                                            <button class="text-red-600 hover:text-red-900">Xóa</button>
                                                        </td>
                                                    </tr>
                                                    <tr class="bg-white border-b hover:bg-gray-50">
                                                        <td class="px-6 py-4 font-medium text-gray-900">79</td>
                                                        <td class="px-6 py-4">TP. Hồ Chí Minh</td>
                                                        <td class="px-6 py-4"><span class="status-tag bg-blue-100 text-blue-800">Thành phố</span></td>
                                                        <td class="px-6 py-4">Đông Nam Bộ</td>
                                                        <td class="px-6 py-4">312</td>
                                                        <td class="px-6 py-4"><span class="status-tag bg-green-100 text-green-800">Hoạt động</span></td>
                                                        <td class="px-6 py-4">
                                                            <button class="text-blue-600 hover:text-blue-900 mr-3">Sửa</button>
                                                            <button class="text-red-600 hover:text-red-900">Xóa</button>
                                                        </td>
                                                    </tr>
                                                    <tr class="bg-white border-b hover:bg-gray-50">
                                                        <td class="px-6 py-4 font-medium text-gray-900">48</td>
                                                        <td class="px-6 py-4">Đà Nẵng</td>
                                                        <td class="px-6 py-4"><span class="status-tag bg-blue-100 text-blue-800">Thành phố</span></td>
                                                        <td class="px-6 py-4">Duyên hải Nam Trung Bộ</td>
                                                        <td class="px-6 py-4">56</td>
                                                        <td class="px-6 py-4"><span class="status-tag bg-green-100 text-green-800">Hoạt động</span></td>
                                                        <td class="px-6 py-4">
                                                            <button class="text-blue-600 hover:text-blue-900 mr-3">Sửa</button>
                                                            <button class="text-red-600 hover:text-red-900">Xóa</button>
                                                        </td>
                                                    </tr>
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>



                                <div id="wards-tab" class="address-tab-content hidden">
                                    <div class="bg-white border rounded-lg">
                                        <div class="p-4 border-b bg-gray-50">
                                            <div class="flex justify-between items-center">
                                                <h3 class="text-lg font-semibold text-gray-800">Danh sách Phường/Xã</h3>
                                                <div class="flex space-x-2">
                                                    <select class="px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                                        <option>Tất cả Tỉnh/Thành phố</option>
                                                        <option>TP. Hồ Chí Minh</option>
                                                        <option>Hà Nội</option>
                                                        <option>Đà Nẵng</option>
                                                    </select>
                                                    <input type="text" placeholder="Tìm kiếm phường/xã..." class="px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                                    <button class="bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700">Tìm kiếm</button>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="overflow-x-auto">
                                            <table class="w-full text-sm text-left text-gray-600">
                                                <thead class="text-xs text-gray-700 uppercase bg-gray-100">
                                                    <tr>
                                                        <th scope="col" class="px-6 py-3">Mã</th>
                                                        <th scope="col" class="px-6 py-3">Tên Phường/Xã</th>
                                                        <th scope="col" class="px-6 py-3">Tỉnh/Thành phố</th>
                                                        <th scope="col" class="px-6 py-3">Loại</th>
                                                        <th scope="col" class="px-6 py-3">Số Thôn/Ấp/KP</th>
                                                        <th scope="col" class="px-6 py-3">Trạng thái</th>
                                                        <th scope="col" class="px-6 py-3">Hành động</th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    <tr class="bg-white border-b hover:bg-gray-50">
                                                        <td class="px-6 py-4 font-medium text-gray-900">26734</td>
                                                        <td class="px-6 py-4">Phường Bến Nghé</td>
                                                        <td class="px-6 py-4">TP. Hồ Chí Minh</td>
                                                        <td class="px-6 py-4"><span class="status-tag bg-orange-100 text-orange-800">Phường</span></td>
                                                        <td class="px-6 py-4">5</td>
                                                        <td class="px-6 py-4"><span class="status-tag bg-green-100 text-green-800">Hoạt động</span></td>
                                                        <td class="px-6 py-4">
                                                            <button class="text-blue-600 hover:text-blue-900 mr-3">Sửa</button>
                                                            <button class="text-red-600 hover:text-red-900">Xóa</button>
                                                        </td>
                                                    </tr>
                                                    <tr class="bg-white border-b hover:bg-gray-50">
                                                        <td class="px-6 py-4 font-medium text-gray-900">26737</td>
                                                        <td class="px-6 py-4">Phường Đa Kao</td>
                                                        <td class="px-6 py-4">TP. Hồ Chí Minh</td>
                                                        <td class="px-6 py-4"><span class="status-tag bg-orange-100 text-orange-800">Phường</span></td>
                                                        <td class="px-6 py-4">3</td>
                                                        <td class="px-6 py-4"><span class="status-tag bg-green-100 text-green-800">Hoạt động</span></td>
                                                        <td class="px-6 py-4">
                                                            <button class="text-blue-600 hover:text-blue-900 mr-3">Sửa</button>
                                                            <button class="text-red-600 hover:text-red-900">Xóa</button>
                                                        </td>
                                                    </tr>
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>

                                <div id="villages-tab" class="address-tab-content hidden">
                                    <div class="bg-white border rounded-lg">
                                        <div class="p-4 border-b bg-gray-50">
                                            <div class="flex justify-between items-center">
                                                <h3 class="text-lg font-semibold text-gray-800">Danh sách Thôn/Ấp/Khu phố</h3>
                                                <div class="flex space-x-2">
                                                    <select class="px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                                        <option>Tất cả Phường/Xã</option>
                                                        <option>Phường Bến Nghé</option>
                                                        <option>Phường Đa Kao</option>
                                                    </select>
                                                    <input type="text" placeholder="Tìm kiếm thôn/ấp/khu phố..." class="px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                                    <button class="bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700">Tìm kiếm</button>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="overflow-x-auto">
                                            <table class="w-full text-sm text-left text-gray-600">
                                                <thead class="text-xs text-gray-700 uppercase bg-gray-100">
                                                    <tr>
                                                        <th scope="col" class="px-6 py-3">Mã</th>
                                                        <th scope="col" class="px-6 py-3">Tên Thôn/Ấp/Khu phố</th>
                                                        <th scope="col" class="px-6 py-3">Phường/Xã</th>
                                                        <th scope="col" class="px-6 py-3">Tỉnh/Thành phố</th>
                                                        <th scope="col" class="px-6 py-3">Loại</th>
                                                        <th scope="col" class="px-6 py-3">Trạng thái</th>
                                                        <th scope="col" class="px-6 py-3">Hành động</th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    <tr class="bg-white border-b hover:bg-gray-50">
                                                        <td class="px-6 py-4 font-medium text-gray-900">001</td>
                                                        <td class="px-6 py-4">Khu phố 1</td>
                                                        <td class="px-6 py-4">Phường Bến Nghé</td>
                                                        <td class="px-6 py-4">TP. Hồ Chí Minh</td>
                                                        <td class="px-6 py-4"><span class="status-tag bg-indigo-100 text-indigo-800">Khu phố</span></td>
                                                        <td class="px-6 py-4"><span class="status-tag bg-green-100 text-green-800">Hoạt động</span></td>
                                                        <td class="px-6 py-4">
                                                            <button class="text-blue-600 hover:text-blue-900 mr-3">Sửa</button>
                                                            <button class="text-red-600 hover:text-red-900">Xóa</button>
                                                        </td>
                                                    </tr>
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>

                                <div id="projects-tab" class="address-tab-content hidden">
                                    <div class="bg-white border rounded-lg">
                                        <div class="p-4 border-b bg-gray-50">
                                            <div class="flex justify-between items-center">
                                                <h3 class="text-lg font-semibold text-gray-800">Danh sách Dự án/Toà nhà</h3>
                                                <div class="flex space-x-2">
                                                    <select class="px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                                        <option>Tất cả Khu vực</option>
                                                        <option>Khu phố 1</option>
                                                    </select>
                                                    <input type="text" placeholder="Tìm kiếm dự án/toà nhà..." class="px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                                    <button class="bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700">Tìm kiếm</button>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="overflow-x-auto">
                                            <table class="w-full text-sm text-left text-gray-600">
                                                <thead class="text-xs text-gray-700 uppercase bg-gray-100">
                                                    <tr>
                                                        <th scope="col" class="px-6 py-3">Mã</th>
                                                        <th scope="col" class="px-6 py-3">Tên Dự án/Toà nhà</th>
                                                        <th scope="col" class="px-6 py-3">Địa chỉ</th>
                                                        <th scope="col" class="px-6 py-3">Loại</th>
                                                        <th scope="col" class="px-6 py-3">Số căn hộ</th>
                                                        <th scope="col" class="px-6 py-3">Trạng thái</th>
                                                        <th scope="col" class="px-6 py-3">Hành động</th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    <tr class="px-6 py-4 bg-white border-b hover:bg-gray-50">
                                                        <td class="px-6 py-4 font-medium text-gray-900">PJ001</td>
                                                        <td class="px-6 py-4">Chung cư Landmark 81</td>
                                                        <td class="px-6 py-4">Khu phố 1, P. Bến Nghé, Q.1, TP.HCM</td>
                                                        <td class="px-6 py-4"><span class="status-tag bg-pink-100 text-pink-800">Chung cư</span></td>
                                                        <td class="px-6 py-4">1,200</td>
                                                        <td class="px-6 py-4"><span class="status-tag bg-green-100 text-green-800">Hoạt động</span></td>
                                                        <td class="px-6 py-4">
                                                            <button class="text-blue-600 hover:text-blue-900 mr-3">Sửa</button>
                                                            <button class="text-red-600 hover:text-red-900">Xóa</button>
                                                        </td>
                                                    </tr>
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div id="page-placeholder" class="web-content-page hidden">
                            <div class="bg-white p-10 rounded-lg shadow text-center">
                                <h2 class="text-2xl font-bold text-gray-700">Chức năng đang được phát triển</h2>
                                <p class="text-gray-500 mt-2">Nội dung cho trang này sẽ được cập nhật sớm.</p>
                                
                                <!-- Test table for horizontal scroll -->
                                <div class="mt-8">
                                    <h3 class="text-lg font-semibold mb-4">Test Bảng Scroll Ngang</h3>
                                    <div class="overflow-x-auto table-responsive">
                                        <table class="w-full text-sm text-left text-gray-600" style="min-width: 2000px;">
                                            <thead class="text-xs text-gray-700 uppercase bg-gray-100">
                                                <tr>
                                                    <th scope="col" class="px-6 py-3" style="min-width: 100px;">Cột 1</th>
                                                    <th scope="col" class="px-6 py-3" style="min-width: 150px;">Cột 2</th>
                                                    <th scope="col" class="px-6 py-3" style="min-width: 200px;">Cột 3</th>
                                                    <th scope="col" class="px-6 py-3" style="min-width: 180px;">Cột 4</th>
                                                    <th scope="col" class="px-6 py-3" style="min-width: 160px;">Cột 5</th>
                                                    <th scope="col" class="px-6 py-3" style="min-width: 140px;">Cột 6</th>
                                                    <th scope="col" class="px-6 py-3" style="min-width: 120px;">Cột 7</th>
                                                    <th scope="col" class="px-6 py-3" style="min-width: 100px;">Cột 8</th>
                                                    <th scope="col" class="px-6 py-3" style="min-width: 150px;">Cột 9</th>
                                                    <th scope="col" class="px-6 py-3" style="min-width: 200px;">Cột 10</th>
                                                    <th scope="col" class="px-6 py-3" style="min-width: 180px;">Cột 11</th>
                                                    <th scope="col" class="px-6 py-3" style="min-width: 160px;">Cột 12</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <tr class="bg-white border-b hover:bg-gray-50">
                                                    <td class="px-6 py-4">Dữ liệu 1</td>
                                                    <td class="px-6 py-4">Dữ liệu 2</td>
                                                    <td class="px-6 py-4">Dữ liệu 3</td>
                                                    <td class="px-6 py-4">Dữ liệu 4</td>
                                                    <td class="px-6 py-4">Dữ liệu 5</td>
                                                    <td class="px-6 py-4">Dữ liệu 6</td>
                                                    <td class="px-6 py-4">Dữ liệu 7</td>
                                                    <td class="px-6 py-4">Dữ liệu 8</td>
                                                    <td class="px-6 py-4">Dữ liệu 9</td>
                                                    <td class="px-6 py-4">Dữ liệu 10</td>
                                                    <td class="px-6 py-4">Dữ liệu 11</td>
                                                    <td class="px-6 py-4">Dữ liệu 12</td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </main>
                </div>
            </div>
        </div>
        </div>

    <!-- Mobile Menu -->
    <div id="mobile-menu" class="mobile-menu">
        <div class="mobile-menu-header">
            <div class="mobile-menu-title">GRAC SYSTEM</div>
            <div class="mobile-menu-subtitle" id="mobile-role-name">GRAC Admin</div>
        </div>
        <div class="mobile-menu-content">
            <!-- GRAC Admin Menu -->
            <div id="mobile-menu-grac-admin" class="mobile-menu-role">
                <a href="#" class="mobile-menu-item active" data-target="dashboard-grac-admin">Dashboard</a>
                                <a href="#" class="mobile-menu-item" data-target="customers-content">Khách hàng</a>
                <a href="#" class="mobile-menu-item" data-target="employees-content">Nhân viên</a>
                <a href="#" class="mobile-menu-item" data-target="contracts-content">Hợp đồng</a>
                <a href="#" class="mobile-menu-item" data-target="invoices-content">Công nợ & Thanh toán</a>
                <a href="#" class="mobile-menu-item" data-target="page-placeholder">Quản lý ĐV Thu gom</a>
                <a href="#" class="mobile-menu-item" data-target="services-content">Dịch vụ</a>
                <a href="#" class="mobile-menu-item" data-target="address-categories-content">Quản lý danh mục địa chỉ</a>
                <a href="#" class="mobile-menu-item" data-target="page-placeholder">Thống kê & Báo cáo</a>
            </div>
            
            <!-- Đơn vị quản lý Menu -->
            <div id="mobile-menu-dv-quanly" class="mobile-menu-role hidden">
                <a href="#" class="mobile-menu-item" data-target="dashboard-dv-quanly">Dashboard</a>
                <a href="#" class="mobile-menu-item" data-target="page-placeholder">Quản lý ĐV Cơ sở</a>
                <a href="#" class="mobile-menu-item" data-target="page-placeholder">Quản lý ĐV Thu gom</a>
                <a href="#" class="mobile-menu-item" data-target="employees-content">Nhân viên</a>
                <a href="#" class="mobile-menu-item" data-target="customers-content">Khách hàng</a>
                <a href="#" class="mobile-menu-item" data-target="page-placeholder">Kế hoạch thu gom</a>
                <a href="#" class="mobile-menu-item" data-target="page-placeholder">Theo dõi hiệu suất</a>
                <a href="#" class="mobile-menu-item" data-target="page-placeholder">Thống kê thu gom</a>
                <a href="#" class="mobile-menu-item" data-target="page-placeholder">Hệ thống phản hồi</a>
                <a href="#" class="mobile-menu-item" data-target="invoices-content">Quản lý hóa đơn</a>
            </div>
            
            <!-- Đơn vị cơ sở Menu -->
            <div id="mobile-menu-dv-coso" class="mobile-menu-role hidden">
                <a href="#" class="mobile-menu-item" data-target="dashboard-dv-coso">Dashboard</a>
                <a href="#" class="mobile-menu-item" data-target="page-placeholder">Quản lý tuyến thu gom</a>
                <a href="#" class="mobile-menu-item" data-target="page-placeholder">Quản lý phương tiện</a>
                <a href="#" class="mobile-menu-item" data-target="employees-content">Nhân viên</a>
                <a href="#" class="mobile-menu-item" data-target="page-placeholder">Lịch trình thu gom</a>
                <a href="#" class="mobile-menu-item" data-target="customers-content">Khách hàng</a>
                <a href="#" class="mobile-menu-item" data-target="payment-tracking-content">Theo dõi thanh toán</a>
                <a href="#" class="mobile-menu-item" data-target="page-placeholder">Báo cáo sự cố</a>
            </div>
            
            <!-- Đơn vị thu gom Menu -->
            <div id="mobile-menu-dv-thugom" class="mobile-menu-role hidden">
                <a href="#" class="mobile-menu-item" data-target="dashboard-dv-thugom">Dashboard</a>
                <a href="#" class="mobile-menu-item" data-target="page-placeholder">Lịch làm việc / Tuyến</a>
                <a href="#" class="mobile-menu-item" data-target="page-placeholder">Giao việc / Điều phối</a>
                <a href="#" class="mobile-menu-item" data-target="page-placeholder">Lịch sử thu gom</a>
                <a href="#" class="mobile-menu-item" data-target="page-placeholder">Phản hồi từ người dân</a>
                <a href="#" class="mobile-menu-item" data-target="customers-content">Khách hàng</a>
                <a href="#" class="mobile-menu-item" data-target="payment-collection-content">Thu tiền</a>
                <a href="#" class="mobile-menu-item" data-target="page-placeholder">Tình trạng phương tiện</a>
            </div>
        </div>
    </div>

    <!-- Mobile Overlay -->
    <div id="mobile-overlay" class="mobile-overlay"></div>

    <div id="customer-modal" class="fixed inset-0 bg-black bg-opacity-60 flex justify-center items-center hidden z-50">
        <div class="bg-white rounded-lg p-8 w-full max-w-3xl">
            <h2 class="text-xl font-bold mb-6 text-gray-800">Thêm mới Khách hàng</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div><label class="block text-sm font-medium text-gray-700">Mã khách hàng</label><input type="text" placeholder="Hệ thống tự sinh" disabled class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm bg-gray-100"></div>
                <div><label class="block text-sm font-medium text-gray-700">Tên khách hàng</label><input type="text" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500"></div>
                <div><label class="block text-sm font-medium text-gray-700">Loại khách hàng</label><select class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500"><option>Cá nhân</option><option>Tổ chức</option></select></div>
                <div><label class="block text-sm font-medium text-gray-700">Số điện thoại</label><input type="text" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500"></div>
                <div class="col-span-2"><label class="block text-sm font-medium text-gray-700">Địa chỉ thu gom</label><input type="text" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500"></div>
                <div><label class="block text-sm font-medium text-gray-700">Đơn vị quản lý</label><select class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500"><option>Sở TNMT TP.HCM</option></select></div>
                <div><label class="block text-sm font-medium text-gray-700">Đơn vị cơ sở</label><select class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500"><option>UBND Phường Bến Nghé</option></select></div>
                <div><label class="block text-sm font-medium text-gray-700">Đơn vị thu gom</label><select class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500"><option>ĐV Thu gom A</option></select></div>
                <div><label class="block text-sm font-medium text-gray-700">Trạng thái</label><select class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500"><option>Hoạt động</option><option>Tạm khoá</option></select></div>
                <div class="col-span-2"><label class="block text-sm font-medium text-gray-700">Ghi chú</label><textarea rows="3" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500"></textarea></div>
            </div>
            <div class="mt-8 flex justify-end space-x-3">
                <button id="close-customer-modal" class="bg-gray-200 text-gray-700 px-4 py-2 rounded-md hover:bg-gray-300">Hủy</button>
                <button class="bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700">Lưu thông tin</button>
            </div>
        </div>
    </div>

    <!-- Service Pricing Management Modal -->
    <div id="pricing-modal" class="fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full hidden z-50">
        <div class="relative top-20 mx-auto p-5 border w-11/12 md:w-3/4 lg:w-1/2 shadow-lg rounded-md bg-white">
            <div class="mt-3">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-lg font-medium text-gray-900">Quản lý Giá Dịch vụ</h3>
                    <button id="close-pricing-modal" class="text-gray-400 hover:text-gray-600" onclick="closePricingModal()">
                        <i class="fas fa-times text-xl"></i>
                    </button>
                </div>
                
                <!-- Service Selection -->
                <div class="mb-6">
                    <label class="block text-sm font-medium text-gray-700 mb-2">Chọn Dịch vụ</label>
                    <select id="pricing-service-select" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                        <option value="">-- Chọn dịch vụ --</option>
                        <option value="DV001">DV001 - Thu gom rác sinh hoạt hàng ngày</option>
                        <option value="DV002">DV002 - Thu gom rác sinh hoạt 3 lần/tuần</option>
                        <option value="DV003">DV003 - Thu gom rác công nghiệp 2 lần/tuần</option>
                        <option value="DV004">DV004 - Thu gom rác công nghiệp hàng ngày</option>
                        <option value="DV005">DV005 - Thu gom rác nguy hại theo yêu cầu</option>
                    </select>
                </div>
                
                <!-- Current Price Display -->
                <div id="current-price-display" class="mb-6 p-4 bg-blue-50 rounded-lg hidden">
                    <h4 class="font-medium text-blue-900 mb-2">Giá hiện tại</h4>
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <span class="text-sm text-gray-600">Giá:</span>
                            <span id="current-price" class="ml-2 font-medium text-blue-900"></span>
                        </div>
                        <div>
                            <span class="text-sm text-gray-600">Áp dụng từ:</span>
                            <span id="current-effective-date" class="ml-2 font-medium text-blue-900"></span>
                        </div>
                    </div>
                </div>
                
                <!-- Add New Price -->
                <div class="mb-6">
                    <h4 class="font-medium text-gray-900 mb-3">Thêm mức giá mới</h4>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Giá mới (VNĐ)</label>
                            <input type="number" id="new-price" placeholder="Nhập giá mới" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Ngày áp dụng</label>
                            <input type="date" id="new-effective-date" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                        </div>
                    </div>
                    <div class="mt-3">
                        <label class="block text-sm font-medium text-gray-700 mb-1">Ghi chú</label>
                        <textarea id="price-note" placeholder="Lý do thay đổi giá..." class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" rows="2"></textarea>
                    </div>
                    <button id="add-new-price-btn" class="mt-3 bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700" onclick="addNewPrice()">
                        <i class="fas fa-plus mr-2"></i>Thêm mức giá
                    </button>
                </div>
                
                <!-- Price History -->
                <div class="mb-6">
                    <h4 class="font-medium text-gray-900 mb-3">Lịch sử thay đổi giá</h4>
                    <div id="price-history-table" class="overflow-x-auto">
                        <table class="w-full text-sm text-left text-gray-600">
                            <thead class="text-xs text-gray-700 uppercase bg-gray-100">
                                <tr>
                                    <th class="px-4 py-2">STT</th>
                                    <th class="px-4 py-2">Giá (VNĐ)</th>
                                    <th class="px-4 py-2">Ngày áp dụng</th>
                                    <th class="px-4 py-2">Trạng thái</th>
                                    <th class="px-4 py-2">Ghi chú</th>
                                    <th class="px-4 py-2">Người tạo</th>
                                </tr>
                            </thead>
                            <tbody id="price-history-body">
                                <!-- Price history will be populated here -->
                            </tbody>
                        </table>
                    </div>
                </div>
                
                <!-- Future Price Schedule -->
                <div class="mb-6">
                    <h4 class="font-medium text-gray-900 mb-3">Lịch trình giá tương lai</h4>
                    <div id="future-price-schedule" class="space-y-2">
                        <!-- Future prices will be shown here -->
                    </div>
                </div>
            </div>
        </div>
    </div>



    <script>
        // Global functions for service pricing (must be defined before DOMContentLoaded)
        window.openPricingModal = function() {
            console.log('openPricingModal called');
            const modal = document.getElementById('pricing-modal');
            if (modal) {
                modal.classList.remove('hidden');
                console.log('Pricing modal opened');
            } else {
                console.error('Pricing modal not found');
                showError('Modal không tìm thấy!', 'Lỗi hệ thống');
            }
        };
        
        window.openPricingModalWithService = function(serviceId) {
            console.log('openPricingModalWithService called with:', serviceId);
            const modal = document.getElementById('pricing-modal');
            const serviceSelect = document.getElementById('pricing-service-select');
            
            if (modal && serviceSelect) {
                modal.classList.remove('hidden');
                serviceSelect.value = serviceId;
                console.log('Pricing modal opened with service:', serviceId);
                
                // Load sample data immediately
                loadSamplePriceHistory(serviceId);
            } else {
                console.error('Modal or service select not found');
                showError('Modal không tìm thấy!', 'Lỗi hệ thống');
            }
        };
        
        // Simple function to load sample price history
        window.loadSamplePriceHistory = function(serviceId) {
            console.log('Loading sample price history for:', serviceId);
            
            const historyBody = document.getElementById('price-history-body');
            const currentPriceDisplay = document.getElementById('current-price-display');
            const currentPrice = document.getElementById('current-price');
            const currentEffectiveDate = document.getElementById('current-effective-date');
            const futureSchedule = document.getElementById('future-price-schedule');
            
            if (!historyBody) {
                console.error('History body not found');
                return;
            }
            
            // Sample data for each service
            const sampleData = {
                'DV001': [
                    { price: 30000, effectiveDate: '2023-01-01', status: 'Đã kết thúc', note: 'Giá ban đầu', createdBy: 'Admin' },
                    { price: 35000, effectiveDate: '2024-01-01', status: 'Đang áp dụng', note: 'Tăng giá theo quy định mới', createdBy: 'Admin' },
                    { price: 40000, effectiveDate: '2024-07-01', status: 'Chờ áp dụng', note: 'Tăng giá theo lạm phát', createdBy: 'Manager' }
                ],
                'DV002': [
                    { price: 20000, effectiveDate: '2023-01-01', status: 'Đã kết thúc', note: 'Giá ban đầu', createdBy: 'Admin' },
                    { price: 25000, effectiveDate: '2024-01-01', status: 'Đang áp dụng', note: 'Tăng giá theo quy định mới', createdBy: 'Admin' }
                ],
                'DV003': [
                    { price: 100000, effectiveDate: '2024-02-01', status: 'Đang áp dụng', note: 'Giá ban đầu', createdBy: 'Admin' },
                    { price: 120000, effectiveDate: '2024-06-01', status: 'Chờ áp dụng', note: 'Tăng giá theo thị trường', createdBy: 'Manager' }
                ],
                'DV004': [
                    { price: 130000, effectiveDate: '2024-02-01', status: 'Đang áp dụng', note: 'Giá ban đầu', createdBy: 'Admin' }
                ],
                'DV005': [
                    { price: 450000, effectiveDate: '2024-03-01', status: 'Đã kết thúc', note: 'Giá ban đầu', createdBy: 'Admin' },
                    { price: 500000, effectiveDate: '2024-03-01', status: 'Đang áp dụng', note: 'Tăng giá theo quy định mới', createdBy: 'Admin' }
                ]
            };
            
            const history = sampleData[serviceId] || [];
            
            // Clear previous data
            historyBody.innerHTML = '';
            if (futureSchedule) futureSchedule.innerHTML = '';
            
            // Find current price
            const currentPriceData = history.find(item => item.status === 'Đang áp dụng');
            if (currentPriceData && currentPriceDisplay && currentPrice && currentEffectiveDate) {
                currentPriceDisplay.classList.remove('hidden');
                currentPrice.textContent = new Intl.NumberFormat('vi-VN').format(currentPriceData.price) + ' ₫';
                currentEffectiveDate.textContent = new Date(currentPriceData.effectiveDate).toLocaleDateString('vi-VN');
            } else if (currentPriceDisplay) {
                currentPriceDisplay.classList.add('hidden');
            }
            
            // Populate history table
            history.forEach((item, index) => {
                const row = document.createElement('tr');
                row.className = 'bg-white border-b hover:bg-gray-50';
                
                let statusClass = 'bg-gray-100 text-gray-800';
                if (item.status === 'Đang áp dụng') statusClass = 'bg-green-100 text-green-800';
                else if (item.status === 'Chờ áp dụng') statusClass = 'bg-yellow-100 text-yellow-800';
                
                row.innerHTML = `
                    <td class="px-4 py-2">${index + 1}</td>
                    <td class="px-4 py-2 font-medium">${new Intl.NumberFormat('vi-VN').format(item.price)} ₫</td>
                    <td class="px-4 py-2">${new Date(item.effectiveDate).toLocaleDateString('vi-VN')}</td>
                    <td class="px-4 py-2">
                        <span class="px-2 py-1 text-xs font-medium rounded-full ${statusClass}">
                            ${item.status}
                        </span>
                    </td>
                    <td class="px-4 py-2">${item.note}</td>
                    <td class="px-4 py-2">${item.createdBy}</td>
                `;
                historyBody.appendChild(row);
            });
            
            // Show future prices
            const futurePrices = history.filter(item => item.status === 'Chờ áp dụng');
            if (futureSchedule) {
                if (futurePrices.length > 0) {
                    futurePrices.forEach(item => {
                        const futureItem = document.createElement('div');
                        futureItem.className = 'p-3 bg-yellow-50 border border-yellow-200 rounded-lg';
                        futureItem.innerHTML = `
                            <div class="flex justify-between items-center">
                                <div>
                                    <span class="font-medium text-yellow-900">${new Intl.NumberFormat('vi-VN').format(item.price)} ₫</span>
                                    <span class="text-sm text-yellow-700 ml-2">(Từ ${new Date(item.effectiveDate).toLocaleDateString('vi-VN')})</span>
                                </div>
                                <span class="px-2 py-1 text-xs font-medium rounded-full bg-yellow-100 text-yellow-800">
                                    Chờ áp dụng
                                </span>
                            </div>
                            <div class="text-sm text-yellow-700 mt-1">${item.note}</div>
                        `;
                        futureSchedule.appendChild(futureItem);
                    });
                } else {
                    futureSchedule.innerHTML = '<p class="text-gray-500 text-sm">Không có lịch trình giá tương lai</p>';
                }
            }
        };
        
        window.closePricingModal = function() {
            console.log('closePricingModal called');
            const modal = document.getElementById('pricing-modal');
            if (modal) {
                modal.classList.add('hidden');
                console.log('Pricing modal closed');
            }
        };
        
        window.addNewPrice = function() {
            console.log('addNewPrice called');
            const serviceSelect = document.getElementById('pricing-service-select');
            const newPrice = document.getElementById('new-price');
            const effectiveDate = document.getElementById('new-effective-date');
            const note = document.getElementById('price-note');
            
            if (!serviceSelect || !newPrice || !effectiveDate) {
                showError('Không tìm thấy các trường cần thiết!', 'Lỗi hệ thống');
                return;
            }
            
            const serviceId = serviceSelect.value;
            const priceValue = newPrice.value;
            const dateValue = effectiveDate.value;
            const noteValue = note.value;
            
            if (!serviceId || !priceValue || !dateValue) {
                showWarning('Vui lòng điền đầy đủ thông tin!', 'Thiếu thông tin');
                return;
            }
            
            console.log('Adding new price:', { serviceId, priceValue, dateValue, noteValue });
            showSuccess('Đã thêm mức giá mới thành công! (Demo)', 'Thành công');
            
            // Clear form
            newPrice.value = '';
            effectiveDate.value = '';
            note.value = '';
        };
        
        document.addEventListener('DOMContentLoaded', function() {
            // --- Role Selection Panel Toggle ---
            const roleToggleBtn = document.getElementById('role-toggle-btn');
            const roleSelectionPanel = document.getElementById('role-selection-panel');
            const roleToggleContainer = document.getElementById('role-toggle-container');
            const roleToggleIcon = document.getElementById('role-toggle-icon');
            const roleToggleText = document.getElementById('role-toggle-text');
            const currentRoleDisplay = document.getElementById('current-role-display');
            
            let isRolePanelOpen = false;
            
            if (roleToggleBtn && roleSelectionPanel) {
                // Initialize with minimal spacing when panel is hidden
                roleToggleContainer.style.marginBottom = '0.125rem'; // mb-0.5 - minimal spacing
                roleSelectionPanel.style.marginBottom = '0'; // No margin when hidden
                roleSelectionPanel.style.padding = '0'; // No padding when hidden
                
                roleToggleBtn.addEventListener('click', function() {
                    isRolePanelOpen = !isRolePanelOpen;
                    
                    if (isRolePanelOpen) {
                        roleSelectionPanel.style.maxHeight = '120px';
                        roleSelectionPanel.style.opacity = '1';
                        roleSelectionPanel.style.padding = '1.5rem'; // p-6
                        roleSelectionPanel.style.marginBottom = '0.5rem'; // mb-2
                        roleToggleContainer.style.marginBottom = '0.5rem'; // mb-2
                        roleToggleIcon.style.transform = 'rotate(180deg)';
                        roleToggleText.textContent = 'Ẩn khung chọn vai trò';
                    } else {
                        roleSelectionPanel.style.maxHeight = '0';
                        roleSelectionPanel.style.opacity = '0';
                        roleSelectionPanel.style.padding = '0'; // No padding when hidden
                        roleSelectionPanel.style.marginBottom = '0'; // No margin when hidden
                        roleToggleContainer.style.marginBottom = '0.125rem'; // mb-0.5 - minimal spacing
                        roleToggleIcon.style.transform = 'rotate(0deg)';
                        roleToggleText.textContent = 'Chọn vai trò người dùng';
                    }
                });
            }
            
            // --- Web Admin Role Switching & Navigation ---
            const roleButtons = document.querySelectorAll('.role-button');
            const sidebars = document.querySelectorAll('.sidebar');
            const webContentPages = document.querySelectorAll('.web-content-page');
            const userRoleName = document.getElementById('user-role-name');
            const pageNameBreadcrumb = document.getElementById('page-name-breadcrumb');
            
            // --- Sidebar Toggle Functionality (Desktop) ---
            const sidebarContainer = document.getElementById('sidebar-container');
            const sidebarToggle = document.getElementById('sidebar-toggle');
            let isSidebarCollapsed = false;
            
            // Desktop sidebar toggle
            if (sidebarToggle) {
                sidebarToggle.addEventListener('click', function() {
                    console.log('Sidebar toggle clicked');
                    isSidebarCollapsed = !isSidebarCollapsed;
                    
                    if (isSidebarCollapsed) {
                        sidebarContainer.classList.add('collapsed');
                        sidebarToggle.classList.add('rotated');
                        // Update icon
                        const icon = sidebarToggle.querySelector('i');
                        if (icon) {
                            icon.className = 'fas fa-chevron-right text-gray-600';
                        }
                    } else {
                        sidebarContainer.classList.remove('collapsed');
                        sidebarToggle.classList.remove('rotated');
                        // Update icon
                        const icon = sidebarToggle.querySelector('i');
                        if (icon) {
                            icon.className = 'fas fa-chevron-left text-gray-600';
                        }
                    }
                });
            }
            
            // --- Mobile Menu Functionality ---
            const mobileMenuToggle = document.getElementById('mobile-menu-toggle');
            const mobileMenu = document.getElementById('mobile-menu');
            const mobileOverlay = document.getElementById('mobile-overlay');
            const mobileRoleName = document.getElementById('mobile-role-name');
            
            // Mobile menu toggle
            if (mobileMenuToggle) {
                mobileMenuToggle.addEventListener('click', function() {
                    console.log('Mobile menu toggle clicked');
                    mobileMenu.classList.toggle('open');
                    mobileOverlay.classList.toggle('active');
                });
            }
            
            // Close mobile menu when clicking overlay
            if (mobileOverlay) {
                mobileOverlay.addEventListener('click', function() {
                    console.log('Mobile overlay clicked');
                    mobileMenu.classList.remove('open');
                    mobileOverlay.classList.remove('active');
                });
            }
            
            // Mobile menu item click
            document.querySelectorAll('.mobile-menu-item').forEach(item => {
                item.addEventListener('click', function(e) {
                    e.preventDefault();
                    const targetId = this.getAttribute('data-target');
                    
                    // Update active state
                    document.querySelectorAll('.mobile-menu-item').forEach(i => {
                        i.classList.remove('active');
                    });
                    this.classList.add('active');
                    
                    // Navigate to page
                    webContentPages.forEach(page => {
                        page.classList.toggle('hidden', page.id !== targetId);
                    });
                    
                    // Update breadcrumb
                    if (pageNameBreadcrumb) {
                        pageNameBreadcrumb.textContent = this.textContent.trim().toUpperCase();
                    }
                    
                    // Close mobile menu
                    mobileMenu.classList.remove('open');
                    mobileOverlay.classList.remove('active');
                });
            });

            function navigateToPage(link) {
                if (!link) return;
                const targetId = link.getAttribute('data-target');
                const currentSidebar = link.closest('.sidebar');

                if (currentSidebar) {
                    currentSidebar.querySelectorAll('.web-nav-link').forEach(l => {
                        l.classList.remove('bg-blue-50', 'text-blue-700', 'font-semibold');
                        l.classList.add('text-gray-600', 'hover:bg-gray-100');
                    });
                    link.classList.add('bg-blue-50', 'text-blue-700', 'font-semibold');
                    link.classList.remove('text-gray-600', 'hover:bg-gray-100');
                }
                
                webContentPages.forEach(page => {
                    page.classList.toggle('hidden', page.id !== targetId);
                });
                
                if (pageNameBreadcrumb) {
                    pageNameBreadcrumb.textContent = link.textContent.trim().toUpperCase();
                }
                
                // Close mobile menu after navigation
                if (window.innerWidth <= 768) {
                    if (mobileMenu) mobileMenu.classList.remove('open');
                    if (mobileOverlay) mobileOverlay.classList.remove('active');
                }

                // Initialize chart if dashboard is shown
                if (targetId === 'dashboard-grac-admin') {
                    const chartCanvas = document.getElementById('revenueChart');
                    if (chartCanvas && !chartCanvas.chart) {
                        chartCanvas.chart = new Chart(chartCanvas.getContext('2d'), {
                            type: 'line',
                            data: {
                                labels: ['Tháng 2', 'Tháng 3', 'Tháng 4', 'Tháng 5', 'Tháng 6', 'Tháng 7'],
                                datasets: [{
                                    label: 'Doanh thu (tỷ VNĐ)',
                                    data: [0.8, 0.95, 1.1, 1.05, 1.15, 1.25],
                                    borderColor: 'rgb(37, 99, 235)',
                                    backgroundColor: 'rgba(37, 99, 235, 0.1)',
                                    fill: true,
                                    tension: 0.4
                                }]
                            },
                            options: { responsive: true, scales: { y: { beginAtZero: true } } }
                        });
                    }
                }
            }

            function switchRole(role) {
                roleButtons.forEach(btn => {
                    btn.classList.toggle('active', btn.dataset.role === role);
                    if (btn.dataset.role === role && userRoleName) {
                        userRoleName.textContent = btn.textContent.trim();
                    }
                });

                // Update current role display
                if (currentRoleDisplay) {
                    const activeButton = document.querySelector(`[data-role="${role}"]`);
                    if (activeButton) {
                        currentRoleDisplay.innerHTML = `Vai trò hiện tại: <strong>${activeButton.textContent.trim()}</strong>`;
                    }
                }

                // Auto-hide role selection panel after selection
                if (isRolePanelOpen && roleSelectionPanel) {
                    isRolePanelOpen = false;
                    roleSelectionPanel.style.maxHeight = '0';
                    roleSelectionPanel.style.opacity = '0';
                    roleSelectionPanel.style.padding = '0'; // No padding when hidden
                    roleSelectionPanel.style.marginBottom = '0'; // No margin when hidden
                    roleToggleContainer.style.marginBottom = '0.125rem'; // mb-0.5 - minimal spacing
                    roleToggleIcon.style.transform = 'rotate(0deg)';
                    roleToggleText.textContent = 'Chọn vai trò người dùng';
                }

                // Update desktop sidebar
                sidebars.forEach(sidebar => {
                    sidebar.classList.toggle('hidden', sidebar.id !== `sidebar-${role}`);
                });

                // Update mobile menu
                const mobileRoleMenus = document.querySelectorAll('.mobile-menu-role');
                mobileRoleMenus.forEach(menu => {
                    menu.classList.toggle('hidden', menu.id !== `mobile-menu-${role}`);
                });

                // Update mobile role name
                if (mobileRoleName) {
                    const activeButton = document.querySelector(`[data-role="${role}"]`);
                    if (activeButton) {
                        mobileRoleName.textContent = activeButton.textContent.trim();
                    }
                }

                // Navigate to first page of new role
                const activeSidebar = document.getElementById(`sidebar-${role}`);
                if (activeSidebar) {
                    const firstLink = activeSidebar.querySelector('.web-nav-link');
                    if (firstLink) {
                        navigateToPage(firstLink);
                    }
                }
                
                // Update mobile menu active state
                const activeMobileMenu = document.getElementById(`mobile-menu-${role}`);
                if (activeMobileMenu) {
                    const firstMobileItem = activeMobileMenu.querySelector('.mobile-menu-item');
                    if (firstMobileItem) {
                        document.querySelectorAll('.mobile-menu-item').forEach(item => {
                            item.classList.remove('active');
                        });
                        firstMobileItem.classList.add('active');
                    }
                }
            }
            
            roleButtons.forEach(button => {
                button.addEventListener('click', () => switchRole(button.dataset.role));
            });

            // --- Address Categories Tab Management ---
            const addressTabs = document.querySelectorAll('.address-tab');
            const addressTabContents = document.querySelectorAll('.address-tab-content');
            
            addressTabs.forEach(tab => {
                tab.addEventListener('click', function() {
                    const targetTab = this.getAttribute('data-tab');
                    
                    // Update active tab
                    addressTabs.forEach(t => {
                        t.classList.remove('active');
                        t.classList.add('border-transparent', 'text-gray-500');
                        t.classList.remove('border-blue-500', 'text-blue-600');
                    });
                    this.classList.add('active');
                    this.classList.remove('border-transparent', 'text-gray-500');
                    this.classList.add('border-blue-500', 'text-blue-600');
                    
                    // Show target content
                    addressTabContents.forEach(content => {
                        content.classList.add('hidden');
                    });
                    const targetContent = document.getElementById(targetTab + '-tab');
                    if (targetContent) {
                        targetContent.classList.remove('hidden');
                    }
                });
            });

            document.getElementById('sidebar-container').addEventListener('click', function(e) {
                const link = e.target.closest('.web-nav-link');
                if (link) {
                    e.preventDefault();
                    navigateToPage(link);
                }
            });

            // --- Event Delegation for dynamic buttons ---
            document.body.addEventListener('click', function(e) {
                // Customer Detail Navigation
                if (e.target.matches('.view-customer-detail')) {
                    e.preventDefault();
                    console.log('Customer detail clicked');
                    
                    // Hide all content pages first
                    webContentPages.forEach(page => {
                        page.classList.add('hidden');
                    });
                    
                    // Show customer detail page
                    const customerDetailPage = document.getElementById('customer-detail-content');
                    if (customerDetailPage) {
                        customerDetailPage.classList.remove('hidden');
                    }
                    
                    // Update breadcrumb
                    if (pageNameBreadcrumb) {
                        pageNameBreadcrumb.textContent = 'CHI TIẾT KHÁCH HÀNG';
                    }
                    
                    // Update active navigation link
                    const currentSidebar = document.querySelector('.sidebar:not(.hidden)');
                    if (currentSidebar) {
                        currentSidebar.querySelectorAll('.web-nav-link').forEach(l => {
                            l.classList.remove('bg-blue-50', 'text-blue-700', 'font-semibold');
                            l.classList.add('text-gray-600', 'hover:bg-gray-100');
                        });
                        
                        // Find and activate the customers link
                        const customersLink = currentSidebar.querySelector('[data-target="customers-content"]');
                        if (customersLink) {
                            customersLink.classList.add('bg-blue-50', 'text-blue-700', 'font-semibold');
                            customersLink.classList.remove('text-gray-600', 'hover:bg-gray-100');
                        }
                    }
                }
                
                // Contract Detail Navigation
                if (e.target.matches('.view-contract-detail')) {
                    e.preventDefault();
                    const currentSidebar = e.target.closest('.sidebar') || document.querySelector('.sidebar:not(.hidden)');
                    const mockLink = {
                        getAttribute: () => 'contract-detail-content',
                        textContent: 'Chi tiết hợp đồng',
                        closest: () => currentSidebar
                    };
                    navigateToPage(mockLink);
                }
                
                // Back to Customer List
                if (e.target.matches('#back-to-customer-list')) {
                    e.preventDefault();
                    const currentSidebar = document.querySelector('.sidebar:not(.hidden)');
                    const mockLink = {
                        getAttribute: () => 'customers-content',
                        textContent: 'Khách hàng',
                        closest: () => currentSidebar
                    };
                    navigateToPage(mockLink);
                }
                
                // Back to Contract List
                if (e.target.matches('#back-to-contract-list')) {
                    e.preventDefault();
                    const currentSidebar = document.querySelector('.sidebar:not(.hidden)');
                    const mockLink = {
                        getAttribute: () => 'contracts-content',
                        textContent: 'Hợp đồng',
                        closest: () => currentSidebar
                    };
                    navigateToPage(mockLink);
                }
                
                // Collect Payment from Customer Detail
                if (e.target.matches('#collect-payment-from-detail')) {
                    e.preventDefault();
                    console.log('Collect payment from customer detail clicked');
                    console.log('Button clicked:', e.target);
                    console.log('Button ID:', e.target.id);
                    
                    // Get customer data from the detail page with null checks
                    console.log('Looking for customer detail elements...');
                    
                    const customerNameElement = document.querySelector('.customer-detail-content h2');
                    console.log('Customer name element:', customerNameElement);
                    
                    const customerCodeElement = document.querySelector('.customer-detail-info p:first-child');
                    console.log('Customer code element:', customerCodeElement);
                    
                    let totalDebtElement = document.querySelector('.customer-detail-debt p.text-2xl, .customer-detail-debt p.text-3xl');
                    console.log('Total debt element:', totalDebtElement);
                    
                    // Try alternative selectors if not found
                    if (!totalDebtElement) {
                        console.log('Trying alternative selector for total debt...');
                        const alternativeDebtElement = document.querySelector('.customer-detail-debt p:last-child');
                        console.log('Alternative debt element:', alternativeDebtElement);
                        if (alternativeDebtElement) {
                            totalDebtElement = alternativeDebtElement;
                        }
                    }
                    
                    console.log('Final elements:', { customerNameElement, customerCodeElement, totalDebtElement });
                    
                    if (!customerNameElement || !customerCodeElement || !totalDebtElement) {
                        console.error('Required customer detail elements not found');
                        showError('Không thể lấy thông tin khách hàng. Vui lòng thử lại.', 'Lỗi');
                        return;
                    }
                    
                    const customerName = customerNameElement.textContent || 'Khách hàng';
                    const customerCode = customerCodeElement.textContent.replace('Mã khách hàng:', '').trim() || 'KH000';
                    const totalDebt = totalDebtElement.textContent || '0 ₫';
                    
                    // Try to get address from address tab or use default
                    let customerAddress = 'Địa chỉ không có';
                    const addressTab = document.getElementById('tab-address');
                    if (addressTab && !addressTab.classList.contains('hidden')) {
                        const firstAddressRow = addressTab.querySelector('tbody tr:first-child');
                        if (firstAddressRow) {
                            const addressDetailElement = firstAddressRow.querySelector('td:nth-child(4)');
                            const wardElement = firstAddressRow.querySelector('td:nth-child(5)');
                            const cityElement = firstAddressRow.querySelector('td:nth-child(6)');
                            
                            if (addressDetailElement && wardElement && cityElement) {
                                const addressDetail = addressDetailElement.textContent;
                                const ward = wardElement.textContent;
                                const city = cityElement.textContent;
                                customerAddress = `${addressDetail}, ${ward}, ${city}`;
                            }
                        }
                    }
                    
                    const customerData = {
                        code: customerCode,
                        name: customerName,
                        address: customerAddress,
                        totalDebt: totalDebt
                    };
                    
                    console.log('Opening payment modal with customer data from detail:', customerData);
                    
                    // Check if openPaymentModal function exists
                    if (typeof openPaymentModal === 'function') {
                        openPaymentModal(customerData);
                    } else {
                        console.error('openPaymentModal function not found');
                        showError('Chức năng thanh toán không khả dụng. Vui lòng thử lại.', 'Lỗi');
                    }
                }

                // Customer Detail Tabs
                if (e.target.matches('.detail-tab')) {
                    e.preventDefault();
                    const targetTab = e.target.getAttribute('data-target');
                    
                    // Remove active class from all tabs
                    document.querySelectorAll('.detail-tab').forEach(tab => {
                        tab.classList.remove('active');
                    });
                    
                    // Add active class to clicked tab
                    e.target.classList.add('active');
                    
                    // Hide all tab contents
                    document.querySelectorAll('.detail-tab-content').forEach(content => {
                        content.classList.add('hidden');
                    });
                    
                    // Show target tab content
                    const targetContent = document.getElementById(targetTab);
                    if (targetContent) {
                        targetContent.classList.remove('hidden');
                    }
                }
                
                // Contract Detail Tabs
                if (e.target.matches('.contract-detail-tab')) {
                    e.preventDefault();
                    const targetTab = e.target.getAttribute('data-target');
                    
                    // Remove active class from all contract detail tabs
                    document.querySelectorAll('.contract-detail-tab').forEach(tab => {
                        tab.classList.remove('active', 'text-blue-600', 'border-blue-600');
                        tab.classList.add('text-gray-500', 'hover:text-blue-600', 'hover:border-gray-300');
                    });
                    
                    // Add active class to clicked tab
                    e.target.classList.add('active', 'text-blue-600', 'border-blue-600');
                    e.target.classList.remove('text-gray-500', 'hover:text-blue-600', 'hover:border-gray-300');
                    
                    // Hide all contract detail tab contents
                    document.querySelectorAll('.contract-detail-tab-content').forEach(content => {
                        content.classList.add('hidden');
                    });
                    
                    // Show target tab content
                    const targetContent = document.getElementById(targetTab);
                    if (targetContent) {
                        targetContent.classList.remove('hidden');
                    }
                }
                

                

                
                // Customer Modal
                if (e.target.matches('#add-customer-btn')) {
                    const customerModal = document.getElementById('customer-modal');
                    if(customerModal) customerModal.classList.remove('hidden');
                }
                if (e.target.matches('#close-customer-modal')) {
                    const customerModal = document.getElementById('customer-modal');
                    if(customerModal) customerModal.classList.add('hidden');
                }
            });

            // Initialize with the default role
            switchRole('grac-admin');
            
            // Debug: Log all customer detail links
            console.log('Customer detail links found:', document.querySelectorAll('.view-customer-detail').length);
            
            // Add click event listeners directly to customer detail links for better reliability
            document.querySelectorAll('.view-customer-detail').forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    console.log('Customer detail clicked via direct listener');
                    
                    // Hide all content pages first
                    webContentPages.forEach(page => {
                        page.classList.add('hidden');
                    });
                    
                    // Show customer detail page
                    const customerDetailPage = document.getElementById('customer-detail-content');
                    if (customerDetailPage) {
                        customerDetailPage.classList.remove('hidden');
                    }
                    
                    // Update breadcrumb
                    if (pageNameBreadcrumb) {
                        pageNameBreadcrumb.textContent = 'CHI TIẾT KHÁCH HÀNG';
                    }
                    
                    // Update active navigation link
                    const currentSidebar = document.querySelector('.sidebar:not(.hidden)');
                    if (currentSidebar) {
                        currentSidebar.querySelectorAll('.web-nav-link').forEach(l => {
                            l.classList.remove('bg-blue-50', 'text-blue-700', 'font-semibold');
                            l.classList.add('text-gray-600', 'hover:bg-gray-100');
                        });
                        
                        // Find and activate the customers link
                        const customersLink = currentSidebar.querySelector('[data-target="customers-content"]');
                        if (customersLink) {
                            customersLink.classList.add('bg-blue-50', 'text-blue-700', 'font-semibold');
                            customersLink.classList.remove('text-gray-600', 'hover:bg-gray-100');
                        }
                    }
                });
            });
            
            // Contract status filter function
            function filterContracts(status) {
                console.log('Filtering contracts by status:', status);
                
                // Filter desktop table rows
                const tableRows = document.querySelectorAll('#contracts-content .contract-row');
                let visibleCount = 0;
                
                tableRows.forEach(row => {
                    const rowStatus = row.getAttribute('data-status');
                    const shouldShow = status === 'all' || rowStatus === status;
                    
                    if (shouldShow) {
                        row.style.display = '';
                        visibleCount++;
                    } else {
                        row.style.display = 'none';
                    }
                });
                
                // Filter mobile cards
                const mobileCards = document.querySelectorAll('#contracts-content .mobile-card');
                mobileCards.forEach(card => {
                    const cardStatus = card.getAttribute('data-status');
                    const shouldShow = status === 'all' || cardStatus === status;
                    
                    if (shouldShow) {
                        card.style.display = '';
                    } else {
                        card.style.display = 'none';
                    }
                });
                
                console.log('Visible contracts:', visibleCount);
                return visibleCount;
            }
            
            // Add click handlers for contract status filter
            document.addEventListener('DOMContentLoaded', function() {
                // Contract status filter radio buttons
                const contractFilterRadios = document.querySelectorAll('input[name="contract-status-filter"]');
                contractFilterRadios.forEach(radio => {
                    radio.addEventListener('change', function() {
                        const status = this.value;
                        const visibleCount = filterContracts(status);
                        
                        // Update pagination
                        const paginationStart = document.getElementById('contract-pagination-start');
                        const paginationEnd = document.getElementById('contract-pagination-end');
                        const paginationTotal = document.getElementById('contract-pagination-total');
                        
                        if (paginationStart) paginationStart.textContent = visibleCount > 0 ? '1' : '0';
                        if (paginationEnd) paginationEnd.textContent = visibleCount.toString();
                        if (paginationTotal) paginationTotal.textContent = visibleCount.toString();
                    });
                });
                
                // Initialize counts
                updateContractCount('all', 0);
            });
            
            // Function to update customer count
            function updateCustomerCount(selectedStatus, visibleCount) {
                // Update the count in the selected radio button
                const selectedRadio = document.querySelector(`input[name="status-filter"][value="${selectedStatus}"]`);
                if (selectedRadio) {
                    const textSpan = selectedRadio.parentElement.querySelector('span');
                    if (textSpan) {
                        const currentText = textSpan.textContent;
                        const statusText = currentText.split(' | ')[0];
                        textSpan.textContent = `${statusText} | ${visibleCount}`;
                    }
                }
            }
            
            // Function to update contract count
            function updateContractCount(selectedStatus, visibleCount) {
                // Count all contracts by status from the original DOM
                const allContracts = document.querySelectorAll('#contracts-content .contract-row');
                let allCount = 0;
                let activeCount = 0;
                let pausedCount = 0;
                let endedCount = 0;
                
                allContracts.forEach(contract => {
                    const status = contract.getAttribute('data-status');
                    allCount++;
                    if (status === 'active') activeCount++;
                    else if (status === 'paused') pausedCount++;
                    else if (status === 'ended') endedCount++;
                });
                
                console.log('Contract counts - All:', allCount, 'Active:', activeCount, 'Paused:', pausedCount, 'Ended:', endedCount);
                
                // Update all radio button counts
                const allRadio = document.querySelector(`input[name="contract-status-filter"][value="all"]`);
                const activeRadio = document.querySelector(`input[name="contract-status-filter"][value="active"]`);
                const pausedRadio = document.querySelector(`input[name="contract-status-filter"][value="paused"]`);
                const endedRadio = document.querySelector(`input[name="contract-status-filter"][value="ended"]`);
                
                if (allRadio) {
                    const textSpan = allRadio.parentElement.querySelector('span');
                    if (textSpan) {
                        textSpan.textContent = `Tất cả | ${allCount}`;
                    }
                }
                
                if (activeRadio) {
                    const textSpan = activeRadio.parentElement.querySelector('span');
                    if (textSpan) {
                        textSpan.textContent = `Đang hoạt động | ${activeCount}`;
                    }
                }
                
                if (pausedRadio) {
                    const textSpan = pausedRadio.parentElement.querySelector('span');
                    if (textSpan) {
                        textSpan.textContent = `Tạm dừng | ${pausedCount}`;
                    }
                }
                
                if (endedRadio) {
                    const textSpan = endedRadio.parentElement.querySelector('span');
                    if (textSpan) {
                        textSpan.textContent = `Đã kết thúc | ${endedCount}`;
                    }
                }
            }
            
            // Function to update employee count
            function updateEmployeeCount(selectedStatus, visibleCount) {
                // Update the count in the selected radio button
                const selectedRadio = document.querySelector(`input[name="employee-status-filter"][value="${selectedStatus}"]`);
                if (selectedRadio) {
                    const textSpan = selectedRadio.parentElement.querySelector('span');
                    if (textSpan) {
                        const currentText = textSpan.textContent;
                        const statusText = currentText.split(' | ')[0];
                        textSpan.textContent = `${statusText} | ${visibleCount}`;
                    }
                }
            }
            
            // Function to update pagination info
            function updatePaginationInfo(visibleCount, filterName) {
                let paginationStart, paginationEnd, paginationTotal;
                
                if (filterName === 'contract-status-filter') {
                    paginationStart = document.getElementById('contract-pagination-start');
                    paginationEnd = document.getElementById('contract-pagination-end');
                    paginationTotal = document.getElementById('contract-pagination-total');
                } else if (filterName === 'employee-status-filter') {
                    paginationStart = document.getElementById('employee-pagination-start');
                    paginationEnd = document.getElementById('employee-pagination-end');
                    paginationTotal = document.getElementById('employee-pagination-total');
                } else {
                    paginationStart = document.getElementById('customer-pagination-start');
                    paginationEnd = document.getElementById('customer-pagination-end');
                    paginationTotal = document.getElementById('customer-pagination-total');
                }
                
                if (paginationStart) paginationStart.textContent = visibleCount > 0 ? '1' : '0';
                if (paginationEnd) paginationEnd.textContent = visibleCount.toString();
                if (paginationTotal) paginationTotal.textContent = visibleCount.toString();
            }
            
            // Function to update dashboard statistics based on actual data
            function updateDashboardStats() {
                const customerRows = document.querySelectorAll('.customer-row');
                const totalCustomers = customerRows.length;
                
                let activeCustomers = 0;
                let inactiveCustomers = 0;
                
                customerRows.forEach(row => {
                    const status = row.getAttribute('data-status');
                    if (status === 'active') {
                        activeCustomers++;
                    } else if (status === 'inactive') {
                        inactiveCustomers++;
                    }
                });
                
                // Update dashboard stats if dashboard is visible
                const dashboard = document.getElementById('dashboard-grac-admin');
                if (dashboard && !dashboard.classList.contains('hidden')) {
                    const totalCustomersElement = dashboard.querySelector('.grid > div:first-child p');
                    if (totalCustomersElement) {
                        totalCustomersElement.textContent = totalCustomers;
                    }
                    
                    // Update active contracts (assuming 1 contract per customer for demo)
                    const activeContractsElement = dashboard.querySelector('.grid > div:nth-child(2) p');
                    if (activeContractsElement) {
                        activeContractsElement.textContent = totalCustomers;
                    }
                }
            }
            
            // Initialize dashboard stats when page loads
            document.addEventListener('DOMContentLoaded', function() {
                updateDashboardStats();
                
                // Initialize contract counts
                updateContractCount('all', 0);
            });
            
            // Status tab functionality with color consistency (for other pages)
            document.querySelectorAll('.status-tab').forEach(tab => {
                tab.addEventListener('click', function() {
                    // Remove all status classes from all tabs
                    document.querySelectorAll('.status-tab').forEach(t => {
                        t.classList.remove('active', 'status-active', 'status-inactive', 'status-warning', 'status-success', 'status-danger');
                    });
                    
                    // Add appropriate class based on tab content
                    if (this.textContent.includes('Hoạt động')) {
                        this.classList.add('status-active');
                    } else if (this.textContent.includes('Tạm khoá')) {
                        this.classList.add('status-inactive');
                    } else if (this.textContent.includes('Chờ thanh toán')) {
                        this.classList.add('status-warning');
                    } else if (this.textContent.includes('Đã thanh toán')) {
                        this.classList.add('status-success');
                    } else if (this.textContent.includes('Quá hạn')) {
                        this.classList.add('status-danger');
                    } else {
                        this.classList.add('active');
                    }
                });
            });
            
            // Pagination functionality
            class CustomerPagination {
                constructor() {
                    this.currentPage = 1;
                    this.itemsPerPage = 5; // Số khách hàng hiển thị mỗi trang
                    this.totalItems = 0;
                    this.filteredItems = [];
                    
                    this.init();
                }
                
                init() {
                    this.updateTotalItems();
                    this.setupEventListeners();
                    this.renderPagination();
                }
                
                updateTotalItems() {
                    // Lấy tất cả khách hàng hiện tại (có thể thay đổi khi có filter)
                    const allCustomers = document.querySelectorAll('.customer-row');
                    this.filteredItems = Array.from(allCustomers).filter(row => {
                        return row.style.display !== 'none' && !row.classList.contains('hidden');
                    });
                    this.totalItems = this.filteredItems.length;
                }
                
                setupEventListeners() {
                    // Event listener cho các nút phân trang
                    document.addEventListener('click', (e) => {
                        if (e.target.matches('.pagination-button[data-page]')) {
                            const page = parseInt(e.target.dataset.page);
                            this.goToPage(page);
                        } else if (e.target.matches('#pagination-prev')) {
                            this.goToPage(this.currentPage - 1);
                        } else if (e.target.matches('#pagination-next')) {
                            this.goToPage(this.currentPage + 1);
                        }
                    });
                    
                    // Cập nhật phân trang khi filter thay đổi
                    document.querySelectorAll('.status-radio').forEach(radio => {
                        radio.addEventListener('change', () => {
                            setTimeout(() => {
                                this.updateTotalItems();
                                this.currentPage = 1;
                                this.renderPagination();
                                this.showCurrentPage();
                                
                                // Cập nhật số lượng trong filter
                                const selectedStatus = radio.value;
                                this.updateFilterCount(selectedStatus);
                            }, 350); // Đợi animation filter hoàn thành
                        });
                    });
                }
                
                goToPage(page) {
                    if (page < 1 || page > this.getTotalPages()) return;
                    
                    this.currentPage = page;
                    this.renderPagination();
                    this.showCurrentPage();
                }
                
                getTotalPages() {
                    return Math.ceil(this.totalItems / this.itemsPerPage);
                }
                
                showCurrentPage() {
                    const startIndex = (this.currentPage - 1) * this.itemsPerPage;
                    const endIndex = startIndex + this.itemsPerPage;
                    
                    // Ẩn tất cả khách hàng
                    this.filteredItems.forEach((item, index) => {
                        if (index >= startIndex && index < endIndex) {
                            item.style.display = '';
                            setTimeout(() => {
                                item.style.opacity = '1';
                                item.style.transform = 'translateY(0)';
                            }, 10);
                        } else {
                            item.style.opacity = '0';
                            item.style.transform = 'translateY(-10px)';
                            setTimeout(() => {
                                item.style.display = 'none';
                            }, 300);
                        }
                    });
                    
                    // Cập nhật thông tin phân trang
                    this.updatePaginationInfo(startIndex, endIndex);
                }
                
                updatePaginationInfo(startIndex, endIndex) {
                    const startElement = document.getElementById('pagination-start');
                    const endElement = document.getElementById('pagination-end');
                    const totalElement = document.getElementById('pagination-total');
                    
                    if (startElement) startElement.textContent = startIndex + 1;
                    if (endElement) endElement.textContent = Math.min(endIndex, this.totalItems);
                    if (totalElement) totalElement.textContent = this.totalItems;
                }
                
                updateFilterCount(selectedStatus) {
                    const customerRows = document.querySelectorAll('.customer-row');
                    let visibleCount = 0;
                    
                    customerRows.forEach(row => {
                        if (selectedStatus === 'all') {
                            visibleCount++;
                        } else {
                            const rowStatus = row.getAttribute('data-status');
                            if (rowStatus === selectedStatus) {
                                visibleCount++;
                            }
                        }
                    });
                    
                    // Cập nhật số lượng trong filter
                    const selectedRadio = document.querySelector(`input[name="status-filter"][value="${selectedStatus}"]`);
                    if (selectedRadio) {
                        const textSpan = selectedRadio.parentElement.querySelector('span');
                        if (textSpan) {
                            const currentText = textSpan.textContent;
                            const statusText = currentText.split(' | ')[0];
                            textSpan.textContent = `${statusText} | ${visibleCount}`;
                        }
                    }
                }
                
                renderPagination() {
                    const totalPages = this.getTotalPages();
                    const controlsContainer = document.querySelector('.pagination-controls');
                    
                    if (!controlsContainer) return;
                    
                    // Xóa các nút phân trang cũ (giữ lại prev/next)
                    const existingButtons = controlsContainer.querySelectorAll('.pagination-button[data-page]');
                    existingButtons.forEach(btn => btn.remove());
                    
                    // Cập nhật trạng thái nút prev/next
                    const prevButton = document.getElementById('pagination-prev');
                    const nextButton = document.getElementById('pagination-next');
                    
                    if (prevButton) prevButton.disabled = this.currentPage <= 1;
                    if (nextButton) nextButton.disabled = this.currentPage >= totalPages;
                    
                    // Tạo các nút phân trang
                    const maxVisiblePages = 5;
                    let startPage = Math.max(1, this.currentPage - Math.floor(maxVisiblePages / 2));
                    let endPage = Math.min(totalPages, startPage + maxVisiblePages - 1);
                    
                    if (endPage - startPage + 1 < maxVisiblePages) {
                        startPage = Math.max(1, endPage - maxVisiblePages + 1);
                    }
                    
                    // Thêm nút đầu trang
                    if (startPage > 1) {
                        const firstButton = this.createPageButton(1);
                        controlsContainer.insertBefore(firstButton, nextButton);
                        
                        if (startPage > 2) {
                            const ellipsis = document.createElement('span');
                            ellipsis.className = 'pagination-ellipsis';
                            ellipsis.textContent = '...';
                            controlsContainer.insertBefore(ellipsis, nextButton);
                        }
                    }
                    
                    // Thêm các nút trang
                    for (let i = startPage; i <= endPage; i++) {
                        const button = this.createPageButton(i);
                        if (i === this.currentPage) {
                            button.classList.add('active');
                        }
                        controlsContainer.insertBefore(button, nextButton);
                    }
                    
                    // Thêm nút cuối trang
                    if (endPage < totalPages) {
                        if (endPage < totalPages - 1) {
                            const ellipsis = document.createElement('span');
                            ellipsis.className = 'pagination-ellipsis';
                            ellipsis.textContent = '...';
                            controlsContainer.insertBefore(ellipsis, nextButton);
                        }
                        
                        const lastButton = this.createPageButton(totalPages);
                        controlsContainer.insertBefore(lastButton, nextButton);
                    }
                    
                    // Hiển thị trang hiện tại
                    this.showCurrentPage();
                }
                
                createPageButton(page) {
                    const button = document.createElement('button');
                    button.className = 'pagination-button';
                    button.dataset.page = page;
                    button.textContent = page;
                    return button;
                }
            }
            
            // Global logout function
            function logout() {
                console.log('Logout function called!'); // Debug
                
                // Show confirmation
                if (confirm('Bạn có chắc chắn muốn đăng xuất?')) {
                    // Clear user info
                    localStorage.removeItem('gracUserInfo');
                    sessionStorage.removeItem('gracUserInfo');
                    
                    console.log('User info cleared, redirecting...'); // Debug
                    
                    // Redirect to login page
                    window.location.href = 'web-admin-login.html';
                }
            }
            
            // Make logout function globally available
            window.logout = logout;
            
            // Khởi tạo phân trang khi trang được load
            document.addEventListener('DOMContentLoaded', function() {
                // Check authentication
                const userInfo = localStorage.getItem('gracUserInfo') || sessionStorage.getItem('gracUserInfo');
                if (!userInfo) {
                    // User not logged in, redirect to login page
                    window.location.href = 'web-admin-login.html';
                    return;
                }
                
                // Update user info display
                try {
                    const user = JSON.parse(userInfo);
                    const userRoleName = document.getElementById('user-role-name');
                    if (userRoleName) {
                        userRoleName.textContent = user.username;
                    }
                } catch (e) {
                    console.error('Error parsing user info:', e);
                }
                
                // Logout functionality
                const logoutBtn = document.getElementById('logout-btn');
                console.log('Logout button found:', logoutBtn); // Debug
                
                if (logoutBtn) {
                    logoutBtn.addEventListener('click', function(e) {
                        e.preventDefault();
                        console.log('Logout button clicked!'); // Debug
                        
                        // Show confirmation
                        if (confirm('Bạn có chắc chắn muốn đăng xuất?')) {
                            // Clear user info
                            localStorage.removeItem('gracUserInfo');
                            sessionStorage.removeItem('gracUserInfo');
                            
                            console.log('User info cleared, redirecting...'); // Debug
                            
                            // Redirect to login page
                            window.location.href = 'web-admin-login.html';
                        }
                    });
                } else {
                    console.error('Logout button not found!'); // Debug
                }
                
                            // Khởi tạo phân trang cho khách hàng
            const customerPagination = new CustomerPagination();
            
            // Thêm vào global scope để có thể truy cập từ các function khác
            window.customerPagination = customerPagination;
            
            // Khởi tạo phân trang cho hợp đồng
            const contractPagination = new ContractPagination();
            window.contractPagination = contractPagination;
                
                // Hide unwanted footer text on desktop
                if (window.innerWidth >= 769) {
                    // Function to hide unwanted text
                    function hideUnwantedText() {
                                            // Hide specific mobile menu elements
                    const mobileMenuElements = [
                        '#mobile-menu-grac-admin',
                        '#mobile-menu-dv-quanly',
                        '#mobile-menu-dv-coso',
                        '#mobile-menu-dv-thugom'
                    ];
                    
                    mobileMenuElements.forEach(selector => {
                        const element = document.querySelector(selector);
                        if (element) {
                            element.style.display = 'none';
                            element.style.visibility = 'hidden';
                            element.style.opacity = '0';
                            element.style.position = 'absolute';
                            element.style.left = '-9999px';
                            element.style.top = '-9999px';
                            element.style.zIndex = '-9999';
                            element.style.pointerEvents = 'none';
                        }
                    });
                    
                    // Hide mobile menu content
                    const mobileMenuContent = document.querySelector('.mobile-menu-content');
                    if (mobileMenuContent) {
                        mobileMenuContent.style.display = 'none';
                        mobileMenuContent.style.visibility = 'hidden';
                        mobileMenuContent.style.opacity = '0';
                    }
                    
                    // Hide entire mobile menu
                    const mobileMenu = document.querySelector('#mobile-menu');
                    if (mobileMenu) {
                        mobileMenu.style.display = 'none';
                        mobileMenu.style.visibility = 'hidden';
                        mobileMenu.style.opacity = '0';
                        mobileMenu.style.position = 'absolute';
                        mobileMenu.style.left = '-9999px';
                        mobileMenu.style.top = '-9999px';
                        mobileMenu.style.zIndex = '-9999';
                        mobileMenu.style.pointerEvents = 'none';
                    }
                    
                    // Hide all mobile menu related elements
                    const mobileMenuItems = document.querySelectorAll('.mobile-menu-role, .mobile-menu-item, [class*="mobile-menu"]');
                    mobileMenuItems.forEach(element => {
                        element.style.display = 'none';
                        element.style.visibility = 'hidden';
                        element.style.opacity = '0';
                    });
                        
                        const unwantedTexts = [
                            'GRAC SYSTEM',
                            'Dashboard',
                            'Khách hàng',
                            'Hợp đồng',
                            'Công nợ',
                            'Thanh toán',
                            'ĐV Thu gom',
                            'Dịch vụ',
                            'Quản trị',
                            'Thống kê'
                        ];
                        
                        // Hide elements containing unwanted text
                        unwantedTexts.forEach(text => {
                            const elements = document.querySelectorAll('*');
                            elements.forEach(element => {
                                if (element.textContent && element.textContent.includes(text)) {
                                    // Check if it's not in sidebar or mobile menu
                                    if (!element.closest('.sidebar') && 
                                        !element.closest('.mobile-menu') && 
                                        !element.closest('.web-content-page')) {
                                        element.style.display = 'none';
                                        element.style.visibility = 'hidden';
                                        element.style.opacity = '0';
                                    }
                                }
                            });
                        });
                        
                        // Hide elements positioned at bottom
                        const bottomElements = document.querySelectorAll('[style*="bottom"]');
                        bottomElements.forEach(element => {
                            if (!element.closest('.sidebar') && 
                                !element.closest('.mobile-menu') && 
                                !element.closest('.web-content-page')) {
                                element.style.display = 'none';
                            }
                        });
                    }
                    
                    // Run immediately and also on window resize
                    hideUnwantedText();
                    window.addEventListener('resize', hideUnwantedText);
                    
                    // Also run periodically to catch dynamically added content
                    setInterval(hideUnwantedText, 1000);
                }
                
                // Service management functionality
                function initServiceManagement() {
                    console.log('Initializing service management...');
                    
                    // Service pagination
                    let currentServicePage = 1;
                    const servicesPerPage = 5;
                    const totalServices = 18;
                    
                    function updateServicePagination() {
                        const start = (currentServicePage - 1) * servicesPerPage + 1;
                        const end = Math.min(currentServicePage * servicesPerPage, totalServices);
                        
                        const startElement = document.getElementById('service-pagination-start');
                        const endElement = document.getElementById('service-pagination-end');
                        const totalElement = document.getElementById('service-pagination-total');
                        
                        if (startElement) startElement.textContent = start;
                        if (endElement) endElement.textContent = end;
                        if (totalElement) totalElement.textContent = totalServices;
                        
                        // Update pagination buttons
                        const prevBtn = document.getElementById('service-pagination-prev');
                        const nextBtn = document.getElementById('service-pagination-next');
                        
                        if (prevBtn) prevBtn.disabled = currentServicePage === 1;
                        if (nextBtn) nextBtn.disabled = currentServicePage >= Math.ceil(totalServices / servicesPerPage);
                        
                        // Update active page button
                        document.querySelectorAll('[data-page]').forEach(btn => {
                            btn.classList.remove('active');
                            if (parseInt(btn.dataset.page) === currentServicePage) {
                                btn.classList.add('active');
                            }
                        });
                    }
                    
                    // Service status filtering
                    function filterServicesByStatus(status) {
                        const serviceRows = document.querySelectorAll('.service-row');
                        let visibleCount = 0;
                        
                        serviceRows.forEach(row => {
                            const rowStatus = row.dataset.status;
                            if (status === 'all' || rowStatus === status) {
                                row.style.display = '';
                                visibleCount++;
                            } else {
                                row.style.display = 'none';
                            }
                        });
                        
                        console.log(`Filtered services by status: ${status}, visible: ${visibleCount}`);
                    }
                    
                    // Event listeners for service pagination
                    const prevBtn = document.getElementById('service-pagination-prev');
                    const nextBtn = document.getElementById('service-pagination-next');
                    
                    if (prevBtn) {
                        prevBtn.addEventListener('click', () => {
                            if (currentServicePage > 1) {
                                currentServicePage--;
                                updateServicePagination();
                            }
                        });
                    }
                    
                    if (nextBtn) {
                        nextBtn.addEventListener('click', () => {
                            const maxPage = Math.ceil(totalServices / servicesPerPage);
                            if (currentServicePage < maxPage) {
                                currentServicePage++;
                                updateServicePagination();
                            }
                        });
                    }
                    
                    // Event listeners for service status filtering
                    document.querySelectorAll('input[name="service-status-filter"]').forEach(radio => {
                        radio.addEventListener('change', (e) => {
                            filterServicesByStatus(e.target.value);
                        });
                    });
                    
                    // Initialize service pagination
                    updateServicePagination();
                }
                
                // Initialize service management
                initServiceManagement();
                
                // Service pricing management
                function initServicePricing() {
                    console.log('Initializing service pricing management...');
                    
                    // Sample price history data
                    window.priceHistoryData = {
                        'DV001': [
                            { id: 1, price: 30000, effectiveDate: '2023-01-01', status: 'Đã kết thúc', note: 'Giá ban đầu', createdBy: 'Admin', createdAt: '2023-01-01' },
                            { id: 2, price: 35000, effectiveDate: '2024-01-01', status: 'Đang áp dụng', note: 'Tăng giá theo quy định mới', createdBy: 'Admin', createdAt: '2023-12-15' },
                            { id: 3, price: 40000, effectiveDate: '2024-07-01', status: 'Chờ áp dụng', note: 'Tăng giá theo lạm phát', createdBy: 'Manager', createdAt: '2024-06-01' }
                        ],
                        'DV002': [
                            { id: 1, price: 20000, effectiveDate: '2023-01-01', status: 'Đã kết thúc', note: 'Giá ban đầu', createdBy: 'Admin', createdAt: '2023-01-01' },
                            { id: 2, price: 25000, effectiveDate: '2024-01-01', status: 'Đang áp dụng', note: 'Tăng giá theo quy định mới', createdBy: 'Admin', createdAt: '2023-12-15' }
                        ],
                        'DV003': [
                            { id: 1, price: 100000, effectiveDate: '2024-02-01', status: 'Đang áp dụng', note: 'Giá ban đầu', createdBy: 'Admin', createdAt: '2024-01-15' },
                            { id: 2, price: 120000, effectiveDate: '2024-06-01', status: 'Chờ áp dụng', note: 'Tăng giá theo thị trường', createdBy: 'Manager', createdAt: '2024-05-01' }
                        ],
                        'DV004': [
                            { id: 1, price: 130000, effectiveDate: '2024-02-01', status: 'Đang áp dụng', note: 'Giá ban đầu', createdBy: 'Admin', createdAt: '2024-01-15' }
                        ],
                        'DV005': [
                            { id: 1, price: 450000, effectiveDate: '2024-03-01', status: 'Đã kết thúc', note: 'Giá ban đầu', createdBy: 'Admin', createdAt: '2024-02-15' },
                            { id: 2, price: 500000, effectiveDate: '2024-03-01', status: 'Đang áp dụng', note: 'Tăng giá theo quy định mới', createdBy: 'Admin', createdAt: '2024-02-20' }
                        ]
                    };
                    
                    // Function to format price
                    window.formatPrice = function(price) {
                        return new Intl.NumberFormat('vi-VN').format(price) + ' ₫';
                    }
                    
                    // Function to format date
                    window.formatDate = function(dateString) {
                        const date = new Date(dateString);
                        return date.toLocaleDateString('vi-VN');
                    }
                    
                    // Function to get status badge class
                    window.getStatusBadgeClass = function(status) {
                        switch(status) {
                            case 'Đang áp dụng': return 'bg-green-100 text-green-800';
                            case 'Chờ áp dụng': return 'bg-yellow-100 text-yellow-800';
                            case 'Đã kết thúc': return 'bg-gray-100 text-gray-800';
                            default: return 'bg-gray-100 text-gray-800';
                        }
                    }
                    
                    // Function to load price history
                    window.loadPriceHistory = function(serviceId) {
                        const historyBody = document.getElementById('price-history-body');
                        const currentPriceDisplay = document.getElementById('current-price-display');
                        const currentPrice = document.getElementById('current-price');
                        const currentEffectiveDate = document.getElementById('current-effective-date');
                        const futureSchedule = document.getElementById('future-price-schedule');
                        
                        if (!historyBody || !window.priceHistoryData[serviceId]) return;
                        
                        const history = window.priceHistoryData[serviceId];
                        
                        // Clear previous data
                        historyBody.innerHTML = '';
                        futureSchedule.innerHTML = '';
                        
                        // Find current price
                        const currentPriceData = history.find(item => item.status === 'Đang áp dụng');
                        if (currentPriceData) {
                            currentPriceDisplay.classList.remove('hidden');
                            currentPrice.textContent = formatPrice(currentPriceData.price);
                            currentEffectiveDate.textContent = formatDate(currentPriceData.effectiveDate);
                        } else {
                            currentPriceDisplay.classList.add('hidden');
                        }
                        
                        // Populate history table
                        history.forEach((item, index) => {
                            const row = document.createElement('tr');
                            row.className = 'bg-white border-b hover:bg-gray-50';
                            row.innerHTML = `
                                <td class="px-4 py-2">${index + 1}</td>
                                <td class="px-4 py-2 font-medium">${formatPrice(item.price)}</td>
                                <td class="px-4 py-2">${formatDate(item.effectiveDate)}</td>
                                <td class="px-4 py-2">
                                    <span class="px-2 py-1 text-xs font-medium rounded-full ${getStatusBadgeClass(item.status)}">
                                        ${item.status}
                                    </span>
                                </td>
                                <td class="px-4 py-2">${item.note}</td>
                                <td class="px-4 py-2">${item.createdBy}</td>
                            `;
                            historyBody.appendChild(row);
                        });
                        
                        // Show future prices
                        const futurePrices = history.filter(item => item.status === 'Chờ áp dụng');
                        if (futurePrices.length > 0) {
                            futurePrices.forEach(item => {
                                const futureItem = document.createElement('div');
                                futureItem.className = 'p-3 bg-yellow-50 border border-yellow-200 rounded-lg';
                                futureItem.innerHTML = `
                                    <div class="flex justify-between items-center">
                                        <div>
                                            <span class="font-medium text-yellow-900">${formatPrice(item.price)}</span>
                                            <span class="text-sm text-yellow-700 ml-2">(Từ ${formatDate(item.effectiveDate)})</span>
                                        </div>
                                        <span class="px-2 py-1 text-xs font-medium rounded-full bg-yellow-100 text-yellow-800">
                                            Chờ áp dụng
                                        </span>
                                    </div>
                                    <div class="text-sm text-yellow-700 mt-1">${item.note}</div>
                                `;
                                futureSchedule.appendChild(futureItem);
                            });
                        } else {
                            futureSchedule.innerHTML = '<p class="text-gray-500 text-sm">Không có lịch trình giá tương lai</p>';
                        }
                    }
                    
                    // Event listeners
                    const pricingModal = document.getElementById('pricing-modal');
                    const managePricingBtn = document.getElementById('manage-pricing-btn');
                    const closePricingModal = document.getElementById('close-pricing-modal');
                    const serviceSelect = document.getElementById('pricing-service-select');
                    const addNewPriceBtn = document.getElementById('add-new-price-btn');
                    
                    // Open pricing modal
                    if (managePricingBtn) {
                        managePricingBtn.addEventListener('click', () => {
                            if (pricingModal) pricingModal.classList.remove('hidden');
                        });
                    }
                    
                    // Close pricing modal
                    if (closePricingModal) {
                        closePricingModal.addEventListener('click', () => {
                            if (pricingModal) pricingModal.classList.add('hidden');
                        });
                    }
                    
                    // Service selection change
                    if (serviceSelect) {
                        serviceSelect.addEventListener('change', (e) => {
                            if (e.target.value) {
                                loadPriceHistory(e.target.value);
                            }
                        });
                    }
                    
                    // Add new price
                    if (addNewPriceBtn) {
                        addNewPriceBtn.addEventListener('click', () => {
                            const serviceId = serviceSelect.value;
                            const newPrice = document.getElementById('new-price').value;
                            const effectiveDate = document.getElementById('new-effective-date').value;
                            const note = document.getElementById('price-note').value;
                            
                            if (!serviceId || !newPrice || !effectiveDate) {
                                showWarning('Vui lòng điền đầy đủ thông tin', 'Thiếu thông tin');
                                return;
                            }
                            
                            // Add to price history data
                            if (!window.priceHistoryData[serviceId]) {
                                window.priceHistoryData[serviceId] = [];
                            }
                            
                            const newPriceItem = {
                                id: window.priceHistoryData[serviceId].length + 1,
                                price: parseInt(newPrice),
                                effectiveDate: effectiveDate,
                                status: new Date(effectiveDate) > new Date() ? 'Chờ áp dụng' : 'Đang áp dụng',
                                note: note || 'Thay đổi giá mới',
                                createdBy: 'Admin',
                                createdAt: new Date().toISOString().split('T')[0]
                            };
                            
                            window.priceHistoryData[serviceId].push(newPriceItem);
                            
                            // Reload price history
                            loadPriceHistory(serviceId);
                            
                            // Clear form
                            document.getElementById('new-price').value = '';
                            document.getElementById('new-effective-date').value = '';
                            document.getElementById('price-note').value = '';
                            
                            showSuccess('Đã thêm mức giá mới thành công!', 'Thành công');
                        });
                    }
                    
                    // Auto-apply prices function (simulated)
                    window.autoApplyPrices = function() {
                        const today = new Date().toISOString().split('T')[0];
                        
                        Object.keys(window.priceHistoryData).forEach(serviceId => {
                            const history = window.priceHistoryData[serviceId];
                            history.forEach(item => {
                                if (item.status === 'Chờ áp dụng' && item.effectiveDate <= today) {
                                    // Update status to active
                                    item.status = 'Đang áp dụng';
                                    
                                    // Update previous active price to ended
                                    const previousActive = history.find(h => h.id !== item.id && h.status === 'Đang áp dụng');
                                    if (previousActive) {
                                        previousActive.status = 'Đã kết thúc';
                                    }
                                    
                                    console.log(`Auto-applied new price for service ${serviceId}: ${window.formatPrice(item.price)}`);
                                }
                            });
                        });
                    }
                    
                    // Run auto-apply check every day (simulated)
                    setInterval(window.autoApplyPrices, 24 * 60 * 60 * 1000); // 24 hours
                    
                    // Initial auto-apply check
                    window.autoApplyPrices();
                    
                    // Event listeners for price history buttons
                    document.querySelectorAll('.view-price-history').forEach(btn => {
                        btn.addEventListener('click', (e) => {
                            e.preventDefault();
                            const serviceId = btn.getAttribute('data-service-id');
                            
                            // Open pricing modal
                            if (pricingModal) {
                                pricingModal.classList.remove('hidden');
                                
                                // Set selected service
                                if (serviceSelect) {
                                    serviceSelect.value = serviceId;
                                    loadPriceHistory(serviceId);
                                }
                            }
                        });
                    });
                }
                
                // Initialize service pricing
                initServicePricing();
                
                // Add event delegation for service pricing buttons (in case elements are added dynamically)
                document.addEventListener('click', function(e) {
                    // Handle manage pricing button
                    if (e.target.closest('#manage-pricing-btn')) {
                        console.log('Manage pricing button clicked');
                        const pricingModal = document.getElementById('pricing-modal');
                        if (pricingModal) {
                            pricingModal.classList.remove('hidden');
                            console.log('Pricing modal opened');
                        } else {
                            console.error('Pricing modal not found');
                        }
                    }
                    
                    // Handle close pricing modal
                    if (e.target.closest('#close-pricing-modal')) {
                        console.log('Close pricing modal clicked');
                        const pricingModal = document.getElementById('pricing-modal');
                        if (pricingModal) {
                            pricingModal.classList.add('hidden');
                            console.log('Pricing modal closed');
                        }
                    }
                    
                    // Handle view price history buttons
                    if (e.target.closest('.view-price-history')) {
                        console.log('View price history clicked');
                        const btn = e.target.closest('.view-price-history');
                        const serviceId = btn.getAttribute('data-service-id');
                        console.log('Service ID:', serviceId);
                        
                        const pricingModal = document.getElementById('pricing-modal');
                        const serviceSelect = document.getElementById('pricing-service-select');
                        
                        if (pricingModal && serviceSelect) {
                            pricingModal.classList.remove('hidden');
                            serviceSelect.value = serviceId;
                            
                            // Call loadPriceHistory if it exists
                            if (typeof window.loadPriceHistory === 'function') {
                                window.loadPriceHistory(serviceId);
                            } else {
                                console.error('loadPriceHistory function not found');
                            }
                        }
                    }
                    
                    // Handle add new price button
                    if (e.target.closest('#add-new-price-btn')) {
                        console.log('Add new price button clicked');
                        const serviceSelect = document.getElementById('pricing-service-select');
                        const newPrice = document.getElementById('new-price');
                        const effectiveDate = document.getElementById('new-effective-date');
                        const note = document.getElementById('price-note');
                        
                        if (!serviceSelect || !newPrice || !effectiveDate) {
                            console.error('Required elements not found');
                            return;
                        }
                        
                        const serviceId = serviceSelect.value;
                        const priceValue = newPrice.value;
                        const dateValue = effectiveDate.value;
                        const noteValue = note.value;
                        
                        if (!serviceId || !priceValue || !dateValue) {
                            showWarning('Vui lòng điền đầy đủ thông tin', 'Thiếu thông tin');
                            return;
                        }
                        
                        console.log('Adding new price:', { serviceId, priceValue, dateValue, noteValue });
                        
                        // Simple implementation for testing
                        if (!window.priceHistoryData[serviceId]) {
                            window.priceHistoryData[serviceId] = [];
                        }
                        
                        const newPriceItem = {
                            id: window.priceHistoryData[serviceId].length + 1,
                            price: parseInt(priceValue),
                            effectiveDate: dateValue,
                            status: new Date(dateValue) > new Date() ? 'Chờ áp dụng' : 'Đang áp dụng',
                            note: noteValue || 'Thay đổi giá mới',
                            createdBy: 'Admin',
                            createdAt: new Date().toISOString().split('T')[0]
                        };
                        
                        window.priceHistoryData[serviceId].push(newPriceItem);
                        
                        // Reload price history
                        if (typeof window.loadPriceHistory === 'function') {
                            window.loadPriceHistory(serviceId);
                        }
                        
                        // Clear form
                        newPrice.value = '';
                        effectiveDate.value = '';
                        note.value = '';
                        
                        showSuccess('Đã thêm mức giá mới thành công!', 'Thành công');
                    }
                });
                
                // Debug: Log all service pricing elements
                console.log('Service pricing elements check:');
                console.log('manage-pricing-btn:', document.getElementById('manage-pricing-btn'));
                console.log('pricing-modal:', document.getElementById('pricing-modal'));
                console.log('view-price-history buttons:', document.querySelectorAll('.view-price-history').length);
                
                // Test function to manually trigger modal
                window.testPricingModal = function() {
                    console.log('Testing pricing modal...');
                    const modal = document.getElementById('pricing-modal');
                    if (modal) {
                        modal.classList.remove('hidden');
                        console.log('Modal should be visible now');
                    } else {
                        console.error('Modal not found');
                    }
                };
                
                // Test function to check all elements
                window.checkServiceElements = function() {
                    console.log('=== Service Elements Check ===');
                    console.log('manage-pricing-btn:', document.getElementById('manage-pricing-btn'));
                    console.log('pricing-modal:', document.getElementById('pricing-modal'));
                    console.log('pricing-service-select:', document.getElementById('pricing-service-select'));
                    console.log('add-new-price-btn:', document.getElementById('add-new-price-btn'));
                    console.log('view-price-history buttons:', document.querySelectorAll('.view-price-history'));
                    console.log('price-history-body:', document.getElementById('price-history-body'));
                    console.log('current-price-display:', document.getElementById('current-price-display'));
                    console.log('future-price-schedule:', document.getElementById('future-price-schedule'));
                    console.log('=== End Check ===');
                };
            });
        });
    </script>

    <!-- Payment Collection Modal -->
    <div id="payment-modal" class="fixed inset-0 bg-gray-600 bg-opacity-50 flex justify-center items-center hidden z-50 p-1 md:p-4" style="backdrop-filter: blur(2px); overflow: hidden;">
        <div class="bg-white rounded-lg shadow-xl w-full max-w-2xl max-h-[98vh] md:max-h-[90vh] overflow-y-auto overscroll-contain">
            <div class="p-4 md:p-6">
                <div class="flex justify-between items-center mb-4 md:mb-6">
                    <h3 class="text-lg md:text-xl font-semibold text-gray-900">Thu Tiền Khách Hàng</h3>
                    <button id="close-payment-modal" class="text-gray-400 hover:text-gray-600 transition-colors p-1">
                        <i class="fas fa-times text-lg md:text-xl"></i>
                    </button>
                </div>
                
                <!-- Customer Information -->
                <div class="bg-gray-50 p-3 md:p-4 rounded-lg mb-4">
                    <h4 class="font-semibold text-gray-700 mb-2 text-sm md:text-base">Thông tin khách hàng</h4>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-3 md:gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Mã KH:</label>
                            <span id="payment-customer-code" class="text-gray-900 font-medium">KH001</span>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Tên khách hàng:</label>
                            <span id="payment-customer-name" class="text-gray-900">Nguyễn Văn An</span>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Địa chỉ:</label>
                            <span id="payment-customer-address" class="text-gray-900">123 Lê Lợi, P. Bến Nghé, TP. Hồ Chí Minh</span>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Tổng công nợ:</label>
                            <span id="payment-total-debt" class="text-red-600 font-semibold">35.000 ₫</span>
                        </div>
                    </div>
                </div>
                
                <!-- Payment Periods Selection -->
                <div id="payment-periods-section" class="mb-4">
                    <div class="flex justify-between items-center mb-3">
                        <h4 class="font-semibold text-gray-700">Chọn kỳ thanh toán</h4>
                        <span class="text-xs text-blue-600 bg-blue-50 px-2 py-1 rounded-full">
                            <i class="fas fa-info-circle mr-1"></i>
                            Chỉ chọn được kỳ của năm hiện tại
                        </span>
                    </div>
                    <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-2 mb-3" id="payment-periods-container">
                        <!-- Payment periods will be generated dynamically -->
                    </div>
                    
                    <!-- Quick Selection Buttons -->
                    <div class="flex flex-wrap gap-2 mb-3">
                        <button id="select-all-periods" class="px-3 py-1 bg-blue-100 text-blue-700 rounded text-sm hover:bg-blue-200">Chọn tất cả</button>
                        <button id="select-last-3-months" class="px-3 py-1 bg-green-100 text-green-700 rounded text-sm hover:bg-green-200">3 tháng gần nhất</button>
                        <button id="select-overdue" class="px-3 py-1 bg-red-100 text-red-700 rounded text-sm hover:bg-red-200">Chỉ quá hạn</button>
                        <button id="clear-selection" class="px-3 py-1 bg-gray-100 text-gray-700 rounded text-sm hover:bg-gray-200">Bỏ chọn tất cả</button>
                    </div>
                </div>
                
                <!-- One-time Service Payment Info -->
                <div id="one-time-payment-info" class="mb-4 hidden">
                    <div class="bg-orange-50 border border-orange-200 p-4 rounded-lg">
                        <div class="flex items-start">
                            <i class="fas fa-info-circle text-orange-600 mt-1 mr-3"></i>
                            <div>
                                <h4 class="font-semibold text-orange-800 mb-2">Dịch vụ một lần</h4>
                                <p class="text-orange-700 text-sm mb-3">Đây là dịch vụ một lần, thanh toán sẽ được thực hiện ngay sau khi tạo hợp đồng.</p>
                                <div class="bg-white p-3 rounded border border-orange-200">
                                    <div class="flex justify-between items-center">
                                        <span class="text-sm font-medium text-gray-700">Số tiền cần thanh toán:</span>
                                        <span id="one-time-amount" class="text-lg font-bold text-orange-600"></span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Payment Summary -->
                <div class="bg-blue-50 p-4 rounded-lg mb-4">
                    <h4 class="font-semibold text-gray-700 mb-2">Tổng kết thanh toán</h4>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Số kỳ đã chọn:</label>
                            <span id="selected-periods-count" class="text-blue-600 font-semibold">0</span>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Tổng tiền:</label>
                            <span id="total-payment-amount" class="text-green-600 font-semibold">0 ₫</span>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Kỳ thanh toán:</label>
                            <span id="selected-periods-list" class="text-gray-600 text-sm">Chưa chọn</span>
                        </div>
                    </div>
                </div>
                
                <!-- Payment Method -->
                <div class="mb-4">
                    <h4 class="font-semibold text-gray-700 mb-3">Phương thức thanh toán</h4>
                    <div class="grid grid-cols-2 md:grid-cols-4 gap-3">
                        <label class="flex items-center p-3 border rounded-lg cursor-pointer hover:bg-gray-50 payment-method-option">
                            <input type="radio" name="payment-method" value="cash" class="mr-2" checked>
                            <div>
                                <div class="font-medium text-sm">Tiền mặt</div>
                                <div class="text-xs text-gray-500">Cash</div>
                            </div>
                        </label>
                        <label class="flex items-center p-3 border rounded-lg cursor-pointer hover:bg-gray-50 payment-method-option">
                            <input type="radio" name="payment-method" value="momo" class="mr-2">
                            <div>
                                <div class="font-medium text-sm">Momo</div>
                                <div class="text-xs text-gray-500">QR Code</div>
                            </div>
                        </label>
                        <label class="flex items-center p-3 border rounded-lg cursor-pointer hover:bg-gray-50 payment-method-option">
                            <input type="radio" name="payment-method" value="bank" class="mr-2">
                            <div>
                                <div class="font-medium text-sm">Chuyển khoản</div>
                                <div class="text-xs text-gray-500">Bank Transfer</div>
                            </div>
                        </label>
                        <label class="flex items-center p-3 border rounded-lg cursor-pointer hover:bg-gray-50 payment-method-option">
                            <input type="radio" name="payment-method" value="other" class="mr-2">
                            <div>
                                <div class="font-medium text-sm">Khác</div>
                                <div class="text-xs text-gray-500">Other</div>
                            </div>
                        </label>
                    </div>
                </div>
                
                <!-- Additional Information -->
                <div class="mb-4">
                    <label class="block text-sm font-medium text-gray-700 mb-2">Ghi chú</label>
                    <textarea id="payment-note" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" rows="2" placeholder="Ghi chú về việc thanh toán..."></textarea>
                </div>
                
                <!-- Action Buttons -->
                <div class="flex flex-col sm:flex-row justify-end gap-2 sm:gap-3 mt-6">
                    <button id="cancel-payment" class="px-4 py-3 md:py-2 bg-gray-300 text-gray-700 rounded-md hover:bg-gray-400 text-sm md:text-base font-medium">Hủy</button>
                    <button id="test-confirm" class="px-4 py-3 md:py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 text-sm md:text-base font-medium">Test Confirm</button>
                    <button id="confirm-payment" class="px-4 py-3 md:py-2 bg-green-600 text-white rounded-md hover:bg-green-700 text-sm md:text-base font-medium">Xác nhận thanh toán</button>
                </div>
            </div>
        </div>
        
        <!-- QR Code Payment Content -->
        <div id="qr-payment-content" class="hidden w-full max-w-2xl">
            <div class="bg-white rounded-lg shadow-xl w-full max-h-[90vh] overflow-y-auto">
                <div class="p-6">
                <div class="flex justify-between items-center mb-6">
                    <h3 class="text-xl font-semibold text-gray-900">Thanh toán Online</h3>
                    <button id="qr-cancel-btn" class="text-gray-400 hover:text-gray-600 transition-colors" onclick="hideQRPayment()">
                        <i class="fas fa-times text-xl"></i>
                    </button>
                </div>
                
                <div class="text-center">
                    <div class="mb-6">
                        <div id="qr-code-image" class="mx-auto w-48 h-48 md:w-64 md:h-64 border-4 border-gray-200 rounded-xl bg-white p-4 shadow-lg flex items-center justify-center">
                            <!-- QR code will be generated here -->
                        </div>
                    </div>
                    
                    <div class="mb-6">
                        <p id="qr-payment-text" class="text-xl font-semibold text-gray-700 mb-3"></p>
                        <p id="qr-amount-text" class="text-2xl font-bold text-green-600"></p>
                    </div>
                    
                    <div class="mb-6">
                        <p id="qr-status-text" class="text-blue-600 font-semibold mb-3 text-lg">Đang xử lý thanh toán...</p>
                        <div class="w-full bg-gray-200 rounded-full h-3">
                            <div id="qr-progress-bar" class="bg-blue-500 h-3 rounded-full transition-all duration-500" style="width:0%"></div>
                        </div>
                    </div>
                    
                    <div class="bg-blue-50 p-4 rounded-lg">
                        <h4 class="font-semibold text-blue-800 mb-3">Hướng dẫn thanh toán:</h4>
                        <div class="text-sm text-blue-700 space-y-2">
                            <p class="flex items-center">
                                <i class="fas fa-mobile-alt mr-2"></i>
                                Mở ứng dụng Momo/Payoo trên điện thoại
                            </p>
                            <p class="flex items-center">
                                <i class="fas fa-qrcode mr-2"></i>
                                Quét mã QR để thanh toán
                            </p>
                            <p class="flex items-center">
                                <i class="fas fa-clock mr-2"></i>
                                Chờ xác nhận từ hệ thống
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Payment Success Content -->
        <div id="payment-success-content" class="hidden w-full max-w-2xl">
            <div class="bg-white rounded-lg shadow-xl w-full max-h-[90vh] overflow-y-auto">
                <div class="p-6 text-center">
                    <div class="mb-8">
                        <div class="mx-auto w-16 h-16 md:w-20 md:h-20 bg-green-100 rounded-full flex items-center justify-center mb-6">
                            <i class="fas fa-check text-3xl md:text-4xl text-green-600"></i>
                        </div>
                        <h3 class="text-2xl md:text-3xl font-bold text-green-600 mb-3">Thanh toán thành công!</h3>
                        <p class="text-gray-600 text-base md:text-lg">Giao dịch đã được xử lý thành công</p>
                    </div>
                    
                    <div class="bg-green-50 p-4 md:p-6 rounded-xl mb-8 text-left">
                        <h4 class="font-semibold text-gray-700 mb-4 text-base md:text-lg">Thông tin giao dịch</h4>
                        <div class="space-y-3 text-sm md:text-base">
                                                    <div class="flex justify-between items-center py-2 border-b border-green-100">
                            <span class="text-gray-600 font-medium">Khách hàng:</span>
                            <span id="success-customer-name" class="font-semibold text-gray-800 text-right"></span>
                        </div>
                        <div class="flex justify-between items-center py-2 border-b border-green-100">
                            <span class="text-gray-600 font-medium">Số tiền:</span>
                            <span id="success-amount" class="font-bold text-green-600 text-base md:text-lg"></span>
                        </div>
                        <div class="flex justify-between items-center py-2 border-b border-green-100">
                            <span class="text-gray-600 font-medium">Kỳ thanh toán:</span>
                            <span id="success-periods" class="font-semibold text-gray-800 text-right"></span>
                        </div>
                        <div class="flex justify-between items-center py-2 border-b border-green-100">
                            <span class="text-gray-600 font-medium">Phương thức:</span>
                            <span id="success-method" class="font-semibold text-gray-800 text-right"></span>
                        </div>
                        <div class="flex justify-between items-center py-2">
                            <span class="text-gray-600 font-medium">Ghi chú:</span>
                            <span id="success-note" class="font-semibold text-gray-800 text-right"></span>
                        </div>
                        </div>
                    </div>
                    
                    <div class="bg-blue-50 p-4 rounded-lg">
                        <div class="flex items-center justify-center text-blue-600">
                            <i class="fas fa-clock mr-2"></i>
                            <span class="text-sm font-medium">Màn hình sẽ tự động đóng sau 1 giây...</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Payment Processing Overlay -->
        <div id="payment-processing-overlay" class="hidden absolute inset-0 bg-white bg-opacity-95 flex items-center justify-center z-20 rounded-lg">
            <div class="text-center">
                <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"></div>
                <p class="text-gray-600 font-semibold">Đang xử lý thanh toán...</p>
            </div>
        </div>
    </div>

    <!-- Notification Modal System -->
    <div id="notification-modal" class="fixed inset-0 bg-black bg-opacity-50 flex justify-center items-center hidden z-50 p-4" style="display: none !important; visibility: hidden !important; opacity: 0 !important;">
        <div class="bg-white rounded-lg shadow-xl max-w-md w-full mx-4 transform transition-all scale-95 max-h-[90vh] overflow-y-auto">
            <!-- Success Modal - DISABLED -->
            <div id="success-notification" class="hidden" style="display: none !important; visibility: hidden !important;">
                <div class="p-6 text-center">
                    <div class="mx-auto w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mb-4">
                        <i class="fas fa-check text-3xl text-green-600"></i>
                    </div>
                    <h3 class="text-xl font-semibold text-gray-900 mb-2" id="success-title">Thành công!</h3>
                    <p class="text-gray-600 mb-6" id="success-message">Thao tác đã được thực hiện thành công.</p>
                    <button id="success-ok-btn" class="w-full bg-green-600 text-white px-4 py-2 rounded-md hover:bg-green-700 transition-colors">
                        Đồng ý
                    </button>
                </div>
            </div>

            <!-- Error Modal - DISABLED -->
            <div id="error-notification" class="hidden" style="display: none !important; visibility: hidden !important;">
                <div class="p-6 text-center">
                    <div class="mx-auto w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mb-4">
                        <i class="fas fa-exclamation-triangle text-3xl text-red-600"></i>
                    </div>
                    <h3 class="text-xl font-semibold text-gray-900 mb-2" id="error-title">Lỗi!</h3>
                    <p class="text-gray-600 mb-6" id="error-message">Đã xảy ra lỗi trong quá trình xử lý.</p>
                    <button id="error-ok-btn" class="w-full bg-red-600 text-white px-4 py-2 rounded-md hover:bg-red-700 transition-colors">
                        Đồng ý
                    </button>
                </div>
            </div>

            <!-- Warning Modal - DISABLED -->
            <div id="warning-notification" class="hidden" style="display: none !important; visibility: hidden !important;">
                <div class="p-6 text-center">
                    <div class="mx-auto w-16 h-16 bg-yellow-100 rounded-full flex items-center justify-center mb-4">
                        <i class="fas fa-exclamation-circle text-3xl text-yellow-600"></i>
                    </div>
                    <h3 class="text-xl font-semibold text-gray-900 mb-2" id="warning-title">Cảnh báo!</h3>
                    <p class="text-gray-600 mb-6" id="warning-message">Vui lòng kiểm tra lại thông tin.</p>
                    <button id="warning-ok-btn" class="w-full bg-yellow-600 text-white px-4 py-2 rounded-md hover:bg-yellow-700 transition-colors">
                        Đồng ý
                    </button>
                </div>
            </div>

            <!-- Confirmation Modal - DISABLED -->
            <div id="confirm-notification" class="hidden" style="display: none !important; visibility: hidden !important;">
                <div class="p-6 text-center">
                    <div class="mx-auto w-16 h-16 bg-blue-100 rounded-full flex items-center justify-center mb-4">
                        <i class="fas fa-question-circle text-3xl text-blue-600"></i>
                    </div>
                    <h3 class="text-xl font-semibold text-gray-900 mb-2" id="confirm-title">Xác nhận</h3>
                    <p class="text-gray-600 mb-6" id="confirm-message">Bạn có chắc chắn muốn thực hiện thao tác này?</p>
                    <div class="flex space-x-3">
                        <button id="confirm-cancel-btn" class="flex-1 bg-gray-300 text-gray-700 px-4 py-2 rounded-md hover:bg-gray-400 transition-colors">
                            Hủy
                        </button>
                        <button id="confirm-ok-btn" class="flex-1 bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700 transition-colors">
                            Đồng ý
                        </button>
                    </div>
                </div>
            </div>

            <!-- Info Modal - DISABLED -->
            <div id="info-notification" class="hidden" style="display: none !important; visibility: hidden !important;">
                <div class="p-6 text-center">
                    <div class="mx-auto w-16 h-16 bg-blue-100 rounded-full flex items-center justify-center mb-4">
                        <i class="fas fa-info-circle text-3xl text-blue-600"></i>
                    </div>
                    <h3 class="text-xl font-semibold text-gray-900 mb-2" id="info-title">Thông tin</h3>
                    <p class="text-gray-600 mb-6" id="info-message">Thông tin cần thiết cho bạn.</p>
                    <button id="info-ok-btn" class="w-full bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700 transition-colors">
                        Đồng ý
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Notification Modal System - DISABLED
        window.showNotification = function(type, title, message, callback) {
            console.log('showNotification called but DISABLED:', { type, title, message });
            console.log('showNotification stack trace:', new Error().stack);
            
            // Instead of showing notification modal, use simple modal
            console.log('Redirecting to createSimpleModal...');
            createSimpleModal(title, message, callback);
            
            // Force hide notification modal
            const modal = document.getElementById('notification-modal');
            if (modal) {
                modal.classList.add('hidden');
                modal.style.display = 'none';
                console.log('Forced hide notification modal');
            }
        };
        
        window.hideNotification = function() {
            const modal = document.getElementById('notification-modal');
            modal.classList.add('hidden');
            
            // Add animation
            modal.querySelector('.bg-white').classList.add('scale-95');
            modal.querySelector('.bg-white').classList.remove('scale-100');
        };
        
        // Shorthand functions for different notification types
        window.showSuccess = function(message, title = 'Thành công!', callback) {
            console.log('showSuccess called with:', { message, title });
            console.log('showSuccess stack trace:', new Error().stack);
            
            // Hide any existing notification modal first
            const notificationModal = document.getElementById('notification-modal');
            if (notificationModal) {
                notificationModal.classList.add('hidden');
                console.log('Hidden existing notification modal');
            }
            
            // Force hide all notification elements
            const allNotifications = ['success-notification', 'error-notification', 'warning-notification', 'confirm-notification', 'info-notification'];
            allNotifications.forEach(id => {
                const element = document.getElementById(id);
                if (element) {
                    element.classList.add('hidden');
                    element.style.display = 'none';
                    console.log('Forced hide notification:', id);
                }
            });
            
            // Use simple modal instead of notification modal
            console.log('About to call createSimpleModal...');
            createSimpleModal(title, message, callback);
            console.log('createSimpleModal called');
        };
        
        window.showError = function(message, title = 'Lỗi!', callback) {
            showNotification('error', title, message, callback);
        };
        
        window.showWarning = function(message, title = 'Cảnh báo!', callback) {
            showNotification('warning', title, message, callback);
        };
        
        window.showInfo = function(message, title = 'Thông tin', callback) {
            showNotification('info', title, message, callback);
        };
        
        window.showConfirm = function(message, title = 'Xác nhận', onConfirm, onCancel) {
            console.log('showConfirm called with:', { message, title, onConfirm: !!onConfirm, onCancel: !!onCancel });
            showNotification('confirm', title, message);
            
            // Store callbacks
            window.confirmCallback = onConfirm;
            window.cancelCallback = onCancel;
            console.log('Callbacks stored:', { confirmCallback: !!window.confirmCallback, cancelCallback: !!window.cancelCallback });
        };
        
        // Debug function to check modal elements
        window.debugModalElements = function() {
            console.log('=== Debug Modal Elements ===');
            const modal = document.getElementById('notification-modal');
            console.log('notification-modal:', modal);
            
            const successNotification = document.getElementById('success-notification');
            console.log('success-notification:', successNotification);
            
            const modalContent = modal?.querySelector('.bg-white');
            console.log('modal .bg-white:', modalContent);
            
            const allElements = [
                'notification-modal',
                'success-notification', 
                'error-notification',
                'warning-notification',
                'confirm-notification',
                'info-notification'
            ];
            
            allElements.forEach(id => {
                const element = document.getElementById(id);
                console.log(`${id}:`, element, 'display:', element ? getComputedStyle(element).display : 'N/A');
            });
            
            // Check if modal is visible
            if (modal) {
                const rect = modal.getBoundingClientRect();
                console.log('Modal position:', rect);
                console.log('Modal is visible:', rect.width > 0 && rect.height > 0);
            }
            
            if (successNotification) {
                const rect = successNotification.getBoundingClientRect();
                console.log('Success notification position:', rect);
                console.log('Success notification is visible:', rect.width > 0 && rect.height > 0);
            }
        };
        
        // Force hide notification modal on page load
        document.addEventListener('DOMContentLoaded', function() {
            // Force hide notification modal
            const notificationModal = document.getElementById('notification-modal');
            if (notificationModal) {
                notificationModal.style.display = 'none';
                notificationModal.style.visibility = 'hidden';
                notificationModal.style.opacity = '0';
                notificationModal.classList.add('hidden');
                console.log('Forced hide notification modal on page load');
            }
            
            // Force hide all notification elements
            const allNotifications = ['success-notification', 'error-notification', 'warning-notification', 'confirm-notification', 'info-notification'];
            allNotifications.forEach(id => {
                const element = document.getElementById(id);
                if (element) {
                    element.style.display = 'none';
                    element.style.visibility = 'hidden';
                    element.classList.add('hidden');
                    console.log('Forced hide notification element:', id);
                }
            });
            
            // Add event listeners for notification modal buttons (DISABLED - notification modal is hidden)
            console.log('Notification modal event listeners disabled - modal is hidden');
        });
        
        // Create a simple modal as fallback
        window.createSimpleModal = function(title, message, callback) {
            console.log('Creating simple modal...');
            console.log('createSimpleModal stack trace:', new Error().stack);
            
            // Hide notification modal if it's visible
            const notificationModal = document.getElementById('notification-modal');
            if (notificationModal) {
                notificationModal.classList.add('hidden');
                notificationModal.style.display = 'none';
                console.log('Hidden notification modal before creating simple modal');
            }
            
            // Force hide all notification elements
            const allNotifications = ['success-notification', 'error-notification', 'warning-notification', 'confirm-notification', 'info-notification'];
            allNotifications.forEach(id => {
                const element = document.getElementById(id);
                if (element) {
                    element.classList.add('hidden');
                    element.style.display = 'none';
                    console.log('Forced hide notification in createSimpleModal:', id);
                }
            });
            
            // Remove existing simple modal if any
            const existingModal = document.getElementById('simple-modal');
            if (existingModal) {
                existingModal.remove();
                console.log('Removed existing simple modal');
            }
            
            // Create new modal
            const modal = document.createElement('div');
            modal.id = 'simple-modal';
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0,0,0,0.5);
                display: flex;
                justify-content: center;
                align-items: center;
                z-index: 10000;
                padding: 16px;
            `;
            
            const content = document.createElement('div');
            content.style.cssText = `
                background: white;
                padding: 24px 20px;
                border-radius: 12px;
                width: 100%;
                max-width: 400px;
                text-align: center;
                box-shadow: 0 20px 25px -5px rgba(0,0,0,0.1), 0 10px 10px -5px rgba(0,0,0,0.04);
                max-height: 90vh;
                overflow-y: auto;
            `;
            
            content.innerHTML = `
                <div style="margin-bottom: 20px;">
                    <div style="width: 64px; height: 64px; background: #10b981; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 16px;">
                        <span style="color: white; font-size: 28px; font-weight: bold;">✓</span>
                    </div>
                </div>
                <h3 style="color: #10b981; margin-bottom: 12px; font-size: 20px; font-weight: 600; line-height: 1.3;">${title}</h3>
                <p style="margin-bottom: 24px; white-space: pre-line; color: #374151; line-height: 1.6; font-size: 14px; max-height: 40vh; overflow-y: auto;">${message}</p>
                <button id="simple-modal-ok-btn" style="
                    background: #10b981;
                    color: white;
                    border: none;
                    padding: 14px 28px;
                    border-radius: 8px;
                    cursor: pointer;
                    font-weight: 600;
                    font-size: 16px;
                    transition: all 0.2s;
                    width: 100%;
                    max-width: 200px;
                " onmouseover="this.style.background='#059669'; this.style.transform='translateY(-1px)'" 
                   onmouseout="this.style.background='#10b981'; this.style.transform='translateY(0)'"
                   ontouchstart="this.style.background='#059669'; this.style.transform='translateY(-1px)'"
                   ontouchend="this.style.background='#10b981'; this.style.transform='translateY(0)'">Đồng ý</button>
            `;
            
            modal.appendChild(content);
            document.body.appendChild(modal);
            
            // Add event listener for OK button
            const okBtn = document.getElementById('simple-modal-ok-btn');
            if (okBtn) {
                okBtn.addEventListener('click', function() {
                    modal.remove();
                    if (modal.reEnableScroll) {
                        modal.reEnableScroll();
                    }
                    if (callback && typeof callback === 'function') {
                        callback();
                    }
                });
            }
            
            // Close modal when clicking outside
            modal.addEventListener('click', function(e) {
                if (e.target === modal) {
                    modal.remove();
                    if (modal.reEnableScroll) {
                        modal.reEnableScroll();
                    }
                    if (callback && typeof callback === 'function') {
                        callback();
                    }
                }
            });
            
            // Prevent scrolling on body when modal is open
            document.body.style.overflow = 'hidden';
            document.body.style.position = 'fixed';
            document.body.style.width = '100%';
            document.body.style.top = `-${window.scrollY}px`;
            
            // Store scroll position
            const scrollY = window.scrollY;
            modal.scrollY = scrollY;
            
            // Re-enable scrolling when modal is closed
            const reEnableScroll = () => {
                document.body.style.overflow = '';
                document.body.style.position = '';
                document.body.style.width = '';
                document.body.style.top = '';
                window.scrollTo(0, scrollY);
            };
            
            // Store the re-enable function to call it when modal is closed
            modal.reEnableScroll = reEnableScroll;
            
            console.log('Simple modal created and added to body');
        };
        
        // Payment Collection Modal JavaScript
        document.addEventListener('DOMContentLoaded', function() {
            let selectedPeriods = [];
            let totalAmount = 0;
            
            // Open payment modal
            window.openPaymentModal = function(customerData) {
                console.log('=== openPaymentModal called ===');
                console.log('Customer data:', customerData);
                
                const modal = document.getElementById('payment-modal');
                if (modal) {
                    // Prevent body scroll when modal opens
                    const scrollY = window.scrollY;
                    document.body.style.overflow = 'hidden';
                    document.body.style.position = 'fixed';
                    document.body.style.width = '100%';
                    document.body.style.top = `-${scrollY}px`;
                    
                    // Store scroll position for later restoration
                    modal.scrollY = scrollY;
                    
                    modal.classList.remove('hidden');
                    
                    // Populate customer information
                    if (customerData) {
                        const customerCode = document.getElementById('payment-customer-code');
                        const customerName = document.getElementById('payment-customer-name');
                        const customerAddress = document.getElementById('payment-customer-address');
                        const totalDebt = document.getElementById('payment-total-debt');
                        
                        if (customerCode) customerCode.textContent = customerData.code || 'KH001';
                        if (customerName) customerName.textContent = customerData.name || 'Nguyễn Văn An';
                        if (customerAddress) customerAddress.textContent = customerData.address || '123 Lê Lợi, P. Bến Nghé, TP. Hồ Chí Minh';
                        if (totalDebt) totalDebt.textContent = customerData.totalDebt || '35.000 ₫';
                        
                        console.log('Customer info populated:', {
                            code: customerData.code,
                            name: customerData.name,
                            address: customerData.address,
                            totalDebt: customerData.totalDebt
                        });
                    }
                    
                    // Check if this is a one-time service
                    const isOneTimeService = customerData && customerData.serviceType === 'one-time';
                    
                    if (isOneTimeService) {
                        console.log('Processing one-time service payment...');
                        
                        // Show one-time service info and hide periods selection
                        const periodsSection = document.getElementById('payment-periods-section');
                        const oneTimeInfo = document.getElementById('one-time-payment-info');
                        
                        if (periodsSection) periodsSection.classList.add('hidden');
                        if (oneTimeInfo) oneTimeInfo.classList.remove('hidden');
                        
                        // Set one-time amount
                        const oneTimeAmount = document.getElementById('one-time-amount');
                        if (oneTimeAmount) {
                            oneTimeAmount.textContent = customerData.totalDebt || '0 ₫';
                            console.log('Set one-time amount:', customerData.totalDebt);
                        } else {
                            console.error('one-time-amount element not found');
                        }
                        
                        // Update summary for one-time service
                        selectedPeriods = ['Dịch vụ một lần'];
                        totalAmount = parseInt(customerData.totalDebt.replace(/[^\d]/g, '')) || 0;
                        console.log('Calculated total amount:', totalAmount, 'from:', customerData.totalDebt);
                        
                        updatePaymentSummary();
                        
                        console.log('One-time service payment setup complete:', { 
                            amount: totalAmount, 
                            serviceType: customerData.serviceType,
                            selectedPeriods,
                            totalAmount
                        });
                    } else {
                        // Show periods selection for recurring services
                        document.getElementById('payment-periods-section').classList.remove('hidden');
                        document.getElementById('one-time-payment-info').classList.add('hidden');
                        
                        // Reset form and generate current year periods
                        resetPaymentForm();
                    }
                    
                    // Show current year info
                    const currentYear = new Date().getFullYear();
                    console.log('Payment modal opened for year:', currentYear, 'One-time service:', isOneTimeService);
                }
            };
            
            // Close payment modal
            window.closePaymentModal = function() {
                console.log('closePaymentModal called');
                const modal = document.getElementById('payment-modal');
                if (modal) {
                    // Stop any running payment simulation
                    if (window.qrPaymentInterval) {
                        clearInterval(window.qrPaymentInterval);
                        window.qrPaymentInterval = null;
                        console.log('Stopped QR payment interval');
                    }
                    
                    // Reset all content displays
                    const modalContent = modal.querySelector('.bg-white.rounded-lg.shadow-xl');
                    const qrContent = document.getElementById('qr-payment-content');
                    const successContent = document.getElementById('payment-success-content');
                    const processingOverlay = document.getElementById('payment-processing-overlay');
                    
                    console.log('Modal elements to reset:', { modalContent, qrContent, successContent, processingOverlay });
                    
                    // Show main content, hide others
                    if (modalContent) {
                        modalContent.style.display = 'block';
                        console.log('Reset main modal content to visible');
                    }
                    if (qrContent) {
                        qrContent.style.display = 'none';
                        console.log('Reset QR content to hidden');
                    }
                    if (successContent) {
                        successContent.style.display = 'none';
                        console.log('Reset success content to hidden');
                    }
                    if (processingOverlay) {
                        processingOverlay.style.display = 'none';
                        console.log('Reset processing overlay to hidden');
                    }
                    
                    // Reset one-time service display
                    document.getElementById('payment-periods-section').classList.remove('hidden');
                    document.getElementById('one-time-payment-info').classList.add('hidden');
                    
                    // Restore body scroll
                    const scrollY = modal.scrollY || 0;
                    document.body.style.overflow = '';
                    document.body.style.position = '';
                    document.body.style.width = '';
                    document.body.style.top = '';
                    window.scrollTo(0, scrollY);
                    
                    // Hide modal
                    modal.classList.add('hidden');
                    console.log('Modal hidden and scroll restored');
                } else {
                    console.error('Payment modal not found');
                }
            };
            
            // Generate payment periods for current year
            function generatePaymentPeriods() {
                const currentYear = new Date().getFullYear();
                const container = document.getElementById('payment-periods-container');
                
                if (!container) return;
                
                container.innerHTML = '';
                
                // Generate 12 months for current year
                for (let month = 1; month <= 12; month++) {
                    const periodLabel = `T${month}/${currentYear}`;
                    const amount = '35.000'; // Default amount, can be customized per customer
                    
                    const periodElement = document.createElement('label');
                    periodElement.className = 'flex items-center p-3 border rounded-lg cursor-pointer hover:bg-gray-50 payment-period-option';
                    periodElement.innerHTML = `
                        <input type="checkbox" class="period-checkbox mr-2" value="${periodLabel}" data-amount="${amount}">
                        <div>
                            <div class="font-medium text-sm">${periodLabel}</div>
                            <div class="text-xs text-gray-500">${amount} ₫</div>
                        </div>
                    `;
                    
                    container.appendChild(periodElement);
                }
            }
            
            // Reset payment form
            function resetPaymentForm() {
                selectedPeriods = [];
                totalAmount = 0;
                
                // Generate payment periods for current year
                generatePaymentPeriods();
                
                // Uncheck all checkboxes
                document.querySelectorAll('.period-checkbox').forEach(checkbox => {
                    checkbox.checked = false;
                });
                
                // Update summary
                updatePaymentSummary();
                
                // Clear note
                document.getElementById('payment-note').value = '';
                
                // Reset payment method to cash
                document.querySelector('input[name="payment-method"][value="cash"]').checked = true;
            }
            
            // Update payment summary
            function updatePaymentSummary() {
                console.log('=== updatePaymentSummary called ===');
                console.log('Current state:', { selectedPeriods, totalAmount });
                
                const periodsCount = document.getElementById('selected-periods-count');
                const totalAmountElement = document.getElementById('total-payment-amount');
                const periodsList = document.getElementById('selected-periods-list');
                
                if (periodsCount) {
                    periodsCount.textContent = selectedPeriods.length;
                    console.log('Set periods count:', selectedPeriods.length);
                } else {
                    console.error('selected-periods-count element not found');
                }
                
                if (totalAmountElement) {
                    const formattedAmount = formatCurrency(totalAmount);
                    totalAmountElement.textContent = formattedAmount;
                    console.log('Set total amount:', formattedAmount, 'from:', totalAmount);
                } else {
                    console.error('total-payment-amount element not found');
                }
                
                if (periodsList) {
                    if (selectedPeriods.length > 0) {
                        periodsList.textContent = selectedPeriods.join(', ');
                        console.log('Set periods list:', selectedPeriods.join(', '));
                    } else {
                        periodsList.textContent = 'Chưa chọn';
                        console.log('Set periods list: Chưa chọn');
                    }
                } else {
                    console.error('selected-periods-list element not found');
                }
            }
            
            // Format currency
            function formatCurrency(amount) {
                return new Intl.NumberFormat('vi-VN', {
                    style: 'currency',
                    currency: 'VND'
                }).format(amount);
            }
            
            // Handle period checkbox changes
            document.addEventListener('change', function(e) {
                if (e.target.classList.contains('period-checkbox')) {
                    const period = e.target.value;
                    const amount = parseInt(e.target.dataset.amount.replace(/[^\d]/g, ''));
                    
                    if (e.target.checked) {
                        // Check if this period is from current year
                        const currentYear = new Date().getFullYear();
                        const periodYear = parseInt(period.split('/')[1]);
                        
                        if (periodYear !== currentYear) {
                            e.target.checked = false;
                            showWarning('Chỉ có thể chọn kỳ thanh toán của năm hiện tại (' + currentYear + ')', 'Giới hạn chọn kỳ');
                            return;
                        }
                        
                        // Check if already selected
                        if (!selectedPeriods.includes(period)) {
                            selectedPeriods.push(period);
                            totalAmount += amount;
                        }
                    } else {
                        const index = selectedPeriods.indexOf(period);
                        if (index > -1) {
                            selectedPeriods.splice(index, 1);
                            totalAmount -= amount;
                        }
                    }
                    
                    updatePaymentSummary();
                }
            });
            
            // Quick selection buttons
            document.getElementById('select-all-periods').addEventListener('click', function() {
                const currentYear = new Date().getFullYear();
                
                // Reset selection first
                selectedPeriods = [];
                totalAmount = 0;
                
                document.querySelectorAll('.period-checkbox').forEach(checkbox => {
                    const periodYear = parseInt(checkbox.value.split('/')[1]);
                    if (periodYear === currentYear) {
                        checkbox.checked = true;
                        
                        // Manually add to selection
                        const period = checkbox.value;
                        const amount = parseInt(checkbox.dataset.amount.replace(/[^\d]/g, ''));
                        
                        if (!selectedPeriods.includes(period)) {
                            selectedPeriods.push(period);
                            totalAmount += amount;
                        }
                    }
                });
                
                // Update summary
                updatePaymentSummary();
            });
            
            document.getElementById('select-last-3-months').addEventListener('click', function() {
                const currentYear = new Date().getFullYear();
                
                // Reset selection first
                selectedPeriods = [];
                totalAmount = 0;
                
                // Uncheck all first
                document.querySelectorAll('.period-checkbox').forEach(checkbox => {
                    checkbox.checked = false;
                });
                
                // Check last 3 months of current year
                const currentYearCheckboxes = Array.from(document.querySelectorAll('.period-checkbox')).filter(checkbox => {
                    const periodYear = parseInt(checkbox.value.split('/')[1]);
                    return periodYear === currentYear;
                });
                
                for (let i = Math.max(0, currentYearCheckboxes.length - 3); i < currentYearCheckboxes.length; i++) {
                    const checkbox = currentYearCheckboxes[i];
                    checkbox.checked = true;
                    
                    // Manually add to selection
                    const period = checkbox.value;
                    const amount = parseInt(checkbox.dataset.amount.replace(/[^\d]/g, ''));
                    
                    if (!selectedPeriods.includes(period)) {
                        selectedPeriods.push(period);
                        totalAmount += amount;
                    }
                }
                
                // Update summary
                updatePaymentSummary();
            });
            
            document.getElementById('select-overdue').addEventListener('click', function() {
                const currentYear = new Date().getFullYear();
                
                // Reset selection first
                selectedPeriods = [];
                totalAmount = 0;
                
                // Uncheck all first
                document.querySelectorAll('.period-checkbox').forEach(checkbox => {
                    checkbox.checked = false;
                });
                
                // Check overdue periods of current year (first 3 months for demo)
                const overduePeriods = [`T1/${currentYear}`, `T2/${currentYear}`, `T3/${currentYear}`];
                document.querySelectorAll('.period-checkbox').forEach(checkbox => {
                    if (overduePeriods.includes(checkbox.value)) {
                        checkbox.checked = true;
                        
                        // Manually add to selection
                        const period = checkbox.value;
                        const amount = parseInt(checkbox.dataset.amount.replace(/[^\d]/g, ''));
                        
                        if (!selectedPeriods.includes(period)) {
                            selectedPeriods.push(period);
                            totalAmount += amount;
                        }
                    }
                });
                
                // Update summary
                updatePaymentSummary();
            });
            
            document.getElementById('clear-selection').addEventListener('click', function() {
                // Reset selection
                selectedPeriods = [];
                totalAmount = 0;
                
                // Uncheck all checkboxes
                document.querySelectorAll('.period-checkbox').forEach(checkbox => {
                    checkbox.checked = false;
                });
                
                // Update summary
                updatePaymentSummary();
            });
            
            // Close modal buttons
            document.getElementById('close-payment-modal').addEventListener('click', closePaymentModal);
            document.getElementById('cancel-payment').addEventListener('click', closePaymentModal);
            
            // QR payment cancel button
            document.getElementById('qr-cancel-btn').addEventListener('click', hideQRPayment);
            
            // Notification modal event listeners
            document.getElementById('success-ok-btn').addEventListener('click', hideNotification);
            document.getElementById('error-ok-btn').addEventListener('click', hideNotification);
            document.getElementById('warning-ok-btn').addEventListener('click', hideNotification);
            document.getElementById('info-ok-btn').addEventListener('click', hideNotification);
            
            document.getElementById('confirm-ok-btn').addEventListener('click', function() {
                console.log('Confirm OK button clicked');
                hideNotification();
                if (window.confirmCallback) {
                    console.log('Calling confirm callback');
                    window.confirmCallback();
                    window.confirmCallback = null;
                } else {
                    console.error('No confirm callback found');
                }
            });
            
            document.getElementById('confirm-cancel-btn').addEventListener('click', function() {
                hideNotification();
                if (window.cancelCallback) {
                    window.cancelCallback();
                    window.cancelCallback = null;
                }
            });
            
            // Close notification modal when clicking outside
            const notificationModal = document.getElementById('notification-modal');
            if (notificationModal) {
                notificationModal.addEventListener('click', function(e) {
                    if (e.target === this) {
                        hideNotification();
                    }
                });
            }
            
            // Test confirm button
            document.getElementById('test-confirm').addEventListener('click', function() {
                console.log('Test confirm button clicked');
                showConfirm('Đây là test message', 'Test Title', function() {
                    console.log('Test confirm callback executed!');
                    alert('Test confirm callback worked!');
                }, function() {
                    console.log('Test cancel callback executed!');
                    alert('Test cancel callback worked!');
                });
            });
            
            // Helper function to get payment method name
            function getPaymentMethodName(method) {
                const methodNames = {
                    'cash': 'Tiền mặt',
                    'momo': 'Momo',
                    'bank': 'Chuyển khoản',
                    'other': 'Khác'
                };
                return methodNames[method] || method;
            }
            
            // Process direct payment
            function processDirectPayment(method, note) {
                console.log('Processing direct payment:', method);
                
                // Show success message
                const successMessage = `Thanh toán thành công!\n\n` +
                    `Khách hàng: ${document.getElementById('payment-customer-name').textContent}\n` +
                    `Số tiền: ${formatCurrency(totalAmount)}\n` +
                    `Phương thức: ${getPaymentMethodName(method)}\n` +
                    `Kỳ thanh toán: ${selectedPeriods.join(', ')}`;
                
                showSuccess(successMessage, 'Thanh toán thành công', function() {
                    console.log('Payment success callback');
                    closePaymentModal();
                });
            }
            
            // Show QR code payment
            function showQRCodePayment(method, note) {
                console.log('Showing QR code payment for:', method);
                
                // Hide main modal content
                const modalContent = document.querySelector('#payment-modal .bg-white.rounded-lg.shadow-xl');
                if (modalContent) {
                    modalContent.style.display = 'none';
                }
                
                // Show QR content
                const qrContent = document.getElementById('qr-payment-content');
                if (qrContent) {
                    qrContent.style.display = 'block';
                    
                    // Update QR content
                    document.getElementById('qr-payment-text').textContent = `Thanh toán qua ${getPaymentMethodName(method)}`;
                    document.getElementById('qr-amount-text').textContent = formatCurrency(totalAmount);
                    
                    // Generate QR code (simple SVG for demo)
                    const qrCodeContainer = document.getElementById('qr-code-image');
                    if (qrCodeContainer) {
                        qrCodeContainer.innerHTML = `
                            <svg width="200" height="200" viewBox="0 0 200 200">
                                <rect width="200" height="200" fill="white"/>
                                <text x="100" y="100" text-anchor="middle" dy=".3em" font-size="12" fill="#333">
                                    QR Code Demo
                                </text>
                                <text x="100" y="120" text-anchor="middle" dy=".3em" font-size="10" fill="#666">
                                    ${formatCurrency(totalAmount)}
                                </text>
                            </svg>
                        `;
                    }
                    
                    // Simulate payment progress
                    let progress = 0;
                    const progressBar = document.getElementById('qr-progress-bar');
                    const statusText = document.getElementById('qr-status-text');
                    
                    window.qrPaymentInterval = setInterval(() => {
                        progress += 10;
                        if (progressBar) {
                            progressBar.style.width = progress + '%';
                        }
                        
                        if (progress >= 100) {
                            clearInterval(window.qrPaymentInterval);
                            window.qrPaymentInterval = null;
                            
                            // Show success
                            showPaymentSuccess();
                        } else if (progress >= 50) {
                            if (statusText) {
                                statusText.textContent = 'Đang xác nhận thanh toán...';
                            }
                        }
                    }, 500);
                }
            }
            
            // Show payment success
            function showPaymentSuccess() {
                console.log('Showing payment success');
                
                // Hide QR content
                const qrContent = document.getElementById('qr-payment-content');
                if (qrContent) {
                    qrContent.style.display = 'none';
                }
                
                // Show success content
                const successContent = document.getElementById('payment-success-content');
                if (successContent) {
                    successContent.style.display = 'block';
                    
                    // Update success info
                    document.getElementById('success-customer-name').textContent = document.getElementById('payment-customer-name').textContent;
                    document.getElementById('success-amount').textContent = formatCurrency(totalAmount);
                    
                    // Auto close after 1 second
                    setTimeout(() => {
                        closePaymentModal();
                    }, 1000);
                }
            }
            
            // Hide QR payment
            window.hideQRPayment = function() {
                console.log('hideQRPayment called');
                
                // Stop payment simulation
                if (window.qrPaymentInterval) {
                    clearInterval(window.qrPaymentInterval);
                    window.qrPaymentInterval = null;
                }
                
                // Show main modal content
                const modalContent = document.querySelector('#payment-modal .bg-white.rounded-lg.shadow-xl');
                if (modalContent) {
                    modalContent.style.display = 'block';
                }
                
                // Hide QR content
                const qrContent = document.getElementById('qr-payment-content');
                if (qrContent) {
                    qrContent.style.display = 'none';
                }
            };
            
            // Confirm payment
            document.getElementById('confirm-payment').addEventListener('click', function() {
                console.log('Confirm payment button clicked');
                if (selectedPeriods.length === 0) {
                    showWarning('Vui lòng chọn ít nhất một kỳ thanh toán', 'Thiếu thông tin');
                    return;
                }
                
                const paymentMethod = document.querySelector('input[name="payment-method"]:checked').value;
                const note = document.getElementById('payment-note').value;
                
                console.log('Payment details:', { selectedPeriods, totalAmount, paymentMethod, note });
                
                // Show confirmation dialog
                const confirmMessage = `Khách hàng: ${document.getElementById('payment-customer-name').textContent}\n\n` +
                    `Kỳ thanh toán: ${selectedPeriods.join(', ')}\n` +
                    `Tổng tiền: ${formatCurrency(totalAmount)}\n` +
                    `Phương thức: ${getPaymentMethodName(paymentMethod)}\n` +
                    `Ghi chú: ${note || 'Không có'}`;
                
                console.log('Showing confirmation dialog with message:', confirmMessage);
                showConfirm(confirmMessage, 'Xác nhận thanh toán', function() {
                    console.log('Payment confirmed! Processing payment...');
                    // Process payment based on method
                    if (paymentMethod === 'cash' || paymentMethod === 'bank' || paymentMethod === 'other') {
                        console.log('Processing direct payment:', paymentMethod);
                        // Direct payment methods
                        processDirectPayment(paymentMethod, note);
                    } else if (paymentMethod === 'momo' || paymentMethod === 'payoo') {
                        console.log('Processing online payment:', paymentMethod);
                        // Online payment methods - show QR code
                        showQRCodePayment(paymentMethod, note);
                    }
                }, function() {
                    console.log('Payment cancelled');
                });
            });
            
            // Process direct payment methods
            function processDirectPayment(paymentMethod, note) {
                console.log('processDirectPayment called with:', { paymentMethod, note });
                console.log('Processing direct payment:', {
                    customer: document.getElementById('payment-customer-name').textContent,
                    periods: selectedPeriods,
                    amount: totalAmount,
                    method: paymentMethod,
                    note: note
                });
                
                // Simulate processing delay
                showPaymentProcessing();
                
                setTimeout(() => {
                    console.log('Processing completed, showing success');
                    hidePaymentProcessing();
                    showPaymentSuccess();
                }, 2000);
            }
            
            // Show QR code for online payment
            function showQRCodePayment(paymentMethod, note) {
                console.log('showQRCodePayment called with:', { paymentMethod, note });
                const modal = document.getElementById('payment-modal');
                const modalContent = modal.querySelector('.bg-white.rounded-lg.shadow-xl'); // Find the main modal content
                
                console.log('Modal elements:', { modal, modalContent });
                
                // Hide current content
                if (modalContent) {
                    modalContent.style.display = 'none';
                    console.log('Hidden modal content');
                } else {
                    console.error('Modal content not found');
                }
                
                // Show QR code content
                const qrContent = document.getElementById('qr-payment-content');
                if (qrContent) {
                    qrContent.style.display = 'block';
                    console.log('Showed QR content');
                } else {
                    console.error('QR content not found');
                }
                
                // Generate QR code based on payment method
                const qrCode = document.getElementById('qr-code-image');
                const qrText = document.getElementById('qr-payment-text');
                const amountText = document.getElementById('qr-amount-text');
                
                if (paymentMethod === 'momo') {
                    // Generate Momo QR Code (yellow background)
                    qrCode.innerHTML = `
                        <svg width="200" height="200" viewBox="0 0 200 200" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <rect width="200" height="200" fill="white"/>
                            <rect x="10" y="10" width="180" height="180" fill="#FFD700" rx="10"/>
                            <rect x="20" y="20" width="160" height="160" fill="white" rx="8"/>
                            <rect x="30" y="30" width="140" height="140" fill="#FFD700" rx="6"/>
                            <rect x="40" y="40" width="120" height="120" fill="white" rx="4"/>
                            <rect x="50" y="50" width="100" height="100" fill="#000"/>
                            <rect x="60" y="60" width="80" height="80" fill="white"/>
                            <rect x="70" y="70" width="60" height="60" fill="#000"/>
                            <rect x="80" y="80" width="40" height="40" fill="white"/>
                            <rect x="90" y="90" width="20" height="20" fill="#000"/>
                            <circle cx="100" cy="100" r="8" fill="#FFD700"/>
                            <text x="100" y="115" text-anchor="middle" fill="#000" font-size="10" font-weight="bold">MOMO</text>
                        </svg>
                    `;
                    qrText.textContent = 'Quét mã QR để thanh toán qua Momo';
                    amountText.textContent = `Số tiền: ${formatCurrency(totalAmount)}`;
                } else if (paymentMethod === 'payoo') {
                    // Generate Payoo QR Code (blue background)
                    qrCode.innerHTML = `
                        <svg width="200" height="200" viewBox="0 0 200 200" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <rect width="200" height="200" fill="white"/>
                            <rect x="10" y="10" width="180" height="180" fill="#007FFF" rx="10"/>
                            <rect x="20" y="20" width="160" height="160" fill="white" rx="8"/>
                            <rect x="30" y="30" width="140" height="140" fill="#007FFF" rx="6"/>
                            <rect x="40" y="40" width="120" height="120" fill="white" rx="4"/>
                            <rect x="50" y="50" width="100" height="100" fill="#000"/>
                            <rect x="60" y="60" width="80" height="80" fill="white"/>
                            <rect x="70" y="70" width="60" height="60" fill="#000"/>
                            <rect x="80" y="80" width="40" height="40" fill="white"/>
                            <rect x="90" y="90" width="20" height="20" fill="#000"/>
                            <circle cx="100" cy="100" r="8" fill="#007FFF"/>
                            <text x="100" y="115" text-anchor="middle" fill="#000" font-size="10" font-weight="bold">PAYOO</text>
                        </svg>
                    `;
                    qrText.textContent = 'Quét mã QR để thanh toán qua Payoo';
                    amountText.textContent = `Số tiền: ${formatCurrency(totalAmount)}`;
                }
                
                // Start payment simulation
                startQRPaymentSimulation(paymentMethod, note);
            }
            
            // Simulate QR payment process
            function startQRPaymentSimulation(paymentMethod, note) {
                const statusText = document.getElementById('qr-status-text');
                const progressBar = document.getElementById('qr-progress-bar');
                const cancelBtn = document.getElementById('qr-cancel-btn');
                
                let progress = 0;
                const interval = setInterval(() => {
                    progress += Math.random() * 15;
                    if (progress >= 100) {
                        progress = 100;
                        clearInterval(interval);
                        
                        // Payment completed
                        statusText.textContent = 'Thanh toán thành công!';
                        statusText.className = 'text-green-600 font-semibold';
                        progressBar.style.width = '100%';
                        progressBar.className = 'bg-green-500 h-3 rounded-full transition-all duration-500';
                        
                        // Hide cancel button
                        cancelBtn.style.display = 'none';
                        
                        // Show success and redirect after 2 seconds
                        setTimeout(() => {
                            hideQRPayment();
                            showPaymentSuccess();
                        }, 2000);
                    } else {
                        statusText.textContent = 'Đang xử lý thanh toán...';
                        progressBar.style.width = progress + '%';
                    }
                }, 500);
                
                // Store interval for cancellation
                window.qrPaymentInterval = interval;
            }
            
            // Hide QR payment and return to main modal
            function hideQRPayment() {
                const modal = document.getElementById('payment-modal');
                const modalContent = modal.querySelector('.bg-white.rounded-lg.shadow-xl'); // Find the main modal content
                const qrContent = document.getElementById('qr-payment-content');
                
                // Stop payment simulation if running
                if (window.qrPaymentInterval) {
                    clearInterval(window.qrPaymentInterval);
                    window.qrPaymentInterval = null;
                }
                
                // Show main content
                if (modalContent) {
                    modalContent.style.display = 'block';
                }
                if (qrContent) {
                    qrContent.style.display = 'none';
                }
                
                // Reset QR elements
                document.getElementById('qr-status-text').textContent = 'Đang xử lý thanh toán...';
                document.getElementById('qr-status-text').className = 'text-blue-600 font-semibold';
                document.getElementById('qr-progress-bar').style.width = '0%';
                document.getElementById('qr-progress-bar').className = 'bg-blue-500 h-3 rounded-full transition-all duration-500';
                document.getElementById('qr-cancel-btn').style.display = 'block';
            }
            
            // Show payment processing overlay
            function showPaymentProcessing() {
                const modal = document.getElementById('payment-modal');
                const processingOverlay = document.getElementById('payment-processing-overlay');
                processingOverlay.style.display = 'flex';
            }
            
            // Hide payment processing overlay
            function hidePaymentProcessing() {
                const processingOverlay = document.getElementById('payment-processing-overlay');
                processingOverlay.style.display = 'none';
            }
            
            // Show payment success screen
            function showPaymentSuccess() {
                console.log('showPaymentSuccess called');
                const modal = document.getElementById('payment-modal');
                const modalContent = modal.querySelector('.bg-white.rounded-lg.shadow-xl'); // Find the main modal content
                const qrContent = document.getElementById('qr-payment-content');
                
                console.log('Modal elements:', { modal, modalContent, qrContent });
                
                // Hide all other content
                if (modalContent) {
                    modalContent.style.display = 'none';
                    console.log('Hidden main modal content');
                }
                if (qrContent) {
                    qrContent.style.display = 'none';
                    console.log('Hidden QR content');
                }
                
                // Show success content
                const successContent = document.getElementById('payment-success-content');
                if (successContent) {
                    successContent.style.display = 'block';
                    console.log('Showed success content');
                } else {
                    console.error('Success content not found');
                }
                
                // Populate success data
                document.getElementById('success-customer-name').textContent = document.getElementById('payment-customer-name').textContent;
                document.getElementById('success-amount').textContent = formatCurrency(totalAmount);
                document.getElementById('success-periods').textContent = selectedPeriods.join(', ');
                document.getElementById('success-method').textContent = getPaymentMethodName(document.querySelector('input[name="payment-method"]:checked').value);
                document.getElementById('success-note').textContent = document.getElementById('payment-note').value || 'Không có';
                
                console.log('Success data populated');
                
                // Auto close after 1 second
                console.log('Setting auto-close timer for 1 second');
                setTimeout(() => {
                    console.log('Auto-close timer triggered');
                    closePaymentModal();
                    // Không reload lại trang, chỉ đóng modal
                }, 1000);
            }
            
            // Get payment method name
            function getPaymentMethodName(method) {
                const methods = {
                    'cash': 'Tiền mặt',
                    'momo': 'Momo',
                    'bank': 'Chuyển khoản',
                    'other': 'Khác'
                };
                return methods[method] || method;
            }
            
            // Add event listeners for modal close buttons
            document.getElementById('close-payment-modal').addEventListener('click', function() {
                console.log('Close payment modal button clicked');
                closePaymentModal();
            });
            
            document.getElementById('cancel-payment').addEventListener('click', function() {
                console.log('Cancel payment button clicked');
                closePaymentModal();
            });
            
            // Add event delegation for collect payment buttons
            document.addEventListener('click', function(e) {
                if (e.target.classList.contains('collect-payment')) {
                    e.preventDefault();
                    
                    let customerData = {};
                    
                    // Check if it's desktop view (table row)
                    const row = e.target.closest('tr');
                    if (row && row.cells && row.cells.length >= 6) {
                        // Desktop view - get data from table cells
                        customerData = {
                            code: row.cells[2].textContent.trim(),
                            name: row.cells[3].textContent.trim(),
                            address: row.cells[4].textContent.trim(),
                            totalDebt: row.cells[5].textContent.trim()
                        };
                    } else {
                        // Mobile view - get data from mobile card
                        const mobileCard = e.target.closest('.mobile-card');
                        if (mobileCard) {
                            const title = mobileCard.querySelector('.mobile-card-title');
                            const codeElement = mobileCard.querySelector('.mobile-card-row:nth-child(1) .mobile-card-value');
                            const amountElement = mobileCard.querySelector('.mobile-card-row:nth-child(2) .mobile-card-value');
                            const addressElement = mobileCard.querySelector('.mobile-card-row:nth-child(3) .mobile-card-value');
                            
                            customerData = {
                                code: codeElement ? codeElement.textContent.trim() : 'KH001',
                                name: title ? title.textContent.trim() : 'Khách hàng',
                                address: addressElement ? addressElement.textContent.trim() : 'Địa chỉ',
                                totalDebt: amountElement ? amountElement.textContent.trim() : '0 ₫'
                            };
                        } else {
                            // Fallback data
                            customerData = {
                                code: 'KH001',
                                name: 'Khách hàng',
                                address: 'Địa chỉ',
                                totalDebt: '35.000 ₫'
                            };
                        }
                    }
                    
                    console.log('Opening payment modal with customer data:', customerData);
                    openPaymentModal(customerData);
                }
            });
        });
            </script>
        
        <!-- Contract Filter Script -->
        <script>
            // Wait for DOM to be ready
            document.addEventListener('DOMContentLoaded', function() {
                console.log('Contract filter script loaded');
                
                // Contract status filter function
                function filterContracts(status) {
                    console.log('Filtering contracts by status:', status);
                    
                    // Filter desktop table rows
                    const tableRows = document.querySelectorAll('#contracts-content .contract-row');
                    let visibleCount = 0;
                    
                    tableRows.forEach(row => {
                        const rowStatus = row.getAttribute('data-status');
                        const shouldShow = status === 'all' || rowStatus === status;
                        
                        if (shouldShow) {
                            row.style.display = '';
                            visibleCount++;
                        } else {
                            row.style.display = 'none';
                        }
                    });
                    
                    // Filter mobile cards
                    const mobileCards = document.querySelectorAll('#contracts-content .mobile-card');
                    mobileCards.forEach(card => {
                        const cardStatus = card.getAttribute('data-status');
                        const shouldShow = status === 'all' || cardStatus === status;
                        
                        if (shouldShow) {
                            card.style.display = '';
                        } else {
                            card.style.display = 'none';
                        }
                    });
                    
                    console.log('Visible contracts:', visibleCount);
                    return visibleCount;
                }
                
                // Add event listeners for contract status filter
                const contractFilterRadios = document.querySelectorAll('input[name="contract-status-filter"]');
                console.log('Found contract filter radios:', contractFilterRadios.length);
                
                contractFilterRadios.forEach(radio => {
                    radio.addEventListener('change', function() {
                        console.log('Radio changed:', this.value);
                        const status = this.value;
                        const visibleCount = filterContracts(status);
                        
                        // Update pagination
                        const paginationStart = document.getElementById('contract-pagination-start');
                        const paginationEnd = document.getElementById('contract-pagination-end');
                        const paginationTotal = document.getElementById('contract-pagination-total');
                        
                        if (paginationStart) paginationStart.textContent = visibleCount > 0 ? '1' : '0';
                        if (paginationEnd) paginationEnd.textContent = visibleCount.toString();
                        if (paginationTotal) paginationTotal.textContent = visibleCount.toString();
                    });
                });
                
                // Add event listeners for contract detail links
                const contractDetailLinks = document.querySelectorAll('.view-contract-detail');
                console.log('Found contract detail links:', contractDetailLinks.length);
                
                contractDetailLinks.forEach(link => {
                    link.addEventListener('click', function(e) {
                        e.preventDefault();
                        console.log('Contract detail clicked');
                        
                        // Hide all content pages
                        const allContentPages = document.querySelectorAll('.web-content-page');
                        allContentPages.forEach(page => {
                            page.classList.add('hidden');
                        });
                        
                        // Show contract detail page
                        const contractDetailPage = document.getElementById('contract-detail-content');
                        if (contractDetailPage) {
                            contractDetailPage.classList.remove('hidden');
                            console.log('Contract detail page shown');
                            
                            // Initialize contract detail page after a short delay
                            setTimeout(() => {
                                initializeContractDetailPage();
                            }, 100);
                        } else {
                            console.error('Contract detail page not found');
                        }
                        
                        // Update breadcrumb
                        const pageNameBreadcrumb = document.getElementById('page-name-breadcrumb');
                        if (pageNameBreadcrumb) {
                            pageNameBreadcrumb.textContent = 'CHI TIẾT HỢP ĐỒNG';
                        }
                        
                        // Update active navigation link
                        const currentSidebar = document.querySelector('.sidebar:not(.hidden)');
                        if (currentSidebar) {
                            currentSidebar.querySelectorAll('.web-nav-link').forEach(l => {
                                l.classList.remove('bg-blue-50', 'text-blue-700', 'font-semibold');
                                l.classList.add('text-gray-600', 'hover:bg-gray-100');
                            });
                            
                            // Find and activate the contracts link
                            const contractsLink = currentSidebar.querySelector('[data-target="contracts-content"]');
                            if (contractsLink) {
                                contractsLink.classList.add('bg-blue-50', 'text-blue-700', 'font-semibold');
                                contractsLink.classList.remove('text-gray-600', 'hover:bg-gray-100');
                            }
                        }
                    });
                });
                
                // Add event listener for back to contract list button
                const backToContractListBtn = document.getElementById('back-to-contract-list');
                if (backToContractListBtn) {
                    backToContractListBtn.addEventListener('click', function(e) {
                        e.preventDefault();
                        console.log('Back to contract list clicked');
                        
                        // Hide all content pages
                        const allContentPages = document.querySelectorAll('.web-content-page');
                        allContentPages.forEach(page => {
                            page.classList.add('hidden');
                        });
                        
                        // Show contracts list page
                        const contractsPage = document.getElementById('contracts-content');
                        if (contractsPage) {
                            contractsPage.classList.remove('hidden');
                            console.log('Contracts list page shown');
                        } else {
                            console.error('Contracts list page not found');
                        }
                        
                        // Update breadcrumb
                        const pageNameBreadcrumb = document.getElementById('page-name-breadcrumb');
                        if (pageNameBreadcrumb) {
                            pageNameBreadcrumb.textContent = 'HỢP ĐỒNG';
                        }
                        
                        // Update active navigation link
                        const currentSidebar = document.querySelector('.sidebar:not(.hidden)');
                        if (currentSidebar) {
                            currentSidebar.querySelectorAll('.web-nav-link').forEach(l => {
                                l.classList.remove('bg-blue-50', 'text-blue-700', 'font-semibold');
                                l.classList.add('text-gray-600', 'hover:bg-gray-100');
                            });
                            
                            // Find and activate the contracts link
                            const contractsLink = currentSidebar.querySelector('[data-target="contracts-content"]');
                            if (contractsLink) {
                                contractsLink.classList.add('bg-blue-50', 'text-blue-700', 'font-semibold');
                                contractsLink.classList.remove('text-gray-600', 'hover:bg-gray-100');
                            }
                        }
                    });
                }
                
                // Add event listeners for contract detail tabs
                function initializeContractTabs() {
                    const contractDetailTabs = document.querySelectorAll('.contract-detail-tab');
                    console.log('Found contract detail tabs:', contractDetailTabs.length);
                    
                    contractDetailTabs.forEach(tab => {
                        tab.addEventListener('click', function(e) {
                            e.preventDefault();
                            e.stopPropagation();
                            const targetTab = this.getAttribute('data-target');
                            console.log('Contract detail tab clicked:', targetTab);
                            
                            // Remove active class from all tabs
                            contractDetailTabs.forEach(t => {
                                t.classList.remove('active');
                                t.classList.remove('text-blue-600', 'border-blue-600');
                                t.classList.add('text-gray-500');
                            });
                            
                            // Add active class to clicked tab
                            this.classList.add('active');
                            this.classList.remove('text-gray-500');
                            
                            // Hide all tab contents
                            const tabContents = document.querySelectorAll('.contract-detail-tab-content');
                            tabContents.forEach(content => {
                                content.classList.add('hidden');
                                console.log('Hiding tab content:', content.id);
                            });
                            
                            // Show target tab content
                            const targetContent = document.getElementById(targetTab);
                            if (targetContent) {
                                targetContent.classList.remove('hidden');
                                console.log('Tab content shown:', targetTab);
                                
                                // Force reflow for mobile
                                targetContent.style.display = 'block';
                                targetContent.offsetHeight; // Trigger reflow
                                targetContent.style.display = '';
                            } else {
                                console.error('Tab content not found:', targetTab);
                            }
                        });
                    });
                }
                
                // Initialize tabs when contract detail page is shown
                function initializeContractDetailPage() {
                    console.log('Initializing contract detail page...');
                    
                    // Initialize tabs
                    initializeContractTabs();
                    
                    // Show first tab by default
                    const firstTab = document.querySelector('.contract-detail-tab.active');
                    const firstTabContent = document.querySelector('.contract-detail-tab-content:not(.hidden)');
                    
                    if (firstTab && firstTabContent) {
                        console.log('First tab is active:', firstTab.getAttribute('data-target'));
                        console.log('First tab content is visible:', firstTabContent.id);
                    }
                    
                    // Ensure mobile payment cards are visible
                    const mobilePaymentCards = document.querySelector('#contract-tab-payments .md\\:hidden.space-y-3');
                    if (mobilePaymentCards) {
                        console.log('Mobile payment cards found:', mobilePaymentCards.children.length, 'cards');
                        mobilePaymentCards.style.display = 'block';
                    } else {
                        console.log('Mobile payment cards not found');
                    }
                    
                    // Ensure desktop table is hidden on mobile
                    const desktopTable = document.querySelector('#contract-tab-payments .hidden.md\\:block');
                    if (desktopTable) {
                        console.log('Desktop table found');
                    }
                }
                

            
            // Initialize counts
            const allContracts = document.querySelectorAll('#contracts-content .contract-row');
                let allCount = 0;
                let activeCount = 0;
                let pausedCount = 0;
                let endedCount = 0;
                
                allContracts.forEach(contract => {
                    const status = contract.getAttribute('data-status');
                    allCount++;
                    if (status === 'active') activeCount++;
                    else if (status === 'paused') pausedCount++;
                    else if (status === 'ended') endedCount++;
                });
                
                console.log('Initial counts - All:', allCount, 'Active:', activeCount, 'Paused:', pausedCount, 'Ended:', endedCount);
                
                // Update radio button counts
                const allRadio = document.querySelector(`input[name="contract-status-filter"][value="all"]`);
                const activeRadio = document.querySelector(`input[name="contract-status-filter"][value="active"]`);
                const pausedRadio = document.querySelector(`input[name="contract-status-filter"][value="paused"]`);
                const endedRadio = document.querySelector(`input[name="contract-status-filter"][value="ended"]`);
                
                if (allRadio) {
                    const textSpan = allRadio.parentElement.querySelector('span');
                    if (textSpan) {
                        textSpan.textContent = `Tất cả | ${allCount}`;
                    }
                }
                
                if (activeRadio) {
                    const textSpan = activeRadio.parentElement.querySelector('span');
                    if (textSpan) {
                        textSpan.textContent = `Đang hoạt động | ${activeCount}`;
                    }
                }
                
                if (pausedRadio) {
                    const textSpan = pausedRadio.parentElement.querySelector('span');
                    if (textSpan) {
                        textSpan.textContent = `Tạm dừng | ${pausedCount}`;
                    }
                }
                
                if (endedRadio) {
                    const textSpan = endedRadio.parentElement.querySelector('span');
                    if (textSpan) {
                        textSpan.textContent = `Đã kết thúc | ${endedCount}`;
                    }
                }
            });
            
            // Contract detail payment functionality
            document.addEventListener('DOMContentLoaded', function() {
                // Service data for add contract modal
                const serviceData = {
                    recurring: [
                        { id: 'DV001', name: 'Thu gom rác thải sinh hoạt', price: '35.000', unit: 'tháng' },
                        { id: 'DV002', name: 'Thu gom rác thải công nghiệp', price: '120.000', unit: 'tháng' },
                        { id: 'DV003', name: 'Thu gom rác thải y tế', price: '500.000', unit: 'tháng' }
                    ],
                    'one-time': [
                        { id: 'DV004', name: 'Thu dọn xà bần', price: '2.000.000', unit: 'lần' },
                        { id: 'DV005', name: 'Thu gom rác thải theo yêu cầu', price: '500.000', unit: 'lần' },
                        { id: 'DV006', name: 'Vệ sinh công nghiệp', price: '1.500.000', unit: 'lần' },
                        { id: 'DV007', name: 'Xử lý rác thải nguy hại', price: '3.000.000', unit: 'lần' }
                    ]
                };
                
                // Helper functions for add contract modal
                // Format currency function
                function formatCurrency(amount) {
                    return new Intl.NumberFormat('vi-VN', {
                        style: 'currency',
                        currency: 'VND'
                    }).format(amount);
                }
                
                function updateServiceOptions(serviceType) {
                    const serviceDetailSelect = document.getElementById('contract-service-detail');
                    if (!serviceDetailSelect) {
                        console.error('Service detail select not found');
                        return;
                    }
                    
                    console.log('Updating service options for type:', serviceType);
                    
                    serviceDetailSelect.innerHTML = '<option value="">-- Chọn dịch vụ --</option>';
                    
                    if (serviceType && serviceData[serviceType]) {
                        console.log('Available services:', serviceData[serviceType]);
                        serviceData[serviceType].forEach(service => {
                            const option = document.createElement('option');
                            option.value = service.id;
                            option.textContent = `${service.name} - ${service.price} ₫/${service.unit}`;
                            option.dataset.price = service.price;
                            option.dataset.unit = service.unit;
                            serviceDetailSelect.appendChild(option);
                            console.log('Added service option:', service.name);
                        });
                    } else {
                        console.log('No services found for type:', serviceType);
                    }
                }
                
                function updateServiceDetailsVisibility(serviceType) {
                    const serviceDetailsContainer = document.getElementById('service-details-container');
                    const recurringDetails = document.getElementById('recurring-service-details');
                    const oneTimeDetails = document.getElementById('one-time-service-details');
                    
                    if (!serviceDetailsContainer) return;
                    
                    if (serviceType === 'recurring') {
                        serviceDetailsContainer.classList.remove('hidden');
                        if (recurringDetails) recurringDetails.classList.remove('hidden');
                        if (oneTimeDetails) oneTimeDetails.classList.add('hidden');
                    } else if (serviceType === 'one-time') {
                        serviceDetailsContainer.classList.remove('hidden');
                        if (recurringDetails) recurringDetails.classList.add('hidden');
                        if (oneTimeDetails) oneTimeDetails.classList.remove('hidden');
                    } else {
                        serviceDetailsContainer.classList.add('hidden');
                        if (recurringDetails) recurringDetails.classList.add('hidden');
                        if (oneTimeDetails) oneTimeDetails.classList.add('hidden');
                    }
                }
                
                function updateContractSummary() {
                    const totalValueSpan = document.getElementById('contract-total-value');
                    const durationSpan = document.getElementById('contract-duration');
                    const serviceDetailSelect = document.getElementById('contract-service-detail');
                    const serviceTypeSelect = document.getElementById('contract-service-type');
                    const startDateInput = document.getElementById('contract-start-date');
                    const endDateInput = document.getElementById('contract-end-date');
                    const noEndDateCheckbox = document.getElementById('contract-no-end-date');
                    const oneTimeUnitPrice = document.getElementById('one-time-unit-price');
                    const oneTimeQuantity = document.getElementById('one-time-quantity');
                    
                    console.log('=== updateContractSummary called ===');
                    console.log('Elements found:', { 
                        totalValueSpan: !!totalValueSpan, 
                        durationSpan: !!durationSpan, 
                        serviceDetailSelect: !!serviceDetailSelect, 
                        serviceTypeSelect: !!serviceTypeSelect,
                        oneTimeUnitPrice: !!oneTimeUnitPrice,
                        oneTimeQuantity: !!oneTimeQuantity
                    });
                    
                    if (!totalValueSpan || !durationSpan) {
                        console.error('Required elements not found');
                        return;
                    }
                    
                    // Calculate total value
                    const selectedService = serviceDetailSelect.value;
                    const serviceType = serviceTypeSelect.value;
                    let totalValue = 0;
                    
                    console.log('Selected service:', selectedService, 'Service type:', serviceType);
                    
                    if (selectedService) {
                        if (serviceType === 'recurring') {
                            console.log('Processing recurring service...');
                            // For recurring services, use the predefined price
                            const selectedOption = serviceDetailSelect.querySelector(`option[value="${selectedService}"]`);
                            console.log('Selected option:', selectedOption);
                            
                            if (selectedOption) {
                                const priceString = selectedOption.dataset.price;
                                console.log('Price string:', priceString);
                                
                                // Parse price - handle both "2.000.000" and "2000000" formats
                                const price = parseInt(priceString.replace(/[^\d]/g, ''));
                                console.log('Parsed price:', price);
                                
                                // Calculate based on duration
                                if (startDateInput.value) {
                                    const startDate = new Date(startDateInput.value);
                                    const endDate = noEndDateCheckbox.checked ? null : new Date(endDateInput.value);
                                    
                                    if (startDate && (endDate || noEndDateCheckbox.checked)) {
                                        if (noEndDateCheckbox.checked) {
                                            // Long-term contract, show monthly price
                                            totalValue = price;
                                            console.log('Long-term contract, total value:', totalValue);
                                        } else if (endDateInput.value) {
                                            // Calculate months between dates
                                            const months = (endDate.getFullYear() - startDate.getFullYear()) * 12 + 
                                                         (endDate.getMonth() - startDate.getMonth());
                                            totalValue = price * Math.max(1, months);
                                            console.log('Fixed term contract, months:', months, 'total value:', totalValue);
                                        }
                                    }
                                } else {
                                    console.log('No start date provided');
                                }
                            }
                        } else if (serviceType === 'one-time') {
                            console.log('Processing one-time service...');
                            // For one-time services, calculate based on unit price and quantity
                            if (oneTimeUnitPrice && oneTimeQuantity) {
                                const unitPriceString = oneTimeUnitPrice.value.replace(/[^\d]/g, '');
                                const quantity = parseInt(oneTimeQuantity.value) || 1;
                                
                                console.log('One-time unit price string:', unitPriceString, 'Quantity:', quantity);
                                
                                if (unitPriceString) {
                                    const unitPrice = parseInt(unitPriceString);
                                    totalValue = unitPrice * quantity;
                                    console.log('One-time calculation:', unitPrice, '*', quantity, '=', totalValue);
                                } else {
                                    console.log('No unit price provided');
                                }
                            } else {
                                console.log('One-time price or quantity elements not found');
                            }
                        }
                    } else {
                        console.log('No service selected');
                    }
                    
                    console.log('Final total value:', totalValue);
                    totalValueSpan.textContent = formatCurrency(totalValue);
                    
                    // Update duration
                    if (serviceType === 'one-time') {
                        durationSpan.textContent = 'Một lần';
                    } else if (startDateInput.value) {
                        if (noEndDateCheckbox.checked) {
                            durationSpan.textContent = 'Dài hạn';
                        } else if (endDateInput.value) {
                            const startDate = new Date(startDateInput.value);
                            const endDate = new Date(endDateInput.value);
                            const months = (endDate.getFullYear() - startDate.getFullYear()) * 12 + 
                                         (endDate.getMonth() - startDate.getMonth());
                            durationSpan.textContent = `${months} tháng`;
                        } else {
                            durationSpan.textContent = 'Chưa xác định';
                        }
                    } else {
                        durationSpan.textContent = 'Chưa xác định';
                    }
                }
                
                function resetAddContractForm() {
                    console.log('=== resetAddContractForm called ===');
                    
                    const addContractForm = document.getElementById('add-contract-form');
                    const endDateInput = document.getElementById('contract-end-date');
                    const oneTimeUnitPrice = document.getElementById('one-time-unit-price');
                    const oneTimeQuantity = document.getElementById('one-time-quantity');
                    const oneTimeDescription = document.getElementById('one-time-description');
                    
                    if (addContractForm) {
                        addContractForm.reset();
                        console.log('Form reset');
                    }
                    
                    // Reset one-time service fields
                    if (oneTimeUnitPrice) oneTimeUnitPrice.value = '';
                    if (oneTimeQuantity) oneTimeQuantity.value = '1';
                    if (oneTimeDescription) oneTimeDescription.value = '';
                    
                    // Reset service options
                    updateServiceOptions('');
                    updateServiceDetailsVisibility('');
                    
                    // Reset address
                    const addressInput = document.getElementById('contract-address');
                    if (addressInput) {
                        addressInput.value = '';
                    }
                    hideCustomerAddresses();
                    
                    // Reset summary
                    const totalValueSpan = document.getElementById('contract-total-value');
                    const durationSpan = document.getElementById('contract-duration');
                    if (totalValueSpan) totalValueSpan.textContent = '0 ₫';
                    if (durationSpan) durationSpan.textContent = 'Chưa xác định';
                    
                    // Enable end date input
                    if (endDateInput) {
                        endDateInput.disabled = false;
                    }
                    
                    // Reset form validation
                    validateForm();
                    
                    // Ensure save button has click handler
                    const saveButton = document.getElementById('save-contract');
                    if (saveButton) {
                        saveButton.removeAttribute('data-click-handler-added');
                        console.log('Reset save button click handler flag');
                    }
                }
                
                function handleContractSubmission() {
                    console.log('=== handleContractSubmission called ===');
                    
                    const contractData = {
                        customer: document.getElementById('contract-customer-select').value,
                        address: document.getElementById('contract-address').value,
                        serviceType: document.getElementById('contract-service-type').value,
                        serviceDetail: document.getElementById('contract-service-detail').value,
                        startDate: document.getElementById('contract-start-date').value,
                        endDate: document.getElementById('contract-end-date').value,
                        noEndDate: document.getElementById('contract-no-end-date').checked,
                        note: document.getElementById('contract-note').value,
                        assignedTo: document.getElementById('contract-assigned-to').value
                    };
                    
                    console.log('Contract data:', contractData);
                    
                    // Validate required fields
                    if (!contractData.customer || !contractData.address || !contractData.serviceType || 
                        !contractData.serviceDetail || !contractData.startDate) {
                        showWarning('Vui lòng điền đầy đủ thông tin bắt buộc', 'Thiếu thông tin');
                        return;
                    }
                    
                    // Get customer and service info before form reset
                    const customerSelect = document.getElementById('contract-customer-select');
                    const serviceDetailSelect = document.getElementById('contract-service-detail');
                    const totalValueSpan = document.getElementById('contract-total-value');
                    
                    console.log('Customer select text:', customerSelect.selectedOptions[0].text);
                    console.log('Service detail text:', serviceDetailSelect.selectedOptions[0].text);
                    console.log('Total value text:', totalValueSpan.textContent);
                    
                    const customerName = customerSelect.selectedOptions[0].text.split(' - ')[1] || customerSelect.selectedOptions[0].text;
                    const serviceName = serviceDetailSelect.selectedOptions[0].text;
                    const totalValue = totalValueSpan.textContent;
                    
                    console.log('Extracted customer name:', customerName);
                    console.log('Extracted service name:', serviceName);
                    console.log('Extracted total value:', totalValue);
                    
                    // Show success message
                    console.log('Preparing success message...');
                    const successMessage = `Hợp đồng đã được tạo thành công!\n\n` +
                        `Mã hợp đồng: HD${Date.now().toString().slice(-6)}\n` +
                        `Khách hàng: ${customerSelect.selectedOptions[0].text}\n` +
                        `Dịch vụ: ${serviceName}\n` +
                        `Tổng giá trị: ${totalValue}`;
                    
                    console.log('Success message:', successMessage);
                    console.log('Calling showSuccess...');
                    
                    // Prepare payment data for one-time services
                    let paymentData = null;
                    if (contractData.serviceType === 'one-time') {
                        paymentData = {
                            code: contractData.customer,
                            name: customerName,
                            address: contractData.address,
                            totalDebt: totalValue,
                            serviceType: 'one-time',
                            contractData: contractData
                        };
                        console.log('Payment data prepared:', paymentData);
                    }
                    
                    showSuccess(successMessage, 'Tạo hợp đồng thành công', function() {
                        console.log('Success callback executed');
                        
                        // Close add contract modal
                        const addContractModal = document.getElementById('add-contract-modal');
                        if (addContractModal) {
                            addContractModal.classList.add('hidden');
                            console.log('Add contract modal closed');
                        }
                        
                        // Reset form
                        resetAddContractForm();
                        
                        // If it's a one-time service, show payment modal
                        if (contractData.serviceType === 'one-time' && paymentData) {
                            console.log('One-time service detected, showing payment modal...');
                            console.log('Payment data for modal:', paymentData);
                            setTimeout(() => {
                                console.log('About to call openPaymentModal...');
                                if (window.openPaymentModal) {
                                    window.openPaymentModal(paymentData);
                                    console.log('openPaymentModal called successfully');
                                } else {
                                    console.error('openPaymentModal function not found');
                                }
                            }, 500);
                        } else {
                            console.log('Not a one-time service or no payment data');
                        }
                    });
                }
                

                
                // Add Contract Modal Event Listeners
                const addContractBtn = document.getElementById('add-contract-btn');
                if (addContractBtn) {
                    addContractBtn.addEventListener('click', function() {
                        console.log('Add contract button clicked');
                        const modal = document.getElementById('add-contract-modal');
                        if (modal) {
                            modal.classList.remove('hidden');
                            resetAddContractForm();
                            console.log('Add contract modal opened');
                        } else {
                            console.error('Add contract modal not found');
                        }
                    });
                }
                
                // Close add contract modal
                const closeAddContractModal = document.getElementById('close-add-contract-modal');
                const cancelAddContract = document.getElementById('cancel-add-contract');
                
                if (closeAddContractModal) {
                    closeAddContractModal.addEventListener('click', function() {
                        const modal = document.getElementById('add-contract-modal');
                        if (modal) {
                            modal.classList.add('hidden');
                        }
                    });
                }
                
                if (cancelAddContract) {
                    cancelAddContract.addEventListener('click', function() {
                        const modal = document.getElementById('add-contract-modal');
                        if (modal) {
                            modal.classList.add('hidden');
                        }
                    });
                }
                
                // Service type change handler
                const serviceTypeSelect = document.getElementById('contract-service-type');
                const serviceDetailSelect = document.getElementById('contract-service-detail');
                const serviceDetailsContainer = document.getElementById('service-details-container');
                
                if (serviceTypeSelect) {
                    serviceTypeSelect.addEventListener('change', function() {
                        const selectedType = this.value;
                        updateServiceOptions(selectedType);
                        updateServiceDetailsVisibility(selectedType);
                        
                        // Clear prices when service type changes
                        console.log('Service type changed to:', selectedType);
                        
                        const contractUnitPrice = document.getElementById('contract-unit-price');
                        if (contractUnitPrice) {
                            contractUnitPrice.value = '';
                            console.log('Cleared contract unit price due to service type change');
                        }
                        
                        const oneTimeUnitPrice = document.getElementById('one-time-unit-price');
                        if (oneTimeUnitPrice) {
                            oneTimeUnitPrice.value = '';
                            console.log('Cleared one-time unit price due to service type change');
                        }
                        
                        validateForm(); // Re-validate when service type changes
                    });
                }
                
                // Service detail change handler
                if (serviceDetailSelect) {
                    serviceDetailSelect.addEventListener('change', function() {
                        console.log('Service detail changed:', this.value);
                        
                        // Auto-fill unit price when service is selected
                        if (this.value) {
                            const selectedOption = this.querySelector(`option[value="${this.value}"]`);
                            if (selectedOption && selectedOption.dataset.price) {
                                const price = selectedOption.dataset.price;
                                const unit = selectedOption.dataset.unit;
                                
                                console.log('Auto-filling price:', price, 'unit:', unit);
                                
                                // Fill unit price for recurring services
                                const contractUnitPrice = document.getElementById('contract-unit-price');
                                if (contractUnitPrice) {
                                    // Format price with commas
                                    const formattedPrice = parseInt(price.replace(/[^\d]/g, '')).toLocaleString('vi-VN');
                                    contractUnitPrice.value = formattedPrice;
                                    console.log('Filled contract unit price:', formattedPrice);
                                }
                                
                                // Fill unit price for one-time services
                                const oneTimeUnitPrice = document.getElementById('one-time-unit-price');
                                if (oneTimeUnitPrice) {
                                    // Format price with commas
                                    const formattedPrice = parseInt(price.replace(/[^\d]/g, '')).toLocaleString('vi-VN');
                                    oneTimeUnitPrice.value = formattedPrice;
                                    console.log('Filled one-time unit price:', formattedPrice);
                                }
                                
                                // Fill unit for recurring services
                                const contractUnit = document.getElementById('contract-unit');
                                if (contractUnit) {
                                    // Map unit to select options
                                    const unitMap = {
                                        'month': 'Tháng',
                                        'time': 'Lần',
                                        'kg': 'Kg',
                                        'm3': 'm³'
                                    };
                                    
                                    // Find matching option
                                    for (let i = 0; i < contractUnit.options.length; i++) {
                                        const option = contractUnit.options[i];
                                        if (option.value === unit || option.textContent.includes(unit)) {
                                            contractUnit.selectedIndex = i;
                                            console.log('Filled contract unit:', unit);
                                            break;
                                        }
                                    }
                                }
                            }
                        } else {
                            // Clear prices when no service is selected
                            console.log('No service selected, clearing prices');
                            
                            const contractUnitPrice = document.getElementById('contract-unit-price');
                            if (contractUnitPrice) {
                                contractUnitPrice.value = '';
                                console.log('Cleared contract unit price');
                            }
                            
                            const oneTimeUnitPrice = document.getElementById('one-time-unit-price');
                            if (oneTimeUnitPrice) {
                                oneTimeUnitPrice.value = '';
                                console.log('Cleared one-time unit price');
                            }
                        }
                        
                        updateContractSummary();
                        validateForm(); // Re-validate when service changes
                    });
                }
                
                // Date change handlers
                const startDateInput = document.getElementById('contract-start-date');
                const endDateInput = document.getElementById('contract-end-date');
                const noEndDateCheckbox = document.getElementById('contract-no-end-date');
                
                if (startDateInput) {
                    startDateInput.addEventListener('change', function() {
                        console.log('Start date changed:', this.value);
                        updateContractSummary();
                        validateForm();
                    });
                }
                
                if (endDateInput) {
                    endDateInput.addEventListener('change', updateContractSummary);
                }
                
                if (noEndDateCheckbox) {
                    noEndDateCheckbox.addEventListener('change', function() {
                        if (this.checked) {
                            endDateInput.disabled = true;
                            endDateInput.value = '';
                        } else {
                            endDateInput.disabled = false;
                        }
                        updateContractSummary();
                    });
                }
                
                // One-time service price and quantity handlers
                const oneTimeUnitPrice = document.getElementById('one-time-unit-price');
                const oneTimeQuantity = document.getElementById('one-time-quantity');
                
                if (oneTimeUnitPrice) {
                    oneTimeUnitPrice.addEventListener('input', function() {
                        console.log('One-time unit price changed:', this.value);
                        // Format the input as currency
                        let value = this.value.replace(/[^\d]/g, '');
                        if (value) {
                            value = parseInt(value).toLocaleString('vi-VN');
                            this.value = value;
                        }
                        updateContractSummary();
                        validateForm();
                    });
                }
                
                if (oneTimeQuantity) {
                    oneTimeQuantity.addEventListener('input', function() {
                        console.log('One-time quantity changed:', this.value);
                        updateContractSummary();
                        validateForm();
                    });
                }
                
                // Test calculation button
                const testCalcBtn = document.getElementById('test-calc');
                if (testCalcBtn) {
                    testCalcBtn.addEventListener('click', function() {
                        console.log('=== Test calculation button clicked ===');
                        updateContractSummary();
                        validateForm();
                    });
                }
                
                // Test success button
                const testSuccessBtn = document.getElementById('test-success');
                if (testSuccessBtn) {
                    testSuccessBtn.addEventListener('click', function() {
                        console.log('=== Test success button clicked ===');
                        showSuccess('Đây là thông báo test thành công!', 'Test Thành công');
                    });
                }
                
                // Test submit button
                const testSubmitBtn = document.getElementById('test-submit');
                if (testSubmitBtn) {
                    testSubmitBtn.addEventListener('click', function() {
                        console.log('=== Test submit button clicked ===');
                        
                        // Fill in some test data
                        const customerSelect = document.getElementById('contract-customer-select');
                        const addressInput = document.getElementById('contract-address');
                        const serviceTypeSelect = document.getElementById('contract-service-type');
                        const serviceDetailSelect = document.getElementById('contract-service-detail');
                        const startDateInput = document.getElementById('contract-start-date');
                        
                        if (customerSelect) customerSelect.value = 'KH001';
                        if (addressInput) addressInput.value = '123 Test Street';
                        if (serviceTypeSelect) serviceTypeSelect.value = 'recurring';
                        if (serviceDetailSelect) serviceDetailSelect.value = 'waste-collection';
                        if (startDateInput) startDateInput.value = '2024-01-01';
                        
                        // Trigger validation
                        validateForm();
                        
                        // Try to submit
                        setTimeout(() => {
                            console.log('Attempting to submit form...');
                            handleContractSubmission();
                        }, 100);
                    });
                }
                
                // Test notification modal directly
                const testNotificationBtn = document.getElementById('test-notification');
                if (testNotificationBtn) {
                    testNotificationBtn.addEventListener('click', function() {
                        console.log('=== Test notification modal directly ===');
                        showSuccess('Test thông báo thành công!', 'Test Modal');
                    });
                }
                
                // Test simple alert as fallback
                const testAlertBtn = document.getElementById('test-alert');
                if (testAlertBtn) {
                    testAlertBtn.addEventListener('click', function() {
                        console.log('=== Test alert fallback ===');
                        alert('Test alert - nếu thấy thông báo này thì JS hoạt động bình thường');
                    });
                }
                
                // Test simple modal
                const testSimpleModalBtn = document.getElementById('test-simple-modal');
                if (testSimpleModalBtn) {
                    testSimpleModalBtn.addEventListener('click', function() {
                        console.log('=== Test simple modal ===');
                        if (window.createSimpleModal) {
                            window.createSimpleModal('Test Thành công', 'Đây là test modal đơn giản!\n\nNếu thấy modal này thì có thể tạo modal mới.', function() {
                                console.log('Simple modal callback executed');
                            });
                        } else {
                            console.log('createSimpleModal function not found');
                        }
                    });
                }
                
                // Reset price buttons
                const resetContractPriceBtn = document.getElementById('reset-contract-price');
                if (resetContractPriceBtn) {
                    resetContractPriceBtn.addEventListener('click', function() {
                        console.log('=== Reset contract price clicked ===');
                        const serviceDetailSelect = document.getElementById('contract-service-detail');
                        if (serviceDetailSelect && serviceDetailSelect.value) {
                            const selectedOption = serviceDetailSelect.querySelector(`option[value="${serviceDetailSelect.value}"]`);
                            if (selectedOption && selectedOption.dataset.price) {
                                const price = selectedOption.dataset.price;
                                const formattedPrice = parseInt(price.replace(/[^\d]/g, '')).toLocaleString('vi-VN');
                                const contractUnitPrice = document.getElementById('contract-unit-price');
                                if (contractUnitPrice) {
                                    contractUnitPrice.value = formattedPrice;
                                    console.log('Reset contract price to default:', formattedPrice);
                                    updateContractSummary();
                                }
                            }
                        }
                    });
                }
                
                const resetOneTimePriceBtn = document.getElementById('reset-one-time-price');
                if (resetOneTimePriceBtn) {
                    resetOneTimePriceBtn.addEventListener('click', function() {
                        console.log('=== Reset one-time price clicked ===');
                        const serviceDetailSelect = document.getElementById('contract-service-detail');
                        if (serviceDetailSelect && serviceDetailSelect.value) {
                            const selectedOption = serviceDetailSelect.querySelector(`option[value="${serviceDetailSelect.value}"]`);
                            if (selectedOption && selectedOption.dataset.price) {
                                const price = selectedOption.dataset.price;
                                const formattedPrice = parseInt(price.replace(/[^\d]/g, '')).toLocaleString('vi-VN');
                                const oneTimeUnitPrice = document.getElementById('one-time-unit-price');
                                if (oneTimeUnitPrice) {
                                    oneTimeUnitPrice.value = formattedPrice;
                                    console.log('Reset one-time price to default:', formattedPrice);
                                    updateContractSummary();
                                }
                            }
                        }
                    });
                }
                
                // Test payment modal
                const testPaymentModalBtn = document.getElementById('test-payment-modal');
                if (testPaymentModalBtn) {
                    testPaymentModalBtn.addEventListener('click', function() {
                        console.log('=== Test payment modal clicked ===');
                        
                        // Create test payment data
                        const testPaymentData = {
                            code: 'KH001',
                            name: 'Nguyễn Văn An',
                            address: '123 Test Street, TP. HCM',
                            totalDebt: '6.000.000 ₫',
                            serviceType: 'one-time',
                            contractData: {
                                customer: 'KH001',
                                serviceType: 'one-time',
                                serviceDetail: 'DV004'
                            }
                        };
                        
                        console.log('Test payment data:', testPaymentData);
                        
                        if (window.openPaymentModal) {
                            window.openPaymentModal(testPaymentData);
                        } else {
                            console.error('openPaymentModal function not found');
                        }
                    });
                }
                
                // Debug modal elements
                const debugModalBtn = document.getElementById('debug-modal');
                if (debugModalBtn) {
                    debugModalBtn.addEventListener('click', function() {
                        console.log('=== Debug modal button clicked ===');
                        if (window.debugModalElements) {
                            window.debugModalElements();
                        } else {
                            console.log('debugModalElements function not found');
                        }
                    });
                }
                
                // Form submission
                const addContractForm = document.getElementById('add-contract-form');
                if (addContractForm) {
                    addContractForm.addEventListener('submit', function(e) {
                        e.preventDefault();
                        console.log('Form submitted');
                        handleContractSubmission();
                    });
                }
                
                // Direct button click handler for save contract button
                const saveContractBtn = document.getElementById('save-contract');
                if (saveContractBtn) {
                    saveContractBtn.addEventListener('click', function(e) {
                        e.preventDefault();
                        console.log('Save contract button clicked directly');
                        
                        // Check if button is disabled
                        if (this.disabled) {
                            console.log('Save button is disabled, cannot proceed');
                            showWarning('Vui lòng điền đầy đủ thông tin bắt buộc', 'Thiếu thông tin');
                            return;
                        }
                        
                        // Call the submission handler
                        handleContractSubmission();
                    });
                }
                
                // Customer addresses database
                const customerAddresses = {
                    'KH001': [
                        '123 Lê Lợi, P. Bến Nghé, Q.1, TP. Hồ Chí Minh',
                        '456 Nguyễn Huệ, P. Bến Nghé, Q.1, TP. Hồ Chí Minh'
                    ],
                    'KH002': [
                        '789 Trần Hưng Đạo, P. Cầu Kho, Q.1, TP. Hồ Chí Minh'
                    ],
                    'KH003': [
                        '321 Võ Văn Tần, P.6, Q.3, TP. Hồ Chí Minh',
                        '654 Lý Tự Trọng, P. Bến Thành, Q.1, TP. Hồ Chí Minh'
                    ],
                    'KH004': [
                        '987 Điện Biên Phủ, P. Đa Kao, Q.1, TP. Hồ Chí Minh'
                    ],
                    'KH005': [
                        '147 Hai Bà Trưng, P. Đa Kao, Q.1, TP. Hồ Chí Minh'
                    ]
                };
                
                // Add real-time validation for form fields
                const requiredFields = [
                    'contract-customer-select',
                    'contract-address', 
                    'contract-service-type',
                    'contract-service-detail',
                    'contract-start-date'
                ];
                
                // Dynamic required fields based on service type
                function getRequiredFields() {
                    const serviceType = document.getElementById('contract-service-type')?.value;
                    let fields = [...requiredFields];
                    
                    if (serviceType === 'one-time') {
                        fields.push('one-time-unit-price', 'one-time-quantity');
                    }
                    
                    return fields;
                }
                
                // Handle customer selection change
                const customerSelect = document.getElementById('contract-customer-select');
                if (customerSelect) {
                    customerSelect.addEventListener('change', function() {
                        console.log('Customer selected:', this.value);
                        updateCustomerAddresses(this.value);
                        validateForm();
                    });
                }
                
                // Handle address selection
                const addressInput = document.getElementById('contract-address');
                if (addressInput) {
                    addressInput.addEventListener('input', function() {
                        console.log('Address input:', this.value);
                        validateForm();
                    });
                }
                
                // Handle add new address button
                const addNewAddressBtn = document.getElementById('add-new-address');
                if (addNewAddressBtn) {
                    addNewAddressBtn.addEventListener('click', function() {
                        console.log('Add new address clicked');
                        const addressInput = document.getElementById('contract-address');
                        if (addressInput) {
                            addressInput.value = '';
                            addressInput.focus();
                            hideCustomerAddresses();
                        }
                    });
                }
                
                // Handle other required fields
                const otherRequiredFields = requiredFields.filter(fieldId => 
                    fieldId !== 'contract-customer-select' && fieldId !== 'contract-address'
                );
                
                otherRequiredFields.forEach(fieldId => {
                    const field = document.getElementById(fieldId);
                    if (field) {
                        field.addEventListener('change', function() {
                            console.log(`Required field ${fieldId} changed:`, this.value);
                            validateForm();
                        });
                        field.addEventListener('input', function() {
                            console.log(`Required field ${fieldId} input:`, this.value);
                            validateForm();
                        });
                    }
                });
                
                // Function to update customer addresses
                function updateCustomerAddresses(customerId) {
                    console.log('=== updateCustomerAddresses called ===', customerId);
                    
                    const addressInput = document.getElementById('contract-address');
                    const customerAddressesDiv = document.getElementById('customer-addresses');
                    const addressList = document.getElementById('address-list');
                    
                    if (!addressInput || !customerAddressesDiv || !addressList) {
                        console.error('Address elements not found');
                        return;
                    }
                    
                    if (!customerId) {
                        hideCustomerAddresses();
                        addressInput.value = '';
                        return;
                    }
                    
                    const addresses = customerAddresses[customerId] || [];
                    console.log('Available addresses for customer:', addresses);
                    
                    if (addresses.length === 0) {
                        hideCustomerAddresses();
                        addressInput.value = '';
                        return;
                    }
                    
                    // Show addresses container
                    customerAddressesDiv.classList.remove('hidden');
                    
                    // Clear existing addresses
                    addressList.innerHTML = '';
                    
                    // Add address options
                    addresses.forEach((address, index) => {
                        const addressOption = document.createElement('div');
                        addressOption.className = 'flex items-center p-2 bg-gray-50 rounded border cursor-pointer hover:bg-gray-100 transition-colors';
                        addressOption.innerHTML = `
                            <input type="radio" name="selected-address" value="${address}" class="mr-2" ${index === 0 ? 'checked' : ''}>
                            <span class="text-sm text-gray-700">${address}</span>
                        `;
                        
                        // Add click event
                        addressOption.addEventListener('click', function() {
                            const radio = this.querySelector('input[type="radio"]');
                            radio.checked = true;
                            addressInput.value = address;
                            hideCustomerAddresses();
                            validateForm();
                        });
                        
                        addressList.appendChild(addressOption);
                    });
                    
                    // Auto-select first address
                    if (addresses.length > 0) {
                        addressInput.value = addresses[0];
                        console.log('Auto-selected first address:', addresses[0]);
                    }
                }
                
                // Function to hide customer addresses
                function hideCustomerAddresses() {
                    const customerAddressesDiv = document.getElementById('customer-addresses');
                    if (customerAddressesDiv) {
                        customerAddressesDiv.classList.add('hidden');
                    }
                }
                
                function validateForm() {
                    console.log('=== validateForm called ===');
                    const saveButton = document.getElementById('save-contract');
                    if (!saveButton) {
                        console.error('Save button not found');
                        return;
                    }
                    
                    let isValid = true;
                    const currentRequiredFields = getRequiredFields();
                    
                    console.log('Checking required fields:', currentRequiredFields);
                    
                    currentRequiredFields.forEach(fieldId => {
                        const field = document.getElementById(fieldId);
                        const fieldValue = field ? field.value.trim() : '';
                        console.log(`Field ${fieldId}:`, fieldValue);
                        
                        if (field && !fieldValue) {
                            isValid = false;
                            console.log('Missing required field:', fieldId);
                        }
                    });
                    
                    console.log('Form validation result:', isValid);
                    console.log('Save button current state:', saveButton.disabled);
                    
                    const wasDisabled = saveButton.disabled;
                    saveButton.disabled = !isValid;
                    
                    if (isValid) {
                        saveButton.classList.remove('opacity-50', 'cursor-not-allowed');
                        saveButton.classList.add('hover:bg-blue-700');
                        console.log('Save button enabled');
                        
                        // If button was just enabled, ensure it has click handler
                        if (wasDisabled && !saveButton.hasAttribute('data-click-handler-added')) {
                            console.log('Adding click handler to newly enabled save button');
                            saveButton.setAttribute('data-click-handler-added', 'true');
                        }
                    } else {
                        saveButton.classList.add('opacity-50', 'cursor-not-allowed');
                        saveButton.classList.remove('hover:bg-blue-700');
                        console.log('Save button disabled');
                    }
                }
                // Function to open payment modal from contract detail
                function openPaymentFromContract(customerName = 'Nguyễn Văn An', contractId = 'HD001') {
                    console.log('Opening payment modal from contract detail for:', customerName, contractId);
                    
                    // Prepare customer data
                    const customerData = {
                        code: contractId,
                        name: customerName,
                        address: '123 Lê Lợi, P. Bến Nghé, TP. Hồ Chí Minh',
                        totalDebt: '105.000 ₫'
                    };
                    
                    // Open payment modal with customer data
                    if (window.openPaymentModal) {
                        window.openPaymentModal(customerData);
                        console.log('Payment modal opened from contract detail');
                    } else {
                        console.error('openPaymentModal function not found');
                        showNotification('Lỗi: Không thể mở modal thanh toán', 'error');
                    }
                }
                
                // Contract actions dropdown functionality
                const contractActionsDropdown = document.getElementById('contract-actions-dropdown');
                const contractActionsMenu = document.getElementById('contract-actions-menu');
                
                if (contractActionsDropdown && contractActionsMenu) {
                    contractActionsDropdown.addEventListener('click', function(e) {
                        e.preventDefault();
                        e.stopPropagation();
                        contractActionsMenu.classList.toggle('hidden');
                        
                        // Toggle dropdown arrow
                        const arrow = this.querySelector('.fa-chevron-down');
                        if (arrow) {
                            arrow.classList.toggle('rotate-180');
                        }
                    });
                    
                    // Close dropdown when clicking outside
                    document.addEventListener('click', function(e) {
                        if (!contractActionsDropdown.contains(e.target) && !contractActionsMenu.contains(e.target)) {
                            contractActionsMenu.classList.add('hidden');
                            const arrow = contractActionsDropdown.querySelector('.fa-chevron-down');
                            if (arrow) {
                                arrow.classList.remove('rotate-180');
                            }
                        }
                    });
                }
                
                // Add event listeners for payment buttons in contract detail
                const collectPaymentFromContractBtn = document.getElementById('collect-payment-from-contract');
                const collectPaymentFromPaymentsTabBtn = document.getElementById('collect-payment-from-payments-tab');
                
                if (collectPaymentFromContractBtn) {
                    collectPaymentFromContractBtn.addEventListener('click', function(e) {
                        e.preventDefault();
                        console.log('Collect payment from contract header clicked');
                        openPaymentFromContract();
                        
                        // Close dropdown after action
                        if (contractActionsMenu) {
                            contractActionsMenu.classList.add('hidden');
                            const arrow = contractActionsDropdown?.querySelector('.fa-chevron-down');
                            if (arrow) {
                                arrow.classList.remove('rotate-180');
                            }
                        }
                    });
                }
                
                if (collectPaymentFromPaymentsTabBtn) {
                    collectPaymentFromPaymentsTabBtn.addEventListener('click', function(e) {
                        e.preventDefault();
                        console.log('Collect payment from payments tab clicked');
                        openPaymentFromContract();
                    });
                }
                
                // Add event listener for payment modal close button (alternative ID)
                const paymentModalCloseBtn = document.getElementById('payment-modal-close');
                if (paymentModalCloseBtn) {
                    paymentModalCloseBtn.addEventListener('click', function() {
                        if (window.closePaymentModal) {
                            window.closePaymentModal();
                        } else {
                            const paymentModal = document.getElementById('payment-modal');
                            if (paymentModal) {
                                paymentModal.classList.add('hidden');
                            }
                        }
                    });
                }
            });
        </script>
    </body>
</html>